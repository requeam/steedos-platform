function module(e,t){"use strict";var n=e("./scatter_series"),r=n.chart,i=n.polar,s=e("../../core/utils/object"),a=e("../../core/utils/extend").extend,o=e("../../core/utils/iterator").each,l=e("../core/utils"),u=l.normalizeAngle,h="discrete",c=l.map,p=a,_=o;function g(e,t,n,r){var i=s.clone(e);return i.x=t,i.y=n,i.angle=r,i}function m(e,t,n,r,i){var s=e.angle+i,a=l.getCosAndSin(s),o,u;return g(t,n.x+(e.radius+r*i)*a.cos,n.y-(e.radius+r*i)*a.sin,s)}t.chart={},t.polar={};var f={_applyGroupSettings:function(e,t,n){var r=this;t=p(t,e),this._applyElementsClipRect(t),n.attr(t)},_setGroupsSettings:function(e){var t=this,n=this._styles.normal;this._applyGroupSettings(n.elements,{class:"dxc-elements"},this._elementsGroup),this._bordersGroup&&this._applyGroupSettings(n.border,{class:"dxc-borders"},this._bordersGroup),r._setGroupsSettings.call(this,e),e&&this._markersGroup&&this._markersGroup.attr({opacity:.001})},_createGroups:function(){var e=this;this._createGroup("_elementsGroup",this,this._group),this._areBordersVisible()&&this._createGroup("_bordersGroup",this,this._group),r._createGroups.call(this)},_areBordersVisible:function(){return!1},_getDefaultSegment:function(e){return{line:c(e.line||[],(function(e){return e.getDefaultCoords()}))}},_prepareSegment:function(e){return{line:e}},_parseLineOptions:function(e,t){return{stroke:e.color||t,"stroke-width":e.width,dashStyle:e.dashStyle||"solid"}},_parseStyle:function(e,t){return{elements:this._parseLineOptions(e,t)}},_applyStyle:function(e){var t=this;this._elementsGroup&&this._elementsGroup.attr(e.elements),_(this._graphics||[],(function(t,n){n.line&&n.line.attr({"stroke-width":e.elements["stroke-width"]}).sharp()}))},_drawElement:function(e,t){return{line:this._createMainElement(e.line,{"stroke-width":this._styles.normal.elements["stroke-width"]}).append(t)}},_removeElement:function(e){e.line.remove()},_updateElement:function(e,t,n,r){var i={points:t.line},s=e.line;n?s.animate(i,{},r):s.attr(i)},_animateComplete:function(){var e=this;r._animateComplete.call(this),this._markersGroup&&this._markersGroup.animate({opacity:1},{duration:this._defaultDuration})},_animate:function(){var e=this,t=e._graphics.length-1;_(e._graphics||[],(function(n,r){var i;n===t&&(i=function(){e._animateComplete()}),e._updateElement(r,e._segments[n],!0,i)}))},_drawPoint:function(e){r._drawPoint.call(this,{point:e.point,groups:e.groups})},_createMainElement:function(e,t){return this._renderer.path(e,"line").attr(t).sharp()},_sortPoints:function(e,t){return t?e.sort((function(e,t){return t.y-e.y})):e.sort((function(e,t){return e.x-t.x}))},_drawSegment:function(e,t,n,r){var i=this,s=this._options.rotated,a=!1,o=this._prepareSegment(e,s,r);this._segments.push(o),this._graphics[n]?t||this._updateElement(this._graphics[n],o):this._graphics[n]=this._drawElement(t?this._getDefaultSegment(o):o,this._elementsGroup)},_getTrackerSettings:function(){var e=this,t=this._defaultTrackerWidth,n=this._styles.normal.elements["stroke-width"];return{"stroke-width":n>t?n:t,fill:"none"}},_getMainPointsFromSegment:function(e){return e.line},_drawTrackerElement:function(e){return this._createMainElement(this._getMainPointsFromSegment(e),this._getTrackerSettings(e))},_updateTrackerElement:function(e,t){var n=this._getTrackerSettings(e);n.points=this._getMainPointsFromSegment(e),t.attr(n)}},d=t.chart.line=p({},r,f);t.chart.stepline=p({},d,{_calculateStepLinePoints:function(e){var t=[];return _(e,(function(e,n){var r,i;e?((r=t[t.length-1].y)!==n.y&&((i=s.clone(n)).y=r,t.push(i)),t.push(n)):t.push(n)})),t},_prepareSegment:function(e){return d._prepareSegment(this._calculateStepLinePoints(e))}}),t.chart.spline=p({},d,{_calculateBezierPoints:function(e,t){var n=[],r=e,i=function(e,t,n){return e>t&&n>e||e<t&&n<e?e:n};return 1!==r.length?r.forEach((function(e,s){var a,o,l,u,h,c,p,_,m,f,d,y,S,v,x,G,k,w,E,P=r[s-1],M=r[s+1],T=.5;if(s&&s!==r.length-1){if(h=e.x,c=e.y,p=P.x,_=M.x,m=P.y,f=M.y,d=!!(!t&&(c<=P.y&&c<=M.y||c>=P.y&&c>=M.y)||t&&(h<=P.x&&h<=M.x||h>=P.x&&h>=M.x)))t?(l=a=h,u=(c+M.y)/2,o=(c+P.y)/2):(u=o=c,l=(h+M.x)/2,a=(h+P.x)/2);else{if(v=f-m,x=p-_,G=m*_-p*f,t){if(!v)return void n.push(e,e,e);p-=E=(k=-1*(x*(w=c)+G)/v)-h,_-=E}else{if(!x)return void n.push(e,e,e);m-=E=(w=-1*(v*(k=h)+G)/x)-c,f-=E}l=(h+.5*_)/1.5,u=(c+.5*f)/1.5,a=(h+.5*p)/1.5,o=(c+.5*m)/1.5}t?(a=i(P.x,h,a),l=i(M.x,h,l)):(o=i(P.y,c,o),u=i(M.y,c,u)),y=g(e,a,o),S=g(e,l,u),n.push(y,e,S)}else n.push(e,e)})):n.push(r[0]),n},_prepareSegment:function(e,t){return d._prepareSegment(this._calculateBezierPoints(e,t))},_createMainElement:function(e,t){return this._renderer.path(e,"bezier").attr(t).sharp()}}),t.polar.line=p({},i,f,{_sortPoints:function(e){return e},_prepareSegment:function(e,t,n){var r,i=[],s=this.getValueAxis().getCenter();if(n&&this._closeSegment(e),this.argumentAxisType===h||this.valueAxisType===h)return d._prepareSegment.call(this,e);for(r=1;r<e.length;r++)i=i.concat(this._getTangentPoints(e[r],e[r-1],s));return i.length||(i=e),{line:i}},_getRemainingAngle:function(e){var t=u(e);return e>=0?360-t:-t},_closeSegment:function(e){var t,n;t=this._segments.length?this._segments[0].line[0]:g(e[0],e[0].x,e[0].y,e[0].angle),e[e.length-1].angle!==t.angle&&(u(Math.round(e[e.length-1].angle))===u(Math.round(t.angle))?t.angle=e[e.length-1].angle:(n=e[e.length-1].angle-t.angle,t.angle=e[e.length-1].angle+this._getRemainingAngle(n)),e.push(t))},_getTangentPoints:function(e,t,n){var r,i=[],s=Math.round(t.angle-e.angle),a=(t.radius-e.radius)/s;if(0===s)i=[t,e];else if(s>0)for(r=s;r>=0;r--)i.push(m(e,t,n,a,r));else for(r=0;r>=s;r--)i.push(m(e,t,n,a,s-r));return i}})}

