function module(t,i,e){"use strict";var r=t("../../../core/utils/extend").extend,s=t("../../../core/utils/iterator").each,a=t("../../../core/utils/common").noop,n=t("../../../core/utils/window"),o=n.getWindow(),h=t("./label"),l=r,u=t("../../../core/utils/type").isDefined,c=t("../../core/utils").normalizeEnum,g=Math,_=g.round,d=g.floor,p=g.ceil,m=20,f=20,b=10,v="canvas_position_default";function y(t){return[-t,-t,t,-t,t,t,-t,t,-t,-t]}function x(t){var i=p(t);return[-i,0,0,-i,i,0,0,i,-i,0]}function V(t){var i=p(t),e=d(i/2),r=p(i/2);return[-i,-e,-e,-i,0,-r,e,-i,i,-e,r,0,i,e,e,i,0,r,-e,i,-i,e,-r,0]}function w(t){return[-t,-t,t,-t,0,t,-t,-t]}function B(t){return[-t,t,t,t,0,-t,-t,t]}e.exports={deleteLabel:function(){this._label.dispose(),this._label=null},_hasGraphic:function(){return this.graphic},clearVisibility:function(){var t=this,i=this.graphic;i&&i.attr("visibility")&&i.attr({visibility:null})},isVisible:function(){return this.inVisibleArea&&this.series.isVisible()},setInvisibility:function(){var t=this,i=this.graphic;i&&"hidden"!==i.attr("visibility")&&i.attr({visibility:"hidden"}),this._errorBar&&this._errorBar.attr({visibility:"hidden"}),this._label.draw(!1)},clearMarker:function(){var t=this.graphic;t&&t.attr(this._emptySettings)},_createLabel:function(){this._label=new h.Label({renderer:this.series._renderer,labelsGroup:this.series._labelsGroup,point:this})},_updateLabelData:function(){this._label.setData(this._getLabelFormatObject())},_updateLabelOptions:function(){!this._label&&this._createLabel(),this._label.setOptions(this._options.label)},_checkImage:function(t){return u(t)&&("string"==typeof t||u(t.url))},_fillStyle:function(){this._styles=this._options.styles},_checkSymbol:function(t,i){var e=t.symbol,r=i.symbol,s="circle"===e&&"circle"!==r||"circle"!==e&&"circle"===r,a=this._checkImage(t.image)!==this._checkImage(i.image);return!(!s&&!a)},_populatePointShape:function(t,i){switch(t){case"square":return y(i);case"polygon":return x(i);case"triangle":case"triangleDown":return w(i);case"triangleUp":return B(i);case"cross":return V(i)}},hasCoords:function(){return null!==this.x&&null!==this.y},correctValue:function(t){var i=this;this.hasValue()&&(this.value=this.properValue=this.initialValue+t,this.minValue=t)},resetCorrection:function(){this.value=this.properValue=this.initialValue,this.minValue=v},resetValue:function(){var t=this;this.hasValue()&&(this.value=this.properValue=this.initialValue=0,this.minValue=0,this._label.setDataField("value",this.value))},_getTranslates:function(t){var i=this.x,e=this.y;return t&&(this._options.rotated?i=this.defaultX:e=this.defaultY),{x:i,y:e}},_createImageMarker:function(t,i,e){var r=e.width||20,s=e.height||20;return t.image(-_(.5*r),-_(.5*s),r,s,e.url?e.url.toString():e.toString(),"center").attr({translateX:i.translateX,translateY:i.translateY,visibility:i.visibility})},_createSymbolMarker:function(t,i){var e,r=this._options.symbol;return"circle"===r?(delete i.points,e=t.circle().attr(i)):"square"!==r&&"polygon"!==r&&"triangle"!==r&&"triangleDown"!==r&&"triangleUp"!==r&&"cross"!==r||(e=t.path([],"area").attr(i).sharp()),e},_createMarker:function(t,i,e,r){var s=this,a=this._checkImage(e)?this._createImageMarker(t,r,e):this._createSymbolMarker(t,r);return a&&a.data({"chart-data-point":this}).append(i),a},_getSymbolBBox:function(t,i,e){return{x:t-e,y:i-e,width:2*e,height:2*e}},_getImageBBox:function(t,i){var e=this._options.image,r=e.width||20,s=e.height||20;return{x:t-_(r/2),y:i-_(s/2),width:r,height:s}},_getGraphicBBox:function(){var t,i=this,e=this._options,r=this.x,s=this.y;return t=e.visible?this._checkImage(e.image)?this._getImageBBox(r,s):this._getSymbolBBox(r,s,e.styles.normal.r):{x:r,y:s,width:0,height:0}},hideInsideLabel:a,_getShiftLabelCoords:function(t){var i=this._addLabelAlignmentAndOffset(t,this._getLabelCoords(t));return this._checkLabelPosition(t,i)},_drawLabel:function(){var t=this,i=this._getCustomLabelVisibility(),e=this._label,r=this._showForZeroValues()&&this.hasValue()&&!1!==i&&(this.series.getLabelVisibility()||i);e.draw(!!r)},correctLabelPosition:function(t){var i=this,e=this._getShiftLabelCoords(t);this.hideInsideLabel(t,e)||(t.setFigureToDrawConnector(this._getLabelConnector(t.pointPosition)),t.shift(_(e.x),_(e.y)))},_showForZeroValues:function(){return!0},_getLabelConnector:function(t){var i=this._getGraphicBBox(t),e=i.width/2,r=i.height/2;return{x:i.x+e,y:i.y+r,r:this._options.visible?Math.max(e,r):0}},_getPositionFromLocation:function(){return{x:this.x,y:this.y}},_isPointInVisibleArea:function(t,i){return t.minX<=i.x+i.width&&t.maxX>=i.x&&t.minY<=i.y+i.height&&t.maxY>=i.y},_checkLabelPosition:function(t,i){var e=this,r=this._getVisibleArea(),s=t.getBoundingRect(),a=this._getGraphicBBox(t.pointPosition),n=10;return this._isPointInVisibleArea(r,a)&&(this._options.rotated?(r.minX>i.x&&(i.x=a.x+a.width+10),r.maxX<i.x+s.width&&(i.x=a.x-10-s.width),r.minY>i.y&&(i.y=r.minY),r.maxY<i.y+s.height&&(i.y=r.maxY-s.height)):(r.minX>i.x&&(i.x=r.minX),r.maxX<i.x+s.width&&(i.x=r.maxX-s.width),r.minY>i.y&&(i.y=a.y+a.height+10),r.maxY<i.y+s.height&&(i.y=a.y-s.height-10))),i},_addLabelAlignmentAndOffset:function(t,i){var e=t.getBoundingRect(),r=t.getLayoutOptions();return this._options.rotated||("left"===r.alignment?i.x+=e.width/2:"right"===r.alignment&&(i.x-=e.width/2)),i.x+=r.horizontalOffset,i.y+=r.verticalOffset,i},_getLabelCoords:function(t){return this._getLabelCoordOfPosition(t,this._getLabelPosition(t.pointPosition))},_getLabelCoordOfPosition:function(t,i){var e=this,r=t.getBoundingRect(),s=this._getGraphicBBox(t.pointPosition),a=10,n=s.height/2-r.height/2,o=s.width/2-r.width/2,h=s.x,l=s.y;switch(i){case"left":h-=r.width+10,l+=n;break;case"right":h+=s.width+10,l+=n;break;case"top":h+=o,l-=r.height+10;break;case"bottom":h+=o,l+=s.height+10;break;case"inside":h+=o,l+=n}return{x:h,y:l}},_drawMarker:function(t,i,e){var r=this,s=this._options,a=this._getTranslates(e),n=this._getStyle();this.graphic=this._createMarker(t,i,s.image,l({translateX:a.x,translateY:a.y,points:this._populatePointShape(s.symbol,n.r)},n))},_getErrorBarSettings:function(){return{visibility:"visible"}},_getErrorBarBaseEdgeLength:function(){return 2*this.getPointRadius()},_drawErrorBar:function(t,i){if(this._options.errorBars){var e,r=this,a=this._options,n=a.errorBars,o=[],h=this._errorBarPos,l=this._highErrorCoord,g=this._lowErrorCoord,_=c(n.displayMode),p="high"===_,m="low"===_,f=(p||!u(g))&&u(l)&&!m,b=(m||!u(l))&&u(g)&&!p,v=n.edgeLength;v<=1&&v>0&&(v=this._getErrorBarBaseEdgeLength()*n.edgeLength),v=d(parseInt(v)/2),f&&(g=this._baseErrorBarPos),b&&(l=this._baseErrorBarPos),"none"!==_&&u(l)&&u(g)&&u(h)?(!b&&o.push([h-v,l,h+v,l]),o.push([h,l,h,g]),!f&&o.push([h+v,g,h-v,g]),a.rotated&&s(o,(function(t,i){i.reverse()})),e=this._getErrorBarSettings(n),this._errorBar?(e.points=o,this._errorBar.attr(e)):this._errorBar=t.path(o,"line").attr(e).append(i)):this._errorBar&&this._errorBar.attr({visibility:"hidden"})}},getTooltipParams:function(){var t=this,i=this.graphic;return{x:this.x,y:this.y,offset:i?i.getBBox().height/2:0}},setPercentValue:function(t,i,e,r){var s=this,a=this.value/t||0,n=this.minValue/t||0,o=a-n;this._label.setDataField("percent",o),this._label.setDataField("total",i),this.series.isFullStackedSeries()&&this.hasValue()&&(this.leftHole&&(this.leftHole/=t-e,this.minLeftHole/=t-e),this.rightHole&&(this.rightHole/=t-r,this.minRightHole/=t-r),this.value=this.properValue=a,this.minValue=n||this.minValue)},_storeTrackerR:function(){var t,i=this,e=o.navigator,r=this._options.styles.normal.r;return t=n.hasProperty("ontouchstart")||e.msPointerEnabled&&e.msMaxTouchPoints||e.pointerEnabled&&e.maxTouchPoints?20:6,this._options.trackerR=r<t?t:r,this._options.trackerR},_translateErrorBars:function(){var t=this,i=this._options,e=i.rotated,r=i.errorBars,s=this._getValTranslator();r&&(u(this.lowError)&&(this._lowErrorCoord=s.translate(this.lowError)),u(this.highError)&&(this._highErrorCoord=s.translate(this.highError)),this._errorBarPos=d(e?this.vy:this.vx),this._baseErrorBarPos="stdDeviation"===r.type?this._lowErrorCoord+(this._highErrorCoord-this._lowErrorCoord)/2:e?this.vx:this.vy)},_translate:function(){var t=this,i=this._getValTranslator(),e=this._getArgTranslator();this._options.rotated?(this.vx=this.x=i.translate(this.value),this.vy=this.y=e.translate(this.argument),this.minX=i.translate(this.minValue),this.defaultX=i.translate(v)):(this.vy=this.y=i.translate(this.value),this.vx=this.x=e.translate(this.argument),this.minY=i.translate(this.minValue),this.defaultY=i.translate(v)),this._translateErrorBars(),this._calculateVisibility(this.x,this.y)},_updateData:function(t){var i=this;this.value=this.properValue=this.initialValue=this.originalValue=t.value,this.minValue=this.initialMinValue=this.originalMinValue=u(t.minValue)?t.minValue:v},_getImageSettings:function(t){return{href:t.url||t.toString(),width:t.width||20,height:t.height||20}},getCrosshairData:function(){var t=this,i=this._options.rotated,e=this.properValue,r=this.argument;return{x:this.vx,y:this.vy,xValue:i?e:r,yValue:i?r:e,axis:this.series.axis}},getPointRadius:function(){var t,i=this._getStyle(),e=this._options,r=i.r,s=e.symbol,a="square"===s,n="triangle"===s||"triangleDown"===s||"triangleUp"===s;return e.visible&&!e.image&&r?(a||n?1.4*r:r)+(t=i["stroke-width"]/2):0},_updateMarker:function(t,i){var e,r=this,s=this._options,a=s.image,n=this.isVisible()?{}:{visibility:"hidden"};e=this._checkImage(a)?l({},{visibility:i.visibility},n,this._getImageSettings(a)):l({},i,n,{points:this._populatePointShape(s.symbol,i.r)}),t||(e.translateX=this.x,e.translateY=this.y),this.graphic.attr(e).sharp()},_getLabelFormatObject:function(){var t=this;return{argument:this.initialArgument,value:this.initialValue,originalArgument:this.originalArgument,originalValue:this.originalValue,seriesName:this.series.name,lowErrorValue:this.lowError,highErrorValue:this.highError,point:this}},_getLabelPosition:function(){var t=this._options.rotated;return this.initialValue>0?t?"right":"top":t?"left":"bottom"},_getFormatObject:function(t){var i=this,e=this._label.getData();return l({},e,{argumentText:t.formatValue(this.initialArgument,"argument"),valueText:t.formatValue(this.initialValue)},u(e.percent)?{percentText:t.formatValue(e.percent,"percent")}:{},u(e.total)?{totalText:t.formatValue(e.total)}:{})},getMarkerVisibility:function(){return this._options.visible},coordsIn:function(t,i){var e=this._storeTrackerR();return t>=this.x-e&&t<=this.x+e&&i>=this.y-e&&i<=this.y+e},getMinValue:function(){var t=this._options.errorBars;if(t){var i=t.displayMode,e="high"===i?this.value:this.lowError,r="low"===i?this.value:this.highError;return e<r?e:r}return this.value},getMaxValue:function(){var t=this._options.errorBars;if(t){var i=t.displayMode,e="high"===i?this.value:this.lowError,r="low"===i?this.value:this.highError;return e>r?e:r}return this.value}}}

