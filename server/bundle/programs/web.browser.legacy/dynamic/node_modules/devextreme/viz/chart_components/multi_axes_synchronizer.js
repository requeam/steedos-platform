function module(e,a,n){"use strict";var i=e("../../core/utils/console"),t=e("../../core/utils/type"),u=e("../../core/utils/iterator"),l=e("../core/utils"),r=e("../../core/utils/math"),s=Math,o=s.floor,c=s.max,V=s.abs;function m(e){var a={};return e.forEach((function(e){var n=e.pane;a[n]||(a[n]=[]),a[n].push(e)})),a}var f={transform:function(e,a){return(0,r.adjust)((0,l.getLog)(e,a))},addInterval:function(e,a){return(0,r.adjust)(e+a)},getInterval:function(e,a){return a}},d={transform:function(e,a){return(0,r.adjust)((0,l.raiseTo)(e,a))},addInterval:function(e,a){return(0,r.adjust)(e*a)},getInterval:function(e,a){return s.pow(e,a)}};function v(e,a){if(e.isLogarithmic){var n,i,t=e.logarithmicBase,u=e.tickValues,l=[];for(e.minValue=a.transform(e.minValue,t),e.oldMinValue=a.transform(e.oldMinValue,t),e.maxValue=a.transform(e.maxValue,t),e.oldMaxValue=a.transform(e.oldMaxValue,t),e.tickInterval=s.round(e.tickInterval),e.tickInterval<1&&(e.tickInterval=1),i=a.getInterval(t,e.tickInterval),n=a.transform(u[0],t);l.length<u.length;)l.push(n),n=a.addInterval(n,i);l.tickInterval=e.tickInterval,e.tickValues=l}}function h(e){return e.reduce((function(e,a){var n,i=a.getTicksValues(),u=i.majorTicksValues,l=a.getOptions(),r=a.getTranslator().getBusinessRange(),s=r.minVisible,o=r.maxVisible,c=a._tickInterval,m=l.synchronizedValue;return!(u&&u.length>0&&(0,t.isNumeric)(u[0])&&"discrete"!==l.type)||r.isEmpty()||r.breaks&&r.breaks.length||"zoom"===a.getViewport().action||(s===o&&(0,t.isDefined)(m)&&(c=V(u[0]-m)||1,s=u[0]-c,o=u[0]+c),v(n={axis:a,isLogarithmic:"logarithmic"===l.type,logarithmicBase:r.base,tickValues:u,minorValues:i.minorTicksValues,minorTickInterval:a._minorTickInterval,minValue:s,oldMinValue:s,maxValue:o,oldMaxValue:o,inverted:r.invert,tickInterval:c,synchronizedValue:m},f),e.push(n)),e}),[])}function k(e){var a=e.reduce((function(e,a){return c(e,a.tickValues.length)}),0);e.forEach((function(e){var n,i,u=0,l=e.synchronizedValue,s=e.tickValues,c=e.tickInterval;if((0,t.isDefined)(l))e.baseTickValue=e.invertedBaseTickValue=l,e.tickValues=[e.baseTickValue];else{if(s.length>1&&c){for(i=(n=o((a+1)/s.length))>1?o((a+1)/n):a,u=o((i-s.length)/2);u>0&&0!==s[0];)s.unshift((0,r.adjust)(s[0]-c)),u--;for(;s.length<i;)s.push((0,r.adjust)(s[s.length-1]+c));e.tickInterval=c/n}e.baseTickValue=s[0],e.invertedBaseTickValue=s[s.length-1]}}))}function x(e){return e.maxValue-e.minValue||1}function g(e){for(var a=0;a<e.length;a++)if(!e[a].stubData)return e[a];return null}function I(e){var a=g(e),n=a.tickInterval;e.forEach((function(e){var i,u,l,r;e!==a&&(n&&e.tickInterval&&(e.stubData&&(0,t.isDefined)(e.synchronizedValue)&&(e.oldMinValue=e.minValue=e.baseTickValue-(a.baseTickValue-a.minValue)/n*e.tickInterval,e.oldMaxValue=e.maxValue=e.baseTickValue-(a.baseTickValue-a.maxValue)/n*e.tickInterval),i=n/x(a)/e.tickInterval*x(e),e.maxValue=e.minValue+x(e)/i),l=a.inverted&&!e.inverted||!a.inverted&&e.inverted?a.maxValue-a.invertedBaseTickValue:a.baseTickValue-a.minValue,r=x(e),u=(l/x(a)-(e.baseTickValue-e.minValue)/r)*r,e.minValue-=u,e.maxValue-=u)}))}function T(e){var a,n,i=0,t=0;return e.forEach((function(e){var u=e.inverted;a=e.minValue>e.oldMinValue?(e.minValue-e.oldMinValue)/x(e):0,n=e.maxValue<e.oldMaxValue?(e.oldMaxValue-e.maxValue)/x(e):0,i=c(i,u?n:a),t=c(t,u?a:n)})),{start:i,end:t}}function b(e,a){e.forEach((function(e){var n=x(e),i=e.inverted;e.minValue=(0,r.adjust)(e.minValue-a[i?"end":"start"]*n),e.maxValue=(0,r.adjust)(e.maxValue+a[i?"start":"end"]*n)}))}function p(e){var a=!1;e.forEach((function(e){a=a||(0,t.isDefined)(e.synchronizedValue)})),e.forEach((function(e){var n,i=e.tickInterval,t=e.tickValues,u=e.maxValue,l=e.minValue;if(a&&i){for(;(n=(0,r.adjust)(t[0]-i))>=l;)t.unshift(n);for(n=t[t.length-1];(n=(0,r.adjust)(n+i))<=u;)t.push(n)}for(;t[0]<l;)t.shift();for(;t[t.length-1]>u;)t.pop()}))}function M(e){e.forEach((function(e){var a=e.axis,n=a.getTranslator().getBusinessRange();n.min===n.minVisible&&(n.min=e.minValue),n.max===n.maxVisible&&(n.max=e.maxValue),n.minVisible=e.minValue,n.maxVisible=e.maxValue,n.min>n.minVisible&&(n.min=n.minVisible),n.max<n.maxVisible&&(n.max=n.maxVisible),a.getTranslator().updateBusinessRange(n),a.setTicks({majorTicks:e.tickValues,minorTicks:e.minorValues})}))}function E(e){var a,n=[];e.forEach((function(e){e.oldMaxValue-e.oldMinValue==0?n.push(e):(0,t.isDefined)(a)||(0,t.isDefined)(e.synchronizedValue)||(a=V((e.maxValue-e.minValue)/(e.tickValues[o(e.tickValues.length/2)]-e.minValue||e.maxValue)))})),(0,t.isDefined)(a)&&n.forEach((function(e){var n=e.tickValues[0],i=n*a;n>0?(e.maxValue=i,e.minValue=0):n<0&&(e.minValue=i,e.maxValue=0)}))}function j(e){e.forEach((function(e){if(e.minorTickInterval){for(var a=[],n=e.minorTickInterval,i=e.tickInterval/n-1,t=1;t<e.tickValues.length;t++)for(var u=e.tickValues[t-1],l=0;l<i;l++)u+=n,a.push(u);e.minorValues=a}}))}var y={synchronize:function(e){(0,u.each)(m(e),(function(e,a){var n,i;if(a.length>1){if((n=h(a)).length<2||!g(n))return;k(n),I(n),b(n,i=T(n)),E(n),p(n),j(n),n.forEach((function(e){v(e,d)})),M(n)}}))}};n.exports=y}

