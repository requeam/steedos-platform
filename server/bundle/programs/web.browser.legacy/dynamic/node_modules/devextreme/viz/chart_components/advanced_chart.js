function module(e,i){"use strict";var s=e("../../core/utils/extend").extend,t=e("../../core/utils/array").inArray,n=e("../../core/utils/iterator"),a=e("../translators/range"),r="defaultAxisName",o=e("../axes/base_axis"),u=e("../core/series_family"),p=e("./base_chart").BaseChart,l=e("./crosshair"),c=Array.isArray,h=e("../../core/utils/type").isDefined,g=n.each,d=n.reverseEach,_=e("../../core/utils/common").noop,x=s,f=e("../core/utils"),A=f.map,m=f.mergeMarginOptions;function v(e){return c(e)?0===e.length?[{}]:e:[e]}function b(e,i){return e.processBubbleSize&&(e.size=i),e}function S(e,i,s,t){var n=t?e.width/i:e.width,a=t?e.height:e.height/i;return Math.min(n,a)*s}var O=p.inherit({_setDeprecatedOptions:function(){this.callBase.apply(this,arguments),x(this._deprecatedOptions,{barWidth:{since:"18.1",message:"Use the 'commonSeriesSettings.barPadding' or 'series.barPadding' option instead"},equalBarWidth:{since:"18.1",message:"Use the 'commonSeriesSettings.ignoreEmptyPoints' or 'series.ignoreEmptyPoints' option instead"}})},_dispose:function(){var e=this,i=this._disposeObjectsInArray;this.callBase(),this.panes=null,this._legend&&(this._legend.dispose(),this._legend=null),i.call(this,"panesBackground"),i.call(this,"seriesFamilies"),this._disposeAxes()},_reinitAxes:function(){this.panes=this._createPanes(),this._populateAxes(),this._axesReinitialized=!0},_getCrosshairMargins:function(){var e=this._getCrosshairOptions()||{},i=e.enabled,s=l.getMargins();return{x:i&&e.horizontalLine.visible?s.x:0,y:i&&e.verticalLine.visible?s.y:0}},_populateAxes:function(){var e=this,i=e.panes,s=e._isRotated(),n=v(e.option("argumentAxis")||{})[0],a=e.option("valueAxis"),o=v(a||{}),u=[],p=[],l=[],h=0,d=void 0,_=e._getCrosshairMargins();function x(){return r+h++}d=s?"right"===n.position?i[i.length-1].name:i[0].name:"top"===n.position?i[0].name:i[i.length-1].name,u=A(i,(function(i){var t=i.name!==d;return e._populateAxesOptions("argumentAxis",n,{pane:i.name,name:null,optionPath:"argumentAxis",crosshairMargin:s?_.x:_.y},s,t)})),g(o,(function(i,n){var r=[],o=n.name;o&&-1!==t(o,l)?e._incidentOccurred("E2102"):(o&&l.push(o),n.pane&&r.push(n.pane),n.panes&&n.panes.length&&(r=r.concat(n.panes.slice(0))),(r=f.unique(r)).length||r.push(void 0),g(r,(function(t,r){var u=c(a)?"valueAxis["+i+"]":"valueAxis";p.push(e._populateAxesOptions("valueAxis",n,{name:o||x(),pane:r,priority:i,optionPath:u,crosshairMargin:s?_.y:_.x},s))})))})),e._redesignAxes(u,!0,d),e._redesignAxes(p,!1)},_redesignAxes:function(e,i,s){var t=this,n=[],a=i?t._argumentAxes:t._valueAxes;g(e,(function(e,i){var s=a&&a.filter((function(e){return e.name===i.name&&(!h(i.pane)&&t.panes.some((function(i){return i.name===e.pane}))||e.pane===i.pane)}));s&&s.length>0?g(s,(function(e,s){s.updateOptions(i),n.push({axis:s})})):n.push({options:i})})),a?d(a,(function(e,s){n.some((function(e){return e.axis&&e.axis===s}))||t._disposeAxis(e,i)})):a=i?t._argumentAxes=[]:t._valueAxes=[],g(n,(function(e,n){var r=n.axis;n.axis&&i?n.axis.isVirtual=n.axis.pane!==s:n.options&&(r=t._createAxis(i,n.options,i?n.options.pane!==s:void 0,i?e:void 0),a.push(r)),r.applyVisualRangeSetter(t._getVisualRangeSetter())}))},_disposeAxis:function(e,i){var s=i?this._argumentAxes:this._valueAxes,t=s[e];t&&(t.dispose(),s.splice(e,1))},_prepareStackPoints:function(e,i){var s=e.getPoints(),t=e.getStackName();g(s,(function(e,s){var n=s.argument;i[n]||(i[n]={},i[n].null=[]),t&&!c(i[n][t])&&(i[n][t]=[],g(i[n].null,(function(e,s){s.stackName||i[n][t].push(s)}))),t?(i[n][t].push(s),i[n].null.push(s)):g(i[n],(function(e,i){i.push(s)})),s.stackPoints=i[n][t],s.stackName=t}))},_resetStackPoints:function(e){g(e.getPoints(),(function(e,i){i.stackPoints=null,i.stackName=null}))},_disposeAxes:function(){var e=this,i=this._disposeObjectsInArray;i.call(this,"_argumentAxes"),i.call(this,"_valueAxes")},_appendAdditionalSeriesGroups:function(){this._crosshairCursorGroup.linkAppend(),this._scrollBar&&this._scrollBarGroup.linkAppend()},_getLegendTargets:function(){var e=this;return A(e.series,(function(i){return i.getOptions().showInLegend?e._getLegendOptions(i):null}))},_legendItemTextField:"name",_seriesPopulatedHandlerCore:function(){this._processSeriesFamilies(),this._processValueAxisFormat()},_renderTrackers:function(){var e,i=this;for(e=0;e<this.series.length;++e)this.series[e].drawTrackers()},_specialProcessSeries:function(){this._processSeriesFamilies()},_processSeriesFamilies:function(){var e,i=this,s=[],n=[],a=i._themeManager,r=a.getOptions("negativesAsZeroes"),o=a.getOptions("negativesAsZeros"),p={equalBarWidth:a.getOptions("equalBarWidth"),minBubbleSize:a.getOptions("minBubbleSize"),maxBubbleSize:a.getOptions("maxBubbleSize"),barWidth:a.getOptions("barWidth"),barGroupPadding:a.getOptions("barGroupPadding"),barGroupWidth:a.getOptions("barGroupWidth"),negativesAsZeroes:h(r)?r:o};i.seriesFamilies&&i.seriesFamilies.length?g(i.seriesFamilies,(function(e,i){i.updateOptions(p),i.adjustSeriesValues()})):(g(i.series,(function(e,i){-1===t(i.type,s)&&s.push(i.type)})),g(i._getLayoutTargets(),(function(t,a){e=i._getSeriesForPane(a.name),g(s,(function(s,t){var r=new u.SeriesFamily({type:t,pane:a.name,equalBarWidth:p.equalBarWidth,minBubbleSize:p.minBubbleSize,maxBubbleSize:p.maxBubbleSize,barWidth:p.barWidth,barGroupPadding:p.barGroupPadding,barGroupWidth:p.barGroupWidth,negativesAsZeroes:p.negativesAsZeroes,rotated:i._isRotated()});r.add(e),r.adjustSeriesValues(),n.push(r)}))})),i.seriesFamilies=n)},_updateSeriesDimensions:function(){var e,i=this,s=this.seriesFamilies||[];for(e=0;e<s.length;e++){var t=s[e];t.updateSeriesValues(),t.adjustSeriesDimensions()}},_getLegendCallBack:function(e){return this._legend&&this._legend.getActionCallback(e)},_appendAxesGroups:function(){var e=this;this._stripsGroup.linkAppend(),this._gridGroup.linkAppend(),this._axesGroup.linkAppend(),this._constantLinesGroup.linkAppend(),this._labelAxesGroup.linkAppend(),this._scaleBreaksGroup.linkAppend()},_populateMarginOptions:function(){var e=this,i=S(e.getSize(),e.panes.length,e._themeManager.getOptions("maxBubbleSize"),e._isRotated()),s={};e._valueAxes.forEach((function(t){var n=e.series.filter((function(e){return e.getValueAxis()===t})),a={};n.forEach((function(e){if(e.isVisible()){var t=b(e.getMarginOptions(),i);a=m(a,t),s=m(s,t)}})),t.setMarginOptions(a)})),e._argumentAxes.forEach((function(e){return e.setMarginOptions(s)}))},_populateBusinessRange:function(e){var i=this,s=i._isRotated(),t=new a.Range({rotated:!!s}),n=i._getVisibleSeries();i._valueAxes.forEach((function(r){var o=new a.Range({rotated:!!s,pane:r.pane,axis:r.name}),u=n.filter((function(e){return e.getValueAxis()===r}));u.forEach((function(e){var i=e.getRangeData();o.addRange(i.val),t.addRange(i.arg)})),(!e||e&&u.length&&r===e)&&(r.setGroupSeries(u),r.setBusinessRange(o,i._axesReinitialized,i._argumentAxes[0]._lastVisualRangeUpdateMode))})),(!e||e&&n.length)&&i._argumentAxes.forEach((function(e){return e.setBusinessRange(t,i._axesReinitialized)})),i._populateMarginOptions()},getArgumentAxis:function(){return(this._argumentAxes||[]).filter((function(e){return!e.isVirtual}))[0]},getValueAxis:function(e){var i=this;return(this._valueAxes||[]).filter(h(e)?function(i){return i.name===e}:function(e){return e.pane===i.defaultPane})[0]},_getGroupsData:function(){var e=this,i=[];return e._valueAxes.forEach((function(s){i.push({series:e.series.filter((function(e){return e.getValueAxis()===s})),valueAxis:s,valueOptions:s.getOptions()})})),{groups:i,argumentAxes:e._argumentAxes,argumentOptions:e._argumentAxes[0].getOptions()}},_groupSeries:function(){var e=this;this._correctValueAxes(!1),this._groupsData=this._getGroupsData()},_processValueAxisFormat:function(){var e=[];this.series.forEach((function(i){var s=i.getValueAxis();i.isFullStackedSeries()&&(s.setPercentLabelFormat(),e.push(s))})),this._valueAxes.forEach((function(i){-1===e.indexOf(i)&&i.resetAutoLabelFormat()}))},_populateAxesOptions:function(e,i,s,t,n){var a=this,r=this._prepareStripsAndConstantLines(e,i,t),o=x(!0,{},r,s,this._prepareAxisOptions(e,r,t));return n&&(o.visible=o.tick.visible=o.minorTick.visible=o.label.visible=!1,o.title={}),o},_createAxis:function(e,i,s,t){var n=this,a=e?"argumentAxis":"valueAxis",r=x({renderer:this._renderer,incidentOccurred:this._incidentOccurred,eventTrigger:this._eventTrigger,axisClass:e?"arg":"val",widgetClass:"dxc",stripsGroup:this._stripsGroup,labelAxesGroup:this._labelAxesGroup,constantLinesGroup:this._constantLinesGroup,scaleBreaksGroup:this._scaleBreaksGroup,axesContainerGroup:this._axesGroup,gridGroup:this._gridGroup,isArgumentAxis:e},this._getAxisRenderingOptions(a)),u=new o.Axis(r);return u.updateOptions(i),u.isVirtual=s,u},_getVisualRangeSetter:_,_getTrackerSettings:function(){return x(this.callBase(),{argumentAxis:this.getArgumentAxis()})},_prepareStripsAndConstantLines:function(e,i,s){return(i=this._themeManager.getOptions(e,i,s)).strips&&g(i.strips,(function(e){i.strips[e]=x(!0,{},i.stripStyle,i.strips[e])})),i.constantLines&&g(i.constantLines,(function(e,s){i.constantLines[e]=x(!0,{},i.constantLineStyle,s)})),i},_legendDataField:"series",_adjustSeriesLabels:_,_correctValueAxes:_,refresh:function(){this._disposeAxes(),this.callBase()},_notify:function(){this._axesReinitialized=!1}});i.AdvancedChart=O}

