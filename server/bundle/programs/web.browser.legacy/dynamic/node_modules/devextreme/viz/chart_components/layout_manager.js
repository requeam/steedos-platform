function module(t,e){"use strict";var i=t("../../core/utils/extend").extend,o=t("../core/layout_element"),n=t("../../core/utils/type").isNumeric,r=Math.min,h=Math.max,a=Math.floor,u=Math.sqrt,s=t("../components/consts"),c=s.radialLabelIndent;function d(t,e,i){var o;return o=i<t?t:e<i?e:i}function l(t){if(t._label.isVisible()&&"inside"!==t._label.getLayoutOptions().position)return t._label.getBoundingRect()}function f(t,e,i,o,n){return t.some((function(t){return t.getVisiblePoints().reduce((function(t,a){var u=l(a);if(u){var s=d(u.x,u.x+u.width,e),f=d(u.y,u.y+u.height,i);o=r(h(w(s,f,e,i)-c,n),o),t=!0}return t}),!1)})),o}function p(t){return t.reduce((function(t,e){var i=e.getVisiblePoints().reduce((function(t,e){var i=l(e);return i&&i.width>t&&(t=i.width),t}),0),o=i;return i&&(t.outerLabelsCount++,t.outerLabelsCount>1&&(i+=s.pieLabelSpacing),o+=s.pieLabelSpacing),t.sizes.push(i),t.rSizes.push(o),t.common+=i,t}),{sizes:[],rSizes:[],common:0,outerLabelsCount:0})}function g(t,e,i,o,n,r){var h,u,s=0,c=t.sizes,d=t.rSizes;for(u=0;u<i.length;u++)0!==c[u]?(h=a(h?h+d[u-1]:e),i[u].correctLabelRadius(h),s+=n||c[u],d[u]=n||d[u],i[u].setVisibleArea({left:a(r-e-s),right:a(o.width-(r+e+s)),top:o.top,bottom:o.bottom,width:o.width,height:o.height})):h&&(h+=d[u-1])}function w(t,e,i,o){return u((t-i)*(t-i)+(e-o)*(e-o))}function m(t){var e;return e="pie"===t.type?0:(e=(e=n(t.innerRadius)?Number(t.innerRadius):.5)<.2?.2:e)>.8?.8:e}var v={left:"right",right:"left",top:"bottom",bottom:"top",center:"center"};function b(t,e){t[e.cutLayoutSide]+="horizontal"===e.cutSide?e.width:e.height}function y(t,e){var i=t.cutLayoutSide,o={horizontal:0,vertical:0};switch(i){case"top":case"left":o[t.cutSide]=-e[i];break;case"bottom":case"right":o[t.cutSide]=e[i]}return o}function L(){}function S(t){return new o.WrapperLayoutElement(null,{x:t.left,y:t.top,width:t.width-t.left-t.right,height:t.height-t.top-t.bottom})}function _(t,e,i,o){return(t-e-c-i.left)/o.outerLabelsCount}function z(t,e,i){return t-e.left-(i.outerLabelsCount>0?i.common+c:0)}function E(t,e,i,o,n,h){var a,u=p(i),s=z(n,e,u);return s<o?a=_(n,t=o,e,u):t=r(f(i,n,h,t,o),s),g(u,t+c,i,e,a,n),t}L.prototype={constructor:L,setOptions:function(t){this._options=t},applyPieChartSeriesLayout:function(t,e,i){var o,h,u=t.height-t.top-t.bottom,s=t.width-t.left-t.right,c=s/2+t.left,d=u/2+t.top,l=this._options.piePercentage;return n(l)?o=h=l*r(t.height,t.width)/2:(o=r(s,u)/2,h=this._options.minPiePercentage*o),i||(o=E(o,t,e,h,c,d)),{centerX:a(c),centerY:a(d),radiusInner:a(o*m(e[0])),radiusOuter:a(o)}},applyEqualPieChartLayout:function(t,e){var i=e.radius;return{centerX:a(e.x),centerY:a(e.y),radiusInner:a(i*m(t[0])),radiusOuter:a(i)}},correctPieLabelRadius:function(t,e,i){var o=p(t),n,r=e.radiusOuter+c,h=e.centerX-i.left-r;o.common+c>h&&(n=_(e.centerX,e.radiusOuter,i,o)),g(o,r,t,i,n,e.centerX)},needMoreSpaceForPanesCanvas:function(t,e){var i=this._options,o=i.width,a=i.height,u=i.piePercentage,s=n(u),c=0,d=0;return t.forEach((function(t){var i=t.canvas,n=s?r(i.width,i.height)*u:void 0,l=(s?n:o)-(i.width-i.left-i.right),f=(s?n:a)-(i.height-i.top-i.bottom);e?(c+=l>0?l:0,d=h(f>0?f:0,d)):(c=h(l>0?l:0,c),d+=f>0?f:0)})),(c>0||d>0)&&{width:c,height:d}},layoutElements:function(t,e,i,o,n){this._elements=t,this._probeDrawing(e),this._drawElements(e),i(),this._processAdaptiveLayout(o,n,e,i),this._positionElements(e)},_processAdaptiveLayout:function(t,e,o,n){var r=this,h=this.needMoreSpaceForPanesCanvas(t,e),a=this._elements;function u(t,e,i){t.getLayoutOptions()[i]||(o[e.cutLayoutSide]-=e[i],h[i]=h[i]-e[i])}h&&(a.slice().reverse().forEach((function(t){var e,n,r=t.getLayoutOptions(),a=!1;if(r){if(e=i({},r),a="vertical"===r.cutSide&&h.width<0||"horizontal"===r.cutSide&&h.height<0||"vertical"===r.cutSide&&h.height>0||"horizontal"===r.cutSide&&h.width>0,n="horizontal"===r.cutSide?"width":"height",a){var s=e.width-h.width,c=e.height-h.height;"height"===n&&h.width<0&&(s=o.width-o.left-o.right),"width"===n&&h.height<0&&(c=o.height-o.top-o.bottom),t.draw(s,c)}u(t,r,n)}})),n(h))},_probeDrawing:function(t){var e=this;this._elements.forEach((function(i){var o,n=i.getLayoutOptions();n&&(o={width:t.width-t.left-t.right,height:t.height-t.top-t.bottom},"vertical"===n.cutSide?o.height-=e._options.height:o.width-=e._options.width,i.probeDraw(o.width,o.height),b(t,i.getLayoutOptions()))}))},_drawElements:function(t){this._elements.slice().reverse().forEach((function(e){var i,o,n,r=e.getLayoutOptions();r&&((i={width:t.width-t.left-t.right,height:t.height-t.top-t.bottom})[n="horizontal"===(o=r.cutSide)?"width":"height"]=r[n],e.draw(i.width,i.height))}))},_positionElements:function(t){var e={left:0,right:0,top:0,bottom:0};this._elements.slice().reverse().forEach((function(i){var o,n,r,h=i.getLayoutOptions();h&&(o=h.position,n=h.cutSide,(r={horizontal:o.horizontal,vertical:o.vertical})[n]=v[r[n]],i.position({of:S(t),my:r,at:o,offset:y(h,e)}),e[h.cutLayoutSide]+=h["horizontal"===h.cutSide?"width":"height"])}))}},e.LayoutManager=L}

