function module(e,t){"use strict";var i=e("../../core/renderer"),o=e("../../core/utils/window").getWindow(),r=e("../../core/dom_adapter"),n=e("../../events/core/events_engine"),s=e("../../events/click"),h=e("../../core/utils/extend").extend,a=e("../../core/utils/iterator").each,l=e("../components/consts"),u=l.events,_=e("../core/utils"),c=e("../../events/pointer"),d=e("../../events/hold"),v=e("../../events/utils").addNamespace,g=e("../../core/devices"),p=e("../../core/utils/type").isDefined,f=e("../core/utils").normalizeEnum,m=Math.floor,S=a,T=e("../../core/utils/common").noop,H=l.states.hoverMark,P=l.states.normalMark,A="dxChartTracker",k="."+A,C=v([c.down,c.move],A),O="legendClick",x="seriesClick",y="pointClick",b="chart-data-point",w="chart-data-series",M="chart-data-argument",I=100,L="none",E="allargumentpoints",B="includepoints",D="excludepoints",N=[B,"excludepoints",L];function R(e,t){var i=e.target;return("tspan"===i.tagName?i.parentNode:i)[t]}function V(e,t){return e.cancel||!t.getOptions()}function K(e,t,i){return t>=e.left&&t<=e.right&&i>=e.top&&i<=e.bottom}function G(e){return N.indexOf(e)>-1?e:B}function z(e){var t=e.getOptions().hoverMode;return t===L?t:E}var F={ctor:function(e){var t=this,i={tracker:this};this._renderer=e.renderer,this._legend=e.legend,this._tooltip=e.tooltip,this._eventTrigger=e.eventTrigger,this._seriesGroup=e.seriesGroup,e.seriesGroup.off(k).on(v(u.showPointTooltip,A),i,this._showPointTooltip).on(v(u.hidePointTooltip,A),i,this._hidePointTooltip),this._renderer.root.off(k).on(C,i,this._pointerHandler).on(v(s.name,A),i,this._clickHandler).on(v(d.name,A),{timeout:300},T)},update:function(e){this._prepare()},updateSeries:function(e,t){var i=this,o=!(e&&e.some((function(e){return e===i.hoveredSeries}))||i._hoveredPoint&&i._hoveredPoint.series);i._storedSeries!==e&&(i._storedSeries=e||[]),o&&(i._clean(),i._renderer.initHatching()),t&&(i.clearSelection(),o||(i._hideTooltip(i.pointAtShownTooltip),i.clearHover()))},setCanvases:function(e,t){this._mainCanvas=e,this._canvases=t},repairTooltip:function(){var e=this.pointAtShownTooltip;e&&e.series&&e.isVisible()?this._showTooltip(e):this._hideTooltip(e,!0)},_prepare:function(){this._toggleParentsScrollSubscription(!0)},_toggleParentsScrollSubscription:function(e){var t=i(this._renderer.root.element).parents(),r=v("scroll",A);"generic"===g.real().platform&&(t=t.add(o)),this._proxiedTargetParentsScrollHandler=this._proxiedTargetParentsScrollHandler||function(){this._pointerOut()}.bind(this),n.off(i().add(this._$prevRootParents),r,this._proxiedTargetParentsScrollHandler),e&&(n.on(t,r,this._proxiedTargetParentsScrollHandler),this._$prevRootParents=t)},_setHoveredPoint:function(e){e!==this._hoveredPoint&&(this._releaseHoveredPoint(),e.hover(),this._hoveredPoint=e)},_releaseHoveredPoint:function(){this._hoveredPoint&&this._hoveredPoint.getOptions()&&(this._hoveredPoint.clearHover(),this._hoveredPoint=null,this._tooltip.isEnabled()&&this._hideTooltip(this._hoveredPoint))},_setHoveredSeries:function(e,t){this._releaseHoveredSeries(),this._releaseHoveredPoint(),e.hover(t),this.hoveredSeries=e},_releaseHoveredSeries:function(e,t){this.hoveredSeries&&(this.hoveredSeries.clearHover(),this.hoveredSeries=null)},clearSelection:function(){this._storedSeries.forEach((function(e){e&&(e.clearSelection(),e.getPoints().forEach((function(e){e.clearSelection()})))}))},_clean:function(){var e=this;this.hoveredPoint=this.hoveredSeries=this._hoveredArgumentPoints=null,this._hideTooltip(this.pointAtShownTooltip)},clearHover:function(){this._resetHoveredArgument(),this._releaseHoveredSeries(),this._releaseHoveredPoint()},_hideTooltip:function(e,t){var i=this;!this._tooltip||e&&this.pointAtShownTooltip!==e||(!t&&this.pointAtShownTooltip&&(this.pointAtShownTooltip=null),this._tooltip.hide())},_showTooltip:function(e){var t,i,o=this;if(e&&e.getOptions()){if(t=e.getTooltipFormatObject(this._tooltip),!p(t.valueText)&&!t.points||!e.isVisible())return;this.pointAtShownTooltip&&this.pointAtShownTooltip===e||(i={target:e});var r=e.getTooltipParams(this._tooltip.getLocation()),n=this._renderer.getRootOffset();if(r.x+=n.left,r.y+=n.top,!this._tooltip.show(t,r,i))return;this.pointAtShownTooltip=e}},_showPointTooltip:function(e,t){var i=e.data.tracker,o=i.pointAtShownTooltip;o&&o!==t&&i._hideTooltip(o),i._showTooltip(t)},_hidePointTooltip:function(e,t){e.data.tracker._hideTooltip(t)},_enableOutHandler:function(){if(!this._outHandler){var e=this,t=function(t){var i=e._renderer.getRootOffset(),o=m(t.pageX-i.left),r=m(t.pageY-i.top);K(e._mainCanvas,o,r)||(e._pointerOut(),e._disableOutHandler())};n.on(r.getDocument(),C,t),this._outHandler=t}},_disableOutHandler:function(){this._outHandler&&n.off(r.getDocument(),C,this._outHandler),this._outHandler=null},stopCurrentHandling:function(){this._pointerOut()},_pointerOut:function(){this.clearHover(),this._tooltip.isEnabled()&&this._hideTooltip(this.pointAtShownTooltip)},_triggerLegendClick:function(e,t){var i=this._eventTrigger;i(O,e,(function(){!V(e.event,e.target)&&i(t,e)}))},_hoverLegendItem:function(e,t){var i,o=this,r=this._legend.getItemByCoord(e,t),n=G(this._legend.getOptions().hoverMode);r?((i=this._storedSeries[r.id]).isHovered()&&i.lastHoverMode===n||this._setHoveredSeries(i,n),this._tooltip.isEnabled()&&this._hideTooltip(this.pointAtShownTooltip)):this.clearHover()},_hoverArgument:function(e,t){var i=this,o=this._getArgumentHoverMode();p(e)&&(this._releaseHoveredPoint(),this._hoveredArgument=e,this._argumentIndex=t,this._notifySeries({action:"pointHover",notifyLegend:this._notifyLegendOnHoverArgument,target:{argument:e,fullState:H,argumentIndex:t,getOptions:function(){return{hoverMode:o}}}}))},_resetHoveredArgument:function(){var e,t=this;p(this._hoveredArgument)&&(e=this._getArgumentHoverMode(),this._notifySeries({action:"clearPointHover",notifyLegend:this._notifyLegendOnHoverArgument,target:{fullState:P,argumentIndex:this._argumentIndex,argument:this._hoveredArgument,getOptions:function(){return{hoverMode:e}}}}),this._hoveredArgument=null)},_notifySeries:function(e){this._storedSeries.forEach((function(t){t.notify(e)}))},_pointerHandler:function(e){var t=e.data.tracker,i=t._renderer.getRootOffset(),o=m(e.pageX-i.left),r=m(e.pageY-i.top),n=t._getCanvas(o,r),s=R(e,w),h=R(e,b)||s&&s.getPointByCoord(o,r);if(h&&!h.getMarkerVisibility()&&(h=void 0),t._enableOutHandler(),t._legend.coordsIn(o,r))t._hoverLegendItem(o,r);else if(t.hoveredSeries&&t.hoveredSeries!==t._stuckSeries&&t._releaseHoveredSeries(),!t._hoverArgumentAxis(o,r,e)&&(t._isPointerOut(n,h)&&t._pointerOut(),n||h)){if(s&&!h){if(h=s.getNeighborPoint(o,r),s!==t.hoveredSeries)return void t._setTimeout((function(){t._setHoveredSeries(s),t._setStuckSeries(e,s,o,r),t._pointerComplete(h,o,r)}),s)}else{if(h){if(e.type!==c.move&&"touch"!==e.pointerType)return;return void(t.hoveredSeries?t._setTimeout((function(){t._pointerOnPoint(h,o,r,e)}),h):t._pointerOnPoint(h,o,r,e))}t._setStuckSeries(e,void 0,o,r)&&(s=t._stuckSeries,h=s.getNeighborPoint(o,r),t._releaseHoveredSeries(),h&&h.getMarkerVisibility()&&t._setHoveredPoint(h))}t._pointerComplete(h,o,r)}},_pointerOnPoint:function(e,t,i){this._resetHoveredArgument(),this._setHoveredPoint(e),this._pointerComplete(e,t,i)},_pointerComplete:function(e){this.pointAtShownTooltip!==e&&this._tooltip.isEnabled()&&this._showTooltip(e)},_clickHandler:function(e){var t=e.data.tracker,i=t._renderer.getRootOffset(),o=m(e.pageX-i.left),r=m(e.pageY-i.top),n=R(e,b),s=t._stuckSeries||R(e,w)||n&&n.series,h=t._argumentAxis;if(t._legend.coordsIn(o,r)){var a=t._legend.getItemByCoord(o,r);a&&t._legendClick(a,e)}else if(h&&h.coordsIn(o,r)){var l=R(e,M);p(l)&&t._eventTrigger("argumentAxisClick",{argument:l,event:e})}else s&&((n=n||s.getPointByCoord(o,r))&&n.getMarkerVisibility()?t._pointClick(n,e):R(e,w)&&t._eventTrigger(x,{target:s,event:e}))},dispose:function(){var e=this;this._disableOutHandler(),this._toggleParentsScrollSubscription(),this._renderer.root.off(k),this._seriesGroup.off(k)}},X=function(e){this.ctor(e)};h(X.prototype,F,{_pointClick:function(e,t){var i=this,o=this._eventTrigger,r=e.series;o(y,{target:e,event:t},(function(){!V(t,r)&&o(x,{target:r,event:t})}))},update:function(e){var t=this;this._zoomingMode=f(e.zoomingMode),this._scrollingMode=f(e.scrollingMode),F.update.call(this,e),this._argumentAxis=e.argumentAxis||{},this._axisHoverEnabled=this._argumentAxis&&f(this._argumentAxis.getOptions().hoverMode)===E,this._chart=e.chart,this._rotated=e.rotated,this._crosshair=e.crosshair},_getCanvas:function(e,t){for(var i=this,o=this._canvases||[],r=0;r<o.length;r++){var n=o[r];if(K(n,e,t))return n}return null},_isPointerOut:function(e){return!e&&this._stuckSeries},_hideCrosshair:function(){this._crosshair&&this._crosshair.hide()},_moveCrosshair:function(e,t,i){e&&this._crosshair&&e.isVisible()&&this._crosshair.show({point:e,x:t,y:i})},_clean:function(){var e=this;F._clean.call(this),this._resetTimer(),this._stuckSeries=null},_getSeriesForShared:function(e,t){var i=this,o=[],r=null,n=1/0;return this._tooltip.isShared()&&!this.hoveredSeries&&(S(this._storedSeries,(function(i,r){var n=r.getNeighborPoint(e,t);n&&o.push(n)})),S(o,(function(i,o){var s=o.getCrosshairData(e,t),h=_.getDistance(e,t,s.x,s.y);h<n&&(r=o,n=h)}))),r&&r.series},_setTimeout:function(e,t){var i=this;i._timeoutKeeper!==t&&(i._resetTimer(),i._hoverTimeout=setTimeout((function(){e(),i._timeoutKeeper=null}),100),i._timeoutKeeper=t)},_resetTimer:function(){clearTimeout(this._hoverTimeout),this._timeoutKeeper=this._hoverTimeout=null},_stopEvent:function(e){p(e.cancelable)&&!e.cancelable||(e.preventDefault(),e.stopPropagation())},_setStuckSeries:function(e,t,i,o){return"mouse"!==e.pointerType?this._stuckSeries=null:this._stuckSeries=t||this._stuckSeries||this._getSeriesForShared(i,o),!!this._stuckSeries},_pointerOut:function(){var e=this;this._stuckSeries=null,this._hideCrosshair(),this._resetTimer(),F._pointerOut.call(this)},_hoverArgumentAxis:function(e,t,i){var o=this;if(this._resetHoveredArgument(),this._axisHoverEnabled&&this._argumentAxis.coordsIn(e,t))return this._hoverArgument(R(i,M)),!0},_pointerComplete:function(e,t,i){var o=this;this.hoveredSeries&&this.hoveredSeries.updateHover(t,i),this._resetTimer(),this._moveCrosshair(e,t,i),F._pointerComplete.call(this,e)},_legendClick:function(e,t){var i=this._storedSeries[e.id];this._triggerLegendClick({target:i,event:t},x)},_hoverLegendItem:function(e,t){this._stuckSeries=null,this._hideCrosshair(),F._hoverLegendItem.call(this,e,t)},_pointerOnPoint:function(e,t,i,o){this._setStuckSeries(o,e.series,t,i),this._releaseHoveredSeries(),F._pointerOnPoint.call(this,e,t,i,o)},_notifyLegendOnHoverArgument:!1,_getArgumentHoverMode:function(){return z(this._argumentAxis)},dispose:function(){this._resetTimer(),F.dispose.call(this)}});var Y=function(e){this.ctor(e)};h(Y.prototype,F,{_isPointerOut:function(e,t){return!t},_legendClick:function(e,t){var i=this,o=[];this._storedSeries.forEach((function(t){return o.push.apply(o,t.getPointsByKeys(e.argument,e.argumentIndex))})),this._eventTrigger(O,{target:e.argument,points:o,event:t})},_pointClick:function(e,t){this._eventTrigger(y,{target:e,event:t})},_hoverLegendItem:function(e,t){var i=this,o=this._legend.getItemByCoord(e,t);this._resetHoveredArgument(),o?this._hoverArgument(o.argument,o.argumentIndex):this.clearHover()},_getArgumentHoverMode:function(){return z(this._legend)},_hoverArgumentAxis:T,_setStuckSeries:T,_getCanvas:T,_notifyLegendOnHoverArgument:!0}),t.ChartTracker=X,t.PieTracker=Y}

