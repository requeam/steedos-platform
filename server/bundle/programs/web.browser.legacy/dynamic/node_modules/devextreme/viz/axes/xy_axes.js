function module(t,e,i){"use strict";var n,r=_(t("../translators/range")),a=t("../../format_helper"),s,o=_(t("../../core/utils/date")),l=t("../../core/utils/extend"),h=t("./datetime_breaks"),u=t("../../core/utils/common"),d,c=_(t("../core/utils")),p=t("../../core/utils/type"),g,f=_(t("./axes_constants"));function _(t){return t&&t.__esModule?t:{default:t}}var m=o.default.getNextDateUnit,x=o.default.correctDateWithUnitBeginning,v=Math,b=v.max,k=f.default.top,y=f.default.bottom,w=f.default.left,B=f.default.right,C=f.default.center,T=3,z=.3,E=2,S=0,L=4,H=24;function V(t,e){var i,n;if("week"===e&&(e="day"),"quarter"===e&&(e="month"),t[e])for(n=0;n<o.default.dateUnitIntervals.length&&(t[i=o.default.dateUnitIntervals[n]]&&(t[i]=!1,t.count--),i!==e);n++);}function A(t){return t.sort((function(t,e){return t.from-e.from}))}function M(t,e,i){var n=e.minVisible,r=e.maxVisible,a=i?i.width:0;return t.reduce((function(t,e){var i,s=e.from,l=e.to,h=t[t.length-1];return(0,p.isDefined)(s)&&(0,p.isDefined)(l)?(s>l&&(l=[s,s=l][0]),t.length&&s<h.to?l>h.to&&(h.to=l>r?r:l,h.gapSize&&(h.gapSize=void 0,h.cumulativeWidth+=a)):(s>=n&&s<r||l<=r&&l>n)&&l-s<r-n&&(i={from:s=s>=n?s:n,to:l=l<=r?l:r,cumulativeWidth:(h?h.cumulativeWidth:0)+a},e.gapSize&&(i.gapSize=o.default.convertMillisecondsToDateUnits(l-s),i.cumulativeWidth=h?h.cumulativeWidth:0),t.push(i)),t):t}),[])}function D(t,e,i){var n,r=t;return t=x(t,i),e=x(e,i),(n=o.default.getSequenceByInterval(t,e,i)).length&&r>n[0]&&(n=n.slice(1)),n}function P(t){var e="start";return"center"===t&&(e="center"),"right"===t&&(e="end"),e}function O(t){var e="start";return"center"===t&&(e="center"),"bottom"===t&&(e="end"),e}function R(t){var e=m(t);return"quarter"===e&&(e=m(e)),e}function I(t,e,i,n){var r=n,s=e&&o.default.getDatesDifferences(e,t);return e&&"year"!==i&&(V(s,i),r=(0,a.getDateFormatByDifferences)(s)),r}function G(t,e){return e.reduce((function(e,i){return b(e,t(i))}),0)}function W(t,e){var i=(e=(e=v.abs(e))%180>=90?90-e%90:e%90)*(v.PI/180);return i>=v.atan(t.height/t.width)?t.height/v.abs(v.sin(i)):t.width}function j(t){return t.reduce((function(t,e){return b(t,e.paddingTopBottom)}),0)}function F(t,e,i){return t.some((function(t){return t.label.verticalAlignment===e}))&&i||0}function U(t){return v.abs(t.x)||0}function Y(t){return v.abs(t.width-v.abs(t.x))||0}function X(t,e,i){var n,r,a,s,o,l=null,h=[];for(n=1,r=t.length;n<r;n++)o=i(a=t[n],s=t[n-1]),e.indexOf(a)>=0?(!l||o>l.length)&&(l={start:a,end:s,length:o}):(l&&o<l.length?h.push(l):h.push({start:a,end:s,length:o}),l=null);return l&&h.push(l),h}function q(t,e,i){var n,r,a,s=[],o="logarithmic"===t.type?function(e,i){return c.default.getLog(i/e,t.logarithmBase)}:function(t,e){return e-t},l=o(i.minVisible,i.maxVisible),h=e.reduce((function(t,e){var i=e.getPointsInViewPort();return t[0]=t[0].concat(i[0]),t[1]=t[1].concat(i[1]),t}),[[],[]]),u=h[0].concat(h[1]).sort((function(t,e){return e-t})),d=h[1].filter((function(t){return h[0].indexOf(t)<0})),g=l/1e10,f=z*l;for(n=X(u,d,o).sort((function(t,e){return e.length-t.length})),a=(0,p.isDefined)(t.maxAutoBreakCount)?Math.min(t.maxAutoBreakCount,n.length):n.length,r=0;r<a&&n[r].length>=f&&!(l<=n[r].length);r++)((l-=n[r].length)>g||l<-g)&&(s.push({from:n[r].start,to:n[r].end}),f=z*l);return A(s),s}function Z(t,e,i,n,r,a,s,o,l){var h=l?"bezier":"line",u=t.g().append(n);return function(e,i){t.path(r(N(a,s,o,e,l)),h).attr(i).append(u)}}function N(t,e,i,n,r){if(!r)return[t,e+n,i,e+n];var a,s=(e+=n)+S,o=e+E,l=e+L,h=[[t,o]];for(a=t;a<i+H;a+=H)h.push([a+6,s,a+6,s,a+12,o,a+18,l,a+18,l,a+24,o]);return[].concat.apply([],h)}function J(t){var e,i=[];for(e=0;e<t.length;e+=2)i.push(t[e+1]),i.push(t[e]);return i}i.exports={linear:{_getStep:function(t,e){var i=this._options.label.minSpacing,n,r=G(this._isHorizontal?function(t){return t.width+i}:function(t){return t.height},t);return e&&(r=W({width:r,height:this._getMaxLabelHeight(t,0)},e)),f.default.getTicksCountInRange(this._majorTicks,this._isHorizontal?"x":"y",r)},_getMaxLabelHeight:function(t,e){return G((function(t){return t.height}),t)+e},_validateOverlappingMode:function(t,e){return this._isHorizontal&&("rotate"===e||"stagger"===e)||!this._isHorizontal?f.default.validateOverlappingMode(t):t},_validateDisplayMode:function(t){return this._isHorizontal?t:"standard"},getMarkerTrackers:function(){return this._markerTrackers},_getSharpParam:function(t){return this._isHorizontal^t?"h":"v"},_createAxisElement:function(){return this._renderer.path([],"line")},_updateAxisElementPosition:function(){if(this._axisElement){var t=this._axisPosition,e=this._getCanvasStartEnd();this._axisElement.attr({points:this._isHorizontal?[e.start,t,e.end,t]:[t,e.start,t,e.end]})}},_getTranslatedCoord:function(t,e){return this._translator.translate(t,e)},_initAxisPositions:function(){var t=this,e=this._options.position;this._axisPosition=this._orthogonalPositions["top"===e||"left"===e?"start":"end"]},_getTickMarkPoints:function(t,e){var i=this._isHorizontal,n={left:-1,top:-1,right:0,bottom:0,center:-.5}[this._options.tickOrientation||"center"];return[t.x+(i?0:n*e),t.y+(i?n*e:0),t.x+(i?0:n*e+e),t.y+(i?n*e+e:0)]},_getTitleCoords:function(){var t=this,e=this._axisPosition,i=this._axisPosition,n=this._getCanvasStartEnd(),r=n.start+(n.end-n.start)/2;return this._isHorizontal?e=r:i=r,{x:e,y:i}},_drawTitleText:function(t,e){var i=this._options,n=i.title,r={opacity:n.opacity,align:"center"},a;if(n.text&&t)return e=e||this._getTitleCoords(),this._isHorizontal||(r.rotate=i.position===w?270:90),this._renderer.text(n.text,e.x,e.y).css(c.default.patchFontOptions(n.font)).attr(r).append(t)},_updateTitleCoords:function(){this._title&&this._title.element.attr(this._getTitleCoords())},_drawTitle:function(){var t=this._drawTitleText(this._axisTitleGroup);t&&(this._title={element:t})},_measureTitle:function(){this._title&&(this._title.bBox=this._title.element.getBBox())},_drawDateMarker:function(t,e,i){var n,r,a=this,s=this._options.marker,o=this._translator.getBusinessRange().invert,l=s.width+s.textLeftIndent;if(null!==e.x)return e.withoutStick||(r=this._renderer.path([e.x,e.y,e.x,e.y+s.separatorHeight],"line").attr({"stroke-width":s.width,stroke:s.color,"stroke-opacity":s.opacity,sharp:"h"}).append(this._axisElementsGroup)),n=String(this.formatLabel(t,e.labelOptions,i)),{date:t,x:e.x,y:e.y,cropped:e.withoutStick,label:this._renderer.text(n,e.x,e.y).css(c.default.patchFontOptions(s.label.font)).append(this._axisElementsGroup),line:r,getEnd:function(){return this.x+(o?-1:1)*(l+this.labelBBox.width)},setTitle:function(){this.title=n},hideLabel:function(){this.label.dispose(),this.label=null,this.title=n},hide:function(){r&&(r.dispose(),r=null),this.label.dispose(),this.label=null,this.hidden=!0}}},_drawDateMarkers:function(){var t,e,i,n,r,a=this,s=a._options,l=a._translator,h=a._getViewportRange(),u=h.minVisible,d=[];function c(t,e,i){return a._drawDateMarker(t,{x:l.translate(t),y:n,labelOptions:a._getLabelFormatOptions(e),withoutStick:i},h)}return h.isEmpty()||!s.marker.visible||"datetime"!==s.argumentType||"discrete"===s.type||a._majorTicks.length<=1?[]:(n=a._axisPosition+s.marker.topIndent,t=o.default.getDateUnitInterval(this._tickInterval),e=R(t),((i=D(u,h.maxVisible,e)).length>1||1===i.length&&u<i[0])&&(d=i.reduce((function(i,n,r,a){var s=c(n,I(n,a[r-1]||u<n&&u,t,e));return s&&i.push(s),i}),[]),u<i[0]&&(r=c(u,I(u,i[0],t,e),!0))&&d.unshift(r)),d)},_adjustDateMarkers:function(t){t=t||0;var e=this,i=this._options.marker,n=i.width+i.textLeftIndent,r=this._translator.getBusinessRange().invert,a=e._getCanvasStartEnd(),s=this._dateMarkers,o;return s.length?(s[0].cropped&&(this._checkMarkersPosition(r,s[1],s[0])||s[0].hideLabel()),s.forEach((function(t,i,n){t.cropped||((r?t.getEnd()<a.end:t.getEnd()>a.end)?t.hideLabel():e._checkMarkersPosition(r,t,o)?o=t:t.hide())})),this._dateMarkers.forEach((function(e){if(e.label){var a=e.labelBBox,s=e.y+i.textTopIndent-a.y;e.label.attr({translateX:r?e.x-n-a.x-a.width:e.x+n-a.x,translateY:s+t})}e.line&&e.line.attr({translateY:t})})),e._initializeMarkersTrackers(t),t+i.topIndent+i.separatorHeight):t},_checkMarkersPosition:function(t,e,i){return void 0===i||(t?e.x<i.getEnd():e.x>i.getEnd())},_initializeMarkersTrackers:function(t){var e=this,i=this._options.marker.separatorHeight,n=this._renderer,r=this._translator.getBusinessRange(),a=this._getCanvasStartEnd(),s=this._axisElementsGroup;this._markerTrackers=this._dateMarkers.filter((function(t){return!t.hidden})).map((function(e,o,l){var h=l[o+1]||{x:a.end,date:r.max},u=e.x,d=e.y+t,c=n.path([u,d,u,d+i,h.x,d+i,h.x,d,u,d],"area").attr({"stroke-width":1,stroke:"grey",fill:"grey",opacity:1e-4}).append(s);return c.data("range",{startValue:e.date,endValue:h.date}),e.title&&c.setTitle(e.title),c}))},_getLabelFormatOptions:function(t){var e=this,i=this._markerLabelOptions;return i||(this._markerLabelOptions=i=(0,l.extend)(!0,{},this._options.marker.label)),(0,p.isDefined)(this._options.marker.label.format)||(i.format=t),i},_adjustConstantLineLabels:function(t){var e=this,i=e._options.position,n=e.getCanvas(),r=n.left,a=n.width-n.right,s=n.top,o=n.height-n.bottom,l=s+(o-s)/2,h=r+(a-r)/2,u=0;return t.forEach((function(t){var n,d,c=e._isHorizontal,p=t.options,g=p.paddingTopBottom,f=p.paddingLeftRight,_=p.label,m=_.verticalAlignment,x=_.horizontalAlignment,v="inside"===_.position,k=t.label,T=t.labelBBox;if(null!==k&&!T.isEmpty){if(c)if(v)switch(n=x===w?t.coord-f-T.x-T.width:t.coord+f-T.x,m){case C:d=l-T.y-T.height/2;break;case y:d=o-g-T.y-T.height;break;default:d=s+g-T.y}else i===m&&(u=b(u,T.height+g)),n=t.coord-T.x-T.width/2,d=m===y?o+g-T.y:s-g-T.y-T.height;else if(v)switch(d=m===y?t.coord+g-T.y:t.coord-g-T.y-T.height,x){case C:n=h-T.x-T.width/2;break;case B:n=a-f-T.x-T.width;break;default:n=r+f-T.x}else i===x&&(u=b(u,T.width+f)),d=t.coord-T.y-T.height/2,n=x===B?a+f-T.x:r-f-T.x-T.width;k.attr({translateX:n,translateY:d})}})),u},_drawConstantLinesForEstimating:function(t){var e=this,i=this._renderer,n=i.g();return t.forEach((function(t){e._drawConstantLineLabelText(t.label.text,0,0,t.label,n).attr({align:"center"})})),n.append(i.root)},_estimateLabelHeight:function(t,e){var i=t.height,n=e.drawingType;if("stagger"!==this._validateDisplayMode(n)&&"stagger"!==this._validateOverlappingMode(e.overlappingBehavior,n)||(i=2*i+e.staggeringSpacing),"rotate"===this._validateDisplayMode(n)||"rotate"===this._validateOverlappingMode(e.overlappingBehavior,n)){var r=c.default.getCosAndSin(e.rotationAngle);i=i*r.cos+t.width*r.sin}return i&&(i+e.indentFromAxis||0)||0},estimateMargins:function(t){this.updateCanvas(t);var e=this,i=this._getViewportRange(),n=this._createTicksAndLabelFormat(i),r=n.ticks,a=n.tickInterval,s=this._options,o=this._outsideConstantLines.filter((function(t){return t.labelOptions.visible})).map((function(t){return t.options})),l=this._renderer.root,h=s.label.visible&&!i.isEmpty()&&r.length,u=h&&this.formatLabel(r[r.length-1],s.label,void 0,void 0,a,r),d=h&&this._renderer.text(u,0,0).css(this._textFontStyles).attr(this._textOptions).append(l),c=this._drawTitleText(l,{x:0,y:0}),p=this._drawConstantLinesForEstimating(o),g=d&&d.getBBox()||{x:0,y:0,width:0,height:0},f=c&&c.getBBox()||{x:0,y:0,width:0,height:0},_=p.getBBox(),m=f.height?f.height+s.title.margin:0,x=this._estimateLabelHeight(g,s.label),v=_.height?_.height+j(o):0,k=x+m,y={left:b(U(g),U(_)),right:b(Y(g),Y(_)),top:("top"===s.position?k:0)+F(o,"top",v),bottom:("top"!==s.position?k:0)+F(o,"bottom",v)};return d&&d.remove(),c&&c.remove(),p&&p.remove(),y},_checkAlignmentConstantLineLabels:function(t){var e=t.position,i=(t.verticalAlignment||"").toLowerCase(),n=(t.horizontalAlignment||"").toLowerCase();this._isHorizontal?"outside"===e?(i=i===y?y:k,n=C):(i=i===C?C:i===y?y:k,n=n===w?w:B):"outside"===e?(i=C,n=n===w?w:B):(i=i===y?y:k,n=n===B?B:n===C?C:w),t.verticalAlignment=i,t.horizontalAlignment=n},_getConstantLineLabelsCoords:function(t,e){var i=this,n=t,r=t;return this._isHorizontal?r=this._orthogonalPositions["top"===e.verticalAlignment?"start":"end"]:n=this._orthogonalPositions["right"===e.horizontalAlignment?"end":"start"],{x:n,y:r}},_getAdjustedStripLabelCoords:function(t){var e=t.options,i=e.paddingTopBottom,n=e.paddingLeftRight,r=e.label.horizontalAlignment,a=e.label.verticalAlignment,s=t.labelBBox,o=s.height,l=s.width,h=t.labelCoords,u=h.y-s.y,d=h.x-s.x;return a===k?u+=i:a===C?u-=o/2:a===y&&(u-=i+o),r===w?d+=n:r===C?d-=l/2:r===B&&(d-=n+l),{translateX:d,translateY:u}},_adjustTitle:function(t){if(t=t||0,this._title){var e=this,i=this._options,n=i.position,r=i.title.margin,a=this._title,s=a.bBox,o=s.x,l=s.y,h=s.width,u=s.height,d=this._axisPosition,c=d-r-t,p=d+r+t,g={};this._isHorizontal?g.translateY=n===k?c-(l+u):p-l:g.translateX=n===w?c-(o+h):p-o,a.element.attr(g)}},_checkTitleOverflow:function(){if(this._title){var t=this._getScreenDelta(),e=this._title,i=e.bBox;(this._isHorizontal?i.width:i.height)>t?e.element.applyEllipsis(t)&&e.element.setTitle(this._options.title.text):e.element.restoreText()}},coordsIn:function(t,e){var i=this.getCanvas(),n=this._options.isHorizontal,r=this._options.position,a=n?e:t;return!(n&&(t<i.left||t>i.width-i.right)||!n&&(e<i.top||e>i.height-i.bottom))&&(n&&r===f.default.top||!n&&r===f.default.left?a<i[r]:a>i[n?"height":"width"]-i[r])},_boundaryTicksVisibility:{min:!0,max:!0},_setVisualRange:function(t){var e=this.adjustRange(c.default.getVizRangeObject(t));this._viewport=e},applyVisualRangeSetter:function(t){this._visualRange=t},adjust:function(t){var e=this,i=this._seriesData,n={min:i.min,max:i.max};t||(n=this._series.filter((function(t){return t.isVisible()})).reduce((function(t,e){var i=e.getViewport();return t.min=(0,p.isDefined)(i.min)?t.min<i.min?t.min:i.min:t.min,t.max=(0,p.isDefined)(i.max)?t.max>i.max?t.max:i.max:t.max,e.showZero&&(t=new r.default.Range(t)).correctValueZeroLevel(),t}),{})),(0,p.isDefined)(n.min)&&(0,p.isDefined)(n.max)&&(i.minVisible=n.min,i.maxVisible=n.max),this._translator.updateBusinessRange(this.adjustViewport(i)),this._breaks=this._getScaleBreaks(this._options,{minVisible:i.minVisible,maxVisible:i.maxVisible},this._series,this.isArgumentAxis)},_getStick:function(){return!this._options.valueMarginsEnabled},_getStripLabelCoords:function(t,e,i){var n,r,a=this,s=this._orthogonalPositions,o=this._isHorizontal,l=i.horizontalAlignment,h=i.verticalAlignment;return o?(l===C?n=t+(e-t)/2:l===w?n=t:l===B&&(n=e),r=s[O(h)]):(n=s[P(l)],h===k?r=t:h===C?r=e+(t-e)/2:h===y&&(r=e)),{x:n,y:r}},_getTranslatedValue:function(t,e){var i=this._translator.translate(t,e,"semidiscrete"===this._options.type&&this._options.tickInterval),n=this._axisPosition,r=this._isHorizontal;return{x:r?i:n,y:r?n:i}},areCoordsOutsideAxis:function(t){var e=this._translator.getCanvasVisibleArea(),i=this._isHorizontal?t.x:t.y;return i<e.min||i>e.max},_getSkippedCategory:function(t){var e;return this._options.type===f.default.discrete&&this._tickOffset&&0!==t.length&&(e=t[t.length-1]),e},_getScaleBreaks:function(t,e,i,n){var r=this,a=(t.breaks||[]).map((function(t){return{from:r.parser(t.startValue),to:r.parser(t.endValue)}}));return"discrete"!==t.type&&"datetime"===t.dataType&&t.workdaysOnly&&(a=a.concat((0,h.generateDateBreaks)(e.minVisible,e.maxVisible,t.workWeek,t.singleWorkdays,t.holidays))),!n&&"discrete"!==t.type&&"datetime"!==t.dataType&&t.autoBreaksEnabled&&0!==t.maxAutoBreakCount&&(a=a.concat(q(t,i,e))),M(A(a),e,t.breakStyle)},_drawBreak:function(t,e,i,n,r,a){var s=this,o=t-(this._translator.isInverted()?0:n+1),l={"stroke-width":1,stroke:r.borderColor,sharp:r.isWaved?void 0:r.isHorizontal?"h":"v"},h={stroke:r.color,"stroke-width":n},u=this._isHorizontal?J:function(t){return t},d=Z(this._renderer,h,l,a,u,e,o,i,r.isWaved);d(n/2,h),d(0,l),d(n,l)},_createBreakClipRect:function(t,e){var i,n=this,r=this._canvas,a=e-t;return i=this._isHorizontal?this._renderer.clipRect(r.left,t,r.width,a):this._renderer.clipRect(t,r.top,a,r.height),this._breaksElements=this._breaksElements||[],this._breaksElements.push(i),i.id},_createBreaksGroup:function(t,e){var i=this,n=this._renderer.g().attr({class:this._axisCssPrefix+"breaks","clip-path":this._createBreakClipRect(t,e)}).append(this._scaleBreaksGroup);return this._breaksElements=this._breaksElements||[],this._breaksElements.push(n),n},_disposeBreaksGroup:function(){(this._breaksElements||[]).forEach((function(t){t.dispose()})),this._breaksElements=null},drawScaleBreaks:function(t){var e,i,n,r,a,s,o,l=this,h=l._options,u=h.breakStyle,d=h.position,c=l._translator.getBusinessRange().breaks||[];l._disposeBreaksGroup(),c&&c.length&&(o={color:l._options.containerColor,borderColor:u.color,isHorizontal:l._isHorizontal,isWaved:"straight"!==u.line.toLowerCase()},t?(e=t.start,i=t.end):(e=l._orthogonalPositions.start-(!h.visible||l._axisShift||"left"!==d&&"top"!==d?0:3),i=l._orthogonalPositions.end+(!h.visible||"right"!==d&&"bottom"!==d?0:3)),s=l._createBreaksGroup(e,i),l._axisShift&&h.visible&&(r=l._axisPosition-l._axisShift-3,a=r+6,n=l._createBreaksGroup(r,a)),c.forEach((function(t){if(!t.gapSize){var d=l._getTranslatedCoord(t.to);l._drawBreak(d,e,i,u.width,o,s),l._axisShift&&h.visible&&l._drawBreak(d,r,a,u.width,o,n)}})))},_getSpiderCategoryOption:u.noop,shift:function(t){var e=this,i=this._options,n=i.isHorizontal,r=this.getMultipleAxesSpacing(),a=this._axisConstantLineGroups;function s(e,i){var a={},s=t[e]?t[e]+r:0;return a[n?"translateY":"translateX"]=("left"===e||"top"===e?-1:1)*s,(i[e]||i).attr(a),s}this._axisShift=s(i.position,this._axisGroup),n?(s("top",a),s("bottom",a)):(s("left",a),s("right",a))}}}}

