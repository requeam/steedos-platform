function module(e,t,i){"use strict";var n=e("../../core/renderer"),o=e("../../core/utils/callbacks"),a=e("../../animation/translator"),r=e("../widget/ui.errors"),s=e("../../core/utils/window"),p=e("../dialog"),l=e("./utils.recurrence"),c=e("../../core/utils/dom"),d=e("../../core/utils/date"),u=e("../../core/utils/object"),h=e("../../core/utils/iterator").each,m=e("../../core/utils/extend").extend,_=e("../../core/utils/array").inArray,g=e("../../core/utils/common").noop,f=e("../../core/utils/type"),D=e("../../core/devices"),w=e("../../core/config"),A=e("../../core/component_registrator"),y=e("../../localization/message"),T=e("../../core/utils/date_serialization"),C=e("../../localization/date"),S=e("../widget/ui.widget"),k=e("./ui.scheduler.subscribes"),x=e("../widget/function_template"),v=e("./ui.scheduler.appointment_tooltip"),O=e("./ui.scheduler.header"),b=e("./workspaces/ui.scheduler.work_space_day"),R=e("./workspaces/ui.scheduler.work_space_week"),E=e("./workspaces/ui.scheduler.work_space_work_week"),B=e("./workspaces/ui.scheduler.work_space_month"),F=e("./workspaces/ui.scheduler.timeline_day"),z=e("./workspaces/ui.scheduler.timeline_week"),M=e("./workspaces/ui.scheduler.timeline_work_week"),V=e("./workspaces/ui.scheduler.timeline_month"),I=e("./workspaces/ui.scheduler.agenda"),H=e("./ui.scheduler.resource_manager"),P=e("./ui.scheduler.appointment_model"),W=e("./ui.scheduler.appointments"),U=e("./ui.scheduler.appointments.layout_manager"),L=e("./ui.scheduler.appointments.drop_down"),Z=e("./timezones/ui.scheduler.timezones"),$=e("../shared/async_template_mixin"),G=e("../../data_helper"),N=e("./ui.loading"),j=e("./ui.scheduler.appointment_form"),K=e("../popup"),Y=e("../../core/utils/deferred"),q=Y.when,J=Y.Deferred,Q=e("../widget/empty_template"),X=e("../widget/bindable_template"),ee=e("../themes"),te=e("../../core/utils/browser"),ie=e("../../core/utils/support"),ne=d.dateToMilliseconds,oe="dx-scheduler",ae="dx-scheduler-small",re="dx-scheduler-readonly",se="dx-scheduler-appointment-popup",pe="dx-scheduler-recurrence-rule-item",le="dx-scheduler-recurrence-rule-item-opened",ce=400,de=610,ue="dx-scheduler-win-no-touch",he="yyyyMMddTHHmmss",me="yyyyMMddTHHmmssZ",_e={day:{workSpace:b,renderingStrategy:"vertical"},week:{workSpace:R,renderingStrategy:"vertical"},workWeek:{workSpace:E,renderingStrategy:"vertical"},month:{workSpace:B,renderingStrategy:"horizontalMonth"},timelineDay:{workSpace:F,renderingStrategy:"horizontal"},timelineWeek:{workSpace:z,renderingStrategy:"horizontal"},timelineWorkWeek:{workSpace:M,renderingStrategy:"horizontal"},timelineMonth:{workSpace:V,renderingStrategy:"horizontalMonthLine"},agenda:{workSpace:I,renderingStrategy:"agenda"}},ge=S.inherit({_getDefaultOptions:function(){return m(this.callBase(),{views:["day","week"],currentView:"day",currentDate:d.trimTime(new Date),min:void 0,max:void 0,dateSerializationFormat:void 0,firstDayOfWeek:void 0,groups:[],resources:[],dataSource:null,customizeDateNavigatorText:void 0,appointmentTemplate:"item",dropDownAppointmentTemplate:"dropDownAppointment",appointmentCollectorTemplate:"appointmentCollector",dataCellTemplate:null,timeCellTemplate:null,resourceCellTemplate:null,dateCellTemplate:null,startDayHour:0,endDayHour:24,editing:{allowAdding:!0,allowDeleting:!0,allowDragging:!0,allowResizing:!0,allowUpdating:!0},showAllDayPanel:!0,showCurrentTimeIndicator:!0,shadeUntilCurrentTime:!1,indicatorUpdateInterval:3e5,indicatorTime:void 0,recurrenceEditMode:"dialog",cellDuration:30,maxAppointmentsPerCell:"auto",selectedCellData:[],groupByDate:!1,onAppointmentRendered:null,onAppointmentClick:null,onAppointmentDblClick:null,onAppointmentContextMenu:null,onCellClick:null,onCellContextMenu:null,onAppointmentAdding:null,onAppointmentAdded:null,onAppointmentUpdating:null,onAppointmentUpdated:null,onAppointmentDeleting:null,onAppointmentDeleted:null,onAppointmentFormOpening:null,appointmentTooltipTemplate:"appointmentTooltip",appointmentPopupTemplate:"appointmentPopup",crossScrollingEnabled:!1,useDropDownViewSwitcher:!1,startDateExpr:"startDate",endDateExpr:"endDate",textExpr:"text",descriptionExpr:"description",allDayExpr:"allDay",recurrenceRuleExpr:"recurrenceRule",recurrenceExceptionExpr:"recurrenceException",remoteFiltering:!1,timeZone:"",startDateTimeZoneExpr:"startDateTimeZone",endDateTimeZoneExpr:"endDateTimeZone",noDataText:y.format("dxCollectionWidget-noDataText"),allowMultipleCellSelection:!0,_appointmentTooltipOffset:{x:0,y:0},_appointmentTooltipButtonsPosition:"bottom",_appointmentTooltipCloseButton:!1,_useAppointmentColorForTooltip:!1,_appointmentTooltipOpenButtonText:y.format("dxScheduler-openAppointment"),_appointmentTooltipOpenButtonIcon:"",_dropDownButtonIcon:"overflow",_appointmentCountPerCell:2,_appointmentGroupButtonOffset:0,_appointmentOffset:26})},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(){return"desktop"===D.real().deviceType&&!D.isSimulator()},options:{focusStateEnabled:!0}},{device:function(){return!D.current().generic},options:{useDropDownViewSwitcher:!0,editing:{allowDragging:!1,allowResizing:!1}}},{device:function(){return ee.isMaterial()},options:{useDropDownViewSwitcher:!0,dateCellTemplate:function(e,t,i){var o;e.text.split(" ").forEach((function(e,t){var o=n("<span>").text(e).addClass("dx-scheduler-header-panel-cell-date");n(i).append(o),t||n(i).append(" ")}))},_appointmentTooltipOffset:{x:0,y:11},_appointmentTooltipButtonsPosition:"top",_appointmentTooltipCloseButton:!0,_useAppointmentColorForTooltip:!0,_appointmentTooltipOpenButtonText:null,_appointmentTooltipOpenButtonIcon:"edit",_dropDownButtonIcon:"chevrondown",_appointmentCountPerCell:1,_appointmentGroupButtonOffset:20,_appointmentOffset:30}}])},_setDeprecatedOptions:function(){this.callBase(),m(this._deprecatedOptions,{onAppointmentFormCreated:{since:"18.2",alias:"onAppointmentFormOpening"}})},_postponeDataSourceLoading:function(e){this.postponedOperations.add("_reloadDataSource",this._reloadDataSource.bind(this),e)},_postponeResourceLoading:function(){var e=this,t=this.postponedOperations.add("_loadResources",(function(){return e._loadResources()})),i=new J;return t.done((function(e){i.resolve(e)})),this._postponeDataSourceLoading(t),i.promise()},_optionChanged:function(e){var t=this,i=e.value,n=e.name;switch(e.name){case"customizeDateNavigatorText":this._updateOption("header",n,i);break;case"firstDayOfWeek":this._updateOption("workSpace",n,i),this._updateOption("header",n,i);break;case"currentDate":i=this._dateOption(n),i=d.trimTime(new Date(i)),this.option("selectedCellData",[]),this._workSpace.option(n,new Date(i)),this._header.option(n,new Date(i)),this._header.option("displayedDate",this._workSpace._getViewStartByOptions()),this._appointments.option("items",[]),this._filterAppointmentsByDate(),this._postponeDataSourceLoading();break;case"dataSource":this._initDataSource(),this._customizeStoreLoadOptions(),this._appointmentModel.setDataSource(this._dataSource),this._postponeResourceLoading().done((function(e){t._filterAppointmentsByDate(),t._updateOption("workSpace","showAllDayPanel",t.option("showAllDayPanel"))}));break;case"min":case"max":i=this._dateOption(n),this._updateOption("header",n,new Date(i)),this._updateOption("workSpace",n,new Date(i));break;case"views":this._processCurrentView(),this._getCurrentViewOptions()?this.repaint():this._header.option(n,i);break;case"useDropDownViewSwitcher":this._header.option(n,i);break;case"currentView":this._processCurrentView(),this._appointments.option({items:[],allowDrag:this._allowDragging(),allowResize:this._allowResizing(),itemTemplate:this._getAppointmentTemplate("appointmentTemplate")}),this._postponeResourceLoading().done((function(e){t.getLayoutManager().initRenderingStrategy(t._getAppointmentsRenderingStrategy()),t._refreshWorkSpace(e),t._updateHeader(),t._filterAppointmentsByDate(),t._appointments.option("allowAllDayResize","day"!==i)}));break;case"appointmentTemplate":this._appointments.option("itemTemplate",i);break;case"dateCellTemplate":case"resourceCellTemplate":case"dataCellTemplate":case"timeCellTemplate":this._updateOption("workSpace",n,i),this.repaint();break;case"groups":this._postponeResourceLoading().done((function(e){t._refreshWorkSpace(e),t._filterAppointmentsByDate()}));break;case"resources":this._resourcesManager.setResources(this.option("resources")),this._appointmentModel.setDataAccessors(this._combineDataAccessors()),this._postponeResourceLoading().done((function(e){t._appointments.option("items",[]),t._refreshWorkSpace(e),t._filterAppointmentsByDate()}));break;case"startDayHour":case"endDayHour":this._appointments.option("items",[]),this._updateOption("workSpace",n,i),this._appointments.repaint(),this._filterAppointmentsByDate(),this._postponeDataSourceLoading();break;case"onAppointmentAdding":case"onAppointmentAdded":case"onAppointmentUpdating":case"onAppointmentUpdated":case"onAppointmentDeleting":case"onAppointmentDeleted":case"onAppointmentFormOpening":this._actions[n]=this._createActionByOption(n);break;case"onAppointmentRendered":this._appointments.option("onItemRendered",this._getAppointmentRenderedAction());break;case"onAppointmentClick":this._appointments.option("onItemClick",this._createActionByOption(n));break;case"onAppointmentDblClick":this._appointments.option(n,this._createActionByOption(n));break;case"onAppointmentContextMenu":this._appointments.option("onItemContextMenu",this._createActionByOption(n));break;case"noDataText":case"allowMultipleCellSelection":case"selectedCellData":case"accessKey":case"onCellClick":case"onCellContextMenu":this._workSpace.option(n,i);break;case"crossScrollingEnabled":this._postponeResourceLoading().done((function(e){t._appointments.option("items",[]),t._refreshWorkSpace(e),t._readyToRenderAppointments&&t._appointments.option("items",t._getAppointmentsToRepaint())}));break;case"cellDuration":this._appointments.option("items",[]),this._readyToRenderAppointments&&(this._updateOption("workSpace","hoursInterval",i/60),this._appointments.option("items",this._getAppointmentsToRepaint()));break;case"tabIndex":case"focusStateEnabled":this._updateOption("header",n,i),this._updateOption("workSpace",n,i),this._appointments.option(n,i),this.callBase(e);break;case"width":this._updateOption("header",n,i),this.option("crossScrollingEnabled")&&this._updateOption("workSpace","width",i),this.callBase(e),this._dimensionChanged();break;case"height":this.callBase(e),this._dimensionChanged();break;case"editing":this._initEditing();var o=this._editing;this._bringEditingModeToAppointments(o),this.hideAppointmentTooltip(),this._cleanPopup();break;case"showAllDayPanel":this._postponeResourceLoading().done((function(e){t._filterAppointmentsByDate(),t._updateOption("workSpace","allDayExpanded",i),t._updateOption("workSpace",n,i)}));break;case"showCurrentTimeIndicator":case"indicatorTime":case"indicatorUpdateInterval":case"shadeUntilCurrentTime":case"groupByDate":this._updateOption("workSpace",n,i),this.repaint();break;case"appointmentTooltipTemplate":case"appointmentPopupTemplate":case"recurrenceEditMode":case"remoteFiltering":case"timeZone":case"dropDownAppointmentTemplate":case"appointmentCollectorTemplate":case"_appointmentTooltipOffset":case"_appointmentTooltipButtonsPosition":case"_appointmentTooltipCloseButton":case"_useAppointmentColorForTooltip":case"_appointmentTooltipOpenButtonText":case"_appointmentTooltipOpenButtonIcon":case"_dropDownButtonIcon":case"_appointmentCountPerCell":case"_appointmentGroupButtonOffset":case"_appointmentOffset":this.repaint();break;case"dateSerializationFormat":case"maxAppointmentsPerCell":break;case"startDateExpr":case"endDateExpr":case"startDateTimeZoneExpr":case"endDateTimeZoneExpr":case"textExpr":case"descriptionExpr":case"allDayExpr":case"recurrenceRuleExpr":case"recurrenceExceptionExpr":this._updateExpression(n,i),this._appointmentModel.setDataAccessors(this._combineDataAccessors()),this._initAppointmentTemplate(),this.repaint();break;default:this.callBase(e)}},_updateHeader:function(){var e=this._getViewCountConfig();this._header.option("intervalCount",e.intervalCount),this._header.option("displayedDate",this._workSpace._getViewStartByOptions()),this._header.option("min",this._dateOption("min")),this._header.option("max",this._dateOption("max")),this._header.option("currentDate",this._dateOption("currentDate")),this._header.option("firstDayOfWeek",this._getCurrentViewOption("firstDayOfWeek")),this._header.option("currentView",this._currentView)},_dateOption:function(e){var t=this._getCurrentViewOption(e);return T.deserializeDate(t)},_getSerializationFormat:function(e){var t=this._getCurrentViewOption(e);return"number"==typeof t?"number":f.isString(t)?T.getDateSerializationFormat(t):void 0},_bringEditingModeToAppointments:function(e){var t={allowDelete:e.allowUpdating&&e.allowDeleting};this._isAgenda()||(t.allowDrag=e.allowDragging,t.allowResize=e.allowResizing,t.allowAllDayResize=e.allowResizing&&this._supportAllDayResizing()),this._appointments.option(t),this._dropDownAppointments.repaintExisting(this.$element())},_isAgenda:function(){return"agenda"===this._getAppointmentsRenderingStrategy()},_allowDragging:function(){return this._editing.allowDragging&&!this._isAgenda()},_allowResizing:function(){return this._editing.allowResizing&&!this._isAgenda()},_allowAllDayResizing:function(){return this._editing.allowResizing&&this._supportAllDayResizing()},_supportAllDayResizing:function(){return"day"!==this._getCurrentViewType()||this._currentView.intervalCount>1},_isAllDayExpanded:function(e){return this.option("showAllDayPanel")&&this._appointmentModel.hasAllDayAppointments(e,this._getCurrentViewOption("startDayHour"),this._getCurrentViewOption("endDayHour"))},_getTimezoneOffsetByOption:function(e){return this._calculateTimezoneByValue(this.option("timeZone"),e)},_calculateTimezoneByValue:function(e,t){var i=e;if("string"==typeof e){t=t||new Date;var n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes());i=Z.getTimezoneOffsetById(e,n)}return i},_filterAppointmentsByDate:function(){var e=this._workSpace.getDateRange();this._appointmentModel.filterByDate(e[0],e[1],this.option("remoteFiltering"),this.option("dateSerializationFormat"))},_loadResources:function(){var e=this._getCurrentViewOption("groups"),t=new J;return this._resourcesManager.loadResources(e).done(function(e){this._loadedResources=e,t.resolve(e)}.bind(this)),t.promise()},_dataSourceLoadedCallback:o(),_reloadDataSource:function(){var e=new J;return this._dataSource?(this._dataSource.load().done(function(){N.hide(),this._fireContentReadyAction(e)}.bind(this)).fail((function(){N.hide(),e.reject()})),this._dataSource.isLoading()&&N.show({container:this.$element(),position:{of:this.$element()}})):this._fireContentReadyAction(e),e.promise()},_fireContentReadyAction:function(e){this.callBase(),e&&e.resolve()},_dimensionChanged:function(){var e=this.getFilteredItems();if(this._toggleSmallClass(),!this._isAgenda()&&e&&this._isVisible()){this._workSpace._cleanAllowedPositions(),this._workSpace.option("allDayExpanded",this._isAllDayExpanded(e)),this._workSpace._dimensionChanged();var t=this._layoutManager.createAppointmentsMap(e);this._appointments.option("items",t)}this.hideAppointmentTooltip()},_clean:function(){this._cleanPopup(),this.callBase()},_toggleSmallClass:function(){var e=this.$element().get(0).getBoundingClientRect().width;this.$element().toggleClass(ae,e<400)},_visibilityChanged:function(e){e&&this._dimensionChanged()},_dataSourceOptions:function(){return{paginate:!1}},_init:function(){this._initExpressions({startDate:this.option("startDateExpr"),endDate:this.option("endDateExpr"),startDateTimeZone:this.option("startDateTimeZoneExpr"),endDateTimeZone:this.option("endDateTimeZoneExpr"),allDay:this.option("allDayExpr"),text:this.option("textExpr"),description:this.option("descriptionExpr"),recurrenceRule:this.option("recurrenceRuleExpr"),recurrenceException:this.option("recurrenceExceptionExpr")}),this.callBase(),this._initDataSource(),this._loadedResources=[],this._proxiedCustomizeStoreLoadOptionsHandler=this._customizeStoreLoadOptionsHandler.bind(this),this._customizeStoreLoadOptions(),this.$element().addClass(oe).toggleClass(ue,!(!te.msie||!ie.touch)),this._initEditing(),this._resourcesManager=new H(this.option("resources"));var e=this._combineDataAccessors();this._appointmentModel=new P(this._dataSource,e,this.getAppointmentDurationInMinutes()),this._initActions(),this._dropDownAppointments=new L,this._subscribes=k},_initTemplates:function(){this.callBase(),this._initAppointmentTemplate(),this._defaultTemplates.appointmentTooltip=new Q(this),this._defaultTemplates.appointmentPopup=new Q(this),this._defaultTemplates.dropDownAppointment=new Q(this)},_initAppointmentTemplate:function(){var e=this;this._defaultTemplates.item=new X((function(t,i,n){var o=e.getAppointmentsInstance();o._renderAppointmentTemplate.call(o,t,i,n)}),["html","text","startDate","endDate","allDay","description","recurrenceRule","recurrenceException","startDateTimeZone","endDateTimeZone"],this.option("integrationOptions.watchMethod"),{text:this._dataAccessors.getter.text,startDate:this._dataAccessors.getter.startDate,endDate:this._dataAccessors.getter.endDate,startDateTimeZone:this._dataAccessors.getter.startDateTimeZone,endDateTimeZone:this._dataAccessors.getter.endDateTimeZone,allDay:this._dataAccessors.getter.allDay,recurrenceRule:this._dataAccessors.getter.recurrenceRule})},_combineDataAccessors:function(){var e=this._resourcesManager._dataAccessors,t=m(!0,{},this._dataAccessors);return h(e,function(e,i){t[e].resources=i}.bind(this)),t},_renderContent:function(){this._renderContentImpl()},_dataSourceChangedHandler:function(e){this._readyToRenderAppointments&&this._workSpaceRecalculation.done(function(){this._filteredItems=this.fire("prerenderFilter"),this._workSpace.option("allDayExpanded",this._isAllDayExpanded(this._filteredItems)),this._isAgenda()&&this.getRenderingStrategyInstance().calculateRows(this._filteredItems,7,this.option("currentDate"),!0),this._filteredItems.length&&this._isVisible()?(this._appointments.option("items",this._getAppointmentsToRepaint()),this._appointmentModel.cleanModelState()):this._appointments.option("items",[]),this._isAgenda()&&(this._workSpace._renderView(),this._dataSourceLoadedCallback.fireWith(this,[e]))}.bind(this))},_getAppointmentsToRepaint:function(){var e=this._layoutManager.createAppointmentsMap(this._filteredItems);return this._layoutManager.getRepaintedAppointments(e,this.getAppointmentsInstance().option("items"))},_initExpressions:function(t){var i=e("../../core/utils/data"),n=function(e){return"startDate"===e||"endDate"===e};this._dataAccessors||(this._dataAccessors={getter:{},setter:{},expr:{}}),h(t,function(e,t){if(t){var o=i.compileGetter(t),a=i.compileSetter(t),r,s;if(n(e)){var p=this;r=function(){var e=o.apply(this,arguments);if(w().forceIsoDateParsing){if(!p.option("dateSerializationFormat")){var t=T.getDateSerializationFormat(e);t&&p.option("dateSerializationFormat",t)}e=T.deserializeDate(e)}return e},s=function(e,t){(w().forceIsoDateParsing||p.option("dateSerializationFormat"))&&(t=T.serializeDate(t,p.option("dateSerializationFormat"))),a.call(this,e,t)}}this._dataAccessors.getter[e]=r||o,this._dataAccessors.setter[e]=s||a,this._dataAccessors.expr[e+"Expr"]=t}else delete this._dataAccessors.getter[e],delete this._dataAccessors.setter[e],delete this._dataAccessors.expr[e+"Expr"]}.bind(this))},_updateExpression:function(e,t){var i={};i[e.replace("Expr","")]=t,this._initExpressions(i)},_initEditing:function(){var e=this.option("editing");this._editing={allowAdding:!!e,allowUpdating:!!e,allowDeleting:!!e,allowResizing:!!e,allowDragging:!!e},f.isObject(e)&&(this._editing=m(this._editing,e)),this._editing.allowDragging=this._editing.allowDragging&&this._editing.allowUpdating,this._editing.allowResizing=this._editing.allowResizing&&this._editing.allowUpdating,this.$element().toggleClass(re,this._isReadOnly())},_isReadOnly:function(){var e=!0,t=this._editing;for(var i in t)t.hasOwnProperty(i)&&(e=e&&!t[i]);return e},_customizeStoreLoadOptions:function(){this._dataSource&&this._dataSource.on("customizeStoreLoadOptions",this._proxiedCustomizeStoreLoadOptionsHandler)},_dispose:function(){this.hideAppointmentPopup(),this.hideAppointmentTooltip(),this._cleanAsyncTemplatesTimer(),this._dataSource&&this._dataSource.off("customizeStoreLoadOptions",this._proxiedCustomizeStoreLoadOptionsHandler),this.callBase()},_customizeStoreLoadOptionsHandler:function(e){e.storeLoadOptions.dxScheduler={startDate:this.getStartViewDate(),endDate:this.getEndViewDate(),resources:this.option("resources")}},_initActions:function(){this._actions={onAppointmentAdding:this._createActionByOption("onAppointmentAdding"),onAppointmentAdded:this._createActionByOption("onAppointmentAdded"),onAppointmentUpdating:this._createActionByOption("onAppointmentUpdating"),onAppointmentUpdated:this._createActionByOption("onAppointmentUpdated"),onAppointmentDeleting:this._createActionByOption("onAppointmentDeleting"),onAppointmentDeleted:this._createActionByOption("onAppointmentDeleted"),onAppointmentFormOpening:this._createActionByOption("onAppointmentFormOpening")}},_getAppointmentRenderedAction:function(){return this._createActionByOption("onAppointmentRendered",{excludeValidators:["designMode","disabled","readOnly"]})},_renderFocusTarget:g,_initMarkup:function(){this.callBase(),this._processCurrentView(),this._renderHeader(),this._layoutManager=new U(this,this._getAppointmentsRenderingStrategy()),this._appointments=this._createComponent("<div>",W,this._appointmentsConfig()),this._appointments.option("itemTemplate",this._getAppointmentTemplate("appointmentTemplate")),this._isLoaded()?(this._initMarkupCore(this._loadedResources),this._dataSourceChangedHandler(this._dataSource.items())):this._loadResources().done(function(e){this._initMarkupCore(e),this._reloadDataSource()}.bind(this))},_initMarkupCore:function(e){var t=this;this._readyToRenderAppointments=s.hasWindow(),this._workSpace&&this._cleanWorkspace(),this._renderWorkSpace(e),this._appointments.option({fixedContainer:this._workSpace.getFixedContainer(),allDayContainer:this._workSpace.getAllDayContainer()}),this._waitAsyncTemplates((function(){t._workSpaceRecalculation&&t._workSpaceRecalculation.resolve()})),this._filterAppointmentsByDate()},_isLoaded:function(){return this._isResourcesLoaded()&&this._isDataSourceLoaded()},_isResourcesLoaded:function(){return f.isDefined(this._loadedResources)},_isDataSourceLoaded:function(){return this._dataSource&&this._dataSource.isLoaded()},_render:function(){this._toggleSmallClass(),this.callBase()},_renderHeader:function(){var e=n("<div>").appendTo(this.$element());this._header=this._createComponent(e,O,this._headerConfig())},_headerConfig:function(){var e,t=this._getCurrentViewOptions(),i=this._getViewCountConfig();return(e=m({firstDayOfWeek:this.option("firstDayOfWeek"),currentView:this._currentView,tabIndex:this.option("tabIndex"),focusStateEnabled:this.option("focusStateEnabled"),width:this.option("width"),rtlEnabled:this.option("rtlEnabled"),useDropDownViewSwitcher:this.option("useDropDownViewSwitcher"),_dropDownButtonIcon:this.option("_dropDownButtonIcon"),customizeDateNavigatorText:this.option("customizeDateNavigatorText")},t)).observer=this,e.intervalCount=i.intervalCount,e.views=this.option("views"),e.min=new Date(this._dateOption("min")),e.max=new Date(this._dateOption("max")),e.currentDate=d.trimTime(new Date(this._dateOption("currentDate"))),e},_appointmentsConfig:function(){var e=this,t;return{observer:this,onItemRendered:this._getAppointmentRenderedAction(),onItemClick:this._createActionByOption("onAppointmentClick"),onItemContextMenu:this._createActionByOption("onAppointmentContextMenu"),onAppointmentDblClick:this._createActionByOption("onAppointmentDblClick"),tabIndex:this.option("tabIndex"),focusStateEnabled:this.option("focusStateEnabled"),allowDrag:this._allowDragging(),allowDelete:this._editing.allowUpdating&&this._editing.allowDeleting,allowResize:this._allowResizing(),allowAllDayResize:this._allowAllDayResizing(),rtlEnabled:this.option("rtlEnabled"),onContentReady:function(){e._workSpace&&e._workSpace.option("allDayExpanded",e._isAllDayExpanded(e.getFilteredItems()))}}},getAppointmentGroupButtonOffset:function(){return this._workSpace.applyGroupButtonOffset()?this.option("_appointmentGroupButtonOffset"):0},getAppointmentDurationInMinutes:function(){return this._getCurrentViewOption("cellDuration")},_processCurrentView:function(){var e=this.option("views"),t=this.option("currentView"),i=this;this._currentView=t,h(e,(function(e,n){var o,a=f.isObject(n)?n.name:n,r=n.type;if(t===a||t===r)return i._currentView=n,!1}))},_getCurrentViewType:function(){return this._currentView.type||this._currentView},_getAppointmentsRenderingStrategy:function(){return _e[this._getCurrentViewType()].renderingStrategy},_renderWorkSpace:function(e){this._readyToRenderAppointments&&this._toggleSmallClass();var t=n("<div>").appendTo(this.$element()),i=this._getViewCountConfig();this._workSpace=this._createComponent(t,_e[this._getCurrentViewType()].workSpace,this._workSpaceConfig(e,i)),this._workSpace.getWorkArea().append(this._appointments.$element()),this._recalculateWorkspace(),i.startDate&&this._header&&this._header.option("currentDate",this._workSpace._getHeaderDate()),this._appointments.option("_appointmentGroupButtonOffset",this.getAppointmentGroupButtonOffset())},_getViewCountConfig:function(){var e=this.option("currentView"),t=this._getViewByName(e),i,n;return{intervalCount:t&&t.intervalCount||1,startDate:t&&t.startDate||null}},_getViewByName:function(e){for(var t=this.option("views"),i=0;i<t.length;i++)if(t[i].name===e||t[i].type===e||t[i]===e)return t[i]},_recalculateWorkspace:function(){var e=this;this._workSpaceRecalculation=new J,this._waitAsyncTemplates((function(){c.triggerResizeEvent(e._workSpace.$element()),e._workSpace._refreshDateTimeIndication()}))},_workSpaceConfig:function(e,t){var i=this,n,o=this._getCurrentViewOptions();return(n=m({noDataText:this.option("noDataText"),firstDayOfWeek:this.option("firstDayOfWeek"),startDayHour:this.option("startDayHour"),endDayHour:this.option("endDayHour"),tabIndex:this.option("tabIndex"),accessKey:this.option("accessKey"),focusStateEnabled:this.option("focusStateEnabled"),cellDuration:this.option("cellDuration"),showAllDayPanel:this.option("showAllDayPanel"),showCurrentTimeIndicator:this.option("showCurrentTimeIndicator"),indicatorTime:this.option("indicatorTime"),indicatorUpdateInterval:this.option("indicatorUpdateInterval"),shadeUntilCurrentTime:this.option("shadeUntilCurrentTime"),allDayExpanded:this._appointments.option("items"),crossScrollingEnabled:this.option("crossScrollingEnabled"),dataCellTemplate:this.option("dataCellTemplate"),timeCellTemplate:this.option("timeCellTemplate"),resourceCellTemplate:this.option("resourceCellTemplate"),dateCellTemplate:this.option("dateCellTemplate"),allowMultipleCellSelection:this.option("allowMultipleCellSelection"),selectedCellData:this.option("selectedCellData"),onSelectionChanged:function(e){i.option("selectedCellData",e.selectedCellData)},groupByDate:this._getCurrentViewOption("groupByDate")},o)).observer=this,n.intervalCount=t.intervalCount,n.startDate=t.startDate,n.groups=e,n.onCellClick=this._createActionByOption("onCellClick"),n.onCellContextMenu=this._createActionByOption("onCellContextMenu"),n.min=new Date(this._dateOption("min")),n.max=new Date(this._dateOption("max")),n.currentDate=d.trimTime(new Date(this._dateOption("currentDate"))),n.hoursInterval=n.cellDuration/60,n.allDayExpanded=this._isAllDayExpanded(this.getFilteredItems()),n.dataCellTemplate=n.dataCellTemplate?this._getTemplate(n.dataCellTemplate):null,n.timeCellTemplate=n.timeCellTemplate?this._getTemplate(n.timeCellTemplate):null,n.resourceCellTemplate=n.resourceCellTemplate?this._getTemplate(n.resourceCellTemplate):null,n.dateCellTemplate=n.dateCellTemplate?this._getTemplate(n.dateCellTemplate):null,n},_getCurrentViewOptions:function(){return this._currentView},_getCurrentViewOption:function(e){var t=this._getCurrentViewOptions();return t&&void 0!==t[e]?t[e]:this.option(e)},_getAppointmentTemplate:function(e){var t=this._getCurrentViewOptions();return t&&t[e]?this._getTemplate(t[e]):this._getTemplateByOption(e)},_updateOption:function(e,t,i){var n=this._getCurrentViewOptions();n&&f.isDefined(n[t])||this["_"+e].option(t,i)},_refreshWorkSpace:function(e){var t=this;this._cleanWorkspace(),delete this._workSpace,this._renderWorkSpace(e),this._readyToRenderAppointments&&(this._appointments.option({fixedContainer:this._workSpace.getFixedContainer(),allDayContainer:this._workSpace.getAllDayContainer()}),this._waitAsyncTemplates((function(){t._workSpaceRecalculation.resolve()})))},_cleanWorkspace:function(){this._appointments.$element().detach(),this._workSpace._dispose(),this._workSpace.$element().remove(),this.option("selectedCellData",[])},getWorkSpaceScrollable:function(){return this._workSpace.getScrollable()},getWorkSpaceScrollableScrollTop:function(e){return this._workSpace.getGroupedScrollableScrollTop(e)},getWorkSpaceScrollableScrollLeft:function(){return this._workSpace.getScrollableScrollLeft()},getWorkSpaceScrollableContainer:function(){return this._workSpace.getScrollableContainer()},getWorkSpaceAllDayHeight:function(){return this._workSpace.getAllDayHeight()},getWorkSpaceAllDayOffset:function(){return this._workSpace.getAllDayOffset()},getWorkSpaceHeaderPanelHeight:function(){return this._workSpace.getHeaderPanelHeight()},getWorkSpaceDateTableOffset:function(){return!this.option("crossScrollingEnabled")||this.option("rtlEnabled")?this._workSpace.getWorkSpaceLeftOffset():0},getWorkSpace:function(){return this._workSpace},getAppointmentModel:function(){return this._appointmentModel},getHeader:function(){return this._header},getMaxAppointmentsPerCell:function(){return this._getCurrentViewOption("maxAppointmentsPerCell")},_createPopup:function(e,t){this._$popup=n("<div>").addClass(se).appendTo(this.$element()),this._initDynamicPopupTemplate(e,t),this._popup=this._createComponent(this._$popup,K,this._popupConfig(e))},_popupContent:function(e,t){var i=this._popup.$content();return this._createOrUpdateForm(e,t,i),i},_createAppointmentForm:function(e,t){var i=this.fire("getField","allDay",e),n=this.option("resources");j.prepareAppointmentFormEditors(i,{textExpr:this._dataAccessors.expr.textExpr,allDayExpr:this._dataAccessors.expr.allDayExpr,startDateExpr:this._dataAccessors.expr.startDateExpr,endDateExpr:this._dataAccessors.expr.endDateExpr,descriptionExpr:this._dataAccessors.expr.descriptionExpr,recurrenceRuleExpr:this._dataAccessors.expr.recurrenceRuleExpr,startDateTimeZoneExpr:this._dataAccessors.expr.startDateTimeZoneExpr,endDateTimeZoneExpr:this._dataAccessors.expr.endDateTimeZoneExpr},this),n&&n.length&&(this._resourcesManager.setResources(this.option("resources")),j.concatResources(this._resourcesManager.getEditors())),this._appointmentForm=j.create(this._createComponent.bind(this),t,!!this._editAppointmentData&&!this._editing.allowUpdating,e)},_createOrUpdateForm:function(e,t,i){var n=this.fire("getField","allDay",e),o=this.fire("getField","startDate",e),a=this.fire("getField","endDate",e);h(this._resourcesManager.getResourcesFromItem(e,!0)||{},(function(t,i){e[t]=i}));var r=m(!0,{},e);if(t&&(o=this.fire("convertDateByTimezone",o),a=this.fire("convertDateByTimezone",a),this.fire("setField","startDate",r,o),this.fire("setField","endDate",r,a)),this._appointmentForm){var s=this._dataAccessors.expr.startDateExpr,p=this._dataAccessors.expr.endDateExpr;this._appointmentForm.option("formData",r),this._appointmentForm.option("readOnly",!!this._editAppointmentData&&!this._editing.allowUpdating),j.checkEditorsType(this._appointmentForm,s,p,n)}else this._createAppointmentForm(r,i);var l=this._dataAccessors.expr.recurrenceRuleExpr,c=l?this._appointmentForm.itemOption(l):null;if(c){var d=c.editorOptions||{};d.startDate=o,this._appointmentForm.itemOption(l,"editorOptions",d)}this._actions.onAppointmentFormOpening({form:this._appointmentForm,appointmentData:e})},_initDynamicPopupTemplate:function(e,t){var i=this;this._defaultTemplates.appointmentPopup=new x((function(o){var a=i._popupContent(e,t);return n(o.container).append(a),n(o.container)}))},_popupConfig:function(e){var t=this._getTemplateByOption("appointmentPopupTemplate");return{maxWidth:610,onHiding:function(){this.focus()}.bind(this),contentTemplate:new x((function(i){return t.render({model:e,container:i.container})})),defaultOptionsRules:[{device:function(){return!D.current().generic},options:{fullScreen:!0}}]}},_getPopupToolbarItems:function(){return[{shortcut:"done",location:"after",onClick:this._doneButtonClickHandler.bind(this)},{shortcut:"cancel",location:"after"}]},_cleanPopup:function(){this._$popup&&(this._popup.$element().remove(),delete this._$popup,delete this._popup,delete this._appointmentForm)},_doneButtonClickHandler:function(e){if(e.cancel=!0,this._saveChanges(!0),this._lastEditData){var t=this.fire("getField","startDate",this._lastEditData);this._workSpace.updateScrollPosition(t),delete this._lastEditData}},_saveChanges:function(e){var t=this._appointmentForm.validate();if(t&&!t.isValid)return!1;e&&this._disableDoneButton();var i=u.deepExtendArraySafe({},this._getFormData(),!0),n=this._editAppointmentData,o=this._updatedRecAppointment;function a(e,t){var i=new Date(this.fire("getField",t,e)),n=this._getTimezoneOffsetByOption()*ne("hour")+this.fire("getClientTimezoneOffset",i);return new Date(i.getTime()+n)}return n&&this._convertDatesByTimezoneBack(!1,i),n&&!o?this.updateAppointment(n,i):(o&&(this.updateAppointment(n,o),delete this._updatedRecAppointment,"number"==typeof this._getTimezoneOffsetByOption()&&(this.fire("setField","startDate",i,a.call(this,i,"startDate")),this.fire("setField","endDate",i,a.call(this,i,"endDate")))),this.addAppointment(i)),this._enableDoneButton(),this._lastEditData=i,!0},_getFormData:function(){var e=this._appointmentForm.option("formData"),t=this.fire("getField","startDate",e),i=this.fire("getField","endDate",e);return this.fire("setField","startDate",e,t),this.fire("setField","endDate",e,i),e},_convertDatesByTimezoneBack:function(e,t,i){i=i||t;var n=this.fire("convertDateByTimezoneBack",this.fire("getField","startDate",t),e&&this.fire("getField","startDateTimeZone",t)),o=this.fire("convertDateByTimezoneBack",this.fire("getField","endDate",t),e&&this.fire("getField","endDateTimeZone",t));this.fire("setField","startDate",i,n),this.fire("setField","endDate",i,o)},_disableDoneButton:function(){var e=this._popup.option("toolbarItems");e[0].options=m(e[0].options,{disabled:!0}),this._popup.option("toolbarItems",e)},_enableDoneButton:function(){var e=this._popup.option("toolbarItems");e[0].options=m(e[0].options,{disabled:!1}),this._popup.option("toolbarItems",e)},_checkRecurringAppointment:function(e,t,i,n,o,a){delete this._updatedRecAppointment;var r=this.fire("getField","recurrenceRule",e),s;if(l.getRecurrenceRule(r).isValid&&this._editing.allowUpdating)switch(this.option("recurrenceEditMode")){case"series":n();break;case"occurrence":this._singleAppointmentChangesHandler(e,t,i,o,a);break;default:this._showRecurrenceChangeConfirm(o).done(function(r){r&&n(),!r&&this._singleAppointmentChangesHandler(e,t,i,o,a)}.bind(this)).fail(function(){this._appointments.moveAppointmentBack()}.bind(this))}else n()},_singleAppointmentChangesHandler:function(e,t,i,n,o){function a(e,t){var i=this.fire("getField","startDate",e),n=this.fire("convertDateByTimezoneBack",i,this.fire("getField","startDateTimeZone",e)),o=this.fire("getField","endDate",e),a=this.fire("convertDateByTimezoneBack",o,this.fire("getField","endDateTimeZone",e));if("number"==typeof t&&!isNaN(t)){var r=-this._subscribes.getClientTimezoneOffset(i)/ne("hour"),s=-this._subscribes.getClientTimezoneOffset(o)/ne("hour"),p=n.getTime()-r*ne("hour"),l=a.getTime()-s*ne("hour");n=new Date(p+t*ne("hour")),a=new Date(l+t*ne("hour"))}this.fire("setField","startDate",e,n),this.fire("setField","endDate",e,a)}i=new Date(i),this.fire("setField","recurrenceRule",t,""),this.fire("setField","recurrenceException",t,""),n||o||(a.call(this,t,this._getTimezoneOffsetByOption()),this.addAppointment(t));var r=this._makeDateAsRecurrenceException(i,e),s=m({},e);this.fire("setField","recurrenceException",s,r),o?(this._updatedRecAppointment=s,a.call(this,t),this._showAppointmentPopup(t,!0,!0),this._editAppointmentData=e):this._updateAppointment(e,s)},_makeDateAsRecurrenceException:function(e,t){var i=this._getStartDate(t,!0),n=this.fire("getField","startDateTimeZone",t),o=this._getRecurrenceExceptionDate(e,i,n),a=this.fire("getField","recurrenceException",t);return a?a+","+o:o},_getRecurrenceExceptionDate:function(e,t,i){e=this.fire("convertDateByTimezoneBack",e,i);var n=this.fire("convertDateByTimezoneBack",t,i);e.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds());var o=t.getTimezoneOffset()-e.getTimezoneOffset();return e=new Date(e.getTime()-o*ne("minute")),T.serializeDate(e,"yyyyMMddTHHmmssZ")},_showRecurrenceChangeConfirm:function(e){var t=y.format(e?"dxScheduler-confirmRecurrenceDeleteMessage":"dxScheduler-confirmRecurrenceEditMessage"),i=y.format(e?"dxScheduler-confirmRecurrenceDeleteSeries":"dxScheduler-confirmRecurrenceEditSeries"),n=y.format(e?"dxScheduler-confirmRecurrenceDeleteOccurrence":"dxScheduler-confirmRecurrenceEditOccurrence");return p.custom({messageHtml:t,showCloseButton:!0,showTitle:!0,buttons:[{text:i,onClick:function(){return!0}},{text:n,onClick:function(){return!1}}]}).show()},_getUpdatedData:function(e){var t=e.data||e,i=this.getTargetCellData(),n=this.fire("getField","allDay",t),o=new Date(this.fire("getField","startDate",t)),a=new Date(this.fire("getField","endDate",t)),r=i.date||o,s=a.getTime()-o.getTime();if(this._workSpace.keepOriginalHours()){var p=o.getTime()-d.trimTime(o).getTime();r=new Date(d.trimTime(r).getTime()+p)}var l={},c=i.allDay;this.fire("setField","allDay",l,c),this.fire("setField","startDate",l,r);var u=new Date(r.getTime()+s);if(this.appointmentTakesAllDay(t)&&!l.allDay&&this._workSpace.supportAllDayRow()&&(u=this._workSpace.calculateEndDate(r)),n&&!this._workSpace.supportAllDayRow()&&!this._workSpace.keepOriginalHours()){var h=new Date(r);h.setHours(0),0!==(u=new Date(h.getTime()+s)).getHours()&&u.setHours(this._getCurrentViewOption("endDayHour"))}return this.fire("setField","endDate",l,u),this._resourcesManager.setResourcesToItem(l,i.groups),l},_getCoordinates:function(e,t,i,n){for(var o=[],a=0;a<t.length;a++){for(var r=this._workSpace.getCoordinatesByDateInGroup(t[a],i,n),s=0;s<r.length;s++)m(r[s],{startDate:t[a],initialStartDate:e[a]});o=o.concat(r)}return o},_isAppointmentRecurrence:function(e){var t=this.fire("getField","recurrenceRule",e);return t&&l.getRecurrenceRule(t).isValid},_getSingleAppointmentData:function(e,t){var i,n,o=(t=t||{}).$appointment,r=t.skipDateCalculation?{}:this._getUpdatedData(t),s=m({},e,r),p=this.fire("getField","allDay",e),l=this._workSpace.supportAllDayRow()&&p,c=new Date(this.fire("getField","startDate",s)),d,u=new Date(this.fire("getField","endDate",s)).getTime()-c.getTime();if(f.isDefined(o)&&this._needUpdateAppointmentData(o)){var h=this.getRenderingStrategyInstance().getAppointmentDataCalculator();if(f.isFunction(h))i=h(o,c).startDate;else{var _=a.locate(o);i=new Date(this._workSpace.getCellDataByCoordinates(_,l).startDate),o.hasClass("dx-scheduler-appointment-reduced")&&(n=o.data("dxAppointmentStartDate"))&&(i=n),this._isAppointmentRecurrence(e)&&(n=o.data("dxAppointmentSettings")&&o.data("dxAppointmentSettings").startDate)&&(i=n),t.skipHoursProcessing||this.fire("convertDateByTimezoneBack",i,this.fire("getField","startDateTimeZone",e))}}return!i&&t.startDate&&(i=t.startDate),i&&(this.fire("setField","startDate",s,i),this.fire("setField","endDate",s,new Date(i.getTime()+u))),s},_needUpdateAppointmentData:function(e){return e.hasClass("dx-scheduler-appointment-compact")||e.hasClass("dx-scheduler-appointment-recurrence")},_getNormalizedTemplateArgs:function(e){var t=this.callBase(e);return"targetedAppointmentData"in e&&t.push(e.targetedAppointmentData),t},subscribe:function(e,t){this._subscribes[e]=k[e]=t},fire:function(e){var t=this._subscribes[e],i=Array.prototype.slice.call(arguments);if(!f.isFunction(t))throw r.Error("E1031",e);return t.apply(this,i.slice(1))},getTargetCellData:function(){return this._workSpace.getDataByDroppableCell()},_updateAppointment:function(e,t,i){var n={newData:t,oldData:e,cancel:!1},o=function(e){if(f.isFunction(i)&&i.call(this),e&&"Error"===e.name)throw e}.bind(this);this._actions.onAppointmentUpdating(n),this._processActionResult(n,(function(i){if(i)o();else{this._expandAllDayPanel(t);try{this._appointmentModel.update(e,t).always(function(e){this._executeActionWhenOperationIsCompleted(this._actions.onAppointmentUpdated,t,e)}.bind(this)).fail((function(){o()}))}catch(n){o(n)}}}))},_processActionResult:function(e,t){var i=this;f.isPromise(e.cancel)?q(Y.fromPromise(e.cancel)).always((function(n){f.isDefined(n)||(n="rejected"===e.cancel.state()),t.call(i,n)})):t.call(this,e.cancel)},_expandAllDayPanel:function(e){!this._isAllDayExpanded(this.getFilteredItems())&&this.appointmentTakesAllDay(e)&&this._workSpace.option("allDayExpanded",!0)},_executeActionWhenOperationIsCompleted:function(e,t,i){var n={appointmentData:t},o;i&&"Error"===i.name?n.error=i:this._popup&&this._popup.option("visible")&&this._popup.hide(),e(n),this._fireContentReadyAction()},_showAppointmentPopup:function(e,t,i){this._popup||this._createPopup(e,i);var n=[],o=!0;f.isDefined(t)&&!t||(n=this._getPopupToolbarItems(),o=this._popup.initialOption("showCloseButton")),this._popup.option({toolbarItems:n,showCloseButton:o}),this._appointmentForm?this._createOrUpdateForm(e,i):(this._initDynamicPopupTemplate(e,i),this._popup.option(this._popupConfig(e))),this._popup.show()},getAppointmentPopup:function(){return this._popup},getAppointmentDetailsForm:function(){return this._appointmentForm},getUpdatedAppointment:function(){return this._appointmentModel.getUpdatedAppointment()},getUpdatedAppointmentKeys:function(){return this._appointmentModel.getUpdatedAppointmentKeys()},getAppointmentsInstance:function(){return this._appointments},getResourceManager:function(){return this._resourcesManager},getLayoutManager:function(){return this._layoutManager},getRenderingStrategyInstance:function(){return this._layoutManager.getRenderingStrategyInstance()},getFilteredItems:function(){return this._filteredItems},getActions:function(){return this._actions},appointmentTakesAllDay:function(e){return this._appointmentModel.appointmentTakesAllDay(e,this._getCurrentViewOption("startDayHour"),this._getCurrentViewOption("endDayHour"))},_getStartDate:function(e,t){var i=this.fire("getField","startDate",e),n=this.fire("getField","startDateTimeZone",e);return i=d.makeDate(i),i=this.fire("convertDateByTimezone",i,n),!t&&this.fire("updateAppointmentStartDate",{startDate:i,appointment:e,callback:function(e){i=e}}),i},_getEndDate:function(e,t){var i=this.fire("getField","endDate",e);if(i){var n=this.fire("getField","endDateTimeZone",e);i=d.makeDate(i),i=this.fire("convertDateByTimezone",i,n),!t&&this.fire("updateAppointmentEndDate",{endDate:i,callback:function(e){i=e}})}return i},_getRecurrenceException:function(e){var t=this.fire("getField","recurrenceException",e);if(t){for(var i=this.fire("getField","startDate",e),n=t.split(","),o=this.fire("getField","startDateTimeZone",e),a=this.fire("convertDateByTimezone",i,o),r=0;r<n.length;r++)n[r]=this._convertRecurrenceException(n[r],a,o);t=n.join()}return t},_convertRecurrenceException:function(e,t,i){return e=e.replace(/\s/g,""),e=T.deserializeDate(e),(e=this.fire("convertDateByTimezone",e,i)).setHours(t.getHours()),e=T.serializeDate(e,he)},recurrenceEditorVisibilityChanged:function(e){this._appointmentForm&&this._appointmentForm.$element().find("."+pe).toggleClass(le,e)},dayHasAppointment:function(e,t,i){var n=new Date(this.fire("getField","startDate",t)),o=new Date(this.fire("getField","endDate",t)),a=this.fire("getField","startDateTimeZone",t),r=this.fire("getField","endDateTimeZone",t);if(n=this.fire("convertDateByTimezone",n,a),o=this.fire("convertDateByTimezone",o,r),e.getTime()===o.getTime())return n.getTime()===o.getTime();i&&(e=d.trimTime(e),n=d.trimTime(n),o=d.trimTime(o));var s=e.getTime(),p=n.getTime(),l=o.getTime();return _(s,[p,l])>-1||p<s&&l>s},setTargetedAppointmentResources:function(e,t,i){var o=this._getCurrentViewOption("groups");if(o&&o.length){var a,r,s=this._resourcesManager._dataAccessors.setter,p=this._workSpace;this._isAgenda()?(a=function(){var e=this.getLayoutManager()._positionMap[i];return p._getCellGroups(e[0].groupIndex)},r=function(t,i){s[i.name](e,i.id)}):(a=function(){var e=n(t).data("dxAppointmentSettings")||{};return p.getCellDataByCoordinates({left:e.left,top:e.top}).groups},r=function(t,i){s[t](e,i)}),h(a.call(this),r)}},getStartViewDate:function(){return this._workSpace.getStartViewDate()},getEndViewDate:function(){return this._workSpace.getEndViewDate()},showAppointmentPopup:function(e,t,i){var n=i||this._getSingleAppointmentData(e,{skipDateCalculation:!0}),o=this.fire("getField","startDate",i||e);this._checkRecurringAppointment(e,n,o,function(){t?(delete this._editAppointmentData,this._editing.allowAdding&&this._showAppointmentPopup(e,!0,!1)):(this._editAppointmentData=e,this._showAppointmentPopup(e,this._editing.allowUpdating,!0))}.bind(this),!1,!0)},hideAppointmentPopup:function(e){this._popup&&this._popup.option("visible")&&(e&&this._saveChanges(),this._popup.hide())},showAppointmentTooltip:function(e,t,i){e&&(i=i||e,v.show(e,i,t,this))},hideAppointmentTooltip:function(){v.hide()},scrollToTime:function(e,t,i){this._workSpace.scrollToTime(e,t,i)},addAppointment:function(e){var t;this.fire("getField","text",e)||this.fire("setField","text",e,""),this._convertDatesByTimezoneBack(!0,e);var i={appointmentData:e,cancel:!1};this._actions.onAppointmentAdding(i),this._processActionResult(i,(function(t){t||(this._expandAllDayPanel(e),this._appointmentModel.add(e,{value:this._getTimezoneOffsetByOption(),clientOffset:this.fire("getClientTimezoneOffset")}).always(function(t){this._executeActionWhenOperationIsCompleted(this._actions.onAppointmentAdded,e,t)}.bind(this)))}))},updateAppointment:function(e,t){this._updateAppointment(e,t)},deleteAppointment:function(e){var t={appointmentData:e,cancel:!1};this._actions.onAppointmentDeleting(t),this._processActionResult(t,(function(t){t||this._appointmentModel.remove(e).always(function(t){this._executeActionWhenOperationIsCompleted(this._actions.onAppointmentDeleted,e,t)}.bind(this))}))},focus:function(){this._editAppointmentData?this._appointments.focus():this._workSpace.focus()},getFirstDayOfWeek:function(){return f.isDefined(this.option("firstDayOfWeek"))?this.option("firstDayOfWeek"):C.firstDayOfWeekIndex()}}).include($,G);A("dxScheduler",ge),i.exports=ge}

