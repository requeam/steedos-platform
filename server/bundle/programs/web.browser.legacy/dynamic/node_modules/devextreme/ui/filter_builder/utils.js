function module(t,e){"use strict";var n=t("../../core/utils/deferred"),r=t("../../data/errors"),a=t("../../core/utils/type"),i,u=b(t("../widget/ui.errors")),o,l=b(t("../shared/filtering")),f,s=b(t("../../format_helper")),c=t("../../core/utils/extend"),d,p=b(t("../../core/utils/inflector")),h,g=b(t("./between")),v,m=b(t("../../localization/message")),x=t("../../data/data_source/data_source"),y,F=b(t("./ui.filter_operations_dictionary"));function b(t){return t&&t.__esModule?t:{default:t}}var O="string",T="icon-none",C="and",k="=",A="<>",E={number:["=","<>","<",">","<=",">=","isblank","isnotblank"],string:["contains","notcontains","startswith","endswith","=","<>","isblank","isnotblank"],date:["=","<>","<",">","<=",">=","isblank","isnotblank"],datetime:["=","<>","<",">","<=",">=","isblank","isnotblank"],boolean:["=","<>","isblank","isnotblank"],object:["isblank","isnotblank"]},w={date:"shortDate",datetime:"shortDateShortTime"},I=["=","<>","isblank","isnotblank"],z=["caption","customizeText","dataField","dataType","editorTemplate","falseText","editorOptions","filterOperations","format","lookup","trueText","calculateFilterExpression","name"];function D(t,e){var n=t.format||w[t.dataType];return s.default.format(e,n)}function G(t){return t&&t.length>1&&"!"===t[0]&&!et(t)}function V(t){return G(t)?t[1]:t}function L(t,e){return G(t)?t[1]=e:t=e,t}function _(t,e){var n,r=function(t){var e=t.slice(0);t.length=0,t.push("!",e)},a=function(t){var e=V(t);t.length=0,[].push.apply(t,e)};(function(t){return-1!==t.indexOf("!")})(e)?G(t)||r(t):G(t)&&a(t)}function B(t,e){_(t,e);var n,r,a=function(t){return-1===t.indexOf("!")?t:t.substring(1)},i;return function(t,e){for(n=0;n<t.length;n++)Array.isArray(t[n])||(t[n]=e)}(V(t),e=a(e)),t}function S(t,e){var n=N(t);return e.filter((function(t){return t.value===n}))[0]}function M(t){if(et(t))return C;for(var e="",n=0;n<t.length;n++){var a=t[n];if(!Array.isArray(a)){if(e&&e!==a)throw new r.errors.Error("E4019");"!"!==a&&(e=a)}}return e}function N(t){var e=V(t),n=M(e);return n||(n=C),e!==t&&(n="!"+n),n}function j(t){return t.lookup&&I||E[t.dataType||O]}function H(t){return Array.isArray(t)&&t.length}function P(t){var e=H(t.filterOperations)?t.filterOperations:j(t);return(0,c.extend)([],e)}function W(t,e){var n=F.default.getNameByFilterOperation(t);return e&&e[n]?e[n]:n}function q(t,e){for(var n=0;n<e.length;n++)if(e[n].value===t)return e[n];throw new u.default.Error("E1048",t)}function J(t,e){var n=t.filter((function(t){return t.name===e}));return n.length?n[0]:null}function K(t,e,n){var r=P(t);return n.forEach((function(e){if(!t.filterOperations&&-1===r.indexOf(e.name)){var n=e&&e.dataTypes;n&&n.indexOf(t.dataType||O)>=0&&r.push(e.name)}})),r.map((function(t){var r=J(n,t);return r?{icon:r.icon||T,text:r.caption||p.default.captionize(r.name),value:r.name,isCustom:!0}:{icon:F.default.getIconByFilterOperation(t)||T,text:W(t,e),value:t}}))}function Q(t){return t.defaultFilterOperation||P(t)[0]}function R(t,e){var n=[t.dataField,"",""],r;return Ot(n,Q(t),e),n}function U(t,e){var n=V(t),r=n.indexOf(e);return n.splice(r,1),1!==n.length&&n.splice(r,1),t}function X(t){return-1!==t.indexOf("not")?["!",[t.substring(3).toLowerCase()]]:[t]}function Y(t){var e=V(t),n;return!et(e)&&!e.some((function(t){return et(t)}))}function Z(t,e){var n=V(e),r=N(n);return 1===n.length?n.unshift(t):n.push(t,r),e}function $(t,e){for(var n=0;n<e.length;n++){if(e[n].name===t)return e[n];if(e[n].dataField.toLowerCase()===t.toLowerCase())return e[n]}var r=xt(e,!0).filter((function(e){return e.dataField.toLowerCase()===t.toLowerCase()}));if(r.length>0)return r[0];throw new u.default.Error("E1047",t)}function tt(t){return!!Array.isArray(t)&&(t.length<2||Array.isArray(t[0])||Array.isArray(t[1]))}function et(t){return!!Array.isArray(t)&&(t.length>1&&!Array.isArray(t[0])&&!Array.isArray(t[1]))}function nt(t,e){for(var n=M(t).toLowerCase()||C,r=[],a=0;a<t.length;a++)tt(t[a])?(r.push(it(t[a],e)),r.push(n)):et(t[a])&&(r.push(at(t[a],e)),r.push(n));return 0===r.length&&r.push(n),r}function rt(t,e){var n=J(e,t[1]);return n&&n.name===t[1]}function at(t,e){return rt(t,e)?t:(t.length<3&&(t[2]=t[1],t[1]=k),t)}function it(t,e){return t?et(t=(0,c.extend)(!0,[],t))?[at(t,e),C]:G(t)?["!",et(t[1])?[at(t[1],e),C]:G(t[1])?[it(t[1],e),C]:nt(t[1],e)]:nt(t,e):[C]}function ut(t){return t.reduce((function(t,e){if((0,a.isDefined)(e.dataField)){var n={};for(var r in e)e[r]&&z.indexOf(r)>-1&&(n[r]=e[r]);n.defaultCalculateFilterExpression=l.default.defaultCalculateFilterExpression,(0,a.isDefined)(n.dataType)||(n.dataType=O),t.push(n)}return t}),[])}function ot(t,e,n,r){var a=$(t[0],e),i=at(t,n),u=n.length&&J(n,i[1]);return u&&u.calculateFilterExpression?u.calculateFilterExpression.apply(u,[i[2],a,r]):a.calculateFilterExpression?a.calculateFilterExpression.apply(a,[i[2],i[1],r]):a.defaultCalculateFilterExpression.apply(a,[i[2],i[1],r])}function lt(t,e,n,r){if(null===t)return null;var a;if(G(t))return["!",lt(t[1],e,n,r)];var i=V(t);if(et(i))return ot(i,e,n,r)||null;for(var u=void 0,o=N(i),l=[],f=0;f<i.length;f++)tt(i[f])?(u=lt(i[f],e,n,r))&&(f&&l.push(o),l.push(u)):et(i[f])&&(u=ot(i[f],e,n,r))&&(f&&l.push(o),l.push(u));return l.length?l:null}function ft(t){var e,n=V(t);if(0===n.length)return null;var r=[];for(e=0;e<n.length;e++)if(tt(n[e])){var a=ft(n[e]);a?n[e]=a:r.push(n[e])}else et(n[e])&&(Ct(n[e])||r.push(n[e]));for(e=0;e<r.length;e++)U(n,r[e]);return 1===n.length?null:(n.splice(n.length-1,1),1===n.length&&(t=L(t,n[0])),0===t.length?null:t)}function st(t,e,n){if(""!==e){var r=t.lookup,a;if(r.items)n(r.calculateCellValue(e)||"");else new x.DataSource(r.dataSource).loadSingle(r.valueExpr,e).done((function(t){n(t?r.displayExpr?t[r.displayExpr]:t:"")})).fail((function(){n("")}))}else n("")}function ct(t,e,n,r){var a;return a=!0===e?t.trueText||m.default.format("dxDataGrid-trueText"):!1===e?t.falseText||m.default.format("dxDataGrid-falseText"):D(t,e),t.customizeText&&(a=t.customizeText.call(t,{value:e,valueText:a,target:r})),n&&n.customizeText&&(a=n.customizeText.call(n,{value:e,valueText:a,field:t,target:r})),a}function dt(t,e,n,r){return e.map((function(e){return ct(t,e,n,r)}))}function pt(t){return""===t||null===t}function ht(t,e,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"filterBuilder";if(pt(e))return"";if(Array.isArray(e)){var i=new n.Deferred;return n.when.apply(this,dt(t,e,r,a)).done((function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.some((function(t){return!pt(t)}))?e.map((function(t){return pt(t)?"?":t})):"";i.resolve(r)})),i}return ct(t,e,r,a)}function gt(t,e){return t.some((function(t){return t.dataField===e}))}function vt(t,e,n){var r=n.dataField;yt(r)&&(n.parentId=Ft(r),gt(e,n.parentId)||gt(t,n.parentId)||vt(t,e,{dataType:"object",dataField:n.parentId,caption:mt(n.parentId,!0),filterOperations:["isblank","isnotblank"]})),e.push(n)}function mt(t,e){var n="";if(e)t=t.substring(t.lastIndexOf(".")+1);else if(yt(t))return t.split(".").forEach((function(t,e,r){n+=p.default.captionize(t),e!==r.length-1&&(n+=".")})),n;return p.default.captionize(t)}function xt(t,e){for(var n=[],r=0;r<t.length;r++){var a=(0,c.extend)(!0,{caption:mt(t[r].dataField,e)},t[r]);e?vt(t,n,a):n.push(a)}return n}function yt(t){return-1!==t.lastIndexOf(".")}function Ft(t){return t.substring(0,t.lastIndexOf("."))}function bt(t,e){if(yt(t.dataField))for(var n=Ft(t.dataField),r=0;r<e.length;r++)if(e[r].dataField===n)return bt(e[r],e)+"."+t.caption;return t.caption}function Ot(t,e,n){var r=J(n,e);return r?(!1===r.hasValue?(t[1]=e,t.length=2):(t[1]=e,t[2]=""),t):("isblank"===e?(t[1]=k,t[2]=null):"isnotblank"===e?(t[1]=A,t[2]=null):(((r=J(n,t[1]))||2===t.length||null===t[2])&&(t[2]=""),t[1]=e),t)}function Tt(t){var e;return e=null===t[2]?t[1]===k?"isblank":"isnotblank":t[1]}function Ct(t){return""!==t[2]}function kt(t,e){var n=(0,c.extend)(!0,[],t),r=-1;return n.some((function(t,e){if("between"===t.name)return r=e,!0})),-1!==r?n[r]=(0,c.extend)(g.default.getConfig(e),n[r]):n.unshift(g.default.getConfig(e)),n}function At(t,e){return t[0]===e}function Et(t,e){return t&&0!==t.length?et(t)?At(t,e)?null:t:wt(t,[e],!1):null;var n}function wt(t,e,n){var r=[];return t.forEach((function(t){et(t)?At(t,e[0])?n?(r.push(e),n=!1):r.splice(r.length-1,1):r.push(t):(r.length||tt(t))&&r.push(t)})),0===r.length?null:(n&&(r.push(C),r.push(e)),1===r.length?r[0]:r)}function It(t,e){return null===t||0===t.length?e:et(t)?At(t,e[0])?e:[t,C,e]:N(t)!==C?[e,"and",t]:wt(t,e,!0);var n}function zt(t,e){return null===t||0===t.length?[]:et(t)?At(t,e)?[t]:[]:N(t)!==C?[]:t.filter((function(t){return et(t)&&At(t,e)}));var n,r}function Dt(t,e){return null!==t&&0!==t.length&&(et(t)?t[0]===e:t.some((function(t){return(et(t)||tt(t))&&Dt(t,e)})))}e.isValidCondition=Ct,e.isEmptyGroup=Y,e.getOperationFromAvailable=q,e.updateConditionByOperation=Ot,e.getCaptionWithParents=bt,e.getItems=xt,e.setGroupValue=B,e.getGroupMenuItem=S,e.getGroupValue=N,e.getAvailableOperations=K,e.removeItem=U,e.createCondition=R,e.createEmptyGroup=X,e.addItem=Z,e.getField=$,e.isGroup=tt,e.isCondition=et,e.getNormalizedFields=ut,e.getNormalizedFilter=ft,e.getGroupCriteria=V,e.convertToInnerStructure=it,e.getDefaultOperation=Q,e.getCurrentValueText=ht,e.getCurrentLookupValueText=st,e.getFilterOperations=P,e.getCaptionByOperation=W,e.getOperationValue=Tt,e.getFilterExpression=lt,e.getCustomOperation=J,e.getMergedOperations=kt,e.syncFilters=It,e.getMatchedConditions=zt,e.filterHasField=Dt,e.removeFieldConditionsFromFilter=Et}

