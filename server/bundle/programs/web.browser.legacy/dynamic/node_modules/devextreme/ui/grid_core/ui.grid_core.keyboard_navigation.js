function module(e,t,i){"use strict";var o,n=v(e("../../core/renderer")),s,l=v(e("../../core/dom_adapter")),r,d=v(e("../../events/core/events_engine")),a,c=v(e("./ui.grid_core.modules")),u=e("../../core/utils/type"),h=e("../../core/utils/array"),f=e("../widget/selectors"),_=e("../../core/utils/iterator"),g,C=v(e("../widget/ui.keyboard_processor")),w,x=v(e("../../events/utils")),p,m=v(e("../../events/pointer"));function v(e){return e&&e.__esModule?e:{default:e}}var I="rowsview",y="edit-form",F="group-footer",V="dx-row",b="dx-data-row",E="dx-group-row",R="edit-form-item",P="dx-master-detail-row",T="dx-freespace-row",D="dx-virtual-row",N="dx-master-detail-cell",k="dx-dropdowneditor-overlay",H="dx-command-expand",K="dx-cell-focus-disabled",B="dx-editor-cell",A="input:not([type='hidden']), textarea, a, [tabindex]",S=["rowsView"],M="row",$="form",L="batch",O="cell",W="row",U="cell";function G(e){return e&&e.hasClass(E)}function q(e){return e&&e.hasClass(P)}function j(e){return e&&!G(e)&&!q(e)}function z(e){return!e||e.hasClass(T)||e.hasClass(D)}function J(e){return e.length&&"TD"===e[0].tagName}var Q=c.default.ViewController.inherit({_isRowEditMode:function(){var e=this._editingController.getEditMode();return"row"===e||"form"===e},_isCellEditMode:function(){var e=this._editingController.getEditMode();return"cell"===e||"batch"===e},_focusView:function(e,t){this._focusedViews.viewIndex=t,this._focusedView=e},_getInteractiveElement:function(e,t){var i=e.find(A).filter(":visible");return t?i.last():i.first()},_focusInteractiveElement:function(e,t){if(e){var i=this._getInteractiveElement(e,t);d.default.trigger(i,"focus")}},_updateFocus:function(){var e=this;setTimeout((function(){var t=e._getFocusedCell(),i=e._isCellEditMode()&&t;!t||e._isMasterDetailCell(t)&&!e._isRowEditMode()||(e._hasSkipRow(t.parent())&&(t=e._getNextCell(e._focusedCellPosition&&e._focusedCellPosition.rowIndex>0?"upArrow":"downArrow")),t&&t.length>0&&(t.is("td")||t.hasClass(e.addWidgetPrefix("edit-form-item"))?(e.getController("editorFactory").focus()||i?e._focus(t):e._isHiddenFocus&&e._focus(t,!0),e._editingController.isEditing()&&e._focusInteractiveElement.bind(e)(t)):d.default.trigger(t,"focus")))}))},_applyTabIndexToElement:function(e){var t=this.option("tabIndex");e.attr("tabIndex",(0,u.isDefined)(t)?t:0)},_isEventInCurrentGrid:function(e){var t;return(0,n.default)(e.target).closest("."+this.getWidgetContainerClass()).parent().is(this.component.$element())},_clickHandler:function(e){var t=e.event,i=(0,n.default)(t.currentTarget),o=i.hasClass("dx-editor-cell"),s=t.data;this._isEventInCurrentGrid(t)&&this._isCellValid(i)?(i=this._isInsideEditForm(i)?(0,n.default)(t.target):i,this._focusView(s.view,s.viewIndex),i.parent().hasClass(T)?(this._updateFocusedCellPosition(i),this._focusedView.element().attr("tabindex",0),this._focusedView.focus()):o||this._isMasterDetailCell(i)?this._updateFocusedCellPosition(i):this._clickTargetCellHandler(t,i)):i.is("td")&&this._resetFocusedCell()},_allowRowUpdating:function(){var e=this.getVisibleRowIndex(),t=this._dataController.items()[e];return this._editingController.allowUpdating({row:t})},_clickTargetCellHandler:function(e,t){var i,o=this.getView("rowsView").getCellIndex(t),s=this._columnsController.getVisibleColumns()[o],l=this._isCellEditMode();if(this.setCellFocusType(),t=(i=this._fireFocusChangingEvents(e,t,!0)).$newCellElement,i.cancel)this.setRowFocusType(),this.setFocusedRowIndex(i.prevRowIndex),t=this._getFocusedCell(),this._editingController.isEditing()&&l&&this._editingController.closeEditCell();else{if(i.resetFocusedRow)return void this.getController("focus")._resetFocusedRow();if(i.rowIndexChanged&&(t=this._getFocusedCell()),i.isHighlighted||l||this.setRowFocusType(),this._updateFocusedCellPosition(t),this._allowRowUpdating()&&l&&s&&s.allowEditing)this._isHiddenFocus=!1;else{var r=e&&(0,n.default)(e.target),d=r&&r.not(t).is(A),a=!i.isHighlighted||d;this._focus(t,a,d)}}},_initFocusedViews:function(){var e=this,t=e.createAction(e._clickHandler);e._focusedViews=[],(0,_.each)(S,(function(t,i){var o=e.getView(i);o&&o.isVisible()&&e._focusedViews.push(o)})),(0,_.each)(e._focusedViews,(function(i,o){o&&o.renderCompleted.add((function(n){var s=o.element(),l=!n||"refresh"===n.changeType,r=e._focusedView&&e._focusedView.name===o.name,a=!1,c=n&&("append"===n.changeType||"prepend"===n.changeType);d.default.off(s,x.default.addNamespace(m.default.down,"dxDataGridKeyboardNavigation"),t),d.default.on(s,x.default.addNamespace(m.default.down,"dxDataGridKeyboardNavigation"),".dx-row > td, .dx-row",{viewIndex:i,view:o},t),e._initKeyDownProcessor(e,s,e._keyDownHandler),r&&(a=e._isNeedFocus?!c:e._isHiddenFocus&&l)&&e._updateFocus()}))}))},_initKeyDownProcessor:function(e,t,i){this._keyDownProcessor&&(this._keyDownProcessor.dispose(),this._keyDownProcessor=null),this._keyDownProcessor=new C.default({element:t,context:e,handler:i})},_getCell:function(e){if(this._focusedView&&e)return this._focusedView.getCell({rowIndex:e.rowIndex-this._dataController.getRowIndexOffset(),columnIndex:e.columnIndex})},_getFocusedCell:function(){return this._getCell(this._focusedCellPosition)},_getRowIndex:function(e){var t=this,i=this._focusedView,o=-1;return i&&(o=i.getRowIndex(e)),o>=0&&(o+=this._dataController.getRowIndexOffset()),o},_updateFocusedCellPosition:function(e,t){var i=this._getCellPosition(e,t);i&&(!e.length||i.rowIndex>=0&&i.columnIndex>=0)&&this.setFocusedCellPosition(i.rowIndex,i.columnIndex)},_getCellPosition:function(e,t){var i,o,n=this,s=e.closest("tr");if(s.length>0&&this._focusedView)return i=s.length>0&&this._getRowIndex(s),o=this._focusedView.getCellIndex(e,i),t&&(o="previous"===t?o-1:o+1,o=this._applyColumnIndexBoundaries(o)),{rowIndex:i,columnIndex:o}},setFocusedCellPosition:function(e,t){this.setFocusedRowIndex(e),this.setFocusedColumnIndex(t)},setFocusedRowIndex:function(e){this._focusedCellPosition||(this._focusedCellPosition={}),this._focusedCellPosition.rowIndex=e},setFocusedColumnIndex:function(e){this._focusedCellPosition||(this._focusedCellPosition={}),this._focusedCellPosition.columnIndex=e},getVisibleRowIndex:function(){return this._focusedCellPosition?this._focusedCellPosition.rowIndex?this._focusedCellPosition.rowIndex-this._dataController.getRowIndexOffset():this._focusedCellPosition.rowIndex:null},getVisibleColumnIndex:function(){return this._focusedCellPosition&&(0,u.isDefined)(this._focusedCellPosition.columnIndex)?this._focusedCellPosition.columnIndex:-1},getFocusedColumnIndex:function(){return this._focusedCellPosition?this._focusedCellPosition.columnIndex:null},_applyColumnIndexBoundaries:function(e){var t=this._getVisibleColumnCount();return e<0?e=0:e>=t&&(e=t-1),e},_isCellValid:function(e){if((0,u.isDefined)(e)){var t=this.getView("rowsView"),i=e.parent(),o=this._columnsController.getVisibleColumns(),n=t.getCellIndex(e),s=o[n],l=this._getVisibleColumnCount(),r=this._editingController,d=q(i),a=s&&s.showWhenGrouped,c=s&&!e.hasClass("dx-command-expand")&&j(i),h=function(){return!d&&s&&(!(0,u.isDefined)(s.groupIndex)||a&&c)||parseInt(e.attr("colspan"))>1};if(this._isMasterDetailCell(e))return!0;if(l>n&&h()){var f=this._dataController.items(),_=t.getRowIndex(i),g=f[_],C=r&&this._isCellEditMode()&&r.isEditing(),w,x=r&&r.isEditRow(_)||C;return s.command?!x&&"expand"===s.command:(!C||!g||"data"===g.rowType)&&(!x||s.allowEditing)}}},_isCellByPositionValid:function(e){var t=this._getCell(e);return this._isCellValid(t)},_focus:function(e,t,i){var o=e&&e.is("td")?e.parent():e;if(!o||!z(o)){var n,s=this._getFocusedCell(),l=this._focusedView,r=l&&l.element();this._isHiddenFocus=t,G(o)||this.isRowFocusType()?(n=o,l&&this.setFocusedRowIndex(this._getRowIndex(o))):J(e)&&(n=e,this._updateFocusedCellPosition(e)),s&&s.is("td")&&s.not(n).removeAttr("tabIndex"),n&&(i||(this._applyTabIndexToElement(n),d.default.trigger(n,"focus")),t?(r&&r.find(".dx-cell-focus-disabled[tabIndex]").not(n).removeClass("dx-cell-focus-disabled").removeAttr("tabIndex"),n.addClass("dx-cell-focus-disabled")):(r&&r.find(".dx-cell-focus-disabled:not(.dx-master-detail-cell)").removeClass("dx-cell-focus-disabled"),this.getController("editorFactory").focus(n)))}},_hasSkipRow:function(e){var t=e&&e.get(0);return t&&("none"===t.style.display||e.hasClass(this.addWidgetPrefix("group-footer"))||q(e)&&!e.hasClass(this.addWidgetPrefix("edit-form")))},_enterKeyHandler:function(e,t){var i=this._getFocusedCell(),o=this.getVisibleRowIndex(),s=this._focusedView&&this._focusedView.getRow(o);if(this.option("grouping.allowCollapsing")&&G(s)||this.option("masterDetail.enabled")&&i&&i.hasClass("dx-command-expand")){var l=this._dataController.getKeyByRowIndex(o),r=this._dataController.items()[o];void 0!==l&&r&&r.data&&!r.data.isContinuation&&this._dataController.changeRowExpand(l)}else if(t)if(i=this._getCellElementFromTarget(e.originalEvent.target),this._updateFocusedCellPosition(i),this._isRowEditMode())this._focusEditFormCell(i),setTimeout(this._editingController.saveEditData.bind(this._editingController));else{var a=(0,n.default)(e.originalEvent.target);d.default.trigger(a,"blur"),this._editingController.closeEditCell(),e.originalEvent.preventDefault()}else{var c=this._columnsController.getVisibleColumns()[this._focusedCellPosition.columnIndex],u=this._dataController.items()[o];this._editingController.allowUpdating({row:u})&&c&&c.allowEditing&&(this._isRowEditMode()?this._editingController.editRow(o):this._focusedCellPosition&&this._editingController.editCell(o,this._focusedCellPosition.columnIndex))}},_leftRightKeysHandler:function(e,t){var i,o=this.getVisibleRowIndex(),n=e.originalEvent,s=this._focusedView&&this._focusedView.getRow(o);!t&&j(s)&&(this.setCellFocusType(),i=this._getDirectionCodeByKey(e.keyName),this._arrowKeysHandlerFocusCell(n,this._getNextCell(i)),n&&n.preventDefault())},_getDirectionCodeByKey:function(e){var t;return t=this.option("rtlEnabled")?"leftArrow"===e?"nextInRow":"previousInRow":"leftArrow"===e?"previousInRow":"nextInRow"},_upDownKeysHandler:function(e,t){var i,o,n=this.getVisibleRowIndex(),s=this._focusedView&&this._focusedView.getRow(n),l=e.originalEvent,r="upArrow"===e.keyName,d=this._dataController.dataSource();t||!s||q(s)||((i=this._getNextCell(e.keyName))&&this._isCellValid(i)?this._arrowKeysHandlerFocusCell(l,i,!0):this._isVirtualScrolling()&&r&&d&&!d.isLoading()&&(o=s.outerHeight(),n=this._focusedCellPosition.rowIndex-1,this._scrollBy(-o,n,l)),l&&l.preventDefault())},_arrowKeysHandlerFocusCell:function(e,t,i){var o=this._fireFocusChangingEvents(e,t,i,!0);t=o.$newCellElement,!o.cancel&&this._isCellValid(t)&&this._focus(t,!o.isHighlighted)},_fireFocusChangingEvents:function(e,t,i,o){var n={},s=this._getCellPosition(t)||{};return this.isCellFocusType()&&((n=this._fireFocusedCellChanging(e,t,o)).cancel||(s.columnIndex=n.newColumnIndex,s.rowIndex=n.newRowIndex,o=n.isHighlighted)),!n.cancel&&i&&((n=this._fireFocusedRowChanging(e,t.parent())).cancel||(s.rowIndex=n.newRowIndex,n.isHighlighted=o)),n.$newCellElement=this._getCell(s),n.$newCellElement&&n.$newCellElement.length||(n.$newCellElement=t),n},_isVirtualScrolling:function(){var e=this.option("scrolling.mode");return"virtual"===e||"infinite"===e},_scrollBy:function(e,t,i){var o=this,n=this.getView("rowsView").getScrollable();if(o._focusedCellPosition){var s=function e(){n.off("scroll",e),setTimeout(o.restoreFocusableElement.bind(o,t,i))};n.on("scroll",s)}n.scrollBy({left:0,top:e})},restoreFocusableElement:function(e,t){var i,o,n=this,s=(0,u.isDefined)(e),l=this.getView("rowsView"),r=l.element(),a=this._focusedCellPosition.columnIndex,c=this._dataController.getRowIndexOffset();e=s?e:l.getTopVisibleItemIndex()+c,s?(o=l.getRow(e-c),!(i=this._fireFocusedRowChanging(t,o)).cancel&&i.rowIndexChanged&&(e=i.newRowIndex)):(this.getController("editorFactory").loseFocus(),this._applyTabIndexToElement(r),d.default.trigger(r,"focus")),s&&i.cancel||this.setFocusedCellPosition(e,a),s&&this._updateFocus()},_pageUpDownKeyHandler:function(e){var t=this._dataController.pageIndex(),i=this._dataController.pageCount(),o=this.option("paging.enabled"),n="pageUp"===e.keyName,s=n?-1:1,l=this.getView("rowsView").getScrollable();o&&!this._isVirtualScrolling()?(n?t>0:t<i-1)&&!this._isVirtualScrolling()&&(this._dataController.pageIndex(t+s),e.originalEvent.preventDefault()):l&&l._container().height()<l.$content().height()&&(this._scrollBy(l._container().height()*s),e.originalEvent.preventDefault())},_spaceKeyHandler:function(e,t){var i,o=this.getVisibleRowIndex(),s=(0,n.default)(e.originalEvent&&e.originalEvent.target);this.option("selection")&&"none"!==this.option("selection").mode&&!t&&((i="row"===this._getElementType(s)&&this.isRowFocusType()&&j(s))&&this._selectionController.startSelectionWithCheckboxes(),(i||s.parent().hasClass("dx-data-row")||s.hasClass(this.addWidgetPrefix("rowsview")))&&(this._selectionController.changeItemSelection(o,{shift:e.shift,control:e.ctrl}),e.originalEvent.preventDefault()))},_ctrlAKeyHandler:function(e,t){!t&&e.ctrl&&!e.alt&&"multiple"===this.option("selection.mode")&&this.option("selection.allowSelectAll")&&(this._selectionController.selectAll(),e.originalEvent.preventDefault())},_isInsideEditForm:function(e){return(0,n.default)(e).closest("."+this.addWidgetPrefix("edit-form")).length>0},_isMasterDetailCell:function(e){var t=(0,n.default)(e).closest(".dx-master-detail-cell"),i=t.closest("."+this.getWidgetContainerClass()).parent();return t.length&&i.is(this.component.$element())},_processNextCellInMasterDetail:function(e){!this._isInsideEditForm(e)&&e&&this._applyTabIndexToElement(e)},_handleTabKeyOnMasterDetailCell:function(e,t){if(this._isMasterDetailCell(e)){this._updateFocusedCellPosition((0,n.default)(e),t);var i=this._getNextCell(t,"row");return this._processNextCellInMasterDetail(i),!0}return!1},_tabKeyHandler:function(e,t){var i=this.option("editing"),o=e.shift?"previous":"next",s=!e.shift&&this._isLastValidCell(this._focusedCellPosition)||e.shift&&this._isFirstValidCell(this._focusedCellPosition),l=e.originalEvent.target;if(!this._handleTabKeyOnMasterDetailCell(l,o)){if(i&&l&&!s)if((0,n.default)(l).hasClass(this.addWidgetPrefix("rowsview"))&&this._resetFocusedCell(),t){if(!this._editingCellTabHandler(e,o))return}else this._targetCellTabHandler(e,o)&&(s=!0);s?(this.getController("editorFactory").loseFocus(),this._editingController.isEditing()&&!this._isRowEditMode()&&(this._resetFocusedCell(),this._editingController.closeEditCell())):e.originalEvent.preventDefault()}},_editingCellTabHandler:function(e,t){var i,o,n,s,l=this.option("editing"),r=e.originalEvent.target;if(this._updateFocusedCellPosition(this._getCellElementFromTarget(r)),!(n=this._getNextCell(t))||this._handleTabKeyOnMasterDetailCell(n,t))return!1;if(i=this._columnsController.getVisibleColumns()[this.getView("rowsView").getCellIndex(n)],o=this._dataController.items()[this._getRowIndex(n&&n.parent())],i.allowEditing){var d=!o||"data"===o.rowType;s=l.allowUpdating?d:o&&o.inserted}return s||this._editingController.closeEditCell(),this._focusCell(n)&&(!this._isRowEditMode()&&s?this._editingController.editCell(this.getVisibleRowIndex(),this._focusedCellPosition.columnIndex):this._focusInteractiveElement(n,e.shift)),!0},_targetCellTabHandler:function(e,t){var i,o=e.originalEvent,s=o.target,l=this._getCellElementFromTarget(s),r=this._getInteractiveElement(l,!e.shift),d=!1;if(r.length&&s!==r.get(0))d=!0;else{if(void 0===this._focusedCellPosition.rowIndex&&(0,n.default)(s).hasClass("dx-row")&&this._updateFocusedCellPosition((0,n.default)(s).children().first()),i=this._getElementType(s),this.isRowFocusType()&&(this.setCellFocusType(),"row"===i&&j((0,n.default)(s))&&(s=this.getFirstValidCellInRow((0,n.default)(s)),i=this._getElementType(s))),!(l=this._getNextCellByTabKey(o,t,i)))return!1;if(!(l=this._checkNewLineTransition(o,l)))return!1;this._focusCell(l),this._focusInteractiveElement(l,e.shift)}return d},_getNextCellByTabKey:function(e,t,i){var o=this._getNextCell(t,i),n=this._fireFocusedCellChanging(e,o,!0);if(!n.cancel)return n.$newCellElement&&(o=n.$newCellElement),o},_checkNewLineTransition:function(e,t){var i=this.getVisibleRowIndex(),o=t.parent();if(i!==this._getRowIndex(o)){var n=this._getCellPosition(t),s=this._fireFocusedRowChanging(e,o);if(s.cancel)return;s.rowIndexChanged&&(this.setFocusedColumnIndex(n.columnIndex),t=this._getFocusedCell())}return t},getFirstValidCellInRow:function(e,t){for(var i,o,n=this,s=e.find("> td"),l=t=t||0;l<s.length;++l)if(i=s.eq(l),this._isCellValid(i)){o=i;break}return o},_focusCell:function(e){if(this._isCellValid(e))return this._focus(e),!0},_getElementType:function(e){return(0,n.default)(e).is("tr")?"row":"cell"},_focusEditFormCell:function(e){e.hasClass("dx-master-detail-cell")&&this.getController("editorFactory").focus(e,!0)},_escapeKeyHandler:function(e,t){var i=this._getCellElementFromTarget(e.originalEvent.target);t&&(this._updateFocusedCellPosition(i),this._isRowEditMode()?(this._focusEditFormCell(i),this._editingController.cancelEditData()):"cell"===this._editingController.getEditMode()?this._editingController.cancelEditData():this._editingController.closeEditCell(),e.originalEvent.preventDefault())},_ctrlFKeyHandler:function(e){e.ctrl&&this.option("searchPanel")&&this.option("searchPanel").visible&&(this._headerPanel.focus(),e.originalEvent.preventDefault())},_keyDownHandler:function(e){var t=this._editingController.isEditing(),i=!0,o=e.originalEvent,n={handled:!1,event:o};if(this.executeAction("onKeyDown",n),!o.isDefaultPrevented()&&(this._isNeedFocus=!0,this._isNeedScroll=!0,this._updateFocusedCellPosition(this._getCellElementFromTarget(n.event.target)),!n.handled)){switch(e.keyName){case"leftArrow":case"rightArrow":this._leftRightKeysHandler(e,t);break;case"upArrow":case"downArrow":this._upDownKeysHandler(e,t);break;case"pageUp":case"pageDown":this._pageUpDownKeyHandler(e);break;case"space":this._spaceKeyHandler(e,t);break;case"A":this._ctrlAKeyHandler(e,t);break;case"tab":this._tabKeyHandler(e,t);break;case"enter":this._enterKeyHandler(e,t);break;case"escape":this._escapeKeyHandler(e,t);break;case"F":this._ctrlFKeyHandler(e);break;default:this._isNeedFocus=!1,this._isNeedScroll=!1,i=!1}i&&o.stopPropagation()}},_isLastRow:function(e){return this._isVirtualScrolling()?e>=this._dataController.totalItemsCount()-1:e===this.getController("data").items().length-1},_getNextCell:function(e,t,i){var o,n,s,l,r=i||this._focusedCellPosition,d=this.isRowFocusType(),a=d||(0,h.inArray)(e,["next","previous"])>-1,c="previous"===e?this._isFirstValidCell(r):this._isLastValidCell(r);if(this._focusedView&&r){if(n=this._getNewPositionByCode(r,t,e),(s=this._getCell(n))&&!this._isCellValid(s)&&this._isCellInRow(n,a)&&!c&&(s=d?this.getFirstValidCellInRow(s.parent(),n.columnIndex):this._getNextCell(e,"cell",n)),l=s&&s.parent(),this._hasSkipRow(l)){if(o=this._getRowIndex(l),this._isLastRow(o))return null;s=this._getNextCell(e,"row",{columnIndex:r.columnIndex,rowIndex:o})}return s}return null},_getNewPositionByCode:function(e,t,i){var o,n=e.columnIndex,s=e.rowIndex;if(void 0===e.rowIndex&&"next"===i)return{columnIndex:0,rowIndex:0};switch(i){case"nextInRow":case"next":n<(o=this._getVisibleColumnCount())-1&&!this._isLastValidCell({columnIndex:n,rowIndex:s})&&"row"!==t?n++:this._isLastRow(s)||"next"!==i||(n=0,s++);break;case"previousInRow":case"previous":n>0&&!this._isFirstValidCell({columnIndex:n,rowIndex:s})&&"row"!==t?n--:s>0&&"previous"===i&&(s--,n=(o=this._getVisibleColumnCount())-1);break;case"upArrow":s=s>0?s-1:s;break;case"downArrow":s=this._isLastRow(s)?s:s+1}return{columnIndex:n,rowIndex:s}},_isFirstValidCell:function(e){var t=!1;return 0===e.rowIndex&&e.columnIndex>=0&&(t=t||!this._haveValidCellBeforePosition(e)),t},_haveValidCellBeforePosition:function(e){for(var t=e.columnIndex,i=!1;t>0&&!i;){var o={columnIndex:--t,rowIndex:e.rowIndex};i=this._isCellByPositionValid(o)}return i},_isLastValidCell:function(e){var t,i={columnIndex:e.columnIndex>=0?e.columnIndex+1:0,rowIndex:e.rowIndex},o=this._getVisibleColumnCount(),n=this._isCellByPositionValid(i);return!!this._isLastRow(e.rowIndex)&&(e.columnIndex===o-1||!n&&this._isLastValidCell(i))},_getVisibleColumnCount:function(){return this.getController("columns").getVisibleColumns().length},_isCellInRow:function(e,t){var i=e.columnIndex,o=this._getVisibleColumnCount();return t?i>=0&&i<=o-1:i>0&&i<o-1},_resetFocusedCell:function(){var e=this,t=this._getFocusedCell();t&&t.removeAttr("tabIndex"),this._focusedView&&this._focusedView.renderFocusState&&this._focusedView.renderFocusState(),this._isNeedFocus=!1,this._isNeedScroll=!1,this._focusedCellPosition={}},_getCellElementFromTarget:function(e){return(0,n.default)(e).closest(".dx-row> td")},init:function(){var e=this;e.option("useKeyboard")&&(e._dataController=e.getController("data"),e._selectionController=e.getController("selection"),e._editingController=e.getController("editing"),e._headerPanel=e.getView("headerPanel"),e._columnsController=e.getController("columns"),e.getController("editorFactory").focused.add((function(t){e.setupFocusedView(),e._isNeedScroll&&t.is(":visible")&&e._focusedView&&e._focusedView.getScrollable&&(e._scrollToElement(t),e._isNeedScroll=!1)})),e._focusedCellPosition={},e._canceledCellPosition=null,e._initFocusedViews(),e._documentClickHandler=e.createAction((function(t){var i=(0,n.default)(t.event.target),o=e._isEventInCurrentGrid(t.event)&&i.closest("."+e.addWidgetPrefix("rowsview")).length,s=i.closest(".dx-dropdowneditor-overlay").length;o||s||e._resetFocusedCell()})),e.createAction("onKeyDown"),d.default.on(l.default.getDocument(),x.default.addNamespace(m.default.down,"dxDataGridKeyboardNavigation"),e._documentClickHandler))},_scrollToElement:function(e,t){var i=this._focusedView.getScrollable();i&&i.update(),i&&i.scrollToElement(e,t)},focus:function(e){var t,i=this.option("focusedRowEnabled"),o=J((0,n.default)(e));e||(t=i?".dx-row[tabindex]":".dx-row[tabIndex], .dx-row > td[tabindex]",e=this.component.$element().find(t).first()),e&&this._focusElement((0,n.default)(e),o)},_focusElement:function(e,t){var i=this._getFocusedViewByElement(e),o=this.isRowFocusType(),n={};!i||J(e)&&!this._isCellValid(e)||(this._focusView(i.view,i.viewIndex),this._isNeedFocus=!0,this._isNeedScroll=!0,(J(e)||G(e))&&(this.setCellFocusType(),e=(n=this._fireFocusChangingEvents(null,e,!1,t)).$newCellElement,o&&!n.isHighlighted&&this.setRowFocusType()),this._focus(e,!n.isHighlighted),this._focusInteractiveElement(e))},getFocusedView:function(){return this._focusedView},_getFocusedViewByElement:function(e){var t=function(t){return e.closest(t._$element).length};return this._getFocusedViewByCondition(t)},_getFocusedViewByCondition:function(e){var t;return(0,_.each)(this._focusedViews,(function(i,o){if(e(o))return t={viewIndex:i,view:o},!1})),t},isRowFocusType:function(){return"row"===this.focusType},isCellFocusType:function(){return"cell"===this.focusType},setRowFocusType:function(){this.option("focusedRowEnabled")&&(this.focusType="row")},setCellFocusType:function(){this.focusType="cell"},focusViewByName:function(e){var t=this._getFocusedViewByName(e);this._focusView(t.view,t.viewIndex)},setupFocusedView:function(){this.option("useKeyboard")&&!(0,u.isDefined)(this._focusedView)&&this.focusViewByName("rowsView")},_getFocusedViewByName:function(e){var t=function(t){return t.name===e};return this._getFocusedViewByCondition(t)},optionChanged:function(e){var t=this;switch(e.name){case"useKeyboard":e.handled=!0;break;default:this.callBase(e)}},dispose:function(){this.callBase(),this._focusedView=null,this._focusedViews=null,this._keyDownProcessor&&this._keyDownProcessor.dispose(),d.default.off(l.default.getDocument(),x.default.addNamespace(m.default.down,"dxDataGridKeyboardNavigation"),this._documentClickHandler)},_fireFocusedCellChanging:function(e,t,i){var o=this,n=this.option("focusedColumnIndex"),s=this.option("focusedRowIndex"),l=this._getCellPosition(t),r=l?l.columnIndex:-1,d=l?l.rowIndex:-1,a={cellElement:t,prevColumnIndex:n,prevRowIndex:s,newColumnIndex:r,newRowIndex:d,rows:this.getController("data").getVisibleRows(),columns:this.getController("columns").getVisibleColumns(),event:e,isHighlighted:i||!1,cancel:!1};return this._canceledCellPosition=null,this.executeAction("onFocusedCellChanging",a),a.newColumnIndex===r&&a.newRowIndex===d||(a.$newCellElement=this._getCell({columnIndex:a.newColumnIndex,rowIndex:a.newRowIndex})),a.cancel&&(this._canceledCellPosition={rowIndex:d,columnIndex:r}),a},_fireFocusedCellChanged:function(e,t,i){var o=this,n=this.getController("data"),s=this.getView("rowsView").getCellIndex(e),l=this._getRowIndex(e&&e.parent()),r=this.getController("editing").isEditCell(l,s),d=n.items()[l];r||t===s&&i===l||(n=this.getController("data"),this.executeAction("onFocusedCellChanged",{cellElement:e,columnIndex:s,rowIndex:l,row:d,column:this.getController("columns").getVisibleColumns()[s]}))},_fireFocusedRowChanging:function(e,t){var i=this._getRowIndex(t),o=this.getController("data"),n,s={rowElement:t,prevRowIndex:this.option("focusedRowIndex"),newRowIndex:i,event:e,rows:this.getController("data").getVisibleRows(),cancel:!1};return!o||o.isLoading()?(s.cancel=!0,s):(this.option("focusedRowEnabled")&&(this.executeAction("onFocusedRowChanging",s),s.cancel||s.newRowIndex===i||(s.resetFocusedRow=s.newRowIndex<0,s.resetFocusedRow||this.setFocusedRowIndex(s.newRowIndex),s.rowIndexChanged=!0)),s)},_fireFocusedRowChanged:function(e){var t,i,o=this.option("focusedRowIndex");this.option("focusedRowEnabled")&&(o>=0&&(i=this.getController("data"),t=o>=0&&i.getVisibleRows()[o-i.getRowIndexOffset()]),this.executeAction("onFocusedRowChanged",{rowElement:e,rowIndex:o,row:t}))},_processCanceledEditCellPosition:function(e,t){if(this._canceledCellPosition){var i=this._canceledCellPosition.rowIndex===e&&this._canceledCellPosition.columnIndex===t;return this._canceledCellPosition=null,i}}});i.exports={defaultOptions:function(){return{useKeyboard:!0}},controllers:{keyboardNavigation:Q},extenders:{views:{rowsView:{renderFocusState:function(){var e,t=this._dataController,i=this.option("focusedRowIndex")||0,o=this.element();o&&!(0,f.focused)(o)&&o.attr("tabIndex",null),(i<0||i>=t.getVisibleRows().length)&&(i=0),e=this.getCellElements(i),this.option("useKeyboard")&&e&&this.updateFocusElementTabIndex(e)},updateFocusElementTabIndex:function(e){var t=this,i=e.eq(0).parent(),o=this.option("focusedColumnIndex"),n=this.option("tabIndex");(!o||o<0)&&(o=0),G(i)?i.attr("tabIndex",n):this._updateFocusedCellTabIndex(e,o)},_updateFocusedCellTabIndex:function(e,t){var i,o=this,s=this.option("tabIndex"),l=this.getController("keyboardNavigation"),r=l._focusedView,d=e?e.length:-1;if(l._focusedView=this,d>0){d<=t&&(t=d-1);for(var a=t;a<d;++a)if(i=(0,n.default)(e[a]),!l._isMasterDetailCell(i)&&l._isCellValid(i)&&J(i)){i.attr("tabIndex",s),l.setCellFocusType();break}}l._focusedView=r},renderDelayedTemplates:function(e){this.callBase.apply(this,arguments),e&&e.repaintChangesOnly||this.renderFocusState()},_renderCore:function(e){this.callBase(e),e&&e.repaintChangesOnly||this.renderFocusState()}}},controllers:{editing:{editCell:function(e,t){var i=this.getController("keyboardNavigation");if(i._processCanceledEditCellPosition(e,t))return!1;var o=this.callBase(e,t);return o&&i.setupFocusedView(),o},editRow:function(e){"form"===this.option("editing.mode")&&this._keyboardNavigationController._resetFocusedCell(),this.callBase(e)},addRow:function(e){this.getController("keyboardNavigation").setupFocusedView(),this.callBase.apply(this,arguments)},getFocusedCellInRow:function(e){var t=this.getController("keyboardNavigation"),i=this.callBase(e);return this.option("useKeyboard")&&t._focusedCellPosition.rowIndex===e&&(i=t._getFocusedCell()||i),i},_processCanceledEditingCell:function(){var e=this;this.closeEditCell().done((function(){var t;e.getController("keyboardNavigation")._updateFocus()}))},init:function(){this.callBase(),this._keyboardNavigationController=this.getController("keyboardNavigation")},_delayedInputFocus:function(){this._keyboardNavigationController._isNeedScroll=!0,this.callBase.apply(this,arguments)}},data:{_correctRowIndices:function(e){var t=this,i=t.getController("keyboardNavigation"),o=t.getController("editorFactory"),n=i._focusedCellPosition;if(t.callBase.apply(t,arguments),n&&n.rowIndex>=0){var s=e(n.rowIndex);s&&(n.rowIndex+=s,o.focus(o.focus()))}}}}}}}

