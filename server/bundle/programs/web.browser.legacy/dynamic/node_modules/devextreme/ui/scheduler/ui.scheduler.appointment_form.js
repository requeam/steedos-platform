function module(e,t,i){"use strict";var r=e("../../core/renderer"),o=e("../form"),a=e("../../core/utils/date_serialization"),n=e("../../localization/message"),d=e("../../events/click"),l=e("../../core/utils/type"),p=e("../../events/core/events_engine");e("./ui.scheduler.recurrence_editor"),e("./timezones/ui.scheduler.timezone_editor"),e("../text_area"),e("../tag_box");var s="dx-scheduler-recurrence-rule-item",u="dx-scheduler-recurrence-switch-item",c={_appointmentForm:{},_validateAppointmentFormDate:function(e,t,i){var r;!!t||e.option("value",i)},_getAllDayStartDate:function(e){return e.setHours(0,0,0,0)},_getAllDayEndDate:function(e){var t=new Date(e);return t.setDate(e.getDate()+1),t},create:function(e,t,i,r){return this._appointmentForm=e(t,o,{items:this._editors,readOnly:i,showValidationSummary:!0,scrollingEnabled:!0,formData:r}),this._appointmentForm},prepareAppointmentFormEditors:function(e,t,i){var o=this;return this._editors=[{dataField:t.textExpr,editorType:"dxTextBox",label:{text:n.format("dxScheduler-editorLabelTitle")}},{itemType:"empty"},{dataField:t.allDayExpr,editorType:"dxSwitch",label:{text:n.format("dxScheduler-allDay")},editorOptions:{onValueChanged:function(e){var r=e.value,n=o._appointmentForm.getEditor(t.startDateExpr),d=o._appointmentForm.getEditor(t.endDateExpr);if(n&&d){if(n.option("type",r?"date":"datetime"),d.option("type",r?"date":"datetime"),!n.option("value"))return;var l=a.deserializeDate(n.option("value"));r?(n.option("value",o._getAllDayStartDate(l)),d.option("value",o._getAllDayEndDate(l))):(l.setHours(i.option("startDayHour")),n.option("value",l),d.option("value",i._workSpace.calculateEndDate(a.deserializeDate(n.option("value")))))}}}},{dataField:t.startDateExpr,editorType:"dxDateBox",label:{text:n.format("dxScheduler-editorLabelStartDate")},validationRules:[{type:"required"}],editorOptions:{type:e?"date":"datetime",width:"100%",calendarOptions:{firstDayOfWeek:i.option("firstDayOfWeek")},onValueChanged:function(e){o._validateAppointmentFormDate(e.component,e.value,e.previousValue);var i=a.deserializeDate(e.value),r=a.deserializeDate(e.previousValue),n=o._appointmentForm.getEditor(t.endDateExpr),d=a.deserializeDate(n.option("value"));if(l.isDefined(d)&&l.isDefined(i)&&d<i){var p=d.getTime()-r.getTime();n.option("value",new Date(i.getTime()+p))}}}},{dataField:t.startDateTimeZoneExpr,editorType:"dxSchedulerTimezoneEditor",label:{text:" ",showColon:!1},editorOptions:{observer:i},visible:!1},{dataField:t.endDateExpr,editorType:"dxDateBox",label:{text:n.format("dxScheduler-editorLabelEndDate")},validationRules:[{type:"required"}],editorOptions:{type:e?"date":"datetime",width:"100%",calendarOptions:{firstDayOfWeek:i.option("firstDayOfWeek")},onValueChanged:function(e){o._validateAppointmentFormDate(e.component,e.value,e.previousValue);var i=a.deserializeDate(e.value),r=a.deserializeDate(e.previousValue),n=o._appointmentForm.getEditor(t.startDateExpr),d=a.deserializeDate(n.option("value"));if(i&&d>i){var l=r?r.getTime()-d.getTime():0;n.option("value",new Date(i.getTime()-l))}}}},{dataField:t.endDateTimeZoneExpr,editorType:"dxSchedulerTimezoneEditor",label:{text:" ",showColon:!1},editorOptions:{observer:i},visible:!1},{itemType:"empty"},{dataField:t.descriptionExpr,editorType:"dxTextArea",label:{text:n.format("dxScheduler-editorLabelDescription")}},{name:"repeatOnOff",editorType:"dxSwitch",label:{text:n.format("dxScheduler-editorLabelRecurrence")},editorOptions:{observer:i,onInitialized:function(e){var t=o._getRecurrenceRule(i,o._appointmentForm);i.fire("recurrenceEditorVisibilityChanged",t),e.component.option("value",t)},onValueChanged:function(e){var r=e.value,a=o._appointmentForm.getEditor(t.recurrenceRuleExpr);i.fire("recurrenceEditorVisibilityChanged",r),a.option("visible",r)}},cssClass:u},{dataField:t.recurrenceRuleExpr,editorType:"dxRecurrenceEditor",editorOptions:{observer:i,firstDayOfWeek:i.option("firstDayOfWeek"),onValueChanged:function(e){var t=o._getRecurrenceRule(i,o._appointmentForm);e.component.option("visible",t)},onContentReady:function(e){var t,i=r(e.element).closest(".dx-field-item").find(".dx-field-item-label");p.off(i,d.name),p.on(i,d.name,(function(){e.component.toggle()}))}},cssClass:s,label:{visible:!1}}],t.recurrenceRuleExpr||this._editors.splice(9,2),this._editors},_getRecurrenceRule:function(e,t){return!l.isEmptyObject(t)&&!!e.fire("getField","recurrenceRule",t.option("formData"))},concatResources:function(e){this._editors=this._editors.concat(e)},checkEditorsType:function(e,t,i,r){var o=e.itemOption(t),a=e.itemOption(i);if(o&&a){var n=o.editorOptions,d=a.editorOptions;n.type=d.type=r?"date":"datetime",e.itemOption(t,"editorOptions",n),e.itemOption(i,"editorOptions",d)}}};i.exports=c}

