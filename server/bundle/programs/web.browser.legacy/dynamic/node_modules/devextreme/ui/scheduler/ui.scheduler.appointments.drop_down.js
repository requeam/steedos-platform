function module(t,e,n){"use strict";var i,a=y(t("../../core/renderer")),o,r=y(t("../../core/class")),s,d=y(t("../../animation/translator")),l,p=y(t("../../core/utils/type")),c,u=y(t("../../events/drag")),m,f=y(t("../../events/utils")),h,g=y(t("../../events/core/events_engine")),_,v=y(t("../button")),D,C=y(t("../drop_down_menu")),b,w=y(t("../widget/function_template")),x,I=y(t("../../localization/message")),A=t("../../core/utils/extend"),T,k;function y(t){return t&&t.__esModule?t:{default:t}}var B=y(t("../../core/utils/deferred")).default.when,S=5,E=25,$="dx-scheduler-dropdown-appointments",F=$+"-compact",P="dx-scheduler-dropdown-appointments-content",L="dx-scheduler-dropdown-appointment",M="dx-scheduler-dropdown-appointment-title",O="dx-scheduler-dropdown-appointment-date",R="dx-scheduler-dropdown-appointment-remove-button",W="dx-scheduler-dropdown-appointment-info-block",j="dx-scheduler-dropdown-appointment-buttons-block",z="dx-scheduler-all-day-appointment",H=f.default.addNamespace(u.default.start,"dropDownAppointments"),N=f.default.addNamespace(u.default.move,"dropDownAppointments"),U=f.default.addNamespace(u.default.end,"dropDownAppointments"),Z={left:"borderLeftColor",top:"borderTopColor",right:"borderRightColor",bottom:"borderBottomColor"},X=r.default.inherit({render:function(t,e){this.instance=e;var n=t.coordinates,i=t.items,o=t.buttonWidth,r=0,s=(0,a.default)("<div>").addClass($).appendTo(t.$container);return t.isCompact&&(s.addClass(F),r=this.instance.fire("getCellWidth")-o-5),this._createAppointmentClickAction(),this._createDropDownMenu({$element:s,items:i,itemTemplate:t.itemTemplate,buttonWidth:o},t.isCompact),B.apply(null,t.items.colors).done(function(){this._paintMenuButton(s,t.buttonColor,arguments)}.bind(this)),this._applyInnerShadow(s,t.buttonWidth),d.default.move(s,{top:n.top,left:n.left+r}),s},repaintExisting:function(t){var e=["",$,"dx-dropdownmenu"].join(".");t.find(e).each((function(){C.default.getInstance(this).repaint()}))},_paintMenuButton:function(t,e,n){var i=!0,a=void 0;e&&e.done(function(e){if(n.length){a=n[0];for(var o=1;o<n.length;o++){if(a!==n[o]){i=!1;break}a=e}}e&&i&&t.css("backgroundColor",e)}.bind(this))},_applyInnerShadow:function(t){t.css("boxShadow","inset "+t.get(0).getBoundingClientRect().width+"px 0 0 0 rgba(0, 0, 0, 0.3)")},_createAppointmentClickAction:function(){this._appointmentClickAction=this.instance._createActionByOption("onAppointmentClick",{afterExecute:function(t){var e=t.args[0];e.event.stopPropagation(),this.instance.fire("showEditAppointmentPopup",{data:e.appointmentData})}.bind(this)})},_createDropDownMenu:function(t,e){var n=t.$element,i=t.items;if(!C.default.getInstance(n)){this._initDynamicTemplate(i),this._initDynamicButtonTemplate(i.data.length,e);var a=this.instance._getAppointmentTemplate("dropDownAppointmentTemplate"),o=this.instance._getAppointmentTemplate("appointmentCollectorTemplate");this.instance._createComponent(n,C.default,{buttonIcon:null,usePopover:!0,popupHeight:"auto",popupMaxHeight:200,items:i.data,buttonTemplate:this._createListButtonTemplate(o,i,e),itemTemplate:this._createListItemTemplate(a),buttonWidth:t.buttonWidth,closeOnClick:!1,activeStateEnabled:!1,focusStateEnabled:this.instance.option("focusStateEnabled"),onItemClick:this._onListItemClick.bind(this),onItemRendered:function(t){this._onListItemRenderedCore(t,n)}.bind(this)})}},_createListButtonTemplate:function(t,e,n){return new w.default((function(i){var a={appointmentCount:e.data.length,isCompact:n};return t.render({model:a,container:i.container})}))},_createListItemTemplate:function(t){return new w.default((function(e){return t.render({model:e.model,index:e.index,container:e.container})}))},_onListItemClick:function(t){var e=this.instance.fire("mapAppointmentFields",t),n=(0,A.extendFromObject)(e,t,!1);this._appointmentClickAction(this._clearExcessFields(n))},_onListItemRenderedCore:function(t,e){var n=this;if(this.instance._allowDragging()){var i=t.itemElement,a=t.itemData,o=a.settings;g.default.on(i,H,(function(t){n._onAppointmentDragStart(t,a,o)})),g.default.on(i,N,(function(t){C.default.getInstance(e).close(),n._onAppointmentDragUpdate(t,a.allDay)})),g.default.on(i,U,(function(){n._onAppointmentDragEnd(a)}))}},_onAppointmentDragStart:function(t,e,n){var i=this.instance.getAppointmentsInstance(),a=i.option("items").length;n[0].isCompact=!1,n[0].virtual=!1;var o={itemData:e,settings:n};i._currentAppointmentSettings=n,i._renderItem(a,o);var r=i._findItemElementByItem(e);r.length>0&&this._prepareDragItem(t,r,o.settings)},_onAppointmentDragUpdate:function(t,e){var n={left:this._startPosition.left+t.offset.x,top:this._startPosition.top+t.offset.y};this.instance.getAppointmentsInstance().notifyObserver("correctAppointmentCoordinates",{coordinates:n,allDay:e,isFixedContainer:!1,callback:function(t){t&&(n=t)}}),d.default.move(this._$draggedItem,n)},_onAppointmentDragEnd:function(t){var e=this.instance.getAppointmentsInstance(),n=this.instance._workSpace.getDroppableCellIndex(),i=this.instance._workSpace.getCellIndexByCoordinates(this._startPosition);g.default.trigger(this._$draggedItem,"dxdragend"),n===i&&e._clearItem({itemData:t}),delete this._$draggedItem},_clearExcessFields:function(t){return delete t.itemData,delete t.itemIndex,delete t.itemElement,t},_prepareDragItem:function(t,e,n){var i=this.instance,a=this._getDragContainerOffset();this._$draggedItem=e.length>1?this._getRecurrencePart(e,n[0].startDate):e[0];var o=this._$draggedItem.hasClass(z)?i._workSpace.getAllDayHeight():i._workSpace.getScrollableScrollTop();this._startPosition={top:t.pageY-a.top-this._$draggedItem.height()/2+o,left:t.pageX-a.left-this._$draggedItem.width()/2},d.default.move(this._$draggedItem,this._startPosition),g.default.trigger(this._$draggedItem,"dxdragstart")},_getDragContainerOffset:function(){return this.instance._$element.find(".dx-scheduler-date-table-scrollable .dx-scrollable-wrapper").offset()},_getRecurrencePart:function(t,e){for(var n,i=0;i<t.length;i++){var a=t[i],o;a.data("dxAppointmentStartDate").getTime()===e.getTime()&&(n=a)}return n},_initDynamicTemplate:function(t){var e=this;this.instance._defaultTemplates.dropDownAppointment=new w.default((function(n){return e._createDropDownAppointmentTemplate(n.model,(0,a.default)(n.container),t.colors[n.index])}))},_initDynamicButtonTemplate:function(t,e){var n=this;this.instance._defaultTemplates.appointmentCollector=new w.default((function(i){return n._createButtonTemplate(t,(0,a.default)(i.container),e)}))},_createButtonTemplate:function(t,e,n){var i=n?t:I.default.getFormatter("dxScheduler-moreAppointments")(t);return e.append([(0,a.default)("<span>").text(i)]).addClass(P)},_createDropDownAppointmentTemplate:function(t,e,n){var i,o,r,s="",d=[],l="left",p=this.instance.fire("getField","text",t);e.addClass(L),this.instance.option("rtlEnabled")&&(l="right"),n&&n.done((function(t){e.css(Z[l],t)}));var c=this.instance.fire("getField","startDate",t),u=this.instance.fire("getField","endDate",t),m=this.instance.fire("getField","startDateTimeZone",t),f=this.instance.fire("getField","endDateTimeZone",t);return c=this.instance.fire("convertDateByTimezone",c,m),u=this.instance.fire("convertDateByTimezone",u,f),this.instance.fire("formatDates",{startDate:c,endDate:u,formatType:"DATETIME",callback:function(t){s=t}}),r=(0,a.default)("<div>").addClass(W),i=(0,a.default)("<div>").addClass(M).text(p),o=(0,a.default)("<div>").addClass(O).text(s),r.append([i,o]),d.push(r),d.push(this._createButtons(t)),e.append(d),e},_createButtons:function(t){var e=this,n=this.instance.option("editing"),i=!1;if(!n)return"";!0===n&&(i=!0),p.default.isObject(n)&&(i=n.allowDeleting);var o=(0,a.default)("<div>").addClass(j),r=(0,a.default)("<div>").addClass(R);return i&&(o.append(r),this.instance._createComponent(r,v.default,{icon:"trash",height:25,width:25,onClick:function(n){n.event.stopPropagation(),e.instance.deleteAppointment(t)}})),o}});n.exports=X}

