function module(t,e,n){"use strict";var a=t("../../core/renderer"),i=t("../../core/utils/common").noop,o=t("../../core/utils/type").isNumeric,r=t("../widget/ui.errors"),s=t("../../core/utils/date"),d=t("../../core/utils/type"),u=t("../../core/utils/extend").extend,c=t("../../core/component_registrator"),h=t("../../core/devices"),p=t("../widget/ui.widget"),l=t("../button"),v=t("../calendar"),g=t("../popover"),f=t("../popup"),_=t("./ui.scheduler.publisher_mixin"),D=t("../../localization/date"),m=t("../../core/utils/type").isDefined,C="dx-scheduler-navigator",b="dx-scheduler-navigator-calendar",x="dx-scheduler-navigator-next",y="dx-scheduler-navigator-caption",k="dx-scheduler-navigator-previous",O="dx-scheduler-navigator-calendar-popover",S=1,w=function(t){return t?1:D.firstDayOfWeekIndex()},M=function(t){return function(e){var n=D.getMonthNames(t?"abbreviated":"wide")[e.getMonth()];return[D.format(e,"day"),n].join(" ")}},N=function(t){return D.getMonthNames("abbreviated")[t.getMonth()]+" "+D.format(t,"year")},B=function t(e,n,a){var i=M(e);return function(o){if(n>1){var r=new Date(o),s=a;r.setDate(o.getDate()+s-1);var d=o.getMonth()!==r.getMonth(),u=d||e,c,h;return D.format(o,d?M(u):"d")+"-"+D.format(r,t(u))}return[i(o),D.format(o,"year")].join(" ")}},E=function(t,e,n){var a=this.option("firstDayOfWeek"),i=m(a)?a:w(e);0===i&&n&&(i=1);var o=s.getFirstWeekDate(t,i),r=2;n&&(o=s.normalizeDateByWeek(o,t)),a>=6&&n&&o.setDate(o.getDate()+(7-a+1));var d=new Date(o),u=this.option("intervalCount");return e=e||6,(d=new Date(d.setDate(d.getDate()+(u>1?7*(u-1)+e:e)))).getDay()%6==0&&n&&d.setDate(d.getDate()+2),{text:F.call(this,d,o),startDate:o,endDate:d}},F=function(t,e){var n,a,i=e.getMonth()!==t.getMonth(),o=e.getFullYear()!==t.getFullYear(),r=i||this.option("_useShortDateFormat");return o?(a=D.format(e,B(!0)),n=D.format(t,B(!0))):(a=D.format(e,i?M(r):"d"),n=D.format(t,B(r))),a+"-"+n},I=function(t){var e,n=new Date(t),a=new Date(n);if(this.option("intervalCount")>1){a.setMonth(a.getMonth()+this.option("intervalCount")-1);var i=n.getYear()===a.getYear(),o=N(a),r;e=(i?D.getMonthNames("abbreviated")[n.getMonth()]:N(n))+"-"+o}else e=D.format(t,"monthandyear");return{text:e,startDate:n,endDate:a}},P=function(t,e){return new Date(t[this.setter](t[this.getter]()+e))},W=function(t){var e;switch(t){case"day":return{duration:1*this.option("intervalCount"),setter:"setDate",getter:"getDate",getDate:P,getCaption:function(t){var e=B(!1,this.option("intervalCount"),this._getConfig().duration);return{text:D.format(t,e),startDate:t,endDate:t}}};case"week":return{duration:7*this.option("intervalCount"),setter:"setDate",getter:"getDate",getDate:P,getCaption:E};case"workWeek":return{duration:7*this.option("intervalCount"),setter:"setDate",getter:"getDate",getDate:P,getCaption:function(t){return E.call(this,t,4,!0)}};case"month":return{duration:1*this.option("intervalCount"),setter:"setMonth",getter:"getMonth",getDate:function(t,e){var n=t.getDate();t.setDate(1),t=P.call(this,t,e);var a=s.getLastMonthDay(t);return t.setDate(n<a?n:a),t},getCaption:I};case"agenda":return e=this.invoke("getAgendaDuration"),{duration:e=o(e)&&e>0?e:7,setter:"setDate",getter:"getDate",getDate:P,getCaption:function(t){var n,a=B(this.option("_useShortDateFormat")),i=new Date(t),o=new Date(t);return e>1?(o.setDate(o.getDate()+e-1),n=F.call(this,o,t)):n=D.format(t,a),{text:n,startDate:i,endDate:o}}}}},$=p.inherit({_getDefaultOptions:function(){return u(this.callBase(),{date:new Date,displayedDate:void 0,step:"day",intervalCount:1,min:void 0,max:void 0,firstDayOfWeek:void 0,_useShortDateFormat:!1})},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(){return!h.real().generic||h.isSimulator()},options:{_useShortDateFormat:!0}}])},_optionChanged:function(t){switch(t.name){case"step":case"date":case"intervalCount":case"displayedDate":this._updateButtonsState(),this._renderCaption(),this._setCalendarOption("value",this.option("date"));break;case"min":case"max":this._updateButtonsState(),this._setCalendarOption(t.name,t.value);break;case"firstDayOfWeek":this._setCalendarOption(t.name,t.value);break;case"customizeDateNavigatorText":this._renderCaption();break;case"tabIndex":case"focusStateEnabled":this._next.option(t.name,t.value),this._caption.option(t.name,t.value),this._prev.option(t.name,t.value),this._setCalendarOption(t.name,t.value),this.callBase(t);break;case"_useShortDateFormat":break;default:this.callBase(t)}},_init:function(){this.callBase(),this.$element().addClass(C),this._initButtons()},_initButtons:function(){var t=a("<div>").addClass(x);this._next=this._createComponent(t,l,{icon:"chevronnext",onClick:this._updateCurrentDate.bind(this,1),focusStateEnabled:this.option("focusStateEnabled"),tabIndex:this.option("tabIndex"),integrationOptions:{}});var e=a("<div>").addClass(y);this._caption=this._createComponent(e,l,{focusStateEnabled:this.option("focusStateEnabled"),tabIndex:this.option("tabIndex"),integrationOptions:{}});var n=a("<div>").addClass(k);this._prev=this._createComponent(n,l,{icon:"chevronprev",onClick:this._updateCurrentDate.bind(this,-1),focusStateEnabled:this.option("focusStateEnabled"),tabIndex:this.option("tabIndex"),integrationOptions:{}}),this.setAria("label","Next period",t),this.setAria("label","Previous period",n),this._updateButtonsState(),this.$element().append(n,e,t)},_updateButtonsState:function(){var t=this.option("min"),e=this.option("max");t=t?s.trimTime(t):t,e=e?s.trimTime(e):e,this._prev.option("disabled",t&&!isNaN(t.getTime())&&this._getNextDate(-1)<t),this._next.option("disabled",e&&!isNaN(e.getTime())&&this._getNextDate(1)>e)},_updateCurrentDate:function(t){var e=this._getNextDate(t);s.normalizeDate(e,this.option("min"),this.option("max")),this.notifyObserver("currentDateUpdated",e)},_getNextDate:function(t){var e=this._getConfig(),n=e.duration*t,a;return e.getDate(new Date(this.option("date")),n)},_renderFocusTarget:i,_initMarkup:function(){this.callBase(),this._renderCaption()},_render:function(){this.callBase(),this._renderPopover(),this._renderCaptionKeys()},_renderPopover:function(){var t=h.current().generic?g:f,e=a("<div>").addClass(O);this._popover=this._createComponent(e,t,{onContentReady:this._popoverContentReadyHandler.bind(this),defaultOptionsRules:[{device:function(){return!h.current().generic},options:{fullScreen:!0,showCloseButton:!1,toolbarItems:[{shortcut:"cancel"}]}},{device:function(){return h.current().generic},options:{target:this._caption.$element()}}]}),this._popover.$element().appendTo(this.$element())},_popoverContentReadyHandler:function(){this._calendar=this._createComponent(a("<div>"),v,this._calendarOptions()),this._calendar.$element().addClass(b),this._popover.$content().append(this._calendar.$element())},_calendarOptions:function(){return{min:this.option("min"),max:this.option("max"),firstDayOfWeek:this.option("firstDayOfWeek"),value:this.option("date"),focusStateEnabled:this.option("focusStateEnabled"),onValueChanged:function(t){this.option("visible")&&(this.notifyObserver("currentDateUpdated",t.value),this._popover.hide())}.bind(this),hasFocus:function(){return!0},tabIndex:null,_keyboardProcessor:this._calendarKeyboardProcessor}},_renderCaption:function(){var t=this.option("displayedDate")||this.option("date"),e=this._getConfig().getCaption.call(this,t),n=this.option("customizeDateNavigatorText"),a=d.isFunction(n)?n(e):e.text;this._caption.option({text:a,onClick:function(){this._popover.toggle()}.bind(this)})},_renderCaptionKeys:function(){if(this.option("focusStateEnabled")&&!this.option("disabled")){this._calendarKeyboardProcessor=this._caption._keyboardProcessor.attachChildProcessor(),this._setCalendarOption("_keyboardProcessor",this._calendarKeyboardProcessor);var t=this,e=function(){if(!t._popover.$content().is(":hidden"))return!0;t._popover.show()},n=function(){t._popover.hide()};this._caption.registerKeyHandler("enter",e),this._caption.registerKeyHandler("space",e),this._caption.registerKeyHandler("tab",n)}},_setCalendarOption:function(t,e){this._calendar&&this._calendar.option(t,e)},_getConfig:function(){var t=this.option("step"),e=W.call(this,t);if(!e)throw r.Error("E1033",t);return e}}).include(_);c("dxSchedulerNavigator",$),n.exports=$}

