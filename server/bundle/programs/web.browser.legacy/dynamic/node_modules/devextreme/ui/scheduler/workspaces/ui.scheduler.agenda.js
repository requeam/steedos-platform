function module(e,t,a){"use strict";var n=e("../../../core/renderer"),r=e("../../../core/dom_adapter"),o=e("../../../core/utils/common").noop,i=e("../../../core/utils/iterator").each,s=e("../../../core/utils/dom").getPublicElement,l=e("../../../core/component_registrator"),u=e("./ui.scheduler.work_space"),h=e("../../../core/utils/extend").extend,d=e("../../../localization/date"),c=e("../ui.scheduler.table_creator"),p="dx-scheduler-agenda",_="dx-scheduler-agenda-date",g="dx-scheduler-group-table",C="dx-group-column-count",m="dx-scheduler-time-panel-row",f="dx-scheduler-time-panel-cell",T="dx-scheduler-agenda-nodata",b="dx-scheduler-date-table-last-row",w=5,D=20,v=u.inherit({_activeStateUnit:void 0,_getDefaultOptions:function(){return h(this.callBase(),{agendaDuration:7,rowHeight:60,noDataText:""})},_optionChanged:function(e){var t=e.name,a=e.value;switch(t){case"agendaDuration":break;case"noDataText":case"rowHeight":this._recalculateAgenda(this._rows);break;case"groups":a&&a.length?this._$groupTable||(this._initGroupTable(),this._dateTableScrollable.$content().prepend(this._$groupTable)):this._$groupTable&&(this._$groupTable.remove(),this._$groupTable=null,this._detachGroupCountAttr()),this.callBase(e);break;default:this.callBase(e)}},_renderFocusState:o,_renderFocusTarget:o,_cleanFocusState:o,supportAllDayRow:function(){return!1},_isVerticalGroupedWorkSpace:function(){return!1},_getElementClass:function(){return p},_setFirstViewDate:function(){this._firstViewDate=new Date(this.option("currentDate")),this._setStartDayHour(this._firstViewDate)},_getRowCount:function(){return this.option("agendaDuration")},_getCellCount:function(){return 1},_getTimePanelRowCount:function(){return this.option("agendaDuration")},_getDateByIndex:o,_getFormat:function(){return"d ddd"},_renderAllDayPanel:o,_toggleAllDayVisibility:o,_initWorkSpaceUnits:function(){this._initGroupTable(),this._$timePanel=n("<table>").addClass(this._getTimePanelClass()),this._$dateTable=n("<table>").addClass(this._getDateTableClass())},_initGroupTable:function(){var e=this.option("groups");e&&e.length&&(this._$groupTable=n("<table>").addClass(g))},_renderView:function(){this._setFirstViewDate(),this._rows=[],this.invoke("getAgendaRows",{agendaDuration:this.option("agendaDuration"),currentDate:new Date(this.option("currentDate"))}).done(function(e){this._recalculateAgenda(e)}.bind(this))},_recalculateAgenda:function(e){var t=[];this._cleanView(),this._rowsIsEmpty(e)?this._renderNoData():(this._rows=e,this._$groupTable&&(t=this._renderGroupHeader(),this._setGroupHeaderCellsHeight()),this._renderTimePanel(),this._renderDateTable(),this.invoke("agendaIsReady",e,5,20),this._applyCellTemplates(t),this._dateTableScrollable.update())},_renderNoData:function(){this._$noDataContainer=n("<div>").addClass(T).html(this.option("noDataText")),this._dateTableScrollable.$content().append(this._$noDataContainer)},_setTableSizes:o,_toggleHorizontalScrollClass:o,_createCrossScrollingConfig:o,_setGroupHeaderCellsHeight:function(){var e=this._getGroupHeaderCells().filter((function(e,t){return!t.getAttribute("rowSpan")})),t=this._removeEmptyRows(this._rows);if(t.length)for(var a=0;a<e.length;a++){var n;e.eq(a).find(".dx-scheduler-group-header-content").outerHeight(this._getGroupRowHeight(t[a]))}},_rowsIsEmpty:function(e){for(var t=!0,a=0;a<e.length;a++)for(var n=e[a],r=0;r<n.length;r++)if(n[r]){t=!1;break}return t},_detachGroupCountAttr:function(){this.$element().removeAttr(C)},_attachGroupCountAttr:function(){this.$element().attr(C,this.option("groups").length)},_removeEmptyRows:function(e){for(var t=[],a=function(e){return!e.some((function(e){return e>0}))},n=0;n<e.length;n++)e[n].length&&!a(e[n])&&t.push(e[n]);return t},_getGroupHeaderContainer:function(){return this._$groupTable},_makeGroupRows:function(){var e=this.invoke("createReducedResourcesTree"),t=this.option("resourceCellTemplate"),a=this._getGroupHeaderContentClass(),o=[],i=c.makeGroupedTableFromJSON(c.VERTICAL,e,{cellTag:"th",groupTableClass:g,groupRowClass:this._getGroupRowClass(),groupCellClass:this._getGroupHeaderClass(),groupCellCustomContent:function(e,i,l,u){var h=r.createElement("div"),d=r.createElement("div");h.className=a,d.appendChild(i),h.appendChild(d),h.className=a,t&&t.render?o.push(t.render.bind(t,{model:{data:u.data,id:u.value,color:u.color,text:i.textContent},container:s(n(h)),index:l})):(d.appendChild(i),h.appendChild(d)),e.appendChild(h)},cellTemplate:t});return{elements:n(i).find("."+this._getGroupRowClass()),cellTemplates:o}},_cleanView:function(){this._$dateTable.empty(),this._$timePanel.empty(),this._$groupTable&&this._$groupTable.empty(),this._$noDataContainer&&(this._$noDataContainer.empty(),this._$noDataContainer.remove(),delete this._$noDataContainer)},_createWorkSpaceElements:function(){this._createWorkSpaceStaticElements()},_createWorkSpaceStaticElements:function(){this._$groupTable&&this._dateTableScrollable.$content().prepend(this._$groupTable),this._dateTableScrollable.$content().append(this._$timePanel,this._$dateTable),this.$element().append(this._dateTableScrollable.$element())},_renderDateTable:function(){this._renderTableBody({container:s(this._$dateTable),rowClass:this._getDateTableRowClass(),cellClass:this._getDateTableCellClass()})},_attachTablesEvents:o,_attachEvents:o,_cleanCellDataCache:o,needRenderDateTimeIndication:function(){return!1},_prepareCellTemplateOptions:function(e,t,a,n){var r=this.option("groups"),o={},i;return(r.length&&this._getPathToLeaf(a)||[]).forEach((function(e,t){var a=r[t].name;o[a]=e})),{model:{text:e,date:t,groups:o},container:s(n),index:a}},_renderTableBody:function(e){var t=[],a=e.cellTemplate;this._$rows=[];for(var r=function(r,i){if(i){var s,l,u,h=n("<tr>"),c=n("<td>").height(this._getRowHeight(i));if(e.getStartDate&&(s=e.getStartDate&&e.getStartDate(r),l=d.format(s,"d"),u=d.format(s,this._formatWeekday)),a&&a.render){var p=this._prepareCellTemplateOptions(l+" "+u,s,o,c);t.push(a.render.bind(a,p))}else l&&u&&c.addClass(_).text(l+" "+u);e.rowClass&&h.addClass(e.rowClass),e.cellClass&&c.addClass(e.cellClass),h.append(c),this._$rows.push(h)}}.bind(this),o=0;o<this._rows.length;o++)i(this._rows[o],r),this._setLastRowClass();n(e.container).append(n("<tbody>").append(this._$rows)),this._applyCellTemplates(t)},_setLastRowClass:function(){var e;this._rows.length>1&&this._$rows.length&&this._$rows[this._$rows.length-1].addClass(b)},_renderTimePanel:function(){this._renderTableBody({container:s(this._$timePanel),rowCount:this._getTimePanelRowCount(),cellCount:1,rowClass:m,cellClass:f,cellTemplate:this.option("dateCellTemplate"),getStartDate:this._getTimePanelStartDate.bind(this)})},_getTimePanelStartDate:function(e){var t=new Date(this.option("currentDate")),a;return new Date(t.setDate(t.getDate()+e))},_getRowHeight:function(e){var t=this.option("rowHeight"),a;return e?t*e+5*(e-1)+20:0},_getGroupRowHeight:function(e){if(e){for(var t=0,a=0;a<e.length;a++)t+=this._getRowHeight(e[a]);return t}},getAgendaVerticalStepHeight:function(){return this.option("rowHeight")},getEndViewDate:function(){var e=new Date(this.option("currentDate")),t=this.option("agendaDuration");e.setHours(this.option("endDayHour"));var a=e.setDate(e.getDate()+t-1)-6e4;return new Date(a)},getCoordinatesByDate:function(){return{top:0,left:0,max:0,groupIndex:0}},getCellDataByCoordinates:function(){return{startDate:null,endDate:null}}});l("dxSchedulerAgenda",v),a.exports=v}

