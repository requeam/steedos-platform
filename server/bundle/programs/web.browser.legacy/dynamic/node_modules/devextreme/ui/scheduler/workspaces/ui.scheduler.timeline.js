function module(e,t,i){"use strict";var n=e("../../../core/renderer"),r=e("../../../core/utils/common").noop,l=e("../../../core/utils/extend").extend,o=e("../../../core/component_registrator"),a=e("./ui.scheduler.work_space.indicator"),s=e("../../../core/utils/date"),h=e("../ui.scheduler.table_creator"),u=e("../shaders/ui.scheduler.current_time_shader.horizontal"),d="dx-scheduler-timeline",c="dx-scheduler-group-table",g="dx-scheduler-work-space-horizontal-grouped",_="dx-scheduler-header-panel-cell",f="dx-scheduler-header-panel-week-cell",C="dx-scheduler-header-row",p="horizontal",b=1,D=10,m=s.dateToMilliseconds,T=a.inherit({_init:function(){this.callBase(),this.$element().addClass(d),this._$sidebarTable=n("<table>").addClass(c)},_getCellFromNextRow:function(e,t){return t?this._$focusedCell:this.callBase(e,t)},_getDefaultGroupStrategy:function(){return"vertical"},_toggleGroupingDirectionClass:function(){this.$element().toggleClass(g,this._isHorizontalGroupedWorkSpace())},_getDefaultOptions:function(){return l(this.callBase(),{groupOrientation:"vertical"})},_getRightCell:function(){var e,t=this._$focusedCell,i=this._getCellCount(),n=this._isRTL()?0:i-1,r=this._isRTL()?"prev":"next";return t.index()===n?e=t:(e=t[r](),e=this._checkForViewBounds(e)),e},_getLeftCell:function(){var e,t=this._$focusedCell,i=this._getCellCount(),n=this._isRTL()?i-1:0,r=this._isRTL()?"next":"prev";return t.index()===n?e=t:(e=t[r](),e=this._checkForViewBounds(e)),e},_getRowCount:function(){return 1},_getCellCount:function(){return this._getCellCountInDay()*this.option("intervalCount")},getGroupTableWidth:function(){return this._$sidebarTable?this._$sidebarTable.outerWidth():0},_getTotalRowCount:function(e){return this._isHorizontalGroupedWorkSpace()?this._getRowCount():(e=e||1,this._getRowCount()*e)},_getDateByIndex:function(e){var t=new Date(this._firstViewDate),i=Math.floor(e/this._getCellCountInDay());return t.setTime(this._firstViewDate.getTime()+this._calculateCellIndex(0,e)*this._getInterval()+i*this._getHiddenInterval()),t},_getFormat:function(){return"shorttime"},_needApplyLastGroupCellClass:function(){return!0},_calculateHiddenInterval:function(e,t){var i;return Math.floor(t/this._getCellCountInDay())*this._getHiddenInterval()},_getMillisecondsOffset:function(e,t){return t=this._calculateCellIndex(e,t),this._getInterval()*t+this._calculateHiddenInterval(e,t)},_createWorkSpaceElements:function(){this._createWorkSpaceScrollableElements()},_getWorkSpaceHeight:function(){return this.option("crossScrollingEnabled")?this._$dateTable.get(0).getBoundingClientRect().height:this.$element().get(0).getBoundingClientRect().height},_dateTableScrollableConfig:function(){var e,t=this.callBase(),i={direction:p,onStart:function(){this._headerScrollable&&(e=this._headerScrollable.option("onScroll"),this._headerScrollable.option("onScroll",void 0))}.bind(this),onScroll:function(e){this._headerScrollable&&this._headerScrollable.scrollTo({left:e.scrollOffset.left})}.bind(this),onEnd:function(t){this._headerScrollable&&this._headerScrollable.option("onScroll",e)}.bind(this)};return this.option("crossScrollingEnabled")?t:l(t,i)},_headerScrollableConfig:function(){var e=this.callBase();return l(e,{scrollByContent:!0})},_renderTimePanel:r,_renderAllDayPanel:r,_getTableAllDay:function(){return!1},_getDateHeaderTemplate:function(){return this.option("timeCellTemplate")},_toggleAllDayVisibility:r,_changeAllDayVisibility:r,supportAllDayRow:function(){return!1},_getGroupHeaderContainer:function(){return this._isHorizontalGroupedWorkSpace()?this._$thead:this._$sidebarTable},_insertAllDayRowsIntoDateTable:function(){return!1},_createAllDayPanelElements:r,_renderDateHeader:function(){var e=this.callBase();if(this._needRenderWeekHeader()){for(var t=new Date(this._firstViewDate),i=[],r=this._getCellCountInDay(),l=this.option("dateCellTemplate"),o=0;o<this._getWeekDuration()*this.option("intervalCount");o++){var a=n("<th>"),s=this._formatWeekdayAndDay(t);if(l){var h={model:{text:s,date:new Date(t)},container:a,index:o};l.render(h)}else a.text(s);a.addClass(_).addClass(f).attr("colSpan",r),i.push(a),this._incrementDate(t)}var u=n("<tr>").addClass(C).append(i);e.before(u)}},_needRenderWeekHeader:function(){return!1},_incrementDate:function(e){e.setDate(e.getDate()+1)},_getWeekDuration:function(){return 1},_renderView:function(){this._setFirstViewDate();var e=this._renderGroupHeader();this._renderDateHeader(),this._renderAllDayPanel(),this._renderTimePanel(),this._renderDateTable(),this._shader=new u,this._updateGroupTableHeight(),this._$sidebarTable.appendTo(this._sidebarScrollable.$content()),this._applyCellTemplates(e)},_setHorizontalGroupHeaderCellsHeight:r,getIndicationWidth:function(){var e=this._getToday(),t=this.getCellWidth(),i=this._getIndicationFirstViewDate(),n=this._getHiddenInterval(),r=e.getTime()-i.getTime(),l,o,a;return(r-(Math.ceil(r/m("day"))-1)*n)/this.getCellDuration()*t},_renderIndicator:function(e,t,i,n){var r,l=this.getIndicationWidth();if("vertical"===this.option("groupOrientation"))(r=this._createIndicator(i)).height(i.get(0).getBoundingClientRect().height),r.css("left",t?t-l:l);else for(var o=0;o<n;o++){var a=this._getCellCount()*this.getCellWidth()*o;(r=this._createIndicator(i)).height(i.get(0).getBoundingClientRect().height),r.css("left",t?t-l-a:l+a)}},_isVerticalShader:function(){return!1},_isCurrentTimeHeaderCell:function(e){var t=!1;if(this.option("showCurrentTimeIndicator")&&this._needRenderDateTimeIndicator()){var i=this._getDateByIndex(e),n=this._getToday();if(i=new Date(i),s.sameDate(n,i)){var r=new Date(i),l=new Date(i);l=l.setMilliseconds(i.getMilliseconds()+this.getCellDuration()),t=s.dateInRange(n,r,l)}}return t},_cleanView:function(){this.callBase(),this._$sidebarTable.empty()},_visibilityChanged:function(e){this.callBase(e)},_setTableSizes:function(){var e=this.getCellHeight(),t=this._getWorkSpaceMinHeight(),i,n=e*this._$sidebarTable.find("tr").length;n<t&&(n=t),this._$sidebarTable.height(n),this._$dateTable.height(n),this.callBase()},_getWorkSpaceMinHeight:function(){var e=this._getWorkSpaceHeight(),t=this.$element().outerHeight(!0)-this.getHeaderPanelHeight()-2-10;return e<t&&(e=t),e},_makeGroupRows:function(e,t){var i="vertical"===this.option("groupOrientation")?h.VERTICAL:h.HORIZONTAL;return h.makeGroupedTable(i,e,{groupRowClass:this._getGroupRowClass(),groupHeaderRowClass:this._getGroupRowClass(),groupHeaderClass:this._getGroupHeaderClass.bind(this),groupHeaderContentClass:this._getGroupHeaderContentClass()},this._getCellCount()||1,this.option("resourceCellTemplate"),this._getTotalRowCount(this._getGroupCount()),t)},_ensureGroupHeaderCellsHeight:function(e){var t=this._calculateMinCellHeight();return e<t?t:e},_calculateMinCellHeight:function(){var e=this._getDateTable(),t="."+this._getDateTableRowClass();return e.get(0).getBoundingClientRect().height/e.find(t).length-2},_getCellCoordinatesByIndex:function(e){return{cellIndex:e%this._getCellCount(),rowIndex:0}},_getCellByCoordinates:function(e,t){var i=this._groupedStrategy.prepareCellIndexes(e,t);return this._$dateTable.find("tr").eq(i.rowIndex).find("td").eq(i.cellIndex)},_getWorkSpaceWidth:function(){return this._$dateTable.outerWidth(!0)},_getGroupIndexByCell:function(e){return e.parent().index()},_getIndicationFirstViewDate:function(){return new Date(this._firstViewDate)},_getIntervalBetween:function(e,t){var i=this.option("startDayHour"),n=this.option("endDayHour"),r=this.getStartViewDate(),l=r.getTime(),o=(24-n+i)*m("hour"),a=s.getTimezonesDifference(r,e),h=e.getTime(),u=h-l-a,d=Math.floor(u/m("day")),c=u-d*m("day"),g=0,_=this._getCellCountInDay()*(d-this._getWeekendsCount(d)),f=h-s.trimTime(new Date(e)).getTime(),C=_*this.option("hoursInterval")*m("hour");return t||(e.getHours()<i?g=c-o+f:e.getHours()>=i&&e.getHours()<n?g=c:e.getHours()>=i&&e.getHours()>=n?g=c-(f-n*m("hour")):d||(C=u),C+=g),C},_getWeekendsCount:function(){return 0},getAllDayContainer:function(){return null},getTimePanelWidth:function(){return 0},getPositionShift:function(e){var t=this.callBase(e),i=this.getCellWidth()*e;return this.option("rtlEnabled")&&(i*=-1),{top:0,left:i+=t.left,cellPosition:i}},getVisibleBounds:function(){var e=this.option("rtlEnabled"),t={},i=this.getScrollable().$element(),n=this.getCellWidth(),r,l=(e?this.getScrollableOuterWidth()-this.getScrollableScrollLeft():this.getScrollableScrollLeft())/n,o=i.width()/n,a=e?l-o:l+o,h=this._getDateByIndex(l),u=this._getDateByIndex(a);return e&&(h=this._getDateByIndex(a),u=this._getDateByIndex(l)),t.left={hours:h.getHours(),minutes:h.getMinutes()>=30?30:0,date:s.trimTime(h)},t.right={hours:u.getHours(),minutes:u.getMinutes()>=30?30:0,date:s.trimTime(u)},t},needUpdateScrollPosition:function(e,t,i,n){var r=!1;return r=this._dateWithinBounds(i,n),(e<i.left.hours||e>i.right.hours)&&(r=!0),e===i.left.hours&&t<i.left.minutes&&(r=!0),e===i.right.hours&&t>i.right.minutes&&(r=!0),r},getIntervalDuration:function(e){return this.getCellDuration()},_dateWithinBounds:function(e,t){var i=s.trimTime(new Date(t)),n=!1;return(i<e.left.date||i>e.right.date)&&(n=!0),n},_supportCompactDropDownAppointments:function(){return!1},getCellMinWidth:function(){return 0},getWorkSpaceLeftOffset:function(){return 0},scrollToTime:function(e,t,i){var n=this._getScrollCoordinates(e,t,i),r=this.getScrollable(),l=this.option("rtlEnabled")?this.getScrollableContainer().get(0).getBoundingClientRect().width:0;r.scrollBy({left:n.left-r.scrollLeft()-l,top:0})}});o("dxSchedulerTimeline",T),i.exports=T}

