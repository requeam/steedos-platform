function module(e,t){"use strict";var r=e("../../core/utils/type"),n=e("../../core/utils/ajax"),a=e("../../core/utils/data"),o=e("../../core/utils/iterator"),u=e("../../core/utils/extend").extend,i=e("../../core/utils/type").isDefined,l=e("../../localization/date"),c=e("../../format_helper"),f=e("../../data/data_source/data_source"),d=e("../../data/array_store"),s=e("../../core/utils/deferred"),p=s.when,h=s.Deferred,v=t.setFieldProperty=function(e,t,r,n){var a=e._initProperties=e._initProperties||{},o=n?r:e[t];a.hasOwnProperty(t)&&!n||(a[t]=o),e[t]=r};t.sendRequest=function(e){return n.sendRequest(e)};var m=new Date;function g(e){var t;return function t(r,n,a,o,u,i){var l,c,f,d;function s(e,u,i){p(t(r,n,a,o,u,i)).done(e.resolve)}for(o=o||[],r=r||[],c=u=u||0;c<r.length;c++){if(e&&c>u&&c%1e4==0&&new Date-m>=300)return m=new Date,f=new h,setTimeout(s(f,c,!1),0),f;if(l=r[c],!i){if(o.unshift(l),a&&!1===n(o,c))return;if(l.children&&(d=t(l.children,n,a,o),e&&d))return f=new h,d.done(s(f,c,!0)),f}if(i=!1,!a&&!1===n(o,c))return;o.shift(),r[c]!==l&&c--}}}function y(e){return o.map(["year","quarter","month"],(function(t,r){return u({},e,{groupInterval:t,groupIndex:r})}))}function x(e,t,n,u){var i=[];return o.each(t||[],(function(t,o){if(!t||0!==t.indexOf("__")){for(var l,c=1,f=n.length?n+"."+t:t,d=u[f],s=a.compileGetter(f);!r.isDefined(o)&&e[c];)o=s(e[c]),c++;!d&&r.isDefined(o)&&(d=r.type(o)),l=[{dataField:f,dataType:d,groupName:"date"===d?t:void 0,groupInterval:void 0,displayFolder:n}],"date"===d?l=l.concat(y(l[0])):"object"===d&&(l=x(e,o,f,u)),i.push.apply(i,l)}})),i}t.foreachTree=g(!1),t.foreachTreeAsync=g(!0),t.findField=function(e,t){var n,a;if(e&&r.isDefined(t))for(n=0;n<e.length;n++)if((a=e[n]).name===t||a.caption===t||a.dataField===t||a.index===t)return n;return-1},t.formatValue=function(e,t){var r={value:e,valueText:c.format(e,t.format)||""};return t.customizeText?t.customizeText.call(t,r):r.valueText},t.getCompareFunction=function(e){return function(t,r){var n=0,a=e(t),o=e(r),u=i(a),l=i(o);return u&&l&&(a>o?n=1:a<o&&(n=-1)),u&&!l&&(n=1),!u&&l&&(n=-1),n}},t.createPath=function(e){var t,r=[];for(t=e.length-1;t>=0;t--)r.push(e[t].key||e[t].value);return r},t.foreachDataLevel=function e(t,r,n,a){var o,u;for(n=n||0,a=a||"children",t.length&&r(t,n),u=0;u<t.length;u++)(o=t[u])[a]&&o[a].length&&e(o[a],r,n+1,a)},t.mergeArraysByMaxValue=function(e,t){var r,n=[];for(r=0;r<e.length;r++)n.push(Math.max(e[r]||0,t[r]||0));return n},t.getExpandedLevel=function(e,t){var r=e[t],n=0,a=("columns"===t?e.columnExpandedPaths:e.rowExpandedPaths)||[];for(e.headerName===t?n=e.path.length:o.each(a,(function(e,t){n=Math.max(n,t.length)}));r[n+1]&&r[n].expanded;)n++;return n},t.discoverObjectFields=function(e,r){var n=t.getFieldsDataType(r);return x(e,e[0],"",n)},t.getFieldsDataType=function(e){var t={};return o.each(e,(function(e,r){t[r.dataField]=t[r.dataField]||r.dataType})),t};var D={month:function(e){return l.getMonthNames()[e-1]},quarter:function(e){return l.format(new Date(2e3,3*e-1),"quarter")},dayOfWeek:function(e){return l.getDayNames()[e]}};t.setDefaultFieldValueFormatting=function(e){if("date"===e.dataType)e.format||v(e,"format",D[e.groupInterval]);else if("number"===e.dataType){var t=r.isNumeric(e.groupInterval)&&e.groupInterval>0&&e.groupInterval;t&&!e.customizeText&&v(e,"customizeText",(function(r){var n=r.value+t,a=c.format(n,e.format);return r.valueText&&a?r.valueText+" - "+a:""}))}},t.getFiltersByPath=function(e,t){var r=[];t=t||[];for(var n=0;n<t.length;n++)r.push(u({},e[n],{groupIndex:null,groupName:null,filterType:"include",filterValues:[t[n]]}));return r},t.storeDrillDownMixin={createDrillDownDataSource:function(e,t){function r(e){return function(t){var r;return n?r=n[e](t):(r=new h,p(a).done((function(a){(n=new d(a))[e](t).done(r.resolve).fail(r.reject)})).fail(r.reject)),r}}var n,a=this.getDrillDownItems(e,t),o;return new f.DataSource({load:r("load"),totalCount:r("totalCount"),key:this.key()})}},t.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}

