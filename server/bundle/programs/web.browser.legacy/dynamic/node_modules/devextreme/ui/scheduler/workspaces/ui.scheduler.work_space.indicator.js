function module(e,t,i){"use strict";var n=e("../../../core/renderer"),a=e("./ui.scheduler.work_space"),r=e("../../../core/component_registrator"),s=e("../../../core/utils/date"),o=e("../../../core/utils/extend").extend,d=e("../../../core/utils/window"),l=s.dateToMilliseconds,c="dx-scheduler-date-time-indicator",h="dx-scheduler-time-panel-current-time-cell",u="dx-scheduler-header-panel-current-time-cell",_=a.inherit({_getToday:function(){var e=this.option("indicatorTime")||new Date;return this.invoke("convertDateByTimezone",e)||e},_needRenderDateTimeIndicator:function(){var e=this._getToday(),t=s.trimTime(this.getEndViewDate());return s.dateInRange(e,this._firstViewDate,new Date(t.getTime()+l("day")))},needRenderDateTimeIndication:function(){return!!d.hasWindow()&&this._getToday()>=s.trimTime(new Date(this.getStartViewDate()));var e},_renderDateTimeIndication:function(){if(this.needRenderDateTimeIndication()&&(this.option("shadeUntilCurrentTime")&&this._shader.render(this),this.option("showCurrentTimeIndicator")&&this._needRenderDateTimeIndicator())){var e=this._getGroupCount()||1,t=this._dateTableScrollable.$content(),i=this.getIndicationHeight(),n=this._getRtlOffset(this.getCellWidth());i>0&&this._renderIndicator(i,n,t,e)}},_renderIndicator:function(e,t,i,n){for(var a=0;a<n;a++){var r=this._createIndicator(i);r.width(this.getCellWidth()),this._groupedStrategy.shiftIndicator(r,e,t,a)}},_createIndicator:function(e){var t=n("<div>").addClass("dx-scheduler-date-time-indicator");return e.append(t),t},_getRtlOffset:function(e){return this.option("rtlEnabled")?this._dateTableScrollable.$content().get(0).getBoundingClientRect().width-this.getTimePanelWidth()-e:0},_setIndicationUpdateInterval:function(){this.option("showCurrentTimeIndicator")&&0!==this.option("indicatorUpdateInterval")&&(this._clearIndicatorUpdateInterval(),this._indicatorInterval=setInterval(function(){this._refreshDateTimeIndication()}.bind(this),this.option("indicatorUpdateInterval")))},_clearIndicatorUpdateInterval:function(){this._indicatorInterval&&(clearInterval(this._indicatorInterval),delete this._indicatorInterval)},_isVerticalShader:function(){return!0},getIndicationWidth:function(e){var t=this.getCellWidth()*this._getCellCount(),i=this._getIndicatorDuration();i>this._getCellCount()&&(i=this._getCellCount());var n=i*this.getRoundedCellWidth(e,e*this._getCellCount(),i);return t<n?t:n},getIndicatorOffset:function(e){var t=this._getIndicatorDuration()-1,i;return t*this.getRoundedCellWidth(e,e*this._getCellCount(),t)},_getIndicatorDuration:function(){var e=this._getToday(),t=new Date(this._firstViewDate),i=e.getTime()-t.getTime()+1;return Math.ceil(i/l("day"))},getIndicationHeight:function(){var e=this._getToday(),t=this.getCellHeight(),i=new Date(this._firstViewDate),n,a;return this._needRenderDateTimeIndicator()&&i.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),(e.getTime()-i.getTime())/this.getCellDuration()*t},_dispose:function(){this._clearIndicatorUpdateInterval(),this.callBase.apply(this,arguments)},_refreshDateTimeIndication:function(){this._cleanDateTimeIndicator(),this._shader&&this._shader.clean(),this._renderDateTimeIndication()},_isCurrentTime:function(e){if(this.option("showCurrentTimeIndicator")&&this._needRenderDateTimeIndicator()){var t=this._getToday(),i=!1;(e=new Date(e)).setFullYear(t.getFullYear(),t.getMonth(),t.getDate());var n=new Date(e),a=new Date(e);return s.sameDate(t,e)&&(n=n.setMilliseconds(e.getMilliseconds()-this.getCellDuration()+1),a=a.setMilliseconds(e.getMilliseconds()+this.getCellDuration()),i=s.dateInRange(t,n,a)),i}},_isCurrentTimeHeaderCell:function(e){var t=!1;if(this.option("showCurrentTimeIndicator")&&this._needRenderDateTimeIndicator()){var i=this._getDateByIndex(e),n=this.option("indicatorTime")||new Date;t=s.sameDate(i,n)}return t},_getTimeCellClass:function(e){var t=this._getTimeCellDate(e),i=this.callBase(e);return this._isCurrentTime(t)?i+" "+h:i},_getHeaderPanelCellClass:function(e){var t=this.callBase(e);return this._isCurrentTimeHeaderCell(e)?t+" "+u:t},_cleanView:function(){this.callBase(),this._cleanDateTimeIndicator()},_dimensionChanged:function(){this.callBase(),this._refreshDateTimeIndication()},_cleanDateTimeIndicator:function(){this.$element().find(".dx-scheduler-date-time-indicator").remove()},_cleanWorkSpace:function(){this.callBase(),this._renderDateTimeIndication(),this._setIndicationUpdateInterval()},_optionChanged:function(e){switch(e.name){case"showCurrentTimeIndicator":case"indicatorTime":this._cleanWorkSpace();break;case"indicatorUpdateInterval":this._setIndicationUpdateInterval();break;case"showAllDayPanel":case"allDayExpanded":case"crossScrollingEnabled":this.callBase(e),this._refreshDateTimeIndication();break;case"shadeUntilCurrentTime":this._refreshDateTimeIndication();break;default:this.callBase(e)}},_getDefaultOptions:function(){return o(this.callBase(),{showCurrentTimeIndicator:!0,indicatorTime:new Date,indicatorUpdateInterval:5*l("minute"),shadeUntilCurrentTime:!0})}});r("dxSchedulerWorkSpace",_),i.exports=_}

