function module(e,t,n){"use strict";var i,o=U(e("../../core/renderer")),a,r=U(e("../../core/utils/callbacks")),l=e("../../core/utils/variable_wrapper"),s,u=U(e("../../core/utils/data")),d=e("../../core/utils/common"),c=e("../../core/utils/type"),h,m=U(e("../../core/utils/iterator")),f=e("../../core/utils/position"),p=e("../../core/utils/extend"),g=e("../../core/utils/array"),x,C=U(e("../../core/config")),v=e("../../core/utils/object"),_,y=U(e("../widget/ui.errors")),b,I=U(e("./ui.grid_core.modules")),S=e("./ui.grid_core.utils"),w,F=U(e("../../core/utils/inflector")),O,D=U(e("../../core/utils/date_serialization")),V,z=U(e("../../localization/number")),B,E=U(e("../../localization/date")),T,P=U(e("../../localization/message")),A=e("../../core/utils/deferred"),G,R=U(e("../../data/abstract_store")),M=e("../../data/data_source/data_source"),k,N=U(e("../shared/filtering"));function U(e){return e&&e.__esModule?e:{default:e}}var W=["filterValues","filterType","fixed","fixedPosition"],j=["visibleIndex","dataField","name","dataType","width","visible","sortOrder","lastSortOrder","sortIndex","groupIndex","filterValue","selectedFilterOperation","added"].concat(W),q={visibleWidth:!0,bestFitWidth:!0,bufferedFilterValue:!0},H="dx-command-expand",L=Number.MAX_SAFE_INTEGER||9007199254740991,X="groupExpand",J=/columns\[(\d+)\]\.?/gi,K=1,Q,Y,Z,$,ee,te,ne,ie,oe,ae,re,le,se,ue,de,ce,he,me,fe,pe,ge,xe,Ce,ve,_e,ye,be,Ie,Se,we,Fe,Oe,De,Ve,ze,Be,Ee,Te,Pe,Ae,Ge,Re,Me,ke,Ne,Ue,We,je;n.exports={defaultOptions:function(){return{commonColumnSettings:{allowFiltering:!0,allowHiding:!0,allowSorting:!0,allowEditing:!0,encodeHtml:!0,trueText:P.default.format("dxDataGrid-trueText"),falseText:P.default.format("dxDataGrid-falseText")},allowColumnReordering:!1,allowColumnResizing:!1,columnResizingMode:"nextColumn",columnMinWidth:void 0,columnWidth:void 0,adaptColumnWidthByRatio:!0,columns:void 0,regenerateColumnsByVisibleItems:!1,customizeColumns:null,dateSerializationFormat:void 0}},controllers:{columns:I.default.Controller.inherit((Q={visible:!0,showInColumnChooser:!0},Y={number:["=","<>","<",">","<=",">=","between"],string:["contains","notcontains","startswith","endswith","=","<>"],date:["=","<>","<",">","<=",">=","between"],datetime:["=","<>","<",">","<=",">=","between"]},Z={visibleIndex:!0,groupIndex:!0,grouped:!0,sortIndex:!0,sortOrder:!0},$="group",ee="columnChooser",te=function(e){e.filterOperations=e.defaultFilterOperations},ne=function(e,t,n,i){var o,a={};if(t){(0,c.isString)(t)&&(t={dataField:t});var r=void 0;return t.command?r=(0,v.deepExtendArraySafe)(a,t):(a=e.getCommonSettings(t),n&&n.name&&n.dataField&&(t=(0,p.extend)({},t,{dataField:n.dataField})),o=e._createCalculatedColumnOptions(t,i),r=(0,v.deepExtendArraySafe)({headerId:"dx-col-"+K++},Q),(0,v.deepExtendArraySafe)(r,a),(0,v.deepExtendArraySafe)(r,o),(0,v.deepExtendArraySafe)(r,t),(0,v.deepExtendArraySafe)(r,{selector:null})),t.filterOperations===t.defaultFilterOperations&&te(r),r}},ie=function e(t,n,i){var o=[];return n&&m.default.each(n,(function(n,a){var r=t._columnsUserState&&be(a,t._columnsUserState[n])&&t._columnsUserState[n],l=ne(t,a,r,i);l&&(i&&(l.ownerBand=i),o.push(l),l.isBand&&(o=o.concat(e(t,l.columns,l)),delete l.columns))})),o},oe=function(e,t){for(var n=[],i=t[e];i;)n.unshift(i),i=t[e=i.index];return n},ae=function e(t,n,i){var o,a=[],r=n[t];if(r)for(var l=0;l<r.length;l++)o=r[l],(0,c.isDefined)(o.groupIndex)&&!o.showWhenGrouped||(a.push(o),i&&o.isBand&&(a=a.concat(e(o.index,n,i))));return a},re=function(e,t){for(var n,i=function(e){var t=n?n.index:void 0;return e.ownerBand===t},o=e._columns.filter(i),a=0;a<t.length;a++)(n=o[t[a]])&&(o=e._columns.filter(i));return n},le=function(e,t){for(var n=[],i=e.getBandColumnsCache(),o=function(e){return e.ownerBand===t.ownerBand},a=e._columns.filter(o);a.length&&-1!==a.indexOf(t);)n.unshift("columns["+a.indexOf(t)+"]"),a=(t=i.columnParentByIndex[t.index])?e._columns.filter(o):[];return n.join(".")},se=function e(t,n){var i=0,o=t.getChildrenByBandColumn(n,!0);return m.default.each(o,(function(n,o){o.isBand?(o.colspan=o.colspan||e(t,o.index),i+=o.colspan||1):i+=1})),i},ue=function(e,t,n){var i,o,a,r=e.getRowCount();for(i=0;i<t.length;i++)((o=t[i]).visible||o.command)&&(o.isBand&&(o.colspan=o.colspan||se(e,o.index)),o.isBand&&o.colspan||(a=r-(o.command||(0,c.isDefined)(o.groupIndex)?0:oe(o.index,n.columnParentByIndex).length))>1&&(o.rowspan=a))},de=function(e){var t=(0,c.type)(e);return"string"!==t&&"boolean"!==t&&"number"!==t&&"date"!==t&&"object"!==t&&(t=void 0),t},ce=function(e,t){switch(e){case"date":case"datetime":return D.default.getDateSerializationFormat(t);case"number":if((0,c.isString)(t))return"string";if((0,c.isNumeric)(t))return null}},he=function(e,t){e.deserializeValue||((0,S.isDateType)(t)&&(e.deserializeValue=function(e){return D.default.deserializeDate(e)},e.serializeValue=function(e){return(0,c.isString)(e)?e:D.default.serializeDate(e,this.serializationFormat)}),"number"===t&&(e.deserializeValue=function(e){var t=parseFloat(e);return isNaN(t)?e:t},e.serializeValue=function(e,t){return"filter"===t?e:(0,c.isDefined)(e)&&"string"===this.serializationFormat?e.toString():e}))},me=function(e,t){switch(e){case"number":return"right";case"boolean":return"center";default:return(0,f.getDefaultAlignment)(t)}},fe=function(e){if("boolean"===e)return function(e){return!0===e.value?this.trueText||"true":!1===e.value?this.falseText||"false":e.valueText||""}},pe=function(e,t){var n,i,o=e._getFirstItems(t),a={},r=[];for(i=0;i<o.length;i++)if(o[i])for(n in o[i])(0,c.isFunction)(o[i][n])&&!(0,l.isWrapped)(o[i][n])||(a[n]=!0);for(n in a)if(0!==n.indexOf("__")){var s=ne(e,n);r.push(s)}return r},ge=function(e){m.default.each(e._columns,(function(e,t){t.index=e})),m.default.each(e._columns,(function(e,t){(0,c.isObject)(t.ownerBand)&&(t.ownerBand=t.ownerBand.index)})),m.default.each(e._commandColumns,(function(e,t){t.index=-(e+1)}))},xe=function(e,t){(0,g.normalizeIndexes)(e._columns,"groupIndex",t,(function(e){var t=e.grouped;return delete e.grouped,t}))},Ce=function(e,t){m.default.each(e._columns,(function(e,t){(0,c.isDefined)(t.sortIndex)&&!Ee(t.sortOrder)&&delete t.sortIndex})),(0,g.normalizeIndexes)(e._columns,"sortIndex",t,(function(e){return!(0,c.isDefined)(e.groupIndex)&&Ee(e.sortOrder)}))},ve=function(e,t){var n,i,o,a,r,l={},s=[],u=e.getBandColumnsCache(),d=e._columns.filter((function(e){return!e.command}));for(n=0;n<d.length;n++)o=d[n],(r=oe(n,u.columnParentByIndex)).length?(l[a=r[r.length-1].index]=l[a]||[],l[a].push(o)):s.push(o);for(i in l)(0,g.normalizeIndexes)(l[i],"visibleIndex",t);(0,g.normalizeIndexes)(s,"visibleIndex",t)},_e=function(e,t,n){var i,o=(0,c.isObject)(t)?t.rowIndex:null,a="group"===n?e.getGroupColumns():"columnChooser"===n?e.getChooserColumns():e.getVisibleColumns(o);return t=(0,c.isObject)(t)?t.columnIndex:t,(i=a[t])&&"groupExpand"===i.type&&(i=e._columns.filter((function(e){return i.type===e.type}))[0]||i),i&&(0,c.isDefined)(i.index)?i.index:-1},ye=function(e,t,n){var i,o=e.getGroupColumns();if(n>=0)for(i=0;i<o.length;i++)o[i].groupIndex>=n&&o[i].groupIndex++;else for(n=0,i=0;i<o.length;i++)n=Math.max(n,o[i].groupIndex+1);return n},be=function(e,t){return e&&t&&t.name===e.name&&(t.dataField===e.dataField||e.name)},Ie=function(e){var t,n,i,o,a=e._columnsUserState,r=e._ignoreColumnOptionNames||[],l=e._columns,s={},u=[],d=!0,h=[];function m(e,t){var n;if(t)for(var i=0;i<j.length;i++)n=j[i],(0,g.inArray)(n,r)>=0||("dataType"===n?e[n]=e[n]||t[n]:(0,g.inArray)(n,W)>=0?n in t&&(e[n]=t[n]):("selectedFilterOperation"===n&&t[n]&&(e.defaultSelectedFilterOperation=e[n]||null),e[n]=t[n]))}function f(e,t){for(var n=t.name||t.dataField,i=s[n]||0,o=0;o<e.length;o++)if(be(t,e[o])){if(!i)return s[n]=s[n]||0,s[n]++,o;i--}return-1}if(a){for(o=0;o<l.length;o++)i=f(a,l[o]),d=d&&i>=0,h.push(i);for(o=0;o<l.length;o++)t=l[o],i=h[o],(e._hasUserState||d)&&m(t,a[i]),i>=0&&(0,c.isDefined)(a[i].initialIndex)?u[i]=t:u.push(t);var p=!1;for(o=0;o<a.length;o++)(n=a[o]).added&&f(l,n)<0&&(m(t=ne(e,n.added),n),u.push(t),n.added.columns&&(p=!0));p&&(ge(e),u=ie(e,u)),Fe(e,u)}},Se=function(e,t){ge(e),xe(e,t),Ce(e,t),ve(e,t)},we=function(e){e.resetColumnsCache()},Fe=function(e,t){e._columns=t,we(e),e.updateColumnDataTypes()},Oe=function(e,t,n,i){var o=e._columnChanges||{optionNames:{length:0},changeTypes:{length:0},columnIndex:i};n=(n=n||"all").split(".")[0];var a=o.changeTypes;t&&!a[t]&&(a[t]=!0,a.length++);var r=o.optionNames;n&&!r[n]&&(r[n]=!0,r.length++),void 0!==i&&i===o.columnIndex||delete o.columnIndex,e._columnChanges=o,we(e)},De=function(e){var t=e.option("onColumnsChanging"),n=e._columnChanges,i=["dataField","lookup","dataType","columns"],o=function(e){return e&&i.some((function(t){return e[t]}))};e.isInitialized()&&!e._updateLockCount&&n&&(t&&(e._updateLockCount++,t((0,p.extend)({component:e.component},n)),e._updateLockCount--),e._columnChanges=void 0,o(n.optionNames)?e.reinit():e.columnsChanged.fire(n))},Ve=function(e,t,n){var i;t>=0?n>=0||(e.lastSortOrder=e.sortOrder):e.sortOrder=e.lastSortOrder},ze=function(e,t){var n=t.value,i=t.optionName,o=t.prevValue,a=t.fullOptionName;q[i]||(e._skipProcessingColumnsChange=!0,e.component._notifyOptionChanged(a+"."+i,n,o),e._skipProcessingColumnsChange=!1)},Be=function(e,t,n,i,o){var a,r,l,s,d,h,m=u.default.compileGetter(n),f=t.index;if(3===arguments.length)return m(t,{functionsAsIs:!0});(a=m(t,{functionsAsIs:!0}))!==i&&("groupIndex"===n||"calculateGroupValue"===n?(s="grouping",Ve(t,i,a)):s="sortIndex"===n||"sortOrder"===n||"calculateSortValue"===n?"sorting":"columns",(r=u.default.compileSetter(n))(t,i,{functionsAsIs:!0}),(d=le(e,t))&&ze(e,{fullOptionName:d,optionName:n,value:i,prevValue:a}),(0,c.isDefined)(a)||(0,c.isDefined)(i)||0===n.indexOf("buffer")||(o=!0),o?we(e):((0,g.inArray)(n,j)<0&&"visibleWidth"!==n&&(l=e.option("columns"),h=e.getColumnByPath(d,l),(0,c.isString)(h)&&(h=l[f]={dataField:h}),h&&be(h,t)&&r(h,i,{functionsAsIs:!0})),Oe(e,s,n,f)))},Ee=function(e){return"asc"===e||"desc"===e},Te=function(e){var t=e._getExpandColumnOptions();e.addCommandColumn(t)},Pe=function(e,t){var n,i,o=this.dataField.split("."),a=o.length-1;for(this.serializeValue&&(t=this.serializeValue(t)),i=0;i<a;i++)e=e[n=o[i]]=e[n]||{};e[o[a]]=t},Ae=function e(t,n,i){var o=[];return t[n=n||0]&&m.default.each(t[n],(function(a,r){(r.ownerBand===i||(0,c.isDefined)(r.groupIndex))&&(r.isBand&&r.colspan?o.push.apply(o,e(t,n+1,r.index)):(!r.command||n<1)&&o.push(r))})),o},Ge=function(e,t,n){var i=1,o,a=e.getBandColumnsCache().columnParentByIndex;return e._columns.forEach((function(e){var t=oe(e.index,a),n=t.filter((function(e){return!e.visible}));e.visible&&!n.length&&(i=Math.max(i,t.length+1))})),i},Re=function(e,t){var n=e.option("rtlEnabled");return t.command&&!We(e,t)||!t.fixedPosition?n?"right":"left":t.fixedPosition},Me=function(e,t,n,i){var o,a=this.getRowCount(),r=e[i]&&e[i].rowspan,l=t.filter((function(e){return e.type===n}));return e.forEach((function(t,i){t.type===n&&(o=i,r=e[i+1]?e[i+1].rowspan:a)})),r>1&&(l=m.default.map(l,(function(e){return(0,p.extend)({},e,{rowspan:r})}))),l.unshift.apply(l,(0,c.isDefined)(o)?[o,1]:[i,0]),e.splice.apply(e,l),r||1},ke=function(e){var t;for(t=0;e>1;t++)e/=10;return t},Ne=function(e,t){for(var n=e?e.toString():"0";n.length<t;)n="0"+n;return n},Ue=function(e,t,n,i){var o,a,r,l,s=t.slice().map((function(e){return(0,p.extend)({},e)})),u=e._isColumnFixing(),d=n.slice().map((function(e){return(0,p.extend)({fixed:u},e)})),c=function(e){return n.reduce((function(t,n,o){var a=i&&"groupExpand"===e.type?"expand":e.type;return n.type===a||n.command===e.command?o:t}),-1)},h=function(e){return e.command!==n[l].command};for(o=0;o<t.length;o++)a=t[o],(l=a&&(a.type||a.command)?c(a):-1)>=0&&(i?(s[o]=(0,p.extend)({fixed:u},n[l],a),"groupExpand"!==a.type&&(d=d.filter(h))):(r={visibleIndex:a.visibleIndex,index:a.index,headerId:a.headerId,allowFixing:0===a.groupIndex,allowReordering:0===a.groupIndex,groupIndex:a.groupIndex},s[o]=(0,p.extend)({},a,n[l],"groupExpand"===a.type&&r)));return t.length&&i&&d.length&&(s=s.concat(d)),s},We=function(e,t){return!!e._columns.filter((function(e){return e.type===t.type})).length},je=function(e,t){return(0,c.isDefined)(t.fixed)||!t.type?t.fixed:e._isColumnFixing()},{_getExpandColumnOptions:function(){return{type:"expand",command:"expand",width:"auto",cssClass:"dx-command-expand",allowEditing:!1,allowGrouping:!1,allowSorting:!1,allowResizing:!1,allowReordering:!1,allowHiding:!1}},_getFirstItems:function(e){var t,n=[],i=function e(t,n){var i,o;if(!t||!n)return t;for(i=0;i<t.length;i++)if((o=e(t[i].items||t[i].collapsedItems,n-1))&&o.length)return o};return e&&e.items().length>0&&(t=(0,S.normalizeSortingInfo)(e.group()).length,n=i(e.items(),t)||[]),n},_endUpdateCore:function(){!this._skipProcessingColumnsChange&&De(this)},init:function(){var e=this,t=this.option("columns");this._commandColumns=this._commandColumns||[],this._columns=this._columns||[],this._isColumnsFromOptions=!!t,this._isColumnsFromOptions?(Fe(this,t?ie(this,t):[]),Ie(this)):Fe(this,this._columnsUserState?ie(this,this._columnsUserState):this._columns),Te(this),this._dataSourceApplied?this.applyDataSource(this._dataSource,!0):Se(this)},callbackNames:function(){return["columnsChanged"]},getColumnByPath:function(e,t){var n,i=this,o=[];return e.replace(J,(function(e,t){return o.push(parseInt(t)),""})),o.length&&(n=t?o.reduce((function(e,t){return e&&e.columns&&e.columns[t]}),{columns:t}):re(this,o)),n},optionChanged:function(e){switch(e.name){case"adaptColumnWidthByRatio":e.handled=!0;break;case"columns":e.handled=!0,this._skipProcessingColumnsChange?this._updateRequireResize(e):e.name===e.fullName?(this._columnsUserState=null,this._ignoreColumnOptionNames=null,this.init()):this._columnOptionChanged(e);break;case"commonColumnSettings":case"columnAutoWidth":case"allowColumnResizing":case"allowColumnReordering":case"columnFixing":case"grouping":case"groupPanel":case"regenerateColumnsByVisibleItems":case"customizeColumns":case"editing":case"columnHidingEnabled":case"dateSerializationFormat":case"columnResizingMode":case"columnMinWidth":case"columnWidth":e.handled=!0,e.fullName&&0===e.fullName.indexOf("editing.popup")||this.reinit();break;case"rtlEnabled":this.reinit();break;default:this.callBase(e)}},_columnOptionChanged:function(e){var t={},n=this.getColumnByPath(e.fullName),i=e.fullName.replace(J,"");n&&(i?t[i]=e.value:t=e.value,this.columnOption(n.index,t))},_updateRequireResize:function(e){var t=this.component;"width"===e.fullName.replace(J,"")&&t._updateLockCount&&(t._requireResize=!0)},publicMethods:function(){return["addColumn","deleteColumn","columnOption","columnCount","clearSorting","clearGrouping","getVisibleColumns"]},applyDataSource:function(e,t){var n=this,i=e&&e.isLoaded();if(this._dataSource=e,!this._dataSourceApplied||0===this._dataSourceColumnsCount||t||this.option("regenerateColumnsByVisibleItems")){if(i){if(!this._isColumnsFromOptions){var o=pe(this,e);o.length&&(Fe(this,o),this._dataSourceColumnsCount=this._columns.length,Ie(this))}return this.updateColumns(e,t)}this._dataSourceApplied=!1}else if(i&&!this.isAllDataTypesDefined(!0)&&this.updateColumnDataTypes(e))return Oe(this,"columns"),De(this),(new A.Deferred).reject().promise()},reset:function(){this._dataSourceApplied=!1,this._dataSourceColumnsCount=void 0,this.reinit()},resetColumnsCache:function(){var e=this;this._visibleColumns=void 0,this._fixedColumns=void 0,this._rowCount=void 0,this._bandColumnsCache=void 0},reinit:function(){this._columnsUserState=this.getUserState(),this._ignoreColumnOptionNames=null,this.init()},isInitialized:function(){return!!this._columns.length||!!this.option("columns")},isDataSourceApplied:function(){return this._dataSourceApplied},getCommonSettings:function(e){var t=(!e||!e.type)&&this.option("commonColumnSettings")||{},n=this.option("grouping")||{},i=this.option("groupPanel")||{};return(0,p.extend)({allowFixing:this.option("columnFixing.enabled"),allowResizing:this.option("allowColumnResizing")||void 0,allowReordering:this.option("allowColumnReordering"),minWidth:this.option("columnMinWidth"),width:this.option("columnWidth"),autoExpandGroup:n.autoExpandAll,allowCollapsing:n.allowCollapsing,allowGrouping:i.allowColumnDragging&&i.visible||n.contextMenuEnabled},t)},isColumnOptionUsed:function(e){for(var t=0;t<this._columns.length;t++)if(this._columns[t][e])return!0},isAllDataTypesDefined:function(e){var t,n=this._columns;if(!n.length)return!1;for(t=0;t<n.length;t++)if((n[t].dataField||n[t].calculateCellValue!==n[t].defaultCalculateCellValue)&&(!n[t].dataType||e&&n[t].deserializeValue&&void 0===n[t].serializationFormat))return!1;return!0},getColumns:function(){return this._columns},isBandColumnsUsed:function(){return this.getColumns().some((function(e){return e.isBand}))},getGroupColumns:function(){var e=[];return m.default.each(this._columns,(function(){var t=this;(0,c.isDefined)(this.groupIndex)&&(e[this.groupIndex]=this)})),e},getVisibleColumns:function(e){return this._visibleColumns=this._visibleColumns||this._getVisibleColumnsCore(),e=(0,c.isDefined)(e)?e:this._visibleColumns.length-1,this._visibleColumns[e]||[]},getFixedColumns:function(e){return this._fixedColumns=this._fixedColumns||this._getFixedColumnsCore(),e=(0,c.isDefined)(e)?e:this._fixedColumns.length-1,this._fixedColumns[e]||[]},getFilteringColumns:function(){return this.getColumns().filter((function(e){return(e.dataField||e.name)&&(e.allowFiltering||e.allowHeaderFiltering)})).map((function(e){var t=(0,p.extend)(!0,{},e);return(0,c.isDefined)(t.dataField)||(t.dataField=t.name),t.filterOperations=e.filterOperations!==e.defaultFilterOperations?t.filterOperations:null,t}))},_getFixedColumnsCore:function(){var e,t,n,i,o,a,r,l,s=this,u=[],d=this.getRowCount(),h,m={command:"transparent"},f=0;if(this._isColumnFixing())for(e=0;e<=d;e++){for(o=0,r=null,a=null,l=this.getVisibleColumns(e,!0),t=0;t<l.length;t++)i=l[t-1],(n=l[t]).fixed?i&&i.fixed&&Re(this,i)!==Re(this,n)?(0,c.isDefined)(a)||(a=t):r=n.fixedPosition:(0===e&&(n.isBand&&n.colspan?f+=n.colspan:f++),o++,(0,c.isDefined)(a)||(a=t));if(0===e&&(0===o||o>=l.length))return[];(0,c.isDefined)(a)||(a="right"===r?0:l.length),u[e]=l.slice(0),m.colspan||(m.colspan=f),u[e].splice(a,o,m)}return u},_isColumnFixing:function(){var e=this.option("columnFixing.enabled");return!e&&m.default.each(this._columns,(function(t,n){if(n.fixed)return e=!0,!1})),e},_getExpandColumnsCore:function(){return this.getGroupColumns()},getExpandColumns:function(){var e,t=this._getExpandColumnsCore(),n=t.filter((function(e){return 0===e.groupIndex}))[0],i=n&&n.fixed,o=this._isColumnFixing();return t.length&&(e=this.columnOption("command:expand")),t=m.default.map(t,(function(t){return(0,p.extend)({},t,{visibleWidth:null,minWidth:null,cellTemplate:(0,c.isDefined)(t.groupIndex)?null:t.cellTemplate,headerCellTemplate:null,fixed:!(!(0,c.isDefined)(t.groupIndex)||!i)||o},e,{index:t.index,type:t.type||"groupExpand"})}))},getBandColumnsCache:function(){if(!this._bandColumnsCache){var e=this._columns,t={},n={};e.forEach((function(i){var o=i.ownerBand,a=e[o];i.colspan&&(i.colspan=void 0),i.rowspan&&(i.rowspan=void 0),a?n[i.index]=a:o=-1,t[o]=t[o]||[],t[o].push(i)})),this._bandColumnsCache={columnChildrenByIndex:t,columnParentByIndex:n}}return this._bandColumnsCache},_isColumnVisible:function(e){return e.visible&&this.isParentColumnVisible(e.index)},_getVisibleColumnsCore:function(){var e,t,n,i=this,o=[],a=0,r=0,l=i.getRowCount(),s=[],u=[],d=0,h=i.option("rtlEnabled"),f=i.getBandColumnsCache(),p=Ue(i,i.getExpandColumns(),i._columns),g=Ue(i,i._columns,i._commandColumns,!0),x=ke(g.length);for(ue(i,g,f),e=0;e<l;e++)o[e]=[],u[e]=[{}],s[e]=[{},{},{}];return m.default.each(g,(function(){var t,o,a=this,r=this.visibleIndex,l=oe(this.index,f.columnParentByIndex),m;if(i._isColumnVisible(this)&&(!(0,c.isDefined)(this.groupIndex)||this.showWhenGrouped)){if(t=l.length,r<0?(r=-r,o=u[t]):(this.fixed=l.length?l[0].fixed:this.fixed,this.fixedPosition=l.length?l[0].fixedPosition:this.fixedPosition,this.fixed?(n="right"===this.fixedPosition,!h||this.command&&!We(i,this)||(n=!n),o=n?s[t][2]:s[t][0]):o=s[t][1]),l.length)for(r=Ne(r,x),e=l.length-1;e>=0;e--)r=Ne(l[e].visibleIndex,x)+r;o[r]=o[r]||[],o[r].push(this),d++}})),m.default.each(o,(function(e){(0,v.orderEach)(u[e],(function(t,n){o[e].unshift.apply(o[e],n)})),t=o[e].length,m.default.each(s[e],(function(t,n){(0,v.orderEach)(n,(function(t,n){o[e].push.apply(o[e],n)}))})),r<e+1&&(r+=Me.call(i,o[e],p,"detailExpand",t)),a<e+1&&(a+=Me.call(i,o[e],p,"groupExpand",t))})),o.push(Ae(o)),!d&&i._columns.length&&o[l].push({command:"empty"}),o},getInvisibleColumns:function(e,t){var n,i=this,o=[];return e=e||i._columns,m.default.each(e,(function(e,a){a.ownerBand===t&&(a.isBand?(n=a.visible?i.getInvisibleColumns(i.getChildrenByBandColumn(a.index),a.index):i.getChildrenByBandColumn(a.index)).length&&(o.push(a),o=o.concat(n)):a.visible||o.push(a))})),o},getChooserColumns:function(e){var t=e?this.getColumns():this.getInvisibleColumns();return(0,d.grep)(t,(function(e){return e.showInColumnChooser}))},allowMoveColumn:function(e,t,n,i){var o=this,a=_e(this,e,n),r=this._columns[a];return!(!r||!(r.allowReordering||r.allowGrouping||r.allowHiding))&&(n===i?"columnChooser"!==n&&(e=(0,c.isObject)(e)?e.columnIndex:e)!==(t=(0,c.isObject)(t)?t.columnIndex:t)&&e+1!==t:"group"===n&&"columnChooser"!==i||"group"===i?r&&r.allowGrouping:"columnChooser"!==n&&"columnChooser"!==i||r&&r.allowHiding)},moveColumn:function(e,t,n,i){var o,a,r,l=this,s={},u=_e(this,e,n),d=_e(this,t,i);if(u>=0){if(r=this._columns[u],t=(0,c.isObject)(t)?t.columnIndex:t,a=d>=0?this._columns[d].groupIndex:-1,(0,c.isDefined)(r.groupIndex)&&"group"===n&&(a>r.groupIndex&&a--,"group"!==i?s.groupIndex=void 0:(o=r.groupIndex,delete r.groupIndex,xe(this))),"group"===i)s.groupIndex=ye(this,r,a),r.groupIndex=o;else if(t>=0){var h=this._columns[d];h&&r.ownerBand===h.ownerBand?je(this,r)^je(this,h)?s.visibleIndex=L:s.visibleIndex=h.visibleIndex:s.visibleIndex=L}var m="columnChooser"!==i;r.visible!==m&&(s.visible=m),this.columnOption(r.index,s)}},changeSortOrder:function(e,t){var n=this,i={},o=this.option("sorting"),a=o&&o.mode,r="single"===a||!t,l="single"===a||"multiple"===a,s=this._columns[e],u=function(e){if("ctrl"===t){if(!("sortOrder"in e&&"sortIndex"in e))return!1;i.sortOrder=void 0,i.sortIndex=void 0}else(0,c.isDefined)(e.groupIndex)||(0,c.isDefined)(e.sortIndex)?i.sortOrder="desc"===e.sortOrder?"asc":"desc":i.sortOrder="asc";return!0};l&&s&&s.allowSorting&&(r&&!(0,c.isDefined)(s.groupIndex)&&m.default.each(this._columns,(function(t){t!==e&&this.sortOrder&&!(0,c.isDefined)(this.groupIndex)&&(delete this.sortOrder,delete this.sortIndex)})),Ee(t)?s.sortOrder!==t&&(i.sortOrder=t):"none"===t?s.sortOrder&&(i.sortIndex=void 0,i.sortOrder=void 0):u(s)),this.columnOption(s.index,i)},getSortDataSourceParameters:function(e){var t=this,n=[],i=[];return m.default.each(this._columns,(function(){(this.dataField||this.selector||this.calculateCellValue)&&(0,c.isDefined)(this.sortIndex)&&!(0,c.isDefined)(this.groupIndex)&&(n[this.sortIndex]=this)})),m.default.each(n,(function(){var t=this&&this.sortOrder;if(Ee(t)){var n={selector:this.calculateSortValue||this.displayField||this.calculateDisplayValue||e&&this.selector||this.dataField||this.calculateCellValue,desc:"desc"===this.sortOrder};this.sortingMethod&&(n.compare=this.sortingMethod.bind(this)),i.push(n)}})),i.length>0?i:null},getGroupDataSourceParameters:function(e){var t=[];return m.default.each(this.getGroupColumns(),(function(){var n=this.calculateGroupValue||this.displayField||this.calculateDisplayValue||e&&this.selector||this.dataField||this.calculateCellValue;if(n){var i={selector:n,desc:"desc"===this.sortOrder,isExpanded:!!this.autoExpandGroup};this.sortingMethod&&(i.compare=this.sortingMethod.bind(this)),t.push(i)}})),t.length>0?t:null},refresh:function(e){var t=[];return m.default.each(this._columns,(function(){var n=this.lookup;if(n&&!this.calculateDisplayValue){if(e&&n.valueMap)return;n.update&&t.push(n.update())}})),A.when.apply(o.default,t).done(we.bind(null,this))},_updateColumnOptions:function(e){e.selector=e.selector||function(t){return e.calculateCellValue(t)},m.default.each(["calculateSortValue","calculateGroupValue","calculateDisplayValue"],(function(t,n){var i=e[n];(0,c.isFunction)(i)&&!i.originalCallback&&(e[n]=function(t){return i.call(e,t)},e[n].originalCallback=i)})),(0,c.isString)(e.calculateDisplayValue)&&(e.displayField=e.calculateDisplayValue,e.calculateDisplayValue=u.default.compileGetter(e.displayField)),e.calculateDisplayValue&&(e.displayValueMap=e.displayValueMap||{}),he(e,e.dataType);var t=e.lookup;t&&he(t,t.dataType);var n=t?t.dataType:e.dataType;n&&(e.alignment=e.alignment||me(n,this.option("rtlEnabled")),e.format=e.format||(0,S.getFormatByDataType)(n),e.customizeText=e.customizeText||fe(n),e.defaultFilterOperations=e.defaultFilterOperations||!t&&Y[n]||[],(0,c.isDefined)(e.filterOperations)||te(e),e.defaultFilterOperation=e.filterOperations&&e.filterOperations[0]||"=",e.showEditorAlways=(0,c.isDefined)(e.showEditorAlways)?e.showEditorAlways:"boolean"===n&&!e.cellTemplate)},updateColumnDataTypes:function(e){var t=this,n=t.option("dateSerializationFormat"),i=t._getFirstItems(e),o=!1;return m.default.each(t._columns,(function(e,a){var r,l,s,u,d,c=a.lookup;if((0,S.isDateType)(a.dataType)&&void 0===a.serializationFormat&&(a.serializationFormat=n),c&&(0,S.isDateType)(c.dataType)&&void 0===a.serializationFormat&&(c.serializationFormat=n),a.calculateCellValue&&i.length){if(!a.dataType||c&&!c.dataType){for(r=0;r<i.length;r++)l=a.calculateCellValue(i[r]),a.dataType||(d=de(l),(s=s||d)&&d&&s!==d&&(s="string")),c&&!c.dataType&&(d=de((0,S.getDisplayValue)(a,l,i[r])),(u=u||d)&&d&&u!==d&&(u="string"));(s||u)&&(s&&(a.dataType=s),c&&u&&(c.dataType=u),o=!0)}if(void 0===a.serializationFormat||c&&void 0===c.serializationFormat)for(r=0;r<i.length;r++)l=a.calculateCellValue(i[r],!0),void 0===a.serializationFormat&&(a.serializationFormat=ce(a.dataType,l)),c&&void 0===c.serializationFormat&&(c.serializationFormat=ce(c.dataType,c.calculateCellValue(l,!0)))}t._updateColumnOptions(a)})),o},_customizeColumns:function(e){var t,n=this,i=this.option("customizeColumns");i&&((t=e.some((function(e){return(0,c.isObject)(e.ownerBand)})))&&Se(this),i(e),Fe(this,ie(this,e)))},updateColumns:function(e,t){var n,i,o=this;if(t||o.updateSortingGrouping(e),!e||e.isLoaded()){n=e?e.sort()||[]:o.getSortDataSourceParameters(),i=e?e.group()||[]:o.getGroupDataSourceParameters(),o._customizeColumns(o._columns),Se(o);var a=o._columns;return(0,A.when)(o.refresh(!0)).always((function(){o._columns===a&&(o._updateChanges(e,{sorting:n,grouping:i}),De(o))}))}},_updateChanges:function(e,t){var n=this;e&&(this.updateColumnDataTypes(e),this._dataSourceApplied=!0),(0,S.equalSortParameters)(t.sorting,this.getSortDataSourceParameters())||Oe(this,"sorting"),(0,S.equalSortParameters)(t.grouping,this.getGroupDataSourceParameters())||Oe(this,"grouping"),Oe(this,"columns")},updateSortingGrouping:function(e,t){var n,i,o,a,r,l=this,s=function(e,t,n){var i,o,a;m.default.each(e,(function(e,r){if(delete r[n],t)for(i=0;i<t.length;i++)if(o=t[i].selector,a=t[i].isExpanded,o===r.dataField||o===r.name||o===r.selector||o===r.calculateCellValue||o===r.calculateGroupValue){r.sortOrder=r.sortOrder||(t[i].desc?"desc":"asc"),void 0!==a&&(r.autoExpandGroup=a),r[n]=i;break}}))};e&&(n=(0,S.normalizeSortingInfo)(e.sort()),i=(0,S.normalizeSortingInfo)(e.group()),o=l.getGroupDataSourceParameters(),a=l.getSortDataSourceParameters(),l._columns.length||(m.default.each(i,(function(e,t){l._columns.push(t.selector)})),m.default.each(n,(function(e,t){l._columns.push(t.selector)})),Fe(l,ie(l,l._columns))),!t&&(o||l._hasUserState)||(0,S.equalSortParameters)(i,o)||(s(l._columns,i,"groupIndex"),t&&(Oe(l,"grouping"),r=!0)),!t&&(a||l._hasUserState)||(0,S.equalSortParameters)(n,a)||(s(l._columns,n,"sortIndex"),t&&(Oe(l,"sorting"),r=!0)),r&&De(l))},updateFilter:function(e,t,n,i){var o=this,a,r;if(!Array.isArray(e))return e;for(n=(e=(0,p.extend)([],e)).columnIndex||n,i=e.filterValue||i,(0,c.isString)(e[0])?(a=this.columnOption(e[0]),t?(0,C.default)().forceIsoDateParsing&&a&&a.serializeValue&&e.length>1&&(e[e.length-1]=a.serializeValue(e[e.length-1],"filter")):a&&a.selector&&(e[0]=a.selector,e[0].columnIndex=a.index)):(0,c.isFunction)(e[0])&&(e[0].columnIndex=n,e[0].filterValue=i),r=0;r<e.length;r++)e[r]=this.updateFilter(e[r],t,n,i);return e},columnCount:function(){return this._columns?this._columns.length:0},columnOption:function(e,t,n,i){var o,a,r,l=this,s=(0,c.isString)(e)&&e.substr(0,e.indexOf(":")),u=l._columns.concat(l._commandColumns);if(void 0!==e){for(s&&(e=e.substr(s.length+1)),o=0;o<u.length;o++)if(s){if(""+u[o][s]===e){r=u[o];break}}else if(u[o].index===e||u[o].name===e||u[o].dataField===e||u[o].caption===e){r=u[o];break}if(r){if(1===arguments.length)return(0,p.extend)({},r);if((0,c.isString)(t)){if(2===arguments.length)return Be(l,r,t);a=a||Z[t],Be(l,r,t,n,i)}else(0,c.isObject)(t)&&m.default.each(t,(function(e,t){a=a||Z[e],Be(l,r,e,t,i)}));a&&Se(l,r),De(l)}}},clearSorting:function(){var e,t=this,n=this.columnCount();for(this.beginUpdate(),e=0;e<n;e++)this.columnOption(e,"sortOrder",void 0);this.endUpdate()},clearGrouping:function(){var e,t=this,n=this.columnCount();for(this.beginUpdate(),e=0;e<n;e++)this.columnOption(e,"groupIndex",void 0);this.endUpdate()},getVisibleIndex:function(e,t){var n,i=this.getVisibleColumns(t);for(n=i.length-1;n>=0;n--)if(i[n].index===e)return n;return-1},addColumn:function(e){var t=this,n=ne(this,e),i=this._columns.length;this._columns.push(n),n.isBand&&(this._columns=ie(this,this._columns),n=this._columns[i]),n.added=e,Se(this,n),this.updateColumns(this._dataSource)},deleteColumn:function(e){var t,n=this,i=this.columnOption(e);i&&i.index>=0&&(this._columns.splice(i.index,1),i.isBand&&(t=this.getChildrenByBandColumn(i.index).map((function(e){return e.index})),this._columns=this._columns.filter((function(e){return t.indexOf(e.index)<0}))),Se(this),this.updateColumns(this._dataSource))},addCommandColumn:function(e){var t=this._commandColumns.filter((function(t){return t.command===e.command}))[0];t||(t=e,this._commandColumns.push(t))},getUserState:function(){var e,t=this._columns,n=[];function i(i,o){void 0!==t[e][o]&&(n[e][o]=t[e][o])}for(e=0;e<t.length;e++)n[e]={},m.default.each(j,i);return n},setUserState:function(e){var t,n=this,i=this._dataSource,o=this.option("stateStoring.ignoreColumnOptionNames");o||(o=[],t=this.getCommonSettings(),this.option("columnChooser.enabled")||o.push("visible"),"none"===this.option("sorting.mode")&&o.push("sortIndex","sortOrder"),t.allowGrouping||o.push("groupIndex"),t.allowFixing||o.push("fixed","fixedPosition"),t.allowResizing||o.push("width","visibleWidth"),this.option("filterRow.visible")||o.push("filterValue","selectedFilterOperation"),this.option("headerFilter.visible")||o.push("filterValues","filterType")),this._columnsUserState=e,this._ignoreColumnOptionNames=o,this._hasUserState=!!e,Oe(this,"filtering"),this.init(),i&&(i.sort(null),i.group(null))},_createCalculatedColumnOptions:function(e,t){var n,i={},o=e.dataField;return(Array.isArray(e.columns)&&e.columns.length||e.isBand)&&(i.isBand=!0,o=null),o?((0,c.isString)(o)&&(n=u.default.compileGetter(o),i={caption:F.default.captionize(o),calculateCellValue:function(e,t){var i=n(e);return this.deserializeValue&&!t?this.deserializeValue(i):i},setCellValue:Pe,parseValue:function(e){var t,n,i=this;return"number"===this.dataType?(0,c.isString)(e)&&this.format?(n=z.default.parse(e),(0,c.isNumeric)(n)&&(t=n)):(0,c.isDefined)(e)&&(0,c.isNumeric)(e)&&(t=Number(e)):"boolean"===this.dataType?e===this.trueText?t=!0:e===this.falseText&&(t=!1):(0,S.isDateType)(this.dataType)?(n=E.default.parse(e,this.format))&&(t=n):t=e,t}}),i.allowFiltering=!0):i.allowFiltering=!!e.calculateFilterExpression,i.calculateFilterExpression=function(){return N.default.defaultCalculateFilterExpression.apply(this,arguments)},i.createFilterExpression=function(e){var t;return this.calculateFilterExpression&&(t=this.calculateFilterExpression.apply(this,arguments)),(0,c.isFunction)(t)?t=[t,"=",!0]:t&&(t.columnIndex=this.index,t.filterValue=e),t},o&&(0,c.isString)(o)||(0,p.extend)(!0,i,{allowSorting:!1,allowGrouping:!1,calculateCellValue:function(){return null}}),t&&(i.allowFixing=!1),e.dataType&&(i.userDataType=e.dataType),!e.selectedFilterOperation||"defaultSelectedFilterOperation"in i||(i.defaultSelectedFilterOperation=e.selectedFilterOperation),e.lookup&&(i.lookup={calculateCellValue:function(e,t){return this.valueExpr&&(e=this.valueMap&&this.valueMap[e]),this.deserializeValue&&!t?this.deserializeValue(e):e},updateValueMap:function(){var e,t,n,i;if(this.valueMap={},this.items)for(e=u.default.compileGetter(this.valueExpr),t=u.default.compileGetter(this.displayExpr),i=0;i<this.items.length;i++){var o=t(n=this.items[i]);this.valueMap[e(n)]=o,this.dataType=this.dataType||de(o)}},update:function(){var e,t=this,n=t.dataSource;if(n)if((0,c.isFunction)(n)&&!(0,l.isWrapped)(n)&&(n=n({})),(0,c.isPlainObject)(n)||n instanceof R.default||Array.isArray(n)){if(t.valueExpr)return(e=(0,M.normalizeDataSourceOptions)(n)).paginate=!1,(n=new M.DataSource(e)).load().done((function(e){t.items=e,t.updateValueMap&&t.updateValueMap()}))}else y.default.log("E1016");else t.updateValueMap&&t.updateValueMap()}}),i.resizedCallbacks=(0,r.default)(),e.resized&&i.resizedCallbacks.add(e.resized.bind(e)),m.default.each(i,(function(e){var t;(0,c.isFunction)(i[e])&&0!==e.indexOf("default")&&(t="default"+e.charAt(0).toUpperCase()+e.substr(1),i[t]=i[e])})),i},getRowCount:function(){return this._rowCount=this._rowCount||Ge(this),this._rowCount},getRowIndex:function(e,t){var n=this._columns[e],i=this.getBandColumnsCache();return n&&(t||n.visible&&!n.command&&!(0,c.isDefined)(n.groupIndex))?oe(e,i.columnParentByIndex).length:0},getChildrenByBandColumn:function(e,t){var n=this,i=this.getBandColumnsCache(),o=ae(e,i.columnChildrenByIndex,!t);return t?o.filter((function(e){return e.visible&&!e.command})).sort((function(e,t){return e.visibleIndex-t.visibleIndex})):o},isParentBandColumn:function(e,t){var n=!1,i=this._columns[e],o=this.getBandColumnsCache(),a=i&&oe(e,o.columnParentByIndex);return a&&m.default.each(a,(function(e,i){if(i.index===t)return n=!0,!1})),n},isParentColumnVisible:function(e){var t=!0,n=this.getBandColumnsCache(),i=e>=0&&oe(e,n.columnParentByIndex);return i&&m.default.each(i,(function(e,n){return t=t&&n.visible})),t},getColumnId:function(e){return e.command&&"groupExpand"===e.type?We(this,e)?"type:"+e.type:"command:"+e.command:e.index}}))}}}

