function module(t,e,a){"use strict";var n=t("../../core/renderer"),i=t("../../core/utils/extend").extend,r=t("./ui.pivot_grid.utils"),o=t("../../core/utils/iterator").each,l=r.foreachTree,s={number:"numeric",date:"datetime"},d="dxPivotGridUnbinding";function u(t,e){var a=[],n=e.length-1;return o(t,(function(t,i){a.push(i.text||r.formatValue(i.value,e[n-t]))})),a.reverse()}function c(t){var e=0;return l(t,(function(t){e=Math.max(e,t.length-1)})),e}function h(t,e){var a=t.chartDataItem,n=e&&e(t);return n?(a=i({},a,n.chartDataItem),n=i({},t,n,{chartDataItem:a})):t}function m(t,e,a){var n,i,s,d,m,p,g,f,v,x,F=t.getData(),D=[],T=t.getAreaFields("data"),I=t.getAreaFields("row"),A=t.getAreaFields("column"),P=[{index:F.grandTotalColumnIndex,children:F.columns}],y=[{index:F.grandTotalRowIndex,children:F.rows}],M=c(y),b=c(P);function C(){var t,r=(F.values[s]||[])[g]||[],o=r[n],l={rowPath:p,maxRowLevel:M,rowPathFormatted:m,rowFields:I,columnPathFormatted:x,maxColumnLevel:b,columnPath:v,columnFields:A,dataFields:T,dataIndex:n,dataValues:r,visible:f&&d},u=(e.inverted?x:m).join(" - "),c=(e.inverted?m:x).join("/");T.length>1&&("args"!==e.putDataFieldsInto&&"both"!==e.putDataFieldsInto||(c+=" | "+i.caption),"args"!==e.putDataFieldsInto&&(u+=" | "+i.caption,"singleAxis"!==e.dataFieldsDisplayMode&&(t=i.caption))),l.chartDataItem={val:void 0===o?null:o,series:u,arg:c},(l=h(l,e.processCell)).visible&&(a[l.chartDataItem.series]=a[l.chartDataItem.series]||t,D.push(l.chartDataItem))}function w(t){l(y,(function(a){s=a[0].index,a=a.slice(0,a.length-1),d=M===a.length,p=r.createPath(a),m=u(a,I),0===p.length&&(m=[e.grandTotalText]),l(P,(function(a){g=a[0].index,a=a.slice(0,a.length-1),f=b===a.length,v=r.createPath(a),x=u(a,A),0===v.length&&(x=[e.grandTotalText]),t()}))}))}function z(t){o(T,(function(e,a){i=a,n=e,t()}))}return!1===e.alternateDataFields?z((function(){w(C)})):w((function(){z(C)})),D}function p(t,e){var a=t.getAreaFields("data");if("args"!==e.putDataFieldsInto&&"singleAxis"!==e.dataFieldsDisplayMode||1===a.length){var n=[];return o(a,(function(t,a){var i={name:a.caption,title:a.caption,valueType:s[a.dataType]||a.dataType,label:{format:a.format}};a.customizeText&&(i.label.customizeText=function(t){return a.customizeText.call(a,t)}),"splitPanes"===e.dataFieldsDisplayMode&&(i.pane=a.caption),n.push(i)})),n}return[{}]}function g(t,e){var a=[],n=t.getAreaFields("data");return n.length>1&&"splitPanes"===e.dataFieldsDisplayMode&&"args"!==e.putDataFieldsInto&&o(n,(function(t,e){a.push({name:e.caption})})),a.length||a.push({}),a}function f(t,e){var a=e.customizeSeries,n=e.customizeChart,r={valueAxis:p(t,e),panes:g(t,e)},o={};return n&&(r=i(!0,{},r,n(r))),r.dataSource=m(t,e,o),r.seriesTemplate={nameField:"series",customizeSeries:function(t){var n={};return"splitPanes"===e.dataFieldsDisplayMode?n.pane=o[t]:"singleAxis"!==e.dataFieldsDisplayMode&&(n.axis=o[t]),a&&(n=i(n,a(t,n))),n}},r}function v(t){if(!t)return!1;if(t.NAME)return"dxChart"===t.NAME&&t;var e=n(t);return e.data("dxChart")&&e.dxChart("instance")}function x(t){var e=t.$element().data(d);e&&e()}a.exports={bindChart:function(t,e){e=i({},e);var a,n=this,r=function(){e.grandTotalText=n.option("texts.grandTotal");var a=f(n.getDataSource(),e);t.option(a)};return(t=v(t))?(x(t),n.on("changed",r),r(),a=function(){t.$element().removeData(d),n.off("changed",r)},t.on("disposing",a),this.on("disposing",a),t.$element().data(d,a),a):null}}}

