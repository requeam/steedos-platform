function module(t,e){"use strict";var n=t("../../core/renderer"),l=t("../../core/class"),i=t("../../core/utils/dom").getPublicElement,s=t("../../core/utils/extend").extend,o=t("../../core/utils/type").isDefined,a="dx-expand",r=function(t){var e=0,n=t.offsetWidth;if(t.getBoundingClientRect){var l=t.getBoundingClientRect();(e=l.width)||(e=l.right-l.left),e<=n-1&&(e=n)}return e>0?e:n};function h(t,e,n,l){var i=0,s=0,o=n/2;return t+l-(e+n)>1?(t>=e+n+o&&(s=parseInt((t-(e+n))/o,10)),i=e+n+o*s):t<e?(t<=e-o&&(s=parseInt((t-(e-o))/o,10)),i=e-(n-o*s)):i=e,i}e.AreaItem=l.inherit({_getRowElement:function(t){var e=this;return this._tableElement&&this._tableElement.length>0?this._tableElement[0].rows[t]:null},_createGroupElement:function(){return n("<div>")},_createTableElement:function(){return n("<table>")},_getCellText:function(t,e){var l=t.isWhiteSpace?"&nbsp":t.text||"&nbsp";return!e||-1===l.indexOf("<")&&-1===l.indexOf(">")||(l=n("<div>").text(l).html()),l},_getRowClassNames:function(){},_applyCustomStyles:function(t){t.cell.width&&t.cssArray.push("min-width:"+t.cell.width+"px"),t.cell.sorted&&t.classArray.push("dx-pivotgrid-sorted")},_getMainElementMarkup:function(){return"<tbody>"},_getCloseMainElementMarkup:function(){return"</tbody>"},_renderTableContent:function(t,e){var n,l,i,s,a,r,h,u,p=this,c=e.length,d=this.option("rtlEnabled"),g=[],f=this.option("encodeHtml"),_="colspan='",m="rowspan='";for(t.data("area",this._getAreaName()),t.data("data",e),t.css("width",""),g.push(this._getMainElementMarkup()),i=0;i<c;i++){n=e[i];var b=[];for(u=[],g.push("<tr "),s=0;s<n.length;s++){if(l=n[s],this._getRowClassNames(i,l,u),b.push("<td "),l){l.rowspan&&b.push(m+(l.rowspan||1)+"'"),l.colspan&&b.push(_+(l.colspan||1)+"'");var E={cellElement:void 0,cell:l,cellsCount:n.length,cellIndex:s,rowElement:void 0,rowIndex:i,rowsCount:c,rtlEnabled:d,classArray:[],cssArray:[]};this._applyCustomStyles(E),E.cssArray.length&&(b.push("style='"),b.push(E.cssArray.join(";")),b.push("'")),E.classArray.length&&(b.push("class='"),b.push(E.classArray.join(" ")),b.push("'")),b.push(">"),o(l.expanded)&&b.push("<div class='dx-expand-icon-container'><span class='dx-expand'></span></div>"),h=this._getCellText(l,f)}else h="";b.push("<span "),o(l.wordWrapEnabled)&&b.push("style='white-space:",l.wordWrapEnabled?"normal":"nowrap",";'"),b.push(">"+h+"</span>"),l.sorted&&b.push("<span class='dx-icon-sorted'></span>"),b.push("</td>")}u.length&&(g.push("class='"),g.push(u.join(" ")),g.push("'")),g.push(">"),g.push(b.join("")),g.push("</tr>")}g.push(this._getCloseMainElementMarkup()),t.append(g.join("")),this._triggerOnCellPrepared(t,e)},_triggerOnCellPrepared:function(t,e){var n,l,o,a,r,h,u,p=this,c=t.find("tr"),d=this._getAreaName(),g=this.option("onCellPrepared"),f=this.component.hasEvent("cellPrepared"),_=this.component._defaultActionArgs();if(g||f)for(h=0;h<e.length;h++)for(a=e[h],n=c.eq(h),u=0;u<a.length;u++)r=a[u],l=n.children().eq(u),o={area:d,rowIndex:h,columnIndex:u,cellElement:i(l),cell:r},f?this.component._trigger("onCellPrepared",o):g(s(o,_))},_getRowHeight:function(t){var e=this._getRowElement(t),n=0,l=e.offsetHeight;if(e&&e.lastChild){var i;if(e.getBoundingClientRect)(n=e.getBoundingClientRect().height)<=l-1&&(n=l);return n>0?n:l}return 0},_setRowHeight:function(t,e){var n=this._getRowElement(t);n&&(n.style.height=e+"px")},ctor:function(t){this.component=t},option:function(){return this.component.option.apply(this.component,arguments)},getRowsLength:function(){var t=this;return this._tableElement&&this._tableElement.length>0?this._tableElement[0].rows.length:0},getRowsHeight:function(){var t,e=this,n=[],l=this.getRowsLength();for(t=0;t<l;t++)n.push(this._getRowHeight(t));return n},setRowsHeight:function(t){var e,n=this,l=0,i=t.length;for(e=0;e<i;e++)l+=t[e],this._setRowHeight(e,t[e]);this._tableHeight=l,this._tableElement[0].style.height=l+"px"},getColumnsWidth:function(){var t,e,n,l,i=this.getRowsLength(),s=[],o=[],a=function(t,e,n,l,i){var s,o;for(s=0;s<l;s++)for(o=0;o<i;o++)t[e+s]=t[e+s]||[],t[e+s][n+o]=!0};if(i)for(t=0;t<i;t++)for(s[t]=s[t]||[],e=this._getRowElement(t),n=0;n<e.cells.length;n++){for(l=0;s[t][l];l++);a(s,t,l,e.cells[n].rowSpan,e.cells[n].colSpan),1===e.cells[n].colSpan&&(o[l]=o[l]||r(e.cells[n]))}return o},setColumnsWidth:function(t){var e,n=0,l=this._tableElement[0],i="",s=this.getColumnsCount(),o=[];for(e=0;e<s;e++)o.push(t[e]||0);for(e=s;e<t.length&&t;e++)o[s-1]+=t[e];for(e=0;e<s;e++)n+=o[e],i+='<col style="width: '+o[e]+'px">';this._colgroupElement.html(i),this._tableWidth=n-this._groupWidth>.01?Math.ceil(n):n,l.style.width=this._tableWidth+"px",l.style.tableLayout="fixed"},resetColumnsWidth:function(){this._colgroupElement.find("col").width("auto"),this._tableElement.css({width:"",tableLayout:""})},groupWidth:function(t){return void 0===t?this._groupElement.width():t>=0?(this._groupWidth=t,this._groupElement[0].style.width=t+"px"):this._groupElement[0].style.width=t},groupHeight:function(t){if(void 0===t)return this._groupElement.height();this._groupHeight=null,t>=0?(this._groupHeight=t,this._groupElement[0].style.height=t+"px"):this._groupElement[0].style.height=t},groupElement:function(){return this._groupElement},tableElement:function(){return this._tableElement},element:function(){return this._rootElement},headElement:function(){return this._tableElement.find("thead")},_setTableCss:function(t){this.option("rtlEnabled")&&(t.right=t.left,delete t.left),this.tableElement().css(t)},setVirtualContentParams:function(t){this._virtualContent.css({width:t.width,height:t.height}),this.groupElement().addClass("dx-virtual-mode")},disableVirtualMode:function(){this.groupElement().removeClass("dx-virtual-mode")},_renderVirtualContent:function(){var t=this;this._virtualContent||"virtual"!==this.option("scrolling.mode")||(this._virtualContent=n("<div>").addClass("dx-virtual-content").insertBefore(this._tableElement))},reset:function(){var t=this,e=this._tableElement[0];if(this._fakeTable&&this._fakeTable.detach(),this._fakeTable=null,this.disableVirtualMode(),this.groupWidth("100%"),this.groupHeight("auto"),this.resetColumnsWidth(),e){for(var n=0;n<e.rows.length;n++)e.rows[n].style.height="";e.style.height="",e.style.width="100%"}},_updateFakeTableVisibility:function(){var t=this,e=this.tableElement()[0],n=this.option("rtlEnabled")?"right":"left",l=this._fakeTable[0];e.style.top===l.style.top&&l.style[n]===e.style[n]?this._fakeTable.addClass("dx-hidden"):this._fakeTable.removeClass("dx-hidden")},_moveFakeTableHorizontally:function(t){var e=this,n,l=this.option("rtlEnabled")?"right":"left",i,s=h(t,parseFloat(this.tableElement()[0].style[l]),this._tableWidth,this._groupWidth);parseFloat(this._fakeTable[0].style[l])!==s&&(this._fakeTable[0].style[l]=s+"px")},_moveFakeTableTop:function(t){var e=this,n,l=h(t,parseFloat(this.tableElement()[0].style.top),this._tableHeight,this._groupHeight);parseFloat(this._fakeTable[0].style.top)!==l&&(this._fakeTable[0].style.top=l+"px")},_moveFakeTable:function(){this._updateFakeTableVisibility()},_createFakeTable:function(){var t=this;this._fakeTable||(this._fakeTable=this.tableElement().clone().addClass("dx-pivot-grid-fake-table").appendTo(this._virtualContent))},render:function(t,e){var l=this;if(this._tableElement){try{this._tableElement[0].innerHTML=""}catch(i){this._tableElement.empty()}this._tableElement.attr("style","")}else this._groupElement=this._createGroupElement(),this._tableElement=this._createTableElement(),this._tableElement.appendTo(this._groupElement),this._groupElement.appendTo(t),this._rootElement=t;this._colgroupElement=n("<colgroup>").appendTo(this._tableElement),this._renderTableContent(this._tableElement,e),this._renderVirtualContent()},_getScrollable:function(){return this.groupElement().data("dxScrollable")},on:function(t,e){var n=this,l=n._getScrollable();return l&&l.on(t,(function(t){n.option("rtlEnabled")&&o(t.scrollOffset.left)&&(t.scrollOffset.left=l.$content().width()-l._container().width()-t.scrollOffset.left),e(t)})),this},off:function(t){var e=this._getScrollable();return e&&e.off(t),this},scrollTo:function(t){var e=this._getScrollable(),n=t;e&&(this.option("rtlEnabled")&&("column"===this._getAreaName()?n=e.$content().width()-e._container().width()-t:"data"===this._getAreaName()&&(n={x:e.$content().width()-e._container().width()-t.x,y:t.y})),e.scrollTo(n),this._virtualContent&&(this._createFakeTable(),this._moveFakeTable(t)))},updateScrollable:function(){var t=this._getScrollable();if(t)return t.update()},getColumnsCount:function(){var t,e=0,n=this._getRowElement(0);if(n)for(var l=0,i=(t=n.cells).length;l<i;++l)e+=t[l].colSpan;return e},getData:function(){var t=this._tableElement;return t?t.data("data"):[]}})}

