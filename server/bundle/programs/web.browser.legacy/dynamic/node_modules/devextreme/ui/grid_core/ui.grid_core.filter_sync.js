function module(e,t,i){"use strict";var l=e("../../core/utils/type"),r,n=y(e("./ui.grid_core.modules")),o,a=y(e("../filter_builder/utils")),u,s=y(e("../widget/ui.errors")),c,f=y(e("./ui.grid_core.utils")),d,h=y(e("../shared/filtering")),p,F=y(e("./ui.grid_core.filter_custom_operations"));function y(e){return e&&e.__esModule?e:{default:e}}var m=["=","<>","<","<=",">",">=","notcontains","contains","startswith","endswith","between"],g="include",v="exclude";function C(e){return e.dataField||e.name}function V(e){e.forEach((function(e){var t=C(e);if(!(0,l.isDefined)(t)&&e.allowFiltering)throw new s.default.Error("E1049",e.caption)}))}var S=n.default.Controller.inherit((O=function(){return{filterType:"include",filterValues:void 0}},_=function(e){return!(h.default.getGroupInterval(e)||e.headerFilter&&e.headerFilter.dataSource)},b=function(e,t){if(!e)return{filterType:"include",filterValues:void 0};var i,l=e[1],r=e[2],n=Array.isArray(r);if(!n&&!_(t))return{filterType:"include",filterValues:void 0};switch(l){case"anyof":case"=":i="include";break;case"noneof":case"<>":i="exclude";break;default:return{filterType:"include",filterValues:void 0}}return{filterType:i,filterValues:n?r:[r]}},w=function(e){var t=e.filterValue;if((0,l.isDefined)(t)){var i=e.selectedFilterOperation||e.defaultFilterOperation||a.default.getDefaultOperation(e),r;return[C(e),i,e.filterValue]}return null},A=function(e){var t,i,l=e.filterValues;return l?(_(e)&&1===e.filterValues.length&&!Array.isArray(l[0])?(t="exclude"===e.filterType?"<>":"=",i=l[0]):(t="exclude"===e.filterType?"noneof":"anyof",i=l),[C(e),t,i]):null},x=function(e,t,i){var l=b(i,t);e.columnOption(C(t),l)},k=function(e,t,i){var r,n=i&&i[1],o=t.filterOperations||t.defaultFilterOperations;(!o||o.indexOf(n)>=0||n===t.defaultFilterOperation)&&m.indexOf(n)>=0?(n!==t.defaultFilterOperation||(0,l.isDefined)(t.selectedFilterOperation)||(n=t.selectedFilterOperation),r={filterValue:i[2],selectedFilterOperation:n}):r={filterValue:void 0,selectedFilterOperation:void 0},e.columnOption(C(t),r)},{syncFilterValue:function(){var e=this,t=e.getController("columns"),i=t.getFilteringColumns();this._skipSyncColumnOptions=!0,i.forEach((function(i){var r=a.default.getMatchedConditions(e.option("filterValue"),C(i));if(1===r.length){var n=r[0];x(t,i,n),k(t,i,n)}else(0,l.isDefined)(i.filterValues)&&x(t,i),(0,l.isDefined)(i.filterValue)&&k(t,i)})),this._skipSyncColumnOptions=!1},_initSync:function(){var e=this.getController("columns").getColumns(),t=this.getController("data"),i=t.pageIndex();if(V(e),!this.option("filterValue")){var l=this.getController("columns").getFilteringColumns(),r=this.getFilterValueFromColumns(l);this.option("filterValue",r)}this.syncFilterValue(),t.pageIndex(i)},init:function(){var e=this,t=this.getController("data");t.isFilterSyncActive()&&(this.getController("columns").isAllDataTypesDefined()?this._initSync():t.dataSourceChanged.add((function(){return e._initSync()})))},_getSyncFilterRow:function(e,t){var i=w(t);return(0,l.isDefined)(i)?a.default.syncFilters(e,i):a.default.removeFieldConditionsFromFilter(e,C(t))},_getSyncHeaderFilter:function(e,t){var i=A(t);return i?a.default.syncFilters(e,i):a.default.removeFieldConditionsFromFilter(e,C(t))},getFilterValueFromColumns:function(e){if(!this.getController("data").isFilterSyncActive())return null;var t=["and"];return e&&e.forEach((function(e){var i=A(e),l=w(e);i&&a.default.addItem(i,t),l&&a.default.addItem(l,t)})),a.default.getNormalizedFilter(t)},syncFilterRow:function(e,t){this.option("filterValue",this._getSyncFilterRow(this.option("filterValue"),e))},syncHeaderFilter:function(e){this.option("filterValue",this._getSyncHeaderFilter(this.option("filterValue"),e))},getCustomFilterOperations:function(){var e=this.option("filterBuilder.customOperations")||[];return[F.default.anyOf(this.component),F.default.noneOf(this.component)].concat(e)},publicMethods:function(){return["getCustomFilterOperations"]}})),O,_,b,w,A,x,k,B={isFilterSyncActive:function(){var e=this.option("filterSyncEnabled");return"auto"===e?this.option("filterPanel.visible"):e},skipCalculateColumnFilters:function(){return(0,l.isDefined)(this.option("filterValue"))&&this.isFilterSyncActive()},_calculateAdditionalFilter:function(){var e=this;if(!1===this.option("filterPanel.filterEnabled"))return this.callBase();var t=[this.callBase()],i=this.getController("columns").getFilteringColumns(),l=this.option("filterValue");if(this.isFilterSyncActive()){var r=this.getController("headerFilter").getCurrentColumn();r&&l&&(l=a.default.removeFieldConditionsFromFilter(l,C(r)))}var n=this.getController("filterSync").getCustomFilterOperations(),o=a.default.getFilterExpression(l,i,n,"filterBuilder");return o&&t.push(o),f.default.combineFilters(t)},_parseColumnPropertyName:function(e){var t;return e.match(/.*\.(.*)/)[1]},clearFilter:function(e){this.component.beginUpdate(),arguments.length>0?("filterValue"===e&&this.option("filterValue",null),this.callBase(e)):(this.option("filterValue",null),this.callBase()),this.component.endUpdate()},optionChanged:function(e){switch(e.name){case"filterValue":this._applyFilter(),this.isFilterSyncActive()&&this.getController("filterSync").syncFilterValue(),e.handled=!0;break;case"filterSyncEnabled":e.handled=!0;break;case"columns":if(this.isFilterSyncActive()){var t=this.getController("columns").getColumnByPath(e.fullName),i=this.getController("filterSync");if(t&&!i._skipSyncColumnOptions){var l=this._parseColumnPropertyName(e.fullName);i._skipSyncColumnOptions=!0,"filterType"===l?"exclude"!==e.value&&"exclude"!==e.previousValue||i.syncHeaderFilter(t):"filterValues"===l?i.syncHeaderFilter(t):["filterValue","selectedFilterOperation"].indexOf(l)>-1&&i.syncFilterRow(t,t.filterValue),i._skipSyncColumnOptions=!1}}this.callBase(e);break;default:this.callBase(e)}}},E={_isHeaderFilterEmpty:function(e){return this.getController("data").isFilterSyncActive()?!a.default.filterHasField(this.option("filterValue"),C(e)):this.callBase(e)},_needUpdateFilterIndicators:function(){return!this.getController("data").isFilterSyncActive()},optionChanged:function(e){"filterValue"===e.name?this._updateHeaderFilterIndicators():this.callBase(e)}};i.exports={defaultOptions:function(){return{filterValue:null,filterSyncEnabled:"auto"}},controllers:{filterSync:S},extenders:{controllers:{data:B},views:{columnHeadersView:E}}}}

