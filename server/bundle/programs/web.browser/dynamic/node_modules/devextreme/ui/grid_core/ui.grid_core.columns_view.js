function module(e,t){"use strict";var n,l=V(e("../../core/renderer")),i,r=V(e("../../core/dom_adapter")),o=e("../../core/utils/window"),a,d=V(e("../../events/core/events_engine")),s,c=V(e("../../core/element_data")),u,h=V(e("../../events/click")),f,m=V(e("../../core/utils/browser")),p=e("../../core/utils/common"),g,C=V(e("../../core/utils/style")),_=e("../../core/utils/dom"),w,x=V(e("../../core/utils/type")),v,b=V(e("../../core/utils/iterator")),y=e("../../core/utils/extend"),T=e("../../core/utils/position"),E,I=V(e("../../core/devices")),A,R=V(e("./ui.grid_core.modules")),W=e("./ui.grid_core.utils"),P,D=V(e("./ui.grid_core.column_state_mixin"));function V(e){return e&&e.__esModule?e:{default:e}}var S="scroll-container",k="group-space",N="content",O="table",H="table-fixed",q="content-fixed",B="dx-row",L="dx-group-row",M="dx-master-detail-row",z="filter-row",F="cell-updated-animation",G="0.0001px",J="dxCellHintVisible",K="dx-field-item-content",j={render:function(e){e.container.append(e.content)}},Q=function(e,t){var n,i,r;function o(e){return setTimeout((function(){n=i=null}),e)}d.default.on(t,"touchstart touchend",".dx-row",(function(e){clearTimeout(r),"touchstart"===e.type?(n=e.target,i=e.currentTarget,r=o(1e3)):r=o()})),d.default.on(t,"dxclick",".dx-row",{useNative:e._isNativeClick()},e.createAction((function(t){var r=t.event;n&&(r.target=n,r.currentTarget=i),(0,l.default)(r.target).closest("a").length||(t.rowIndex=e.getRowIndex(r.currentTarget),t.rowIndex>=0&&(t.rowElement=(0,_.getPublicElement)((0,l.default)(r.currentTarget)),t.columns=e.getColumns(),e._rowClick(t)))})))},U=function(e){return"auto"===e?"":x.default.isNumeric(e)?e+"px":e},X=function(e,t,n){e.style.width=e.style.maxWidth="auto"===t.width?"":n},Y=function(e,t){if(e&&t){var n,l,i=e.attributes,r=t.attributes;for(l=0;l<i.length;l++)n=i[l].nodeName,t.hasAttribute(n)||e.removeAttribute(n);for(l=0;l<r.length;l++)e.setAttribute(r[l].nodeName,r[l].nodeValue)}};t.ColumnsView=R.default.View.inherit(D.default).inherit({_createScrollableOptions:function(){var e=this,t=this.option("scrolling"),n=this.option("scrolling.useNative"),l=(0,y.extend)({pushBackValue:0},t,{direction:"both",bounceEnabled:!1,useKeyboard:!1});return void 0===n&&(n=!0),"auto"===n?(delete l.useNative,delete l.useSimulatedScrollbar):(l.useNative=!!n,l.useSimulatedScrollbar=!n),l},_updateCell:function(e,t){t.rowType&&this._cellPrepared(e,t)},_createCell:function(e){var t=e.column,n=t.alignment||(0,T.getDefaultAlignment)(this.option("rtlEnabled")),i=r.default.createElement("td");i.style.textAlign=n;var o=(0,l.default)(i);return"data"===e.rowType&&t.headerId&&this.setAria("describedby",t.headerId,o),!x.default.isDefined(t.groupIndex)&&t.cssClass&&o.addClass(t.cssClass),"expand"===t.command&&(o.addClass(t.cssClass),o.addClass(this.addWidgetPrefix("group-space"))),t.colspan>1?o.attr("colSpan",t.colspan):t.isBand||"auto"===t.visibleWidth||this.option("legacyRendering")||!this.option("columnAutoWidth")||((t.width||t.minWidth)&&(i.style.minWidth=U(t.minWidth||t.width)),t.width&&X(i,t,U(t.width))),o},_createRow:function(e){var t=(0,l.default)("<tr>").addClass("dx-row");return this.setAria("role","row",t),t},_createTable:function(e,t){var n=this,i=(0,l.default)("<table>").addClass(n.addWidgetPrefix("table")).addClass(n.addWidgetPrefix("table-fixed"));if(e&&!t?(i.append(n._createColGroup(e)),I.default.real().ios&&i.append((0,l.default)("<thead>").append("<tr>")),n.setAria("role","presentation",i)):n.setAria("hidden",!0,i),this.setAria("role","presentation",(0,l.default)("<tbody>").appendTo(i)),t)return i;m.default.mozilla&&d.default.on(i,"mousedown","td",(function(e){e.ctrlKey&&e.preventDefault()})),n.option("cellHintEnabled")&&d.default.on(i,"mousemove",".dx-row > td",this.createAction((function(e){var t,i=e.event,r=(0,l.default)(i.target),o=(0,l.default)(i.currentTarget),a=o.parent(),d=a.hasClass("dx-data-row"),s=a.hasClass("dx-header-row"),c=a.hasClass("dx-group-row"),u=a.hasClass(M),h=a.hasClass(n.addWidgetPrefix("filter-row")),f=n._columnsController.getVisibleColumns(),p=a.data("options"),g=o.index(),C=p&&p.cells&&p.cells[g],_=C?C.column:f[g],w=m.default.msie?1:0;u||h||d&&(!d||!_||_.cellTemplate)||s&&(!s||!_||_.headerCellTemplate)||c&&(!c||!_||void 0!==_.groupIndex&&_.groupCellTemplate)||(r.data(J)&&(r.removeAttr("title"),r.data(J,!1)),(t=r[0].scrollWidth-r[0].clientWidth-w)>0&&!x.default.isDefined(r.attr("title"))&&(r.attr("title",r.text()),r.data(J,!0)))})));var r=function(e){var t,i,r=(0,l.default)(e.currentTarget),o=(0,l.default)(e.target).closest(".dx-field-item-content"),a=r.parent().data("options"),d=a&&a.cells&&a.cells[r.index()];if(r.closest("table").is(e.delegateTarget))return i=(0,y.extend)({},d,{cellElement:(0,_.getPublicElement)(r),event:e,eventType:e.type}),o.length&&(t=o.data("dx-form-item")).column&&(i.column=t.column,i.columnIndex=n._columnsController.getVisibleIndex(i.column.index)),i};return d.default.on(i,"mouseover",".dx-row > td",(function(e){var t=r(e);t&&n.executeAction("onCellHoverChanged",t)})),d.default.on(i,"mouseout",".dx-row > td",(function(e){var t=r(e);t&&n.executeAction("onCellHoverChanged",t)})),d.default.on(i,h.default.name,".dx-row > td",(function(e){var t=r(e);t&&n.executeAction("onCellClick",t)})),Q(n,i),i},_isNativeClick:p.noop,_rowClick:p.noop,_createColGroup:function(e){var t,n,i,r=(0,l.default)("<colgroup>");for(t=0;t<e.length;t++)for(i=e[t].colspan||1,n=0;n<i;n++)r.append(this._createCol(e[t]));return r},_createCol:function(e){var t=e.visibleWidth||e.width;"adaptiveHidden"===t&&(t="0.0001px");var n=(0,l.default)("<col>");return C.default.setWidth(n,t),n},renderDelayedTemplates:function(){var e=this._delayedTemplates,t=e.filter((function(e){return!e.async})),n=e.filter((function(e){return e.async}));this._delayedTemplates=[],this._renderDelayedTemplatesCore(t),this._renderDelayedTemplatesCoreAsync(n)},_renderDelayedTemplatesCoreAsync:function(e){var t=this;e.length&&(0,o.getWindow)().setTimeout((function(){t._renderDelayedTemplatesCore(e,!0)}))},_renderDelayedTemplatesCore:function(e,t){for(var n,i=new Date;e.length;){var o=(n=e.shift()).options,a=o.model,d=r.default.getDocument();if(t&&!(0,l.default)(o.container).closest(d).length||(n.template.render(o),a&&a.column&&this._updateCell(o.container,a)),t&&new Date-i>30){this._renderDelayedTemplatesCoreAsync(e);break}}},_processTemplate:function(e){var t,n,i=this;return e&&e.render&&!x.default.isRenderer(e)?n={allowRenderToDetachedContainer:e.allowRenderToDetachedContainer,render:function(t){e.render(t.container,t.model)}}:x.default.isFunction(e)?n={render:function(t){var n=e((0,_.getPublicElement)(t.container),t.model);n&&(n.nodeType||x.default.isRenderer(n))&&t.container.append(n)}}:(t=x.default.isString(e)?e:(0,l.default)(e).attr("id"))?(this._templatesCache[t]||(this._templatesCache[t]=this.getTemplate(e)),n=this._templatesCache[t]):n=this.getTemplate(e),n},renderTemplate:function(e,t,n,l){var i,r=this,o=this._processTemplate(t,n),a=n.column,d="data"===n.rowType;if(o){if(n.component=this.component,i=a&&(a.renderAsync&&d||this.option("renderAsync")&&(!1!==a.renderAsync&&(a.command||a.showEditorAlways)&&d||"filter"===n.rowType)),(o.allowRenderToDetachedContainer||l)&&!i)return o.render({container:e,model:n}),!0;this._delayedTemplates.push({template:o,options:{container:e,model:n},async:i})}return!1},_getBodies:function(e){return(0,l.default)(e).children("tbody").not(".dx-header").not(".dx-footer")},_wrapRowIfNeed:function(e,t){var n=this.option("rowTemplate")&&this._getBodies(this._tableElement||e);if(n&&n.filter(".dx-row").length){var i=(0,l.default)("<tbody>").addClass(t.attr("class"));return this.setAria("role","presentation",i),i.append(t)}return t},_appendRow:function(e,t,n){(n=n||j).render({content:t,container:e})},_resizeCore:function(){var e=this,t=this._scrollLeft;t>=0&&(this._scrollLeft=0,this.scrollTo({left:t}))},_renderCore:function(e){var t=this.element().parent();t&&!t.parent().length||this.renderDelayedTemplates(e)},_renderTable:function(e){var t,n=this;(e=e||{}).columns=this._columnsController.getVisibleColumns();var l=e.change&&e.change.changeType;return t=this._createTable(e.columns,"append"===l||"prepend"===l||"update"===l),this._renderRows(t,e),t},_renderRows:function(e,t){var n,l=this,i=this._getRows(t.change),r=t.change&&t.change.columnIndices||[];for(n=0;n<i.length;n++)this._renderRow(e,(0,y.extend)({row:i[n],columnIndices:r[n]},t))},_renderRow:function(e,t){var n,l,i=this;t.columnIndices||(t.row.cells=[]),n=this._createRow(t.row),l=this._wrapRowIfNeed(e,n),this._renderCells(n,t),this._appendRow(e,l);var r=(0,y.extend)({columns:t.columns},t.row);this._addWatchMethod(r,t.row),this._rowPrepared(l,r)},_renderCells:function(e,t){var n,l=this,i=0,r=t.row,o=t.columns;for(n=0;n<o.length;n++)(!t.columnIndices||t.columnIndices.indexOf(n)>=0)&&this._renderCell(e,(0,y.extend)({column:o[n],columnIndex:i,value:r.values&&r.values[i],oldValue:r.oldValues&&r.oldValues[i]},t)),o[n].colspan>1?i+=o[n].colspan:i++},_updateCells:function(e,t,n){var l=e.children(),i=t.children(),r=this.option("highlightChanges"),o=this.addWidgetPrefix("cell-updated-animation");n.forEach((function(e,t){var n=l.eq(e),a=i.eq(t);n.replaceWith(a),r&&!a.hasClass("dx-command-expand")&&a.addClass(o)})),Y(e.get(0),t.get(0))},_setCellAriaAttributes:function(e,t){"freeSpace"!==t.rowType&&(this.setAria("selected",!1,e),this.setAria("role","gridcell",e),this.setAria("colindex",t.columnIndex+1,e))},_renderCell:function(e,t){var n,l=this,i=this._getCellOptions(t);return t.columnIndices?t.row.cells&&(t.row.cells[i.columnIndex]=i):t.row.cells.push(i),n=this._createCell(i),this._setCellAriaAttributes(n,i),this._renderCellContent(n,i),e.get(0).appendChild(n.get(0)),n},_renderCellContent:function(e,t){var n=this._getCellTemplate(t);n&&!this.renderTemplate(e,n,t)||this._updateCell(e,t)},_getCellTemplate:function(){},_getRows:function(){return[]},_getCellOptions:function(e){var t={column:e.column,columnIndex:e.columnIndex,rowType:e.row.rowType};return this._addWatchMethod(t),t},_addWatchMethod:function(e,t){if(this.option("repaintChangesOnly")){var n=[];return(t=t||e).watch=t.watch||function(e,l){var i=e(t.data),r=function(){var n=e(t.data);JSON.stringify(i)!==JSON.stringify(n)&&(l(n,i),i=n)},o;return n.push(r),function(){var e=n.indexOf(r);e>=0&&n.splice(e,1)}},t.update=t.update||function(t){this.data=e.data=t.data,this.rowIndex=e.rowIndex=t.rowIndex,this.dataIndex=e.dataIndex=t.dataIndex,this.isExpanded=e.isExpanded=t.isExpanded,e.row&&(e.row=t),n.forEach((function(e){e()}))},t!==e&&(e.watch=t.watch.bind(t)),e}},_cellPrepared:function(e,t){t.cellElement=(0,_.getPublicElement)((0,l.default)(e)),this.executeAction("onCellPrepared",t)},_rowPrepared:function(e,t){c.default.data(e.get(0),"options",t),t.rowElement=(0,_.getPublicElement)(e),this.executeAction("onRowPrepared",t)},_columnOptionChanged:function(e){var t=e.optionNames;if((0,W.checkChanges)(t,["width","visibleWidth"])){var n=this._columnsController.getVisibleColumns(),l=b.default.map(n,(function(e){var t=e.visibleWidth||e.width;return x.default.isDefined(t)?t:"auto"}));this.setColumnWidths(l)}else this._requireReady||this.render()},getTableElements:function(){return this._tableElement||(0,l.default)()},_getTableElement:function(){return this._tableElement},_setTableElement:function(e){this._tableElement=e},optionChanged:function(e){switch(this.callBase(e),e.name){case"cellHintEnabled":case"onCellPrepared":case"onRowPrepared":case"onCellHoverChanged":this._invalidate(!0,!0),e.handled=!0}},init:function(){var e=this;e._scrollLeft=-1,e._columnsController=e.getController("columns"),e._dataController=e.getController("data"),e._delayedTemplates=[],e._templatesCache={},e.createAction("onCellClick"),e.createAction("onRowClick"),e.createAction("onCellHoverChanged",{excludeValidators:["disabled","readOnly"]}),e.createAction("onCellPrepared",{excludeValidators:["designMode","disabled","readOnly"],category:"rendering"}),e.createAction("onRowPrepared",{excludeValidators:["designMode","disabled","readOnly"],category:"rendering",afterExecute:function(t){e._afterRowPrepared(t)}}),e._columnsController.columnsChanged.add(e._columnOptionChanged.bind(e)),e._dataController&&e._dataController.changed.add(e._handleDataChanged.bind(e))},_afterRowPrepared:p.noop,_handleDataChanged:function(){},callbackNames:function(){return["scrollChanged"]},scrollTo:function(e){var t=this,n=this.element(),l=n&&n.children("."+this.addWidgetPrefix("scroll-container")).not("."+this.addWidgetPrefix("content-fixed"));this._skipScrollChanged=!1,x.default.isDefined(e)&&x.default.isDefined(e.left)&&this._scrollLeft!==e.left&&(this._scrollLeft=e.left,l&&l.scrollLeft(Math.round(e.left)),this._skipScrollChanged=!0)},_wrapTableInScrollContainer:function(e){var t,n=this;return t=(0,l.default)("<div>"),d.default.on(t,"scroll",(function(){!n._skipScrollChanged&&n.scrollChanged.fire({left:t.scrollLeft()},n.name),n._skipScrollChanged=!1})),t.addClass(n.addWidgetPrefix("content")).addClass(n.addWidgetPrefix("scroll-container")).append(e).appendTo(n.element()),n.setAria("role","presentation",t),t},_updateContent:function(e){this._setTableElement(e),this._wrapTableInScrollContainer(e)},_findContentElement:p.noop,_getWidths:function(e){var t,n,l=[],i=this.option("legacyRendering");return e&&b.default.each(e,(function(e,r){t=r.offsetWidth,r.getBoundingClientRect&&(n=r.getBoundingClientRect()).width>t-1&&(t=i?Math.ceil(n.width):n.width),l.push(t)})),l},getColumnWidths:function(e){var t,n,l=this,i=[];if((this.option("forceApplyBindings")||p.noop)(),e=e||this._getTableElement()){t=e.children("tbody").children();for(var r=0;r<t.length;r++){var o=t.eq(r),a="none"!==o.get(0).style.display&&!o.hasClass("dx-state-invisible");if(!o.is(".dx-group-row")&&!o.is("."+M)&&a){n=o.children("td");break}}i=this._getWidths(n)}return i},getVisibleColumnIndex:function(e,t){return e},setColumnWidths:function(e,t,n,l){var i,r,o,a,d,s=this.option("columnAutoWidth"),c=this.option("legacyRendering");if((t=t||this._getTableElement())&&t.length&&e)for(d=0,i=t.children("colgroup").children("col"),C.default.setWidth(i,"auto"),n=n||this.getColumns(null,t),r=0;r<n.length;r++){if(!c&&s&&!l&&(o=n[r].width)&&!n[r].command){o=n[r].visibleWidth||o,o=U(o),a=U(n[r].minWidth||o);for(var u=u||t.children().children(".dx-row").not(".dx-group-row").not("."+M),h=0;h<u.length;h++){var f=this.getVisibleColumnIndex(r,h),m=u[h].cells[f];m&&(X(m,n[r],o),m.style.minWidth=a)}}n[r].colspan?d+=n[r].colspan:("adaptiveHidden"===(o=e[d])&&(o="0.0001px"),"number"==typeof o&&(o=o.toFixed(3)+"px"),C.default.setWidth(i.eq(d),x.default.isDefined(o)?o:"auto"),d++)}},getCellElements:function(e){return this._getCellElementsCore(e)},_getCellElementsCore:function(e){var t;return this._getRowElements().eq(e).children()},_getCellElement:function(e,t){var n,l=this,i=this.getCellElements(e),r=this._getVisibleColumnIndex(i,e,t);if(i.length&&r>=0&&(n=i.eq(r)),n&&n.length)return n},_getRowElement:function(e){var t=this,n=(0,l.default)(),i=t.getTableElements();if(b.default.each(i,(function(i,r){n=n.add(t._getRowElements((0,l.default)(r)).eq(e))})),n.length)return n},getCellElement:function(e,t){return(0,_.getPublicElement)(this._getCellElement(e,t))},getRowElement:function(e){var t=this._getRowElement(e),n=[];if(t&&!(0,_.getPublicElement)(t).get)for(var l=0;l<t.length;l++)n.push(t[l]);else n=t;return n},_getVisibleColumnIndex:function(e,t,n){var l;return x.default.isString(n)?(l=this._columnsController.columnOption(n,"index"),this._columnsController.getVisibleIndex(l)):n},getColumnElements:function(){},getColumns:function(e){return this._columnsController.getVisibleColumns(e)},getCell:function(e,t){var n,l=t||this._getRowElements();if(l.length>0&&e.rowIndex>=0&&("virtual"!==this.option("scrolling.mode")&&(e.rowIndex=e.rowIndex<l.length?e.rowIndex:l.length-1),(n=this.getCellElements(e.rowIndex))&&n.length>0))return n.eq(n.length>e.columnIndex?e.columnIndex:n.length-1)},getRowsCount:function(){var e=this._getTableElement();return e&&1===e.length?e[0].rows.length:0},_getRowElements:function(e){if(e=e||this._getTableElement()){var t=this.option("rowTemplate")&&e.find("> tbody.dx-row");return t&&t.length?t:e.find("> tbody > .dx-row, > .dx-row")}return(0,l.default)()},getRowIndex:function(e){return this._getRowElements().index(e)},getBoundingRect:function(){},getName:function(){},setScrollerSpacing:function(e){var t=this,n=this.element(),l=this.option("rtlEnabled");n&&n.css(l?{paddingLeft:e}:{paddingRight:e})},isScrollbarVisible:function(e){var t=this.element(),n=this._tableElement;return!(!t||!n)&&(e?n.outerWidth()-t.width()>0:n.outerHeight()-t.height()>0)}})}

