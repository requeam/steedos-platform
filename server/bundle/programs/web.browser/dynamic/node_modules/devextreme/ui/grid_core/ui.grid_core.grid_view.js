function module(e,t,i){"use strict";var n,o=b(e("../../core/renderer")),r,s=b(e("./ui.grid_core.modules")),a,d=b(e("../../core/utils/common")),l,h=b(e("../../core/utils/window")),c=e("../../core/utils/iterator"),u,g=b(e("../../core/utils/type")),f,_=b(e("./ui.grid_core.utils")),p,m=b(e("../../localization/message")),w=e("../../core/utils/deferred"),C,V=b(e("../../core/dom_adapter")),v,W=b(e("../../core/utils/browser"));function b(e){return e&&e.__esModule?e:{default:e}}var S="table",x="borders",z="table-fixed",H="important-margin",y="text-content",R="dx-hidden",F="dx-gridbase-container",T="adaptiveHidden",B="input:not([type='hidden'])",E=["columnsSeparatorView","blockSeparatorView","trackerView","headerPanel","columnHeadersView","rowsView","footerView","columnChooserView","filterPanelView","pagerView","draggingHeaderView","contextMenuView","errorView","headerFilterView","filterBuilderView"],A=function(e){return g.default.isString(e)&&"%"===e.slice(-1)},D=function(e,t){var i,n=[];if(e&&t&&e.length&&e.length===t.length)for(i=0;i<e.length;i++)n.push(e[i]>t[i]?e[i]:t[i]);else e&&e.length?n=e:t&&(n=t);return n},P=function(e){var t,i,n;return e.get(0).clientHeight-parseFloat(e.css("paddingTop"))-parseFloat(e.css("paddingBottom"))},L=function(e,t){var i=e._rowsView.contentWidth(),n;return i-e._getTotalWidth(t,i)},M=function(e,t,i,n){return L(e,n.map((function(e,n){return n===t?i:e})))},U=function(e,t){e.focus(),_.default.setSelectionRange(e,t)},$=s.default.ViewController.inherit({_initPostRenderHandlers:function(){var e=this,t=e._dataController;e._refreshSizesHandler||(e._refreshSizesHandler=function(i){t.changed.remove(e._refreshSizesHandler);var n,o=i&&i.changeType,r=i&&i.isDelayed,s=t.items();i&&"refresh"!==o&&"prepend"!==o&&"append"!==o?"update"===o&&i.changeTypes&&(!(s.length>1||"insert"!==i.changeTypes[0])||0===s.length&&"remove"===i.changeTypes[0]||i.needUpdateDimensions?n=e.resize():e._rowsView.resize()):r||(n=e.resize()),o&&"updateSelection"!==o&&"updateFocusedRow"!==o&&!r&&(0,w.when)(n).done((function(){e._setAriaRowColCount(),e.component._fireContentReadyAction()}))},e._dataController.changed.add((function(){e._dataController.changed.add(e._refreshSizesHandler)})))},_setAriaRowColCount:function(){var e=this.component;e.setAria({rowCount:this._dataController.totalItemsCount(),colCount:e.columnCount()},e.$element().children(".dx-gridbase-container"))},_getBestFitWidths:function(){if(!this.option("legacyRendering"))return this._rowsView.getColumnWidths();var e,t,i,n,o=this;return e=this._rowsView.getColumnWidths(),t=this._columnHeadersView&&this._columnHeadersView.getColumnWidths(),i=this._footerView&&this._footerView.getColumnWidths(),n=D(e,t),n=D(n,i)},_setVisibleWidths:function(e,t){var i=this._columnsController;i.beginUpdate(),(0,c.each)(e,(function(e,n){var o=i.getColumnId(n);i.columnOption(o,"visibleWidth",t[e])})),i.endUpdate()},_toggleBestFitModeForView:function(e,t,i){if(e&&e.isVisible()){var n,o=this._rowsView._getTableElement(),r=e._getTableElement();r&&((n=i?r.children("tbody").appendTo(o):o.children("."+t).appendTo(r)).toggleClass(t,i),n.toggleClass(this.addWidgetPrefix("best-fit"),i))}},_toggleBestFitMode:function(e){var t=this.component.$element(),i=this;if(this.option("legacyRendering"))t.find("."+this.addWidgetPrefix("table")).toggleClass(this.addWidgetPrefix("table-fixed"),!e),t.find(B).toggleClass("dx-hidden",e),t.find(".dx-group-cell").toggleClass("dx-hidden",e),t.find(".dx-header-row ."+this.addWidgetPrefix("text-content")).css("maxWidth","");else{var n=this._rowsView._getTableElement(),o=this._rowsView.getTableElements().eq(1);n.css("tableLayout",e?"auto":"fixed"),n.children("colgroup").css("display",e?"none":""),o.toggleClass(this.addWidgetPrefix("table-fixed"),!e),this._toggleBestFitModeForView(this._columnHeadersView,"dx-header",e),this._toggleBestFitModeForView(this._footerView,"dx-footer",e),this._needStretch()&&(n.get(0).style.width=e?"auto":""),W.default.msie&&11===parseInt(W.default.version)&&n.find("."+this.addWidgetPrefix("table-fixed")).each((function(){this.style.width=e?"10px":""}))}},_synchronizeColumns:function(){var e,t,i,n,o=this,r=o._columnsController,s=r.getVisibleColumns(),a=o.option("columnAutoWidth"),l=o.option("legacyRendering"),h=o._needBestFit(),u=!1,f=!1,p=[],m=function(){var e;(0,c.each)(s,(function(t,i){"groupExpand"===i.type&&(e=p[t])})),(0,c.each)(s,(function(t,i){"groupExpand"===i.type&&e&&(p[t]=e)}))};!h&&(0,c.each)(s,(function(e,t){if("auto"===t.width||l&&t.fixed)return h=!0,!1})),(0,c.each)(s,(function(e,t){if(t.minWidth)return u=!0,!1})),o._setVisibleWidths(s,[]),h&&(t=V.default.getActiveElement(),n=_.default.getSelectionRange(t),o._toggleBestFitMode(!0),e=!0),d.default.deferUpdate((function(){h?(p=o._getBestFitWidths(),(0,c.each)(s,(function(e,t){var i=r.getColumnId(t);r.columnOption(i,"bestFitWidth",p[e],!0)}))):u&&(p=o._getBestFitWidths()),(0,c.each)(s,(function(e){var t=this.width;"auto"!==t&&(g.default.isDefined(t)?p[e]=g.default.isNumeric(t)?parseFloat(t):t:a||(p[e]=void 0))})),e&&(o._toggleBestFitMode(!1),e=!1,t&&t!==V.default.getActiveElement()&&((i=t.getBoundingClientRect().bottom<0)||(W.default.msie?setTimeout((function(){U(t,n)})):U(t,n)))),f=o._correctColumnWidths(p,s),a&&(m(),o._needStretch()&&o._processStretch(p,s)),d.default.deferRender((function(){(h||f)&&o._setVisibleWidths(s,p)}))}))},_needBestFit:function(){return this.option("columnAutoWidth")},_needStretch:function(){return this.option("legacyRendering")||this._columnsController.getVisibleColumns().some((function(e){return"auto"===e.width&&!e.command}))},_getAverageColumnsWidth:function(e){var t,i;return L(this,e)/e.filter((function(e){return void 0===e})).length},_correctColumnWidths:function(e,t){var i,n,o,r=this,s=!1,a=!1,d=!1,l=this.component.$element(),h=this._hasWidth;for(i=0;i<t.length;i++){var c=i,u=t[c],f="adaptiveHidden"===e[c],p=e[c],m=u.minWidth,w;if(m)if(void 0===p)p=n=this._getAverageColumnsWidth(e);else if(A(p))M(this,c,m,e)<0&&(p=-1);m&&this._getRealColumnWidth(p)<m&&!f&&(e[c]=m,d=!0,i=-1),g.default.isDefined(u.width)||(a=!0),A(u.width)&&(s=!0)}if(l&&this._maxWidth&&(delete this._maxWidth,l.css("maxWidth","")),!a&&e.length){var C=this._rowsView.contentWidth(),V=this._rowsView.getScrollbarWidth(),v=this._getTotalWidth(e,C);v<C&&(o=_.default.getLastResizableColumnIndex(t,e))>=0&&(e[o]="auto",d=!0,h||s||(this._maxWidth=v+V+(this.option("showBorders")?2:0),l.css("maxWidth",this._maxWidth)))}return d},_processStretch:function(e,t){var i,n,o,r,s=this._rowsView.contentWidth(),a=this._getTotalWidth(e,s),d={length:0};if(e.length&&((0,c.each)(t,(function(t){(this.width||"adaptiveHidden"===e[t])&&(d[t]=!0,d.length++)})),o=(i=s-a)-(n=Math.floor(i/(e.length-d.length)))*(e.length-d.length),i>=0))for(r=0;r<e.length;r++)d[r]||(e[r]+=n,o>0&&(o<1?(e[r]+=o,o=0):(e[r]++,o--)))},_getRealColumnWidth:function(e,t){return A(e)?(t=t||this._rowsView.contentWidth(),parseFloat(e)*t/100):parseFloat(e)},_getTotalWidth:function(e,t){var i,n,o=0;for(n=0;n<e.length;n++)(i=e[n])&&"adaptiveHidden"!==i&&(o+=this._getRealColumnWidth(i,t));return Math.round(o)},updateSize:function(e){var t,i,n=this,o=this.addWidgetPrefix("important-margin");void 0===this._hasHeight&&e&&e.is(":visible")&&((t=e.children("."+this.getWidgetContainerClass())).length&&t.detach(),this._hasHeight=!!P(e),i=e.width(),e.addClass(o),this._hasWidth=e.width()===i,e.removeClass(o),t.length&&t.appendTo(e))},publicMethods:function(){return["resize","updateDimensions"]},resize:function(){return!this.component._requireResize&&this.updateDimensions()},updateDimensions:function(e){var t=this;if(t._initPostRenderHandlers(),t._checkSize(e)){var i=t._resizeDeferred,n=t._resizeDeferred=new w.Deferred;return(0,w.when)(i).always((function(){d.default.deferRender((function(){t._dataController.isLoaded()&&t._synchronizeColumns(),t._resetGroupElementHeight(),d.default.deferUpdate((function(){d.default.deferRender((function(){d.default.deferUpdate((function(){t._updateDimensionsCore()}))}))}))})).done(n.resolve).fail(n.reject)})),n.promise()}},_resetGroupElementHeight:function(){var e=this.component.$element().children().get(0),t=this._rowsView.getScrollable();!e.style.height||t&&t.scrollTop()||(e.style.height="")},_checkSize:function(e){var t=this.component.$element();return!(e&&(this._lastWidth===t.width()&&this._lastHeight===t.height()||!t.is(":visible")))},_setScrollerSpacingCore:function(e){var t=this,i=e?t._rowsView.getScrollbarWidth():0,n=t._rowsView.getScrollbarWidth(!0);d.default.deferRender((function(){t._columnHeadersView&&t._columnHeadersView.setScrollerSpacing(i),t._footerView&&t._footerView.setScrollerSpacing(i),t._rowsView.setScrollerSpacing(i,n)}))},_setScrollerSpacing:function(e){var t=this,i;!t._rowsView.getScrollable()&&e?d.default.deferRender((function(){d.default.deferUpdate((function(){t._setScrollerSpacingCore(e)}))})):t._setScrollerSpacingCore(e)},_updateDimensionsCore:function(){var e,t,i=this,n=i._dataController,r=i._rowsView,s=i.component.$element(),a=s.children().get(0),l=s&&(s.get(0).clientHeight||s.height()),h=parseFloat(s.css("maxHeight")),u=h&&l>=h,g=i.option("height")||s.get(0).style.height,f=i.getController("editorFactory"),_=u&&a.scrollHeight===a.offsetHeight;i.updateSize(s),e=i._hasHeight||u,g&&i._hasHeight^"auto"!==g&&(t=(0,o.default)("<div>").height(g).appendTo(s),i._hasHeight=!!t.height(),t.remove()),d.default.deferRender((function(){r.height(null,e),u&&!_&&(0,o.default)(a).css("height",h),n.isLoaded()?d.default.deferUpdate((function(){i._updateLastSizes(s),i._setScrollerSpacing(e),(0,c.each)(E,(function(e,t){var n=i.getView(t);n&&n.resize()})),f&&f.resize()})):r.setLoading(n.isLoading())}))},_updateLastSizes:function(e){this._lastWidth=e.width(),this._lastHeight=e.height()},optionChanged:function(e){switch(e.name){case"width":case"height":this.component._renderDimensions(),this.resize();case"legacyRendering":case"renderAsync":return void(e.handled=!0);default:this.callBase(e)}},init:function(){var e=this;this._dataController=this.getController("data"),this._columnsController=this.getController("columns"),this._columnHeadersView=this.getView("columnHeadersView"),this._footerView=this.getView("footerView"),this._rowsView=this.getView("rowsView")}}),I=s.default.ViewController.inherit({_scrollChangedHandler:function(e,t,i){for(var n=0;n<e.length;n++)e[n]&&e[n].name!==i&&e[n].scrollTo({left:t.left,top:t.top})},init:function(){var e,t,i=[this.getView("columnHeadersView"),this.getView("footerView"),this.getView("rowsView")];for(t=0;t<i.length;t++)(e=i[t])&&e.scrollChanged.add(this._scrollChangedHandler.bind(this,i))}}),k=s.default.View.inherit({_endUpdateCore:function(){this.component._requireResize&&(this.component._requireResize=!1,this._resizingController.resize())},_getWidgetAriaLabel:function(){return"dxDataGrid-ariaDataGrid"},init:function(){var e=this;this._resizingController=this.getController("resizing"),this._dataController=this.getController("data")},getView:function(e){return this.component._views[e]},element:function(){return this._groupElement},optionChanged:function(e){var t=this;g.default.isDefined(this._groupElement)&&"showBorders"===e.name?(this._groupElement.toggleClass(this.addWidgetPrefix("borders"),!!e.value),e.handled=!0):this.callBase(e)},_renderViews:function(e){var t=this;(0,c.each)(E,(function(i,n){var o=t.getView(n);o&&o.render(e)}))},_getTableRoleName:function(){return"grid"},render:function(e){var t=this,i=!this._groupElement,n=this._groupElement||(0,o.default)("<div>").addClass(this.getWidgetContainerClass());n.addClass("dx-gridbase-container"),n.toggleClass(this.addWidgetPrefix("borders"),!!this.option("showBorders")),this.setAria("role","presentation",e),this.component.setAria({role:this._getTableRoleName(),label:m.default.format(this._getWidgetAriaLabel())},n),this._rootElement=e||this._rootElement,i&&(this._groupElement=n,h.default.hasWindow()&&this.getController("resizing").updateSize(e),n.appendTo(e)),this._renderViews(n)},update:function(){var e=this,t=this._rootElement,i=this._groupElement,n=this.getController("resizing");t&&i&&(n.resize(),this._dataController.isLoaded()&&this.component._fireContentReadyAction())}});i.exports={defaultOptions:function(){return{showBorders:!1,renderAsync:!1,legacyRendering:!1}},controllers:{resizing:$,synchronizeScrolling:I},views:{gridView:k}}}

