function module(t,e,i){"use strict";var n=t("./ui.scheduler.appointments.strategy.base"),o=t("../../../core/utils/extend").extend,a=t("../../../core/utils/type").isNumeric,r=t("../../../core/devices"),s=t("../../../core/utils/date"),l=25,u=50,p=5,h=50,c=5,m=20,f=n.inherit({getDeltaTime:function(t,e,i){var n=0;if(this.isAllDay(i))n=24*this._getDeltaWidth(t,e)*60*6e4;else{var o=t.height-e.height;n=6e4*Math.round(o/this._defaultHeight*this.instance.getAppointmentDurationInMinutes())}return n},getAppointmentGeometry:function(t){var e,i;return e=t.allDay?this._getAllDayAppointmentGeometry(t):this._getVerticalAppointmentGeometry(t),this.callBase(e)},_getItemPosition:function(t){var e=this.isAllDay(t),i=!!this.instance.fire("getField","recurrenceRule",t);if(e)return this.callBase(t);for(var n=this._getAppointmentCoordinates(t),a=[],r=0;r<n.length;r++){var s=this.calculateAppointmentHeight(t,n[r],i),l=this.calculateAppointmentWidth(t,n[r],i),u=s,p=null,h=[],c=n[r].vMax;this._isMultiDayAppointment(n[r],s)&&(p="head",u=this._reduceMultiDayAppointment(s,{top:n[r].top,bottom:c}),h=this._getAppointmentParts({sourceAppointmentHeight:s,reducedHeight:u,width:l},n[r])),o(n[r],{height:u,width:l,allDay:e,appointmentReduced:p}),a=this._getAppointmentPartsPosition(h,n[r],a)}return a},_isMultiDayAppointment:function(t,e){var i,n;return e>t.vMax-t.top},_reduceMultiDayAppointment:function(t,e){return t=e.bottom-Math.floor(e.top)},_getAppointmentParts:function(t,e){var i=t.sourceAppointmentHeight-t.reducedHeight,n=t.width,a=[],r=this.instance.fire("getGroupTop",e.groupIndex),s=this.instance.fire("isGroupedByDate")?this._defaultWidth*this.instance.fire("getGroupCount"):this._defaultWidth,l=e.left+s;if(i){var u=this.getAppointmentMinSize();i<u&&(i=u),r+=this.instance.fire("getOffsetByAllDayPanel",e.groupIndex),a.push(o(!0,{},e,{top:r,left:l,height:i,width:n,appointmentReduced:"tail",rowIndex:++e.rowIndex}))}return a},_getMinuteHeight:function(){return this._defaultHeight/this.instance.getAppointmentDurationInMinutes()},_getCompactLeftCoordinate:function(t,e){var i=1,n;return t+(1+(this._defaultWidth||this.getAppointmentMinSize()))*e},_checkLongCompactAppointment:function(t,e){return this._splitLongCompactAppointment(t,e),e},_getVerticalAppointmentGeometry:function(t){var e;if(this.instance.fire("getMaxAppointmentsPerCell")){var i=this._calculateVerticalGeometryConfig(t);return this._customizeVerticalCoordinates(t,i.width,i.appointmentCountPerCell,i.offset)}var n=this._getAppointmentMaxWidth()/t.count,o=t.height,a=t.top,r=t.left+t.index*n;return n<5&&(n=5),{height:o,width:n,top:a,left:r,empty:this._isAppointmentEmpty(o,n)}},_customizeVerticalCoordinates:function(t,e,i,n,o){var a,r,s=t.index,l=Math.max(e/i,e/t.count),u=t.height,p=t.left+t.index*l,h=t.top;return t.isCompact&&(a=this.getCompactAppointmentDefaultSize(),r=this.getCompactAppointmentDefaultOffset(),h=t.top+r,p=t.left+(s-i)*(a+r)+r,l=a,e=a,this._markAppointmentAsVirtual(t,o)),{height:u,width:l,top:h,left:p,empty:this._isAppointmentEmpty(u,e)}},_calculateVerticalGeometryConfig:function(t){var e=this.instance.fire("getMaxAppointmentsPerCell"),i=this._getOffsets(),n=this._getAppointmentDefaultOffset(),o=this._getAppointmentCount(e,t),r=this._getDefaultRatio(t,o),s=this._getMaxWidth();o||(o=t.count,r=(s-i.unlimited)/s);var l=(1-r)*s;return("auto"===e||a(e))&&(r=1,s-=n,l=0),{width:r*s,appointmentCountPerCell:o,offset:l}},_getMaxWidth:function(){return this._defaultWidth||this.invoke("getCellWidth")},isAllDay:function(t){var e;return!!this.instance.fire("getField","allDay",t)||this.instance.appointmentTakesAllDay(t)},_getAppointmentMaxWidth:function(){var t="desktop"===r.current().deviceType?25:50,e=this._defaultWidth-t;return e>0?e:this.getAppointmentMinSize()},calculateAppointmentWidth:function(t,e,i){if(!this.isAllDay(t))return 0;var n=new Date(this.startDate(t,!1,e)),o=this.endDate(t,e,i),a=this._defaultWidth||this.getAppointmentMinSize();n=s.trimTime(n);var r=(o.getTime()-n.getTime())/36e5,l=Math.ceil(r/24)*a;return l=this.cropAppointmentWidth(l,a)},calculateAppointmentHeight:function(t,e,i){var n=this.endDate(t,e,i),o=this.startDate(t,!1,e),a=this.instance.fire("getField","allDay",t);if(this.isAllDay(t))return 0;var r=this._getAppointmentDurationInMs(o,n,a),s,l;return this._adjustDurationByDaylightDiff(r,o,n)/6e4*this._getMinuteHeight()},getDirection:function(){return"vertical"},_sortCondition:function(t,e){var i=t.allDay-e.allDay,n=t.allDay&&e.allDay,o="vertical"===this.instance._groupOrientation&&n?this._columnCondition(t,e):this._rowCondition(t,e),a=i||o;return this._fixUnstableSorting(a,t,e)},_getDynamicAppointmentCountPerCell:function(){return{allDay:"vertical"===this.instance._groupOrientation?this.callBase():this.instance.option("_appointmentCountPerCell"),simple:this._calculateDynamicAppointmentCountPerCell()||this._getAppointmentMinCount()}},_calculateDynamicAppointmentCountPerCell:function(){return Math.floor(this._getAppointmentMaxWidth()/50)},_getAllDayAppointmentGeometry:function(t){var e=this._calculateGeometryConfig(t);return this._customizeCoordinates(t,e.height,e.appointmentCountPerCell,e.offset,!0)},_calculateGeometryConfig:function(t){this.instance._allowResizing()&&this.instance._allowAllDayResizing()||(t.skipResizing=!0);var e=this.callBase(t);return t.count<=this._getDynamicAppointmentCountPerCell().allDay&&(e.offset=0),e},_getAppointmentCount:function(t,e){return"auto"===t||1!==e.count||a(t)?this._getMaxAppointmentCountPerCellByType(e.allDay):e.count},_getDefaultRatio:function(t,e){return t.count>this.instance.option("_appointmentCountPerCell")?.65:1},_getOffsets:function(){return{unlimited:5,auto:20}},_getMaxHeight:function(){return this._allDayHeight||this.getAppointmentMinSize()},_needVerticalGroupBounds:function(t){return!t},_needHorizontalGroupBounds:function(){return!1}});i.exports=f}

