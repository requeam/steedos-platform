function module(t,e,i){"use strict";var n=t("../core/renderer"),o=t("../events/core/events_engine"),s=t("../core/utils/common"),r=t("../core/utils/type"),a=t("./widget/ui.errors"),c=t("../core/utils/window"),l=c.getWindow(),h=t("../core/utils/iterator"),u=t("../core/utils/extend").extend,_=t("../core/component_registrator"),d=t("./box"),m=t("./collection/ui.collection_widget.edit"),p="dx-responsivebox",f="dx-responsivebox-screen-",g="dx-box-item",S="dxBoxItemData",C=1920,v=m.inherit({_getDefaultOptions:function(){return u(this.callBase(),{rows:[],cols:[],screenByWidth:null,singleColumnScreen:"",height:"100%",width:"100%",activeStateEnabled:!1,focusStateEnabled:!1,onItemStateChanged:void 0,onLayoutChanged:null,currentScreenFactor:void 0,_layoutStrategy:void 0})},_init:function(){this.option("screenByWidth")||(this._options.screenByWidth=c.defaultScreenFactorFunc),this.callBase(),this._initLayoutChangedAction()},_initLayoutChangedAction:function(){this._layoutChangedAction=this._createActionByOption("onLayoutChanged",{excludeValidators:["disabled","readonly"]})},_itemClass:function(){return"dx-box-item"},_itemDataKey:function(){return"dxBoxItemData"},_initMarkup:function(){this.callBase(),this.$element().addClass("dx-responsivebox"),this._updateRootBox()},_updateRootBox:function(){clearTimeout(this._updateTimer),this._updateTimer=setTimeout(function(){this._$root&&o.triggerHandler(this._$root,"dxupdate")}.bind(this))},_renderItems:function(){this._setScreenSize(),this._screenItems=this._itemsByScreen(),this._prepareGrid(),this._spreadItems(),this._layoutItems(),this._linkNodeToItem()},_itemOptionChanged:function(t){var e=this._findItemElementByItem(t);e.length&&(this._refreshItem(e,t),this._clearItemNodeTemplates(),this._update())},_setScreenSize:function(){var t=this._getCurrentScreen();this._removeScreenSizeClass(),this.$element().addClass(f+t),this.option("currentScreenFactor",t)},_removeScreenSizeClass:function(){var t=this.option("currentScreenFactor");t&&this.$element().removeClass(f+t)},_prepareGrid:function(){var t=this._grid=[];this._prepareRowsAndCols(),h.each(this._rows,function(){var e=[];t.push(e),h.each(this._cols,function(){e.push(this._createEmptyCell())}.bind(this))}.bind(this))},getSingleColumnRows:function(){var t=this.option("rows"),e=this._screenItems.length;if(t.length){for(var i=this._filterByScreen(t),n=[],o=0;o<e;o++){var s=this._defaultSizeConfig();o<i.length&&r.isDefined(i[o].shrink)&&(s.shrink=i[o].shrink),n.push(s)}return n}return this._defaultSizeConfig(e)},_prepareRowsAndCols:function(){this._isSingleColumnScreen()?(this._prepareSingleColumnScreenItems(),this._rows=this.getSingleColumnRows(),this._cols=this._defaultSizeConfig(1)):(this._rows=this._sizesByScreen(this.option("rows")),this._cols=this._sizesByScreen(this.option("cols")))},_isSingleColumnScreen:function(){return this._screenRegExp().test(this.option("singleColumnScreen"))||!this.option("rows").length||!this.option("cols").length},_prepareSingleColumnScreenItems:function(){this._screenItems.sort((function(t,e){return t.location.row-e.location.row||t.location.col-e.location.col})),h.each(this._screenItems,(function(t,e){u(e.location,{row:t,col:0,rowspan:1,colspan:1})}))},_sizesByScreen:function(t){return h.map(this._filterByScreen(t),function(t){return u(this._defaultSizeConfig(),t)}.bind(this))},_createDefaultSizeConfig:function(){return{ratio:1,baseSize:0,minSize:0,maxSize:0}},_defaultSizeConfig:function(t){var e=this._createDefaultSizeConfig();if(!arguments.length)return e;for(var i=[],n=0;n<t;n++)i.push(e);return i},_filterByScreen:function(t){var e=this._screenRegExp();return s.grep(t,(function(t){return!t.screen||e.test(t.screen)}))},_screenRegExp:function(){var t=this._getCurrentScreen();return new RegExp("(^|\\s)"+t+"($|\\s)","i")},_getCurrentScreen:function(){var t=this._screenWidth();return this.option("screenByWidth")(t)},_screenWidth:function(){return c.hasWindow()?n(l).width():1920},_createEmptyCell:function(){return{item:{},location:{colspan:1,rowspan:1}}},_spreadItems:function(){h.each(this._screenItems,function(t,e){var i=e.location||{},n=i.col,o=i.row,s=this._grid[o],r=s&&s[n];this._occupyCells(r,e)}.bind(this))},_itemsByScreen:function(){var t=this;return this.option("items").reduce((function(e,i){var n=i.location||{};return n=r.isPlainObject(n)?[n]:n,t._filterByScreen(n).forEach((function(t){e.push({item:i,location:u({rowspan:1,colspan:1},t)})})),e}),[])},_occupyCells:function(t,e){t&&!this._isItemCellOccupied(t,e)&&(u(t,e),this._markSpanningCell(t))},_isItemCellOccupied:function(t,e){if(!r.isEmptyObject(t.item))return!0;var i=!1;return this._loopOverSpanning(e.location,(function(t){i=i||!r.isEmptyObject(t.item)})),i},_loopOverSpanning:function(t,e){var i=t.row+t.rowspan-1,n=t.col+t.colspan-1,o=Math.min(i,this._rows.length-1),s=Math.min(n,this._cols.length-1);t.rowspan-=i-o,t.colspan-=n-s;for(var r=t.row;r<=o;r++)for(var a=t.col;a<=s;a++)r===t.row&&a===t.col||e(this._grid[r][a])},_markSpanningCell:function(t){this._loopOverSpanning(t.location,(function(e){u(e,{item:t.item,spanningCell:t})}))},_linkNodeToItem:function(){h.each(this._itemElements(),(function(t,e){var i=n(e),o=i.data("dxBoxItemData");o.box||(o.node=i.children())}))},_layoutItems:function(){var t=this._grid.length,e=t&&this._grid[0].length;if(t||e){var i=this._layoutBlock({direction:"col",row:{start:0,end:t-1},col:{start:0,end:e-1}}),o=this._prepareBoxConfig(i.box||{direction:"row",items:[u(i,{ratio:1})]});u(o,this._rootBoxConfig(o.items)),this._$root=n("<div>").appendTo(this._itemContainer()),this._createComponent(this._$root,d,o)}},_rootBoxConfig:function(t){var e=h.each(t,function(t,e){this._needApplyAutoBaseSize(e)&&u(e,{baseSize:"auto"})}.bind(this));return u({width:"100%",height:"100%",items:e,itemTemplate:this._getTemplateByOption("itemTemplate"),itemHoldTimeout:this.option("itemHoldTimeout"),onItemHold:this._createActionByOption("onItemHold"),onItemClick:this._createActionByOption("onItemClick"),onItemContextMenu:this._createActionByOption("onItemContextMenu"),onItemRendered:this._createActionByOption("onItemRendered")},{_layoutStrategy:this.option("_layoutStrategy")})},_needApplyAutoBaseSize:function(t){return!(t.baseSize||t.minSize&&"auto"!==t.minSize||t.maxSize&&"auto"!==t.maxSize)},_prepareBoxConfig:function(t){return u(t||{},{crossAlign:"stretch",onItemStateChanged:this.option("onItemStateChanged")})},_layoutBlock:function(t){return this._isSingleItem(t)?this._itemByCell(t.row.start,t.col.start):this._layoutDirection(t)},_isSingleItem:function(t){var e=this._grid[t.row.start][t.col.start].location,i=t.row.end-t.row.start==e.rowspan-1,n=t.col.end-t.col.start==e.colspan-1;return i&&n},_itemByCell:function(t,e){var i=this._grid[t][e];return i.spanningCell?null:i.item},_layoutDirection:function(t){for(var e=[],i=t.direction,n=this._crossDirection(i),o;o=this._nextBlock(t);){if(this._isBlockIndivisible(t.prevBlockOptions,o))throw a.Error("E1025");var s=this._layoutBlock({direction:n,row:o.row,col:o.col,prevBlockOptions:t});s&&(u(s,this._blockSize(o,n)),e.push(s)),t[n].start=o[n].end+1}return{box:this._prepareBoxConfig({direction:i,items:e})}},_isBlockIndivisible:function(t,e){return t&&t.col.start===e.col.start&&t.col.end===e.col.end&&t.row.start===e.row.start&&t.row.end===e.row.end},_crossDirection:function(t){return"col"===t?"row":"col"},_nextBlock:function(t){var e=t.direction,i=this._crossDirection(e),n=t[e].start,o=t[e].end,s=t[i].start;if(s>t[i].end)return null;for(var r=1,a=s;a<s+r;a++){for(var c=1,l=n;l<=o;l++){var h=this._cellByDirection(e,l,a);c=Math.max(c,h.location[i+"span"])}var u=a+c,_=s+r;u>_&&(r+=u-_)}var d={};return d[e]={start:n,end:o},d[i]={start:s,end:s+r-1},d},_cellByDirection:function(t,e,i){return"col"===t?this._grid[i][e]:this._grid[e][i]},_blockSize:function(t,e){for(var i="row"===e?this._rows:this._cols,n=u(this._createDefaultSizeConfig(),{ratio:0}),o=t[e].start;o<=t[e].end;o++){var s=i[o];n.ratio+=s.ratio,n.baseSize+=s.baseSize,n.minSize+=s.minSize,n.maxSize+=s.maxSize,r.isDefined(s.shrink)&&(n.shrink=s.shrink)}return n.minSize=n.minSize?n.minSize:"auto",n.maxSize=n.maxSize?n.maxSize:"auto",this._isSingleColumnScreen()&&(n.baseSize="auto"),n},_update:function(){var t=this._$root;this._renderItems(),t&&t.detach(),this._saveAssistantRoot(t),this._layoutChangedAction(),this._updateRootBox()},_saveAssistantRoot:function(t){this._assistantRoots=this._assistantRoots||[],this._assistantRoots.push(t)},_dispose:function(){clearTimeout(this._updateTimer),this._clearItemNodeTemplates(),this._cleanUnusedRoots(),this.callBase.apply(this,arguments)},_cleanUnusedRoots:function(){this._assistantRoots&&h.each(this._assistantRoots,(function(t,e){n(e).remove()}))},_clearItemNodeTemplates:function(){h.each(this.option("items"),(function(){delete this.node}))},_toggleVisibility:function(t){this.callBase(t),t&&this._updateRootBox()},_attachClickEvent:s.noop,_optionChanged:function(t){switch(t.name){case"rows":case"cols":case"screenByWidth":case"_layoutStrategy":case"singleColumnScreen":this._clearItemNodeTemplates(),this._invalidate();break;case"width":case"height":this.callBase(t),this._update();break;case"onLayoutChanged":this._initLayoutChangedAction();break;case"itemTemplate":this._clearItemNodeTemplates(),this.callBase(t);break;case"currentScreenFactor":break;default:this.callBase(t)}},_dimensionChanged:function(){this._getCurrentScreen()!==this.option("currentScreenFactor")&&this._update()},repaint:function(){this._update()}});_("dxResponsiveBox",v),i.exports=v,i.exports.default=i.exports}

