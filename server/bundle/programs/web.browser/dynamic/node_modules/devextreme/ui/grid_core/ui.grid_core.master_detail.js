function module(e,a,t){"use strict";var l,n=u(e("../../core/renderer")),i,d=u(e("./ui.grid_core.utils")),s=e("../../core/utils/common"),r=e("../../core/utils/iterator"),o=e("../../core/utils/type");function u(e){return e&&e.__esModule?e:{default:e}}var p="dx-master-detail-cell",c="dx-master-detail-row",m="dx-cell-focus-disabled",x="dx-row-lines",f;t.exports={defaultOptions:function(){return{masterDetail:{enabled:!1,autoExpandAll:!1,template:null}}},extenders:{controllers:{columns:{_getExpandColumnsCore:function(){var e=this.callBase();return this.option("masterDetail.enabled")&&e.push({type:"detailExpand",cellTemplate:d.default.getExpandCellTemplate()}),e}},data:(f=function(e){e._expandedItems=[],e._isExpandAll=e.option("masterDetail.autoExpandAll")},{init:function(){var e=this;f(this),this.callBase()},expandAll:function(e){var a=this;e<0?(a._isExpandAll=!0,a._expandedItems=[],a.updateItems()):a.callBase.apply(a,arguments)},collapseAll:function(e){var a=this;e<0?(a._isExpandAll=!1,a._expandedItems=[],a.updateItems()):a.callBase.apply(a,arguments)},isRowExpanded:function(e){var a=this,t=d.default.getIndexByKey(e,a._expandedItems);return Array.isArray(e)?a.callBase.apply(a,arguments):!!(a._isExpandAll^(t>=0&&a._expandedItems[t].visible))},_getRowIndicesForExpand:function(e){var a=this.getRowIndexByKey(e);return[a,a+1]},_changeRowExpandCore:function(e){var a,t,l=this;if(Array.isArray(e))return l.callBase.apply(l,arguments);if((a=d.default.getIndexByKey(e,l._expandedItems))>=0){var n=l._expandedItems[a].visible;l._expandedItems[a].visible=!n}else l._expandedItems.push({key:e,visible:!0}),(t=l.getController("editing"))&&t.correctEditRowIndexAfterExpand(e);l.updateItems({changeType:"update",rowIndices:l._getRowIndicesForExpand(e)})},_processDataItem:function(e,a){var t=this,l=t.callBase.apply(t,arguments);return l.isExpanded=t.isRowExpanded(l.key),void 0===a.detailColumnIndex&&(a.detailColumnIndex=-1,(0,r.each)(a.visibleColumns,(function(e,t){if("expand"===t.command&&!(0,o.isDefined)(t.groupIndex))return a.detailColumnIndex=e,!1}))),a.detailColumnIndex>=0&&(l.values[a.detailColumnIndex]=l.isExpanded),l},_processItems:function(e,a){var t,l=this,n=[];return e=l.callBase.apply(l,arguments),"loadingAll"===a?e:("refresh"===a&&(l._expandedItems=(0,s.grep)(l._expandedItems,(function(e){return e.visible}))),(0,r.each)(e,(function(e,a){n.push(a),t=d.default.getIndexByKey(a.key,l._expandedItems),"data"===a.rowType&&(a.isExpanded||t>=0)&&!a.inserted&&n.push({visible:a.isExpanded,rowType:"detail",key:a.key,data:a.data,values:[]})})),n)},optionChanged:function(e){var a,t,l,n,i=this;if("masterDetail"===e.name){switch(e.name="dataSource",e.fullName){case"masterDetail":a=e.value||{},t=e.previousValue||{},l=a.enabled!==t.enabled,n=a.autoExpandAll!==t.autoExpandAll;break;case"masterDetail.enabled":l=!0;break;case"masterDetail.autoExpandAll":n=!0}(l||n)&&f(this)}this.callBase(e)}})},views:{rowsView:{_getCellTemplate:function(e){var a,t=this,l=e.column,n=t.getController("editing"),i=n&&n.isEditRow(e.rowIndex);return a="detail"!==l.command||i?t.callBase.apply(t,arguments):t.option("masterDetail.template")||{allowRenderToDetachedContainer:!1,render:t._getDefaultTemplate(l)}},_cellPrepared:function(e,a){var t=this,l=t.component;t.callBase.apply(t,arguments),"detail"===a.rowType&&"detail"===a.column.command&&e.find("."+t.getWidgetContainerClass()).each((function(){var e=(0,n.default)(this).parent().data("dxDataGrid");e&&e.on("contentReady",(function(){if(t._isFixedColumns){var e=(0,n.default)(l.getRowElement(a.rowIndex));e&&2===e.length&&e.eq(0).height()!==e.eq(1).height()&&l.updateDimensions()}else{var i=l.getScrollable();i&&i.update()}}))}))},_isDetailRow:function(e){return e&&e.rowType&&0===e.rowType.indexOf("detail")},_createRow:function(e){var a=this.callBase(e);return e&&this._isDetailRow(e)&&(this.option("showRowLines")&&a.addClass("dx-row-lines"),a.addClass("dx-master-detail-row"),(0,o.isDefined)(e.visible)&&a.toggle(e.visible)),a},_renderCells:function(e,a){var t,l=a.row,n=this._columnsController.getVisibleColumns();l.rowType&&this._isDetailRow(l)?(t=this._renderCell(e,{value:null,row:l,rowIndex:l.rowIndex,column:{command:"detail"},columnIndex:0})).addClass("dx-cell-focus-disabled").addClass("dx-master-detail-cell").attr("colSpan",n.length):this.callBase.apply(this,arguments)}}}}}}

