function module(e,o,t){"use strict";var n,i=I(e("../../core/renderer")),l=e("../../core/utils/common"),s,r=I(e("./ui.grid_core.modules")),a,u=I(e("./ui.grid_core.columns_view")),c,d=I(e("../../localization/message")),h,m=I(e("../themes")),p,C=I(e("../button")),f,g=I(e("../tree_view")),_,b=I(e("../../core/devices")),v,x=I(e("../popup")),w=e("../../core/utils/type"),T=e("../../core/utils/extend"),B=e("../../core/utils/iterator");function I(e){return e&&e.__esModule?e:{default:e}}var P="column-chooser",V="column-chooser-button",D="notouch-action",E="column-chooser-list",S="column-chooser-plain",W="column-chooser-mode-drag",y="column-chooser-mode-select",M="column-chooser",k="dx-column-chooser-item",z=".dx-treeview-node",H=".dx-checkbox",L=300,O=function(e,o){var t,n=[],i="select"===e.option("columnChooser.mode");return o.length&&(0,B.each)(o,(function(e,o){t={text:o.caption,cssClass:o.cssClass,allowHiding:o.allowHiding,expanded:!0,id:o.index,disabled:!1,disableCheckBox:!1===o.allowHiding,parentId:(0,w.isDefined)(o.ownerBand)?o.ownerBand:null},i&&(t.selected=o.visible),n.push(t)})),n},N=r.default.ViewController.inherit({renderShowColumnChooserButton:function(e){var o,t=this,n=t.addWidgetPrefix("column-chooser-button"),l=t.option("columnChooser.enabled"),s=e.find("."+n);l?s.length?s.show():(o=(0,i.default)("<div>").addClass(n).appendTo(e),t._createComponent(o,C.default,{icon:"column-chooser",onClick:function(){t.getView("columnChooserView").showColumnChooser()},hint:t.option("columnChooser.title"),integrationOptions:{}})):s.hide()},getPosition:function(){var e=this.getView("rowsView");return{my:"right bottom",at:"right bottom",of:e&&e.element(),collision:"fit",offset:"-2 -2",boundaryOffset:"2 2"}}}),R=u.default.ColumnsView.inherit({_resizeCore:l.noop,_isWinDevice:function(){return!!b.default.real().win},_updateList:function(e){var o,t=this._popupContainer.$content(),n="select"===this.option("columnChooser.mode"),i=this._columnChooserList,l=this._columnsController.getChooserColumns(n);if(n&&i&&e&&"selection"===e.changeType){o=O(this,l);for(var s=0;s<o.length;s++)o[s].id===e.columnIndex&&i.option("items["+s+"].selected",o[s].selected)}else n&&i&&"full"!==e||(this._popupContainer._wrapper().toggleClass(this.addWidgetPrefix(W),!n).toggleClass(this.addWidgetPrefix(y),n),o=O(this,l),this._renderTreeView(t,o))},_initializePopupContainer:function(){var e=this,o=e.element().addClass(e.addWidgetPrefix("column-chooser")),t=e.option("columnChooser"),n=m.default.current(),l=m.default.isGeneric(n),s=m.default.isAndroid5(n),r=m.default.isMaterial(n),a={visible:!1,shading:!1,showCloseButton:!1,dragEnabled:!0,resizeEnabled:!0,toolbarItems:[{text:t.title,toolbar:"top",location:l||s||r?"before":"center"}],position:e.getController("columnChooser").getPosition(),width:t.width,height:t.height,rtlEnabled:e.option("rtlEnabled"),onHidden:function(){e._isWinDevice()&&(0,i.default)("body").removeClass(e.addWidgetPrefix("notouch-action"))},container:t.container};l||r?(0,T.extend)(a,{showCloseButton:!0}):a.toolbarItems[a.toolbarItems.length]={shortcut:"cancel"},(0,w.isDefined)(this._popupContainer)?this._popupContainer.option(a):(e._popupContainer=e._createComponent(o,x.default,a),e._popupContainer.on("optionChanged",(function(o){"visible"===o.name&&e.renderCompleted.fire()})))},_renderCore:function(e){this._popupContainer&&this._updateList(e)},_renderTreeView:function(e,o){var t,n,s=this,r=this.option("columnChooser"),a="select"===r.mode,u={items:o,dataStructure:"plain",activeStateEnabled:!0,focusStateEnabled:!0,hoverStateEnabled:!0,itemTemplate:"item",showCheckBoxesMode:"none",rootValue:null,searchEnabled:r.allowSearch,searchTimeout:r.searchTimeout,onItemRendered:function(e){if(e.itemData.disableCheckBox){var o=(0,i.default)(e.itemElement).closest(".dx-treeview-node"),t=void 0,n=void 0;o.length&&(n=o.find(".dx-checkbox")).length&&(t=n.data("dxCheckBox"))&&t.option("disabled",!0)}}};n=e.find(".dx-scrollable").data("dxScrollable"),t=n&&n.scrollTop(),a&&!this._columnsController.isBandColumnsUsed()&&e.addClass(this.addWidgetPrefix("column-chooser-plain")),u.onContentReady=function(e){(0,l.deferUpdate)((function(){if(t){var o=(0,i.default)(e.element).find(".dx-scrollable").data("dxScrollable");o&&o.scrollTo({y:t})}s.renderCompleted.fire()}))},this._isWinDevice()&&(u.useNativeScrolling=!1),(0,T.extend)(u,a?this._prepareSelectModeConfig():this._prepareDragModeConfig()),this._columnChooserList?(u.searchEnabled||(u.searchValue=""),this._columnChooserList.option(u)):(this._columnChooserList=this._createComponent(e,g.default,u),e.addClass(this.addWidgetPrefix("column-chooser-list")))},_prepareDragModeConfig:function(){var e;return{noDataText:this.option("columnChooser").emptyPanelText,activeStateEnabled:!1,focusStateEnabled:!1,hoverStateEnabled:!1,itemTemplate:function(e,o,t){(0,i.default)(t).text(e.text).parent().addClass(e.cssClass).addClass("dx-column-chooser-item")}}},_prepareSelectModeConfig:function(){var e=this,o;return{selectNodesRecursive:!1,showCheckBoxesMode:"normal",onItemSelectionChanged:function(o){var t,n;1===e._columnsController.getVisibleColumns().filter((function(e){return!e.command})).length&&!o.itemData.selected?o.component.selectItem(o.itemElement):setTimeout((function(){e._columnsController.columnOption(o.itemData.id,"visible",o.itemData.selected)}),300)}}},_columnOptionChanged:function(e){var o=e.changeTypes,t=e.optionNames,n="select"===this.option("columnChooser.mode");this.callBase(e),n&&(t.visible&&1===t.length&&void 0!==e.columnIndex?this.render(null,{changeType:"selection",columnIndex:e.columnIndex}):(t.showInColumnChooser||t.visible||o.columns&&t.all)&&this.render(null,"full"))},optionChanged:function(e){switch(e.name){case"columnChooser":this._initializePopupContainer(),this.render(null,"full");break;default:this.callBase(e)}},getColumnElements:function(){var e,o,t=[],n="select"===this.option("columnChooser.mode"),l=this._columnsController.getChooserColumns(n),s=this._popupContainer&&this._popupContainer.$content(),r=s&&s.find(".dx-treeview-node");return r&&l.forEach((function(n){e=r.filter("[data-item-id = '"+n.index+"']"),o=e.length?e.children(".dx-column-chooser-item").get(0):null,t.push(o)})),(0,i.default)(t)},getName:function(){return"columnChooser"},getColumns:function(){return this._columnsController.getChooserColumns()},allowDragging:function(e,o){var t=e&&e.allowHiding&&("columnChooser"!==o||!e.visible&&this._columnsController.isParentColumnVisible(e.index));return this.isColumnChooserVisible()&&t},getBoundingRect:function(){var e,o=this,t=this._popupContainer&&this._popupContainer._container();return t&&t.is(":visible")?{left:(e=t.offset()).left,top:e.top,right:e.left+t.outerWidth(),bottom:e.top+t.outerHeight()}:null},showColumnChooser:function(){this._popupContainer||(this._initializePopupContainer(),this.render()),this._popupContainer.show(),this._isWinDevice()&&(0,i.default)("body").addClass(this.addWidgetPrefix("notouch-action"))},hideColumnChooser:function(){this._popupContainer&&this._popupContainer.hide()},isColumnChooserVisible:function(){var e=this._popupContainer;return e&&e.option("visible")},publicMethods:function(){return["showColumnChooser","hideColumnChooser"]}});t.exports={defaultOptions:function(){return{columnChooser:{enabled:!1,allowSearch:!1,searchTimeout:500,mode:"dragAndDrop",width:250,height:260,title:d.default.format("dxDataGrid-columnChooserTitle"),emptyPanelText:d.default.format("dxDataGrid-columnChooserEmptyText"),container:void 0}}},controllers:{columnChooser:N},views:{columnChooserView:R},extenders:{views:{headerPanel:{_getToolbarItems:function(){var e=this.callBase();return this._appendColumnChooserItem(e)},_appendColumnChooserItem:function(e){var o=this,t;if(o.option("columnChooser.enabled")){var n=function(){o.component.getView("columnChooserView").showColumnChooser()},l=function(e){(0,i.default)(e.element).addClass(o._getToolbarButtonClass(o.addWidgetPrefix("column-chooser-button")))},s=o.option("columnChooser.title"),r={widget:"dxButton",options:{icon:"column-chooser",onClick:n,hint:s,text:s,onInitialized:l},showText:"inMenu",location:"after",name:"columnChooserButton",locateInMenu:"auto",sortIndex:40};e.push(r)}return e},optionChanged:function(e){switch(e.name){case"columnChooser":this._invalidate(),e.handled=!0;break;default:this.callBase(e)}},isVisible:function(){var e=this,o=this.option("columnChooser.enabled");return this.callBase()||o}}},controllers:{columns:{allowMoveColumn:function(e,o,t,n){var i,l;return!("select"===this.option("columnChooser.mode")&&"columnChooser"===n)&&this.callBase(e,o,t,n)}}}}}}

