function module(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function e(t,i,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(n):void 0},o,s=I(e("../../core/renderer")),l=e("../../core/utils/common"),r=e("../../core/utils/type"),u=e("../../core/utils/iterator"),d=e("../../core/utils/extend"),c=e("../widget/utils.ink_ripple"),p,_=I(e("../hierarchical_collection/ui.hierarchical_collection_widget")),h,m=I(e("./ui.menu_base.edit.strategy")),y,f=I(e("../../core/devices")),v,g=I(e("../collection/item")),k,b=I(e("../themes"));function I(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var x="dx-menu",A="dx-menu-no-icons",w="dx-menu-base",E="dx-menu-item",D=E+"-content",j=E+"-selected",B=E+"-wrapper",P="dx-menu-items-container",F=E+"-expanded",K="dx-menu-separator",N="dx-menu-last-group-item",T=E+"-has-text",R=E+"-has-icon",M=E+"-has-submenu",H=E+"-popout",G="dx-menu-item-popout-container",V=E+"-text",W="single",U={show:50,hide:300},$=function(e){function t(){return S(this,t),C(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return O(t,e),n(t,[{key:"_getDefaultOptions",value:function(){return(0,d.extend)(a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getDefaultOptions",this).call(this),{items:[],cssClass:"",activeStateEnabled:!0,showSubmenuMode:{name:"onHover",delay:{show:50,hide:300}},animation:{show:{type:"fade",from:0,to:1,duration:100},hide:{type:"fade",from:1,to:0,duration:100}},selectByClick:!1,focusOnSelectedItem:!1,keyExpr:null,_itemAttributes:{role:"menuitem"},useInkRipple:!1})}},{key:"_defaultOptionsRules",value:function(){return a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_defaultOptionsRules",this).call(this).concat([{device:function(){return b.default.isAndroid5()},options:{useInkRipple:!0}}])}},{key:"_itemDataKey",value:function(){return"dxMenuItemDataKey"}},{key:"_itemClass",value:function(){return E}},{key:"_setAriaSelected",value:function(){}},{key:"_selectedItemClass",value:function(){return"dx-menu-item-selected"}},{key:"_widgetClass",value:function(){return"dx-menu-base"}},{key:"_focusTarget",value:function(){return this._itemContainer()}},{key:"_clean",value:function(){this.option("focusedElement",null),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_clean",this).call(this)}},{key:"_supportedKeys",value:function(){var e=this,i=function(){var t=(0,s.default)(e.option("focusedElement"));t.length&&e._isSelectionEnabled()&&e.selectItem(t[0])};return(0,d.extend)(a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_supportedKeys",this).call(this),{space:i,pageUp:l.noop,pageDown:l.noop})}},{key:"_isSelectionEnabled",value:function(){return"single"===this.option("selectionMode")}},{key:"_init",value:function(){this._activeStateUnit="."+E,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_init",this).call(this),this._renderSelectedItem(),this._initActions()}},{key:"_getTextContainer",value:function(e){var t=e.text,i=(0,s.default)("<span>").addClass("dx-menu-item-text"),n=(0,r.isPlainObject)(e)?t:String(e);return t&&i.text(n)}},{key:"_getPopoutContainer",value:function(e){var t=e.items,i=void 0;if(t&&t.length){var n=(0,s.default)("<div>").addClass("dx-menu-item-popout");i=(0,s.default)("<span>").addClass("dx-menu-item-popout-container").append(n)}return i}},{key:"_getDataAdapterOptions",value:function(){return{rootValue:0,multipleSelection:!1,recursiveSelection:!1,recursiveExpansion:!1,searchValue:""}}},{key:"_selectByItem",value:function(e){if(e){var t=this._dataAdapter.getNodeByItem(e);this._dataAdapter.toggleSelection(t.internalFields.key,!0)}}},{key:"_renderSelectedItem",value:function(){var e=this._dataAdapter.getSelectedNodesKeys(),t=e.length&&e[0],i=this.option("selectedItem");if(t){var n=this._dataAdapter.getNodeByKey(t);!1!==n.selectable&&(i?i!==n.internalFields.item&&(this._dataAdapter.toggleSelection(t,!1),this._selectByItem(i)):this.option("selectedItem",n.internalFields.item))}else this._selectByItem(i)}},{key:"_initActions",value:function(){}},{key:"_initMarkup",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initMarkup",this).call(this),this._addCustomCssClass(this.$element()),this.option("useInkRipple")&&this._renderInkRipple()}},{key:"_renderInkRipple",value:function(){this._inkRipple=(0,c.render)()}},{key:"_toggleActiveState",value:function(e,i,n){if(a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_toggleActiveState",this).apply(this,arguments),this._inkRipple){var o={element:e,event:n};i?this._inkRipple.showWave(o):this._inkRipple.hideWave(o)}}},{key:"_getShowSubmenuMode",value:function(){var e="onClick",t=this.option("showSubmenuMode");return t=(0,r.isObject)(t)?t.name:t,this._isDesktopDevice()?t:"onClick"}},{key:"_initSelectedItems",value:function(){}},{key:"_isDesktopDevice",value:function(){return"desktop"===f.default.real().deviceType}},{key:"_initEditStrategy",value:function(){var e=m.default;this._editStrategy=new e(this)}},{key:"_addCustomCssClass",value:function(e){e.addClass(this.option("cssClass"))}},{key:"_itemWrapperSelector",value:function(){return".dx-menu-item-wrapper"}},{key:"_hoverStartHandler",value:function(e){var t=this._getItemElementByEventArgs(e);t&&!this._isItemDisabled(t)&&(e.stopPropagation(),"onHover"===this._getShowSubmenuMode()&&(clearTimeout(this._showSubmenusTimeout),this._showSubmenusTimeout=setTimeout(this._showSubmenu.bind(this,t),this._getSubmenuDelay("show"))))}},{key:"_getAvailableItems",value:function(e){return a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getAvailableItems",this).call(this,e).filter((function(){return"hidden"!==(0,s.default)(this).css("visibility")}))}},{key:"_isItemDisabled",value:function(e){return this._disabledGetter(e.data(this._itemDataKey()))}},{key:"_showSubmenu",value:function(e){this._addExpandedClass(e)}},{key:"_addExpandedClass",value:function(e){(0,s.default)(e).addClass("dx-menu-item-expanded")}},{key:"_getSubmenuDelay",value:function(e){var t,i=this.option("showSubmenuMode").delay;return(0,r.isDefined)(i)?(0,r.isObject)(i)?i[e]:i:U[e]}},{key:"_getItemElementByEventArgs",value:function(e){var t=(0,s.default)(e.target);if(t.hasClass(this._itemClass())||t.get(0)===e.currentTarget)return t;for(;!t.hasClass(this._itemClass());)if((t=t.parent()).hasClass("dx-submenu"))return null;return t}},{key:"_hoverEndHandler",value:function(){clearTimeout(this._showSubmenusTimeout)}},{key:"_hasSubmenu",value:function(e){return e.internalFields.childrenKeys.length}},{key:"_renderContentImpl",value:function(){this._renderItems(this._dataAdapter.getRootNodes())}},{key:"_renderItems",value:function(e,t){var i=this;if(e.length){this.hasIcons=!1;var n=this._renderContainer(this.$element(),t),a=-1,o=-1;(0,u.each)(e,(function(e,t){var s=!1!==t.visible,l;s&&a<0&&(a=e),a<e&&(t.beginGroup||e===o)&&(o=s?e:e+1),e===o&&a<e&&i._renderSeparator(n),i._renderItem(e,t,n)})),this.hasIcons||n.addClass("dx-menu-no-icons")}}},{key:"_renderContainer",value:function(e){return(0,s.default)("<ul>").appendTo(e).addClass("dx-menu-items-container")}},{key:"_createDOMElement",value:function(e){var t;return(0,s.default)("<li>").appendTo(e).addClass("dx-menu-item-wrapper")}},{key:"_renderItem",value:function(e,i,n,o){var s=this.option("items"),l=void 0;if(!1!==i.internalFields.item.visible){var r=o||this._createDOMElement(n);s[e+1]&&s[e+1].beginGroup&&r.addClass("dx-menu-last-group-item"),l=a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_renderItem",this).call(this,e,i.internalFields.item,r),i.internalFields.item===this.option("selectedItem")&&l.addClass("dx-menu-item-selected"),l.attr("tabIndex",-1),this._hasSubmenu(i)&&this.setAria("haspopup","true",l)}}},{key:"_renderItemFrame",value:function(e,i,n){var o=n.children("."+E);return o.length?o:a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_renderItemFrame",this).apply(this,arguments)}},{key:"_refreshItem",value:function(e,t){var i=this._dataAdapter.getNodeByItem(t),n=e.data(this._itemIndexKey()),a=e.closest("ul"),o=e.closest("li");this._renderItem(n,i,a,o)}},{key:"_addContentClasses",value:function(e,t){var i=!!e.text&&!!e.text.length,n=!!e.icon,a=!!e.items&&!!e.items.length;t.toggleClass(T,i),t.toggleClass(R,n),this.hasIcons||(this.hasIcons=n),t.toggleClass(M,a)}},{key:"_getItemContent",value:function(e){var i=a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getItemContent",this).call(this,e);return i.length||(i=e.children(".dx-menu-item-content")),i}},{key:"_postprocessRenderItem",value:function(e){var t=(0,s.default)(e.itemElement),i=this._dataAdapter.getSelectedNodesKeys(),n;i.length&&this._selectedGetter(e.itemData)&&this._isItemSelectable(e.itemData)?this._dataAdapter.getNodeByItem(e.itemData).internalFields.key===i[0]?(t.addClass(this._selectedItemClass()),this._setAriaSelected(t,"true")):this._setAriaSelected(t,"false"):this._setAriaSelected(t,"false")}},{key:"_isItemSelectable",value:function(e){return!1!==e.selectable}},{key:"_renderSeparator",value:function(e){(0,s.default)("<li>").appendTo(e).addClass("dx-menu-separator")}},{key:"_itemClickHandler",value:function(e){if(!e._skipHandling){var t=this._createAction(this._updateSubmenuVisibilityOnClick.bind(this));this._itemDXEventHandler(e,"onItemClick",{},{afterExecute:t.bind(this)}),e._skipHandling=!0}}},{key:"_updateSubmenuVisibilityOnClick",value:function(e){this._updateSelectedItemOnClick(e),"onClick"===this._getShowSubmenuMode()&&this._addExpandedClass(e.args[0].itemElement)}},{key:"_updateSelectedItemOnClick",value:function(e){var t=e.args?e.args[0]:e;if(this._isItemSelectionAllowed(t.itemData)){var i=this._dataAdapter.getSelectedNodesKeys(),n=i.length&&this._dataAdapter.getNodeByKey(i[0]);n&&this._toggleItemSelection(n,!1),n&&n.internalFields.item===t.itemData?(this._fireSelectionChangeEvent(null,this.option("selectedItem")),this._setOptionSilent("selectedItem",null)):this.selectItem(t.itemData)}}},{key:"_isItemSelectionAllowed",value:function(e){var t=this._isSelectionEnabled()&&this.option("selectByClick");return!this._isContainerEmpty()&&t&&this._isItemSelectable(e)&&!this._itemsGetter(e)}},{key:"_isContainerEmpty",value:function(){return this._itemContainer().is(":empty")}},{key:"_syncSelectionOptions",value:function(){return(0,l.asyncNoop)()}},{key:"_optionChanged",value:function(e){switch(e.name){case"showSubmenuMode":break;case"selectedItem":var i=this._dataAdapter.getNodeByItem(e.value),n=this._dataAdapter.getSelectedNodesKeys()[0];if(i&&i.internalFields.key!==n){if(!1===i.selectable)break;n&&this._toggleItemSelection(this._dataAdapter.getNodeByKey(n),!1),this._toggleItemSelection(i,!0),this._updateSelectedItems()}break;case"cssClass":case"position":case"selectByClick":case"animation":case"useInkRipple":this._invalidate();break;default:a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_optionChanged",this).call(this,e)}}},{key:"_toggleItemSelection",value:function(e,t){var i=this._getElementByItem(e.internalFields.item);i&&(0,s.default)(i).toggleClass("dx-menu-item-selected"),this._dataAdapter.toggleSelection(e.internalFields.key,t)}},{key:"_getElementByItem",value:function(e){var t=this,i=void 0;return(0,u.each)(this._itemElements(),(function(n,a){return(0,s.default)(a).data(t._itemDataKey())!==e||(i=a,!1)})),i}},{key:"_updateSelectedItems",value:function(e,t){(e||t)&&(this._updateSelection(t,e),this._fireSelectionChangeEvent(t,e))}},{key:"_fireSelectionChangeEvent",value:function(e,t){this._createActionByOption("onSelectionChanged",{excludeValidators:["disabled","readOnly"]})({addedItems:[e],removedItems:[t]})}},{key:"selectItem",value:function(e){var t=e.nodeType?this._getItemData(e):e,i=this._dataAdapter.getSelectedNodesKeys()[0],n=this.option("selectedItem"),a=this._dataAdapter.getNodeByItem(t);a.internalFields.key!==i&&(i&&this._toggleItemSelection(this._dataAdapter.getNodeByKey(i),!1),this._toggleItemSelection(a,!0),this._updateSelectedItems(n,t),this._setOptionSilent("selectedItem",t))}},{key:"unselectItem",value:function(e){var t=e.nodeType?this._getItemData(e):e,i=this._dataAdapter.getNodeByItem(t),n=this.option("selectedItem");i.internalFields.selected&&(this._toggleItemSelection(i,!1),this._updateSelectedItems(n,null),this._setOptionSilent("selectedItem",null))}}]),t}(_.default);$.ItemClass=g.default,i.exports=$}

