function module(e,t,n){"use strict";var o,i=S(e("../../core/renderer")),l=e("../../core/utils/window"),r,a=S(e("../../events/core/events_engine")),s=e("../../core/utils/common"),d,c=S(e("../../core/utils/style")),u=e("../../core/utils/type"),h=e("../../core/utils/iterator"),p=e("../../core/utils/extend"),g=e("../../core/utils/string"),f=e("../../core/utils/position"),m=e("../../core/utils/data"),w=e("./ui.grid_core.utils"),_,C=S(e("./ui.grid_core.columns_view")),v,x=S(e("../scroll_view/ui.scrollable")),b,T=S(e("../../core/remove_event")),R,y=S(e("../../localization/message")),E,I=S(e("../../core/utils/browser"));function S(e){return e&&e.__esModule?e:{default:e}}var L="rowsview",D="content",H="nowrap",W="dx-group-row",B="dx-group-cell",k="dx-data-row",P="dx-freespace-row",M="dx-row-lines",O="dx-column-lines",A="dx-row-alt",z="dx-last-row-border",V="dx-empty",F="row-inserted-animation",G=200,N,q;n.exports={defaultOptions:function(){return{hoverStateEnabled:!1,scrolling:{useNative:"auto"},loadPanel:{enabled:"auto",text:y.default.format("Loading"),width:200,height:90,showIndicator:!0,indicatorSrc:"",showPane:!0},rowTemplate:null,columnAutoWidth:!1,noDataText:y.default.format("dxDataGrid-noDataText"),wordWrapEnabled:!1,showColumnLines:!0,showRowLines:!1,rowAlternationEnabled:!1,activeStateEnabled:!1,twoWayBindingEnabled:!0}},views:{rowsView:C.default.ColumnsView.inherit((N=function(e,t){var n=(0,g.isEmpty)(t.text)&&"data"===t.rowType,o=t.text,i=e.get(0);n?(0,w.setEmptyText)(e):t.column.encodeHtml?i.textContent=o:i.innerHTML=o},q=function(e){var t=e.getScrollable();return t?Math.ceil(parseFloat(t.$content().css("paddingBottom"))):0},{_getDefaultTemplate:function(e){switch(e.command){case"empty":return function(e){e.html("&nbsp;")};default:return N}},_getDefaultGroupTemplate:function(e){var t=this,n=this.option("summary.texts");return function(t,o){var i=o.data,l=o.column.caption+": "+o.text,r=t.get(0);o.summaryItems&&o.summaryItems.length&&(l+=" "+(0,w.getGroupRowSummaryText)(o.summaryItems,n)),i&&(o.groupContinuedMessage&&o.groupContinuesMessage?l+=" ("+o.groupContinuedMessage+". "+o.groupContinuesMessage+")":o.groupContinuesMessage?l+=" ("+o.groupContinuesMessage+")":o.groupContinuedMessage&&(l+=" ("+o.groupContinuedMessage+")")),t.addClass("dx-group-cell"),e.encodeHtml?r.textContent=l:r.innerHTML=l}},_update:function(){},_getCellTemplate:function(e){var t,n=this,o=e.column;return t="group"!==e.rowType||!(0,u.isDefined)(o.groupIndex)||o.showWhenGrouped||o.command?o.cellTemplate||{allowRenderToDetachedContainer:!0,render:this._getDefaultTemplate(o)}:o.groupCellTemplate||{allowRenderToDetachedContainer:!0,render:this._getDefaultGroupTemplate(o)}},_createRow:function(e){var t,n,o,i=this.callBase(e);return e&&(t="group"===e.rowType,(n="data"===e.rowType)&&i.addClass("dx-data-row"),n&&this.option("showRowLines")&&i.addClass("dx-row-lines"),this.option("showColumnLines")&&i.addClass("dx-column-lines"),!1===e.visible&&i.hide(),t&&(i.addClass("dx-group-row"),o=e.isExpanded,this.setAria("role","row",i),this.setAria("expanded",(0,u.isDefined)(o)&&o.toString(),i))),i},_rowPrepared:function(e,t){var n=this;if("data"===t.rowType){if(this.option("rowAlternationEnabled")){var o=function(){return t.dataIndex%2==1};o()&&e.addClass("dx-row-alt"),t.watch&&t.watch(o,(function(t){e.toggleClass("dx-row-alt",t)}))}this._setAriaRowIndex(t,e),t.watch&&t.watch((function(){return t.rowIndex}),(function(){return n._setAriaRowIndex(t,e)}))}this.callBase.apply(this,arguments)},_setAriaRowIndex:function(e,t){var n=this.component,o="standard"===n.option("scrolling.mode")&&"virtual"!==n.option("scrolling.rowRenderingMode"),i=e.rowIndex+1;o?i=n.pageIndex()*n.pageSize()+i:i+=this._dataController.getRowIndexOffset(),this.setAria("rowindex",i,t)},_afterRowPrepared:function(e){var t=this,n=e.args[0],o=this._dataController,i=this.option("integrationOptions.watchMethod");if(n.data&&"data"===n.rowType&&!n.inserted&&this.option("twoWayBindingEnabled")&&i){var l=i((function(){return o.generateDataValues(n.data,n.columns)}),(function(){o.repaintRows([n.rowIndex],t.option("repaintChangesOnly"))}),{deep:!0,skipImmediate:!0});a.default.on(n.rowElement,T.default,l)}},_renderScrollable:function(e){var t=this,n=this.element();if(n.children().length||n.append("<div>"),!e&&this._loadPanel||this._renderLoadPanel(n,n.parent(),this._dataController.isLocalStore()),(e||!this.getScrollable())&&this._dataController.isLoaded()){for(var o=this.getColumns(),i=!0,l=0;l<o.length;l++)if(!o[l].width&&!o[l].minWidth){i=!1;break}(this.option("columnAutoWidth")||this._hasHeight||i||this._columnsController._isColumnFixing())&&this._renderScrollableCore(n)}},_handleScroll:function(e){var t=this;this._isScrollByEvent=!!e.event,this._scrollTop=e.scrollOffset.top,this._scrollLeft=e.scrollOffset.left,this.scrollChanged.fire(e.scrollOffset,this.name)},_renderScrollableCore:function(e){var t=this,n=this._createScrollableOptions(),o=this._handleScroll.bind(this);n.onScroll=o,n.onStop=o,this._scrollable=this._createComponent(e,x.default,n),this._scrollableContainer=this._scrollable&&this._scrollable._$container},_renderLoadPanel:w.renderLoadPanel,_renderContent:function(e,t){return e.replaceWith((0,i.default)("<div>").addClass(this.addWidgetPrefix("content")).append(t)),this._findContentElement()},_updateContent:function(e,t){var n=this,o=n._getTableElement(),i=n._findContentElement(),l=t&&t.changeType,r=[],a=this.option("highlightChanges"),s=this.addWidgetPrefix("row-inserted-animation");switch(l){case"update":(0,h.each)(t.rowIndices,(function(i,l){var d=n._getRowElements(e).eq(i),c=t.changeTypes&&t.changeTypes[i],h=t.items&&t.items[i];r.push((function(){var e=n._getRowElements(),r=e.eq(l);switch(c){case"update":if(h){var p=t.columnIndices&&t.columnIndices[i];(0,u.isDefined)(h.visible)&&h.visible!==r.is(":visible")?r.toggle(h.visible):p?n._updateCells(r,d,p):r.replaceWith(d)}break;case"insert":e.length?r.length?d.insertBefore(r):d.insertAfter(e.last()):d.prependTo(o.children("tbody")),a&&t.isLiveUpdate&&d.addClass(s);break;case"remove":r.remove()}}))})),(0,h.each)(r,(function(){this()})),e.remove();break;default:n._setTableElement(e),i.addClass(n.addWidgetPrefix("content")),n._renderContent(i,e)}},_createEmptyRow:function(e,t,n){var o,i,l=this,r=this._createRow(),a=t?this.getFixedColumns():this.getColumns();for(r.addClass(e).toggleClass("dx-column-lines",this.option("showColumnLines")),o=0;o<a.length;o++)i=this._createCell({column:a[o],rowType:"freeSpace",columnIndex:o,columns:a}),(0,u.isNumeric)(n)&&i.css("height",n),r.append(i);return this.setAria("role","presentation",r),r},_appendEmptyRow:function(e,t,n){var o=this._getBodies(e),i=o.length&&!t.is("tbody")?o:e;"top"===n?i.first().prepend(t):i.last().append(t)},_renderFreeSpaceRow:function(e){var t=this._createEmptyRow(P);t=this._wrapRowIfNeed(e,t),this._appendEmptyRow(e,t)},_checkRowKeys:function(e){var t=this,n=t._getRows(e),o=t._dataController.store()&&t._dataController.store().key();o&&n.some((function(e){if("data"===e.rowType&&void 0===e.key)return t._dataController.fireError("E1046",o),!0}))},_needUpdateRowHeight:function(e){return e>0&&!this._rowHeight},_getRowsHeight:function(e){var t;return e.children("tbody").children().not(".dx-virtual-row").not(".dx-freespace-row").toArray().reduce((function(e,t){return e+t.getBoundingClientRect().height}),0)},_updateRowHeight:function(){var e,t=this,n=this._getTableElement(),o=this._dataController.items().length;n&&this._needUpdateRowHeight(o)&&(e=this._getRowsHeight(n),this._rowHeight=e/o)},_findContentElement:function(){var e=this.element(),t=this.getScrollable();if(e)return t&&(e=t.$content()),e.children().first()},_getRowElements:function(e){var t=this.callBase(e);return t&&t.not(".dx-freespace-row")},_getFreeSpaceRowElements:function(e){var t=e||this.getTableElements();return t&&t.children("tbody").children(".dx-freespace-row")},_getNoDataText:function(){return this.option("noDataText")},_rowClick:function(e){var t=this._dataController.items()[e.rowIndex]||{};this.executeAction("onRowClick",(0,p.extend)({evaluate:function(e){var n;return(0,m.compileGetter)(e)(t.data)}},e,t))},_getColumnsCountBeforeGroups:function(e){for(var t=0;t<e.length;t++)if("groupExpand"===e[t].type)return t;return 0},_getGroupCellOptions:function(e){var t=this._getColumnsCountBeforeGroups(e.columns),n=(e.row.groupIndex||0)+t;return{columnIndex:n,colspan:e.columns.length-n-1}},_renderCells:function(e,t){"group"===t.row.rowType?this._renderGroupedCells(e,t):t.row.values&&this.callBase(e,t)},_renderGroupedCells:function(e,t){var n,o,i,l,r,a=t.row,s=t.columns,d=a.rowIndex,c=this._getGroupCellOptions(t);for(n=0;n<=c.columnIndex;n++)n===c.columnIndex&&s[n].allowCollapsing&&"infinite"!==t.scrollingMode?(i=!!a.isExpanded,o=s[n]):(i=null,o={command:"expand",cssClass:s[n].cssClass}),this._renderCell(e,{value:i,row:a,rowIndex:d,column:o,columnIndex:n});r=(0,f.getDefaultAlignment)(this.option("rtlEnabled")),l=(0,p.extend)({},s[c.columnIndex],{command:null,cssClass:null,width:null,showWhenGrouped:!1,alignment:r}),c.colspan>1&&(l.colspan=c.colspan),this._renderCell(e,{value:a.values[a.groupIndex],row:a,rowIndex:d,column:l,columnIndex:c.columnIndex})},_renderRows:function(e,t){var n=this,o=this.option("scrolling.mode");this.callBase(e,(0,p.extend)({scrollingMode:o},t)),this._checkRowKeys(t.change),this._renderFreeSpaceRow(e),this._hasHeight||this.updateFreeSpaceRowHeight(e)},_renderRow:function(e,t){var n=this,o=t.row,i=this.option("rowTemplate");"data"!==o.rowType&&"group"!==o.rowType||(0,u.isDefined)(o.groupIndex)||!i?this.callBase(e,t):this.renderTemplate(e,i,(0,p.extend)({columns:t.columns},o),!0)},_renderTable:function(e){var t=this,n=t.callBase(e),o=function e(){var n=t.getScrollable();n&&t.element().closest((0,l.getWindow)().document).length&&(t.resizeCompleted.remove(e),n._visibilityChanged(!0))};return(0,u.isDefined)(t._getTableElement())?t._renderScrollable():(t._setTableElement(n),t._renderScrollable(!0),t.resizeCompleted.add(o)),n},_createTable:function(){var e=this.callBase.apply(this,arguments);return this.option("rowTemplate")&&e.appendTo(this.component.$element()),e},_renderCore:function(e){var t,n=this,o=this.element();o.addClass(this.addWidgetPrefix("rowsview")).toggleClass(this.addWidgetPrefix("nowrap"),!this.option("wordWrapEnabled")),o.toggleClass("dx-empty",0===this._dataController.items().length),this.setAria("role","presentation",o),t=this._renderTable({change:e}),this._updateContent(t,e),this.callBase(e),this._lastColumnWidths=null},_getRows:function(e){return e&&e.items||this._dataController.items()},_getCellOptions:function(e){var t,n,o,i=this,l=e.column,r=e.row,a=r.data,s=r&&r.summaryCells,d=e.value,c=(0,w.getDisplayValue)(l,d,a,r.rowType);return(t=this.callBase(e)).value=d,t.oldValue=e.oldValue,t.displayValue=c,t.row=r,t.key=r.key,t.data=a,t.rowType=r.rowType,t.values=r.values,t.text=l.command?"":(0,w.formatValue)(c,l),t.rowIndex=r.rowIndex,t.summaryItems=s&&s[e.columnIndex],t.resized=l.resizedCallbacks,(0,u.isDefined)(l.groupIndex)&&!l.command&&(n=this.option("grouping.texts"),"virtual"!==(o=this.option("scrolling.mode"))&&"infinite"!==o&&(t.groupContinuesMessage=a&&a.isContinuationOnNextPage&&n&&n.groupContinuesMessage,t.groupContinuedMessage=a&&a.isContinuation&&n&&n.groupContinuedMessage)),t},_setRowsOpacityCore:function(e,t,n,o){var l=this._columnsController,r=l.getColumns(),a=r&&r[n],s=a&&a.isBand&&a.index;(0,h.each)(e,(function(r,a){if(!(0,i.default)(a).hasClass("dx-group-row"))for(var d=0;d<t.length&&(!((0,u.isNumeric)(s)&&l.isParentBandColumn(t[d].index,s)||t[d].index===n)||(e.eq(r).children().eq(d).css({opacity:o}),(0,u.isNumeric)(s)));d++);}))},_getDevicePixelRatio:function(){return(0,l.getWindow)().devicePixelRatio},renderNoDataText:w.renderNoDataText,getCellOptions:function(e,t){var n,o,i=this._dataController.items()[e];return i&&(o=(0,u.isString)(t)?this._columnsController.columnOption(t):this._columnsController.getVisibleColumns()[t])&&(n=this._getCellOptions({value:o.calculateCellValue(i.data),rowIndex:i.rowIndex,row:i,column:o})),n},getRow:function(e){if(e>=0){var t=this._getRowElements();if(t.length>e)return(0,i.default)(t[e])}},getCellIndex:function(e){var t;return e.length?e[0].cellIndex:-1},updateFreeSpaceRowHeight:function(e){var t,n,o=this,i=o._dataController,l=i.items().length,r=o._findContentElement(),a=o._getFreeSpaceRowElements(e);if(a&&r&&i.totalCount()>=0){var d=!1;l>0?o._hasHeight?(a.hide(),(0,s.deferUpdate)((function(){var t=q(o),n=o.getScrollbarWidth(!0),i=o.element().height()-n-t,l,c=i-r.outerHeight()>0,u=o._getRowsHeight(r.children().first()),h=e||o.getTableElements(),p,g,f=i-u-Math.ceil(parseFloat(h.css("borderTopWidth")))-(I.default.webkit&&o._getDevicePixelRatio()>=2?1:0);c&&(0,s.deferRender)((function(){a.css("height",f),d=!0,a.show()})),(0,s.deferRender)((function(){o._updateLastRowBorder(d)}))}))):(t=i.pageSize()-l,n=o.option("scrolling.mode"),t>0&&i.pageCount()>1&&"virtual"!==n&&"infinite"!==n&&(c.default.setHeight(a,t*o._rowHeight),d=!0),!d&&e?c.default.setHeight(a,0):a.toggle(d),o._updateLastRowBorder(d)):(a.css("height",0),a.show(),o._updateLastRowBorder(!0))}},_columnOptionChanged:function(e){var t=e.optionNames;e.changeTypes.grouping||(t.width||t.visibleWidth)&&(this.callBase(e),this._fireColumnResizedCallbacks())},getScrollable:function(){return this._scrollable},init:function(){var e=this,t=e.getController("data");e.callBase(),e._editorFactoryController=e.getController("editorFactory"),e._rowHeight=0,e._scrollTop=0,e._scrollLeft=-1,e._hasHeight=!1,t.loadingChanged.add((function(t,n){e.setLoading(t,n)})),t.dataSourceChanged.add((function(){e._scrollLeft>=0&&e._handleScroll({scrollOffset:{top:e._scrollTop,left:e._scrollLeft}})}))},_handleDataChanged:function(e){var t=this;switch(e.changeType){case"refresh":case"prepend":case"append":case"update":this.render(null,e);break;default:this._update(e)}},publicMethods:function(){return["isScrollbarVisible","getTopVisibleRowData","getScrollbarWidth","getCellElement","getRowElement","getScrollable"]},contentWidth:function(){return this.element().width()-this.getScrollbarWidth()},getScrollbarWidth:function(e){var t=this._scrollableContainer&&this._scrollableContainer.get(0),n=0;return t&&(e?(n=t.clientHeight?t.offsetHeight-t.clientHeight:0,n+=q(this)):n=t.clientWidth?t.offsetWidth-t.clientWidth:0),n>0?n:0},_fireColumnResizedCallbacks:function(){var e,t=this,n=this._lastColumnWidths||[],o=[],i=this.getColumns();for(e=0;e<i.length;e++)o[e]=i[e].visibleWidth,i[e].resizedCallbacks&&!(0,u.isDefined)(i[e].groupIndex)&&n[e]!==o[e]&&i[e].resizedCallbacks.fire(o[e]);this._lastColumnWidths=o},_updateLastRowBorder:function(e){this.option("showBorders")&&this.option("showRowLines")&&!e?this.element().addClass(z):this.element().removeClass(z)},_updateScrollable:function(){var e=x.default.getInstance(this.element());e&&(e.update(),this._updateHorizontalScrollPosition())},_updateHorizontalScrollPosition:function(){var e=this.getScrollable(),t=e&&e.scrollOffset().left;this._scrollLeft>=0&&t!==this._scrollLeft&&e.scrollTo({x:this._scrollLeft})},_resizeCore:function(){var e=this;e._fireColumnResizedCallbacks(),e._updateRowHeight(),(0,s.deferRender)((function(){e._renderScrollable(),e.renderNoDataText(),e.updateFreeSpaceRowHeight(),(0,s.deferUpdate)((function(){e._updateScrollable()}))}))},scrollTo:function(e){var t=this.element(),n=t&&x.default.getInstance(t);n&&n.scrollTo(e)},height:function(e,t){var n=this,o=this.element();if(0===arguments.length)return o?o.outerHeight(!0):0;n._hasHeight=void 0===t?"auto"!==e:t,(0,u.isDefined)(e)&&o&&c.default.setHeight(o,e)},setLoading:function(e,t){var n,o=this,i=this._loadPanel,r=this._dataController,a=this.option("loadPanel")||{},s=r.isLoaded()?a.animation:null,d=this.element();(0,l.hasWindow)()&&(!i&&void 0!==t&&r.isLocalStore()&&"auto"===a.enabled&&d&&(this._renderLoadPanel(d,d.parent()),i=this._loadPanel),i&&(n={message:t||a.text,animation:s,visible:e},clearTimeout(this._hideLoadingTimeoutID),i.option("visible")&&!e?this._hideLoadingTimeoutID=setTimeout((function(){i.option(n)}),200):i.option(n)))},setRowsOpacity:function(e,t){var n=this._getRowElements().not(".dx-group-row")||[];this._setRowsOpacityCore(n,this.getColumns(),e,t)},_getCellElementsCore:function(e){var t,n=this.callBase(e);return n&&(t=n.filter(".dx-group-cell").index())>=0&&n.length>t+1?n.slice(0,t+1):n},getTopVisibleItemIndex:function(e){var t,n,o=this,i=0,l=0,r=0,a=this._scrollTop,s=this._findContentElement(),d=s&&s.offset().top,c=this._dataController.items(),u=this._getTableElement();if(c.length&&u){for(t=this._getRowElements(u).filter(":visible"),i=0;i<c.length;i++)if(l=r,(n=t.eq(i)).length&&(r=n.offset().top-d)>a){i&&(e||2*a<Math.round(r+l))&&i--;break}i&&i===c.length&&i--}return i},getTopVisibleRowData:function(){var e=this.getTopVisibleItemIndex(),t=this._dataController.items();if(t[e])return t[e].data},optionChanged:function(e){var t=this;switch(this.callBase(e),e.name){case"wordWrapEnabled":case"showColumnLines":case"showRowLines":case"rowAlternationEnabled":case"rowTemplate":case"twoWayBindingEnabled":this._invalidate(!0,!0),e.handled=!0;break;case"scrolling":this._rowHeight=null,this._tableElement=null,e.handled=!0;break;case"rtlEnabled":this._rowHeight=null,this._tableElement=null;break;case"loadPanel":this._tableElement=null,this._invalidate(!0,"loadPanel.enabled"!==e.fullName),e.handled=!0;break;case"noDataText":this.renderNoDataText(),e.handled=!0}},dispose:function(){clearTimeout(this._hideLoadingTimeoutID),this._scrollable&&this._scrollable.dispose()},setScrollerSpacing:function(){}}))}}}

