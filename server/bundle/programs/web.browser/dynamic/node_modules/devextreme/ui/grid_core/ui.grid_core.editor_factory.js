function module(e,t,o){"use strict";var s,i=O(e("../../core/renderer")),a,n=O(e("../../core/dom_adapter")),u,d=O(e("../../events/core/events_engine")),r,l=O(e("./ui.grid_core.modules")),c,f=O(e("../../events/click")),h,v=O(e("../../events/pointer")),m,_=O(e("../../animation/position")),g=e("../../events/utils"),p,x=O(e("../../core/utils/browser")),y=e("../../core/utils/extend"),F,C=O(e("../shared/ui.editor_factory_mixin"));function O(e){return e&&e.__esModule?e:{default:e}}var $="dx-editor-inline-block",b="dx-cell-focus-disabled",E="focus-overlay",T="content",z="dx-focused",D="dx-row",H="dxDataGridEditorFactory",I=(0,g.addNamespace)([v.default.down,"focusin",f.default.name].join(" "),H),P="dx-pointer-events-target",w="dx-pointer-events-none",k="td[tabindex]:focus, tr[tabindex]:focus, input:focus, textarea:focus, .dx-lookup-field:focus, .dx-checkbox:focus",N="dx-hidden",W=l.default.ViewController.inherit({_getFocusedElement:function(e){return e.find(k)},_getFocusCellSelector:function(){return".dx-row > td"},_updateFocusCore:function(){var e,t,o=this._$focusedElement,s=this.component&&this.component.$element();s&&(o=this._getFocusedElement(s)).length&&(o.hasClass("dx-cell-focus-disabled")||o.hasClass("dx-row")||(t=(e=o.closest(this._getFocusCellSelector()+", .dx-cell-focus-disabled")).get(0)!==o.get(0)&&e.hasClass($),o=e),o.length&&!o.hasClass("dx-cell-focus-disabled"))?this.focus(o,t):this.loseFocus()},_updateFocus:function(e){var t=this,o=e&&e.event&&(0,i.default)(e.event.target).hasClass(t.addWidgetPrefix("focus-overlay"));t._isFocusOverlay=t._isFocusOverlay||o,clearTimeout(t._updateFocusTimeoutID),t._updateFocusTimeoutID=setTimeout((function(){delete t._updateFocusTimeoutID,t._isFocusOverlay||t._updateFocusCore(),t._isFocusOverlay=!1}))},_updateFocusOverlaySize:function(e,t){var o=_.default.calculate(e,(0,y.extend)({collision:"fit"},t));o.h.oversize>0&&e.outerWidth(e.outerWidth()-o.h.oversize),o.v.oversize>0&&e.outerHeight(e.outerHeight()-o.v.oversize)},callbackNames:function(){return["focused"]},focus:function(e,t){var o=this;if(void 0===e)return o._$focusedElement;e&&(e.is(o._$focusedElement)||o._$focusedElement&&o._$focusedElement.removeClass("dx-focused"),o._$focusedElement=e,clearTimeout(o._focusTimeoutID),o._focusTimeoutID=setTimeout((function(){delete o._focusTimeoutID,o.renderFocusOverlay(e,t),e.addClass("dx-focused"),o.focused.fire(e)})))},renderFocusOverlay:function(e,t){var o,s=this;if(this._$focusOverlay||(this._$focusOverlay=(0,i.default)("<div>").addClass(this.addWidgetPrefix("focus-overlay")+" dx-pointer-events-target")),t)this._$focusOverlay.addClass(N);else if(e.length){var a=x.default.msie?"left bottom":x.default.mozilla?"right bottom":"left top",n=e.closest("."+this.addWidgetPrefix("content")),u=e[0].getBoundingClientRect();this._$focusOverlay.removeClass(N).appendTo(n).outerWidth(u.right-u.left+1).outerHeight(u.bottom-u.top+1),o={precise:!0,my:a,at:a,of:e,boundary:n.length&&n},this._updateFocusOverlaySize(this._$focusOverlay,o),_.default.setup(this._$focusOverlay,o),this._$focusOverlay.css("visibility","visible")}},resize:function(){var e=this._$focusedElement;e&&this.focus(e)},loseFocus:function(){this._$focusedElement&&this._$focusedElement.removeClass("dx-focused"),this._$focusedElement=null,this._$focusOverlay&&this._$focusOverlay.addClass(N)},init:function(){this.createAction("onEditorPreparing",{excludeValidators:["designMode","disabled","readOnly"],category:"rendering"}),this.createAction("onEditorPrepared",{excludeValidators:["designMode","disabled","readOnly"],category:"rendering"}),this._updateFocusHandler=this._updateFocusHandler||this.createAction(this._updateFocus.bind(this)),d.default.on(n.default.getDocument(),I,this._updateFocusHandler),this._attachContainerEventHandlers()},_attachContainerEventHandlers:function(){var e=this,t=e.component&&e.component.$element();t&&d.default.on(t,(0,g.addNamespace)("keydown",H),(function(t){"tab"===(0,g.normalizeKeyName)(t)&&e._updateFocusHandler(t)}))},_focusOverlayEventProxy:function(e){var t,o=(0,i.default)(e.target),s=(0,i.default)(e.currentTarget),a;(o.hasClass("dx-pointer-events-target")||o.hasClass("dx-pointer-events-none"))&&!s.hasClass(N)&&(s.addClass(N),t=o.get(0).ownerDocument.elementFromPoint(e.clientX,e.clientY),(0,g.fireEvent)({originalEvent:e,target:t}),e.stopPropagation(),s.removeClass(N),e.type===f.default.name&&"INPUT"===t.tagName&&d.default.trigger((0,i.default)(t),"focus"))},dispose:function(){clearTimeout(this._focusTimeoutID),clearTimeout(this._updateFocusTimeoutID),d.default.off(n.default.getDocument(),I,this._updateFocusHandler)}}).include(C.default);o.exports={defaultOptions:function(){return{}},controllers:{editorFactory:W},extenders:{controllers:{columnsResizer:{_startResizing:function(e){this.callBase(e),this.isResizing()&&this.getController("editorFactory").loseFocus()}}}}}}

