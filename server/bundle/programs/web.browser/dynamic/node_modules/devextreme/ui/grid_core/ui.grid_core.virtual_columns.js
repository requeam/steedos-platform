function module(e,t,i){"use strict";var n=e("../../core/utils/window"),o=e("./ui.grid_core.virtual_columns_core"),s=50,l={_resizeCore:function(){this.callBase.apply(this,arguments),this._columnsController.resize()},_handleScroll:function(e){var t=this,i=this.getScrollable(),n=e.scrollOffset.left;t.callBase.apply(t,arguments),t.option("rtlEnabled")&&i&&(n=i.$content().width()-i.$element().width()-n),t._columnsController.setScrollPosition(n)}},r={_renderCore:function(){var e=this,t=e._scrollLeft;e.callBase.apply(e,arguments),e._columnsController.isVirtualMode()&&t>=0&&(e._scrollLeft=0,e.scrollTo({left:t}))}},a=(h=function(e){return e.map((function(e){return e.visibleWidth||parseFloat(e.width)||50}))},{init:function(){var e=this;this.callBase(),this._beginPageIndex=0,this._endPageIndex=0,this._position=0,this._virtualVisibleColumns={}},resetColumnsCache:function(){this.callBase(),this._virtualVisibleColumns={}},getBeginPageIndex:function(e){for(var t=this.getVisibleColumns(void 0,!0),i=h(t),n=0,o=0;o<i.length;o++){if(n>=e)return Math.floor(o/this.getColumnPageSize());n+=i[o]}return 0},getTotalWidth:function(){var e=this.option("width");return"number"==typeof e?e:this.getController("resizing")._lastWidth||this.component.$element().outerWidth()},getEndPageIndex:function(e){var t=this.getVisibleColumns(void 0,!0),i=h(t),n=0;e+=this.getTotalWidth();for(var o=0;o<i.length;o++){if(n>=e)return Math.ceil(o/this.getColumnPageSize());n+=i[o]}return Math.ceil(i.length/this.getColumnPageSize())},getColumnPageSize:function(){return this.option("scrolling.columnPageSize")},_fireColumnsChanged:function(){var e=new Date;this.columnsChanged.fire({optionNames:{all:!0,length:1},changeTypes:{columns:!0,length:1}}),this._renderTime=new Date-e},setScrollPosition:function(e){var t=this,i=t.option("scrolling.columnRenderingThreshold");t._renderTime>i?(clearTimeout(t._changedTimeout),t._changedTimeout=setTimeout((function(){t._setScrollPositionCore(e)}),t.option("scrolling.timeout"))):t._setScrollPositionCore(e)},isVirtualMode:function(){return(0,n.hasWindow)()&&"virtual"===this.option("scrolling.columnRenderingMode")},resize:function(){this._setScrollPositionCore(this._position)},_setScrollPositionCore:function(e){var t=this;if(this.isVirtualMode()){var i=this.getBeginPageIndex(e),n=this.getEndPageIndex(e),o=e<this._position?this._beginPageIndex>i:this._endPageIndex<n;this._position=e,o&&(this._beginPageIndex=i,this._endPageIndex=n,this._fireColumnsChanged())}},getFixedColumns:function(e,t){var i=this.callBase(e);if(this.isVirtualMode()&&!t&&i.length){var n=i.map((function(e){return e.command})).indexOf("transparent");return i[n].colspan=this.getVisibleColumns().length-this.callBase().length+1,i}return i},getVisibleColumns:function(e,t){if(t||!this.isVirtualMode())return this.callBase(e);this._beginPageIndex||this._endPageIndex||(this._beginPageIndex=this.getBeginPageIndex(this._position),this._endPageIndex=this.getEndPageIndex(this._position));var i=this._beginPageIndex,n=this._endPageIndex,s=e+"-"+i+"-"+n;if(this._virtualVisibleColumns[s])return this._virtualVisibleColumns[s];var l=this.callBase(),r=this.getRowCount(),a=this.getColumnPageSize(),u=i*a,c=n*a,g=this.getFixedColumns(void 0,!0),d=g.map((function(e){return e.command})).indexOf("transparent"),m=g.length?d:0,f=l.slice(0,m),_=l.slice(m,u),p=h(_).reduce((function(e,t){return e+t}),0);p||(u=0);var C=g.length?g.length-d-1:0,v=l.slice(l.length-C),P=l.slice(c,l.length-C),x=h(P).reduce((function(e,t){return e+t}),0);if(x||(c=l.length),r>1&&"number"==typeof e){for(var I=[],b=0;b<r;b++)I.push(this.callBase(b));f=(0,o.createColumnsInfo)(I,0,f.length)[e]||[],v=(0,o.createColumnsInfo)(I,l.length-v.length,l.length)[e]||[],l=(0,o.createColumnsInfo)(I,u,c)[e]||[]}else l=l.slice(u,c);return p&&(l.unshift({command:"virtual",width:p}),l=f.concat(l)),x&&(l.push({command:"virtual",width:x}),l=l.concat(v)),this._virtualVisibleColumns[s]=l,l},dispose:function(){clearTimeout(this._changedTimeout),this.callBase.apply(this,arguments)}}),h,u;i.exports={defaultOptions:function(){return{scrolling:{columnRenderingMode:"standard",columnPageSize:5,columnRenderingThreshold:300}}},extenders:{controllers:{columns:a},views:{columnHeadersView:r,footerView:r,rowsView:l}}}}

