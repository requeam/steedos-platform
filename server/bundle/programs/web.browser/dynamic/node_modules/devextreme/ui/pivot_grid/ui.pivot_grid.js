function module(e,t,o){"use strict";var i=e("../../core/renderer"),a=e("../../core/utils/window"),n=a.getWindow(),r=e("../../core/utils/browser"),l=e("../../events/core/events_engine"),s=e("../../core/component_registrator"),d=e("../../core/utils/dom").getPublicElement,h=e("../../core/utils/string"),c=e("../../core/utils/common"),u=e("../../core/utils/iterator").each,p=e("../../core/utils/type").isDefined,m=e("../../core/utils/extend").extend,g=e("../../events/click"),_=e("../../localization/message"),f=e("../widget/ui.widget"),C=e("../../events/utils"),x=e("../grid_core/ui.grid_core.utils"),w=e("./ui.pivot_grid.utils"),v=e("./ui.pivot_grid.data_controller"),b=e("./data_source"),F=e("./ui.pivot_grid.data_area"),S=e("./ui.pivot_grid.headers_area"),y=e("../../core/utils/size").getSize,A=e("./ui.pivot_grid.fields_area"),P=e("./ui.pivot_grid.field_chooser"),T=e("./ui.pivot_grid.field_chooser_base"),E=e("./ui.pivot_grid.export").ExportMixin,D=e("./ui.pivot_grid.chart_integration"),B=e("../popup"),H=e("../context_menu"),G=e("../../core/utils/deferred"),L=G.when,k=G.Deferred,W="dx-area-data-cell",I="dx-area-row-cell",R="dx-area-column-cell",$="dx-area-description-cell",M="dx-pivotgrid-border",O="dx-pivotgrid",V="dx-row-lines",N="dx-bottom-row",z="dx-bottom-border",U="dx-pivotgrid-fields-container",K="dx-area-fields",j="dx-fieldchooser-popup",q="dx-incompressible-fields",J="dx-overflow-hidden",Q="<tr>",X="<td>",Y="<div>",Z=66666;function ee(e){var t=0;return u(e,(function(e,o){t+=o||0})),t}function te(e,t){for(var o=t/e.length,i=0;i<e.length;i++)e[i]-=o}function oe(e){e.off("scroll").off("stop")}function ie(e,t){oe(e),e.on("scroll",t).on("stop",t)}var ae={};function ne(e){if(ae[e])return ae[e];var t,o=0,a={},n=i(Y).css({position:"absolute",visibility:"hidden",top:-1e3,left:-1e3,width:100,height:100}).appendTo("body"),r=i("<p>").css({width:"100%",height:200}).appendTo(n);return"auto"!==e&&(a.useNative=!!e,a.useSimulatedScrollbar=!e),n.dxScrollable(a),o=(t=n.dxScrollable("instance").option("useNative"))?n.width()-r.width():0,n.remove(),ae[e]={scrollBarWidth:o,scrollBarUseNative:t},ae[e]}function re(e,t){var o="width"===t?["borderLeftWidth","borderRightWidth"]:["borderTopWidth","borderBottomWidth"],i=0;return u(e,(function(e,t){var a=n.getComputedStyle(t.get(0));o.forEach((function(e){i+=parseFloat(a[e])||0}))})),i}function le(e){return e.closest("."+K).length||e.find("."+K).length}var se=f.inherit({_getDefaultOptions:function(){return m(this.callBase(),{scrolling:{timeout:300,renderingThreshold:150,minTimeout:10,mode:"standard",useNative:"auto",removeInvisiblePages:!0},encodeHtml:!0,dataSource:null,activeStateEnabled:!1,fieldChooser:{minWidth:250,minHeight:250,enabled:!0,allowSearch:!1,searchTimeout:500,layout:0,title:_.format("dxPivotGrid-fieldChooserTitle"),width:600,height:600,applyChangesMode:"instantly"},onContextMenuPreparing:null,allowSorting:!1,allowSortingBySummary:!1,allowFiltering:!1,allowExpandAll:!1,wordWrapEnabled:!0,fieldPanel:{showColumnFields:!0,showFilterFields:!0,showDataFields:!0,showRowFields:!0,allowFieldDragging:!0,visible:!1,texts:{columnFieldArea:_.format("dxPivotGrid-columnFieldArea"),rowFieldArea:_.format("dxPivotGrid-rowFieldArea"),filterFieldArea:_.format("dxPivotGrid-filterFieldArea"),dataFieldArea:_.format("dxPivotGrid-dataFieldArea")}},dataFieldArea:"column",export:{enabled:!1,fileName:"PivotGrid",proxyUrl:void 0,ignoreExcelErrors:!0},showRowTotals:!0,showRowGrandTotals:!0,showColumnTotals:!0,showColumnGrandTotals:!0,hideEmptySummaryCells:!0,showTotalsPrior:"none",rowHeaderLayout:"standard",loadPanel:{enabled:!0,text:_.format("Loading"),width:200,height:70,showIndicator:!0,indicatorSrc:"",showPane:!0},texts:{grandTotal:_.format("dxPivotGrid-grandTotal"),total:_.getFormatter("dxPivotGrid-total"),noData:_.format("dxDataGrid-noDataText"),showFieldChooser:_.format("dxPivotGrid-showFieldChooser"),expandAll:_.format("dxPivotGrid-expandAll"),collapseAll:_.format("dxPivotGrid-collapseAll"),sortColumnBySummary:_.getFormatter("dxPivotGrid-sortColumnBySummary"),sortRowBySummary:_.getFormatter("dxPivotGrid-sortRowBySummary"),removeAllSorting:_.format("dxPivotGrid-removeAllSorting"),exportToExcel:_.format("dxDataGrid-exportToExcel"),dataNotAvailable:_.format("dxPivotGrid-dataNotAvailable")},onCellClick:null,onCellPrepared:null,showBorders:!1,stateStoring:{enabled:!1,storageKey:null,type:"localStorage",customLoad:null,customSave:null,savingTimeout:2e3},onExpandValueChanging:null,renderCellCountLimit:2e4,onExporting:null,onExported:null,onFileSaving:null,headerFilter:{width:252,height:325,allowSearch:!1,searchTimeout:500,texts:{emptyValue:_.format("dxDataGrid-headerFilterEmptyValue"),ok:_.format("dxDataGrid-headerFilterOK"),cancel:_.format("dxDataGrid-headerFilterCancel")}}})},_getDataControllerOptions:function(){var e=this;return{component:e,dataSource:e.option("dataSource"),texts:e.option("texts"),showRowTotals:e.option("showRowTotals"),showRowGrandTotals:e.option("showRowGrandTotals"),showColumnTotals:e.option("showColumnTotals"),showTotalsPrior:e.option("showTotalsPrior"),showColumnGrandTotals:e.option("showColumnGrandTotals"),dataFieldArea:e.option("dataFieldArea"),rowHeaderLayout:e.option("rowHeaderLayout"),hideEmptySummaryCells:e.option("hideEmptySummaryCells"),onFieldsPrepared:function(t){u(t,(function(t,o){u(["allowSorting","allowSortingBySummary","allowFiltering","allowExpandAll"],(function(t,i){void 0===o[i]&&w.setFieldProperty(o,i,e.option(i))}))}))}}},_initDataController:function(){var e=this;e._dataController&&e._dataController.dispose(),e._dataController=new v.DataController(e._getDataControllerOptions()),a.hasWindow()&&e._dataController.changed.add((function(){e._render()})),e._dataController.scrollChanged.add((function(t){e._scrollLeft=t.left,e._scrollTop=t.top})),e._dataController.loadingChanged.add((function(t){e._updateLoading()})),e._dataController.progressChanged.add(e._updateLoading.bind(e)),e._dataController.dataSourceChanged.add((function(){e._trigger("onChanged")}));var t=e.option("onExpandValueChanging");t&&e._dataController.expandValueChanging.add((function(e){t(e)}))},_init:function(){var e=this;this.callBase(),this._initDataController(),this._scrollLeft=this._scrollTop=null,this._initActions()},_initActions:function(){var e=this;this._actions={onChanged:this._createActionByOption("onChanged"),onContextMenuPreparing:this._createActionByOption("onContextMenuPreparing"),onCellClick:this._createActionByOption("onCellClick"),onExporting:this._createActionByOption("onExporting"),onExported:this._createActionByOption("onExported"),onFileSaving:this._createActionByOption("onFileSaving"),onCellPrepared:this._createActionByOption("onCellPrepared")}},_trigger:function(e,t){this._actions[e](t)},_optionValuesEqual:function(e,t,o){return"dataSource"===e&&o instanceof b&&t instanceof b?o===t:this.callBase.apply(this,arguments)},_optionChanged:function(e){var t=this;switch(e.name){case"dataSource":case"allowSorting":case"allowFiltering":case"allowExpandAll":case"allowSortingBySummary":case"scrolling":case"stateStoring":this._initDataController(),this._fieldChooserPopup.hide(),this._renderFieldChooser(),this._invalidate();break;case"texts":case"showTotalsPrior":case"showRowTotals":case"showRowGrandTotals":case"showColumnTotals":case"showColumnGrandTotals":case"hideEmptySummaryCells":case"dataFieldArea":this._dataController.updateViewOptions(this._getDataControllerOptions());break;case"useNativeScrolling":case"encodeHtml":case"renderCellCountLimit":break;case"rtlEnabled":this.callBase(e),this._renderFieldChooser(),this._renderContextMenu(),a.hasWindow()&&this._renderLoadPanel(this._dataArea.groupElement(),this.$element()),this._invalidate();break;case"export":this._renderDescriptionArea();break;case"onExpandValueChanging":break;case"onCellClick":case"onContextMenuPreparing":case"onExporting":case"onExported":case"onFileSaving":case"onCellPrepared":this._actions[e.name]=this._createActionByOption(e.name);break;case"fieldChooser":this._renderFieldChooser(),this._renderDescriptionArea();break;case"loadPanel":a.hasWindow()&&(this._renderLoadPanel(this._dataArea.groupElement(),this.$element()),this._invalidate());break;case"fieldPanel":this._renderDescriptionArea(),this._invalidate();break;case"headerFilter":this._renderFieldChooser(),this._invalidate();break;case"showBorders":this._tableElement().toggleClass(M,!!e.value),this.updateDimensions();break;case"wordWrapEnabled":this._tableElement().toggleClass("dx-word-wrap",!!e.value),this.updateDimensions();break;case"rowHeaderLayout":this._tableElement().find(".dx-area-row-cell").toggleClass("dx-area-tree-view","tree"===e.value),this._dataController.updateViewOptions(this._getDataControllerOptions());break;case"height":case"width":this._hasHeight=null,this.callBase(e),this.resize();break;default:this.callBase(e)}},_updateScrollPosition:function(e,t,o){var i,a,n=this,r=this._scrollTop||this._scrollLeft;this._scrollUpdating||(this._scrollUpdating=!0,t&&!t.hasScroll()&&this._hasHeight&&(this._scrollTop=null),e&&!e.hasScroll()&&(this._scrollLeft=null),(null!==this._scrollTop||null!==this._scrollLeft||r||this.option("rtlEnabled"))&&(i=this._scrollTop||0,a=this._scrollLeft||0,o.scrollTo({x:a,y:i}),e.scrollTo(a),t.scrollTo(i),this._dataController.updateWindowScrollPosition(this._scrollTop)),this._scrollUpdating=!1)},_subscribeToEvents:function(e,t,o){var i=this,a=function(a){var n=a.scrollOffset,r=p(n.left)?n.left:i._scrollLeft,l=p(n.top)&&i._hasHeight?n.top:i._scrollTop;(i._scrollLeft||0)===(r||0)&&(i._scrollTop||0)===(l||0)||(i._scrollLeft=r,i._scrollTop=l,i._updateScrollPosition(e,t,o),"virtual"===i.option("scrolling.mode")&&i._dataController.setViewportPosition(i._scrollLeft,i._scrollTop))};u([e,t,o],(function(e,t){ie(t,a)})),!i._hasHeight&&i._dataController.subscribeToWindowScrollEvents(o.groupElement())},_clean:c.noop,_needDelayResizing:function(e){var t;return e.length*(e.length?e[0].length:0)>this.option("renderCellCountLimit")},_renderFieldChooser:function(){var e=this,t=e._pivotGridContainer,o=e.option("fieldChooser")||{},a="onDemand"===o.applyChangesMode?[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:_.format("OK"),onClick:function(t){e._fieldChooserPopup.$content().dxPivotGridFieldChooser("applyChanges"),e._fieldChooserPopup.hide()}}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:_.format("Cancel"),onClick:function(t){e._fieldChooserPopup.hide()}}}]:[],n={layout:o.layout,texts:o.texts||{},dataSource:e.getDataSource(),allowSearch:o.allowSearch,searchTimeout:o.searchTimeout,width:void 0,height:void 0,headerFilter:e.option("headerFilter"),encodeHtml:e.option("encodeHtml"),applyChangesMode:o.applyChangesMode},r={shading:!1,title:o.title,width:o.width,height:o.height,showCloseButton:!0,resizeEnabled:!0,minWidth:o.minWidth,minHeight:o.minHeight,toolbarItems:a,onResize:function(e){e.component.$content().dxPivotGridFieldChooser("updateDimensions")},onShown:function(t){e._createComponent(t.component.content(),P,n)},onHidden:function(e){var t=e.component.$content().dxPivotGridFieldChooser("instance");t.resetTreeView(),t.cancelChanges()}};e._fieldChooserPopup?(e._fieldChooserPopup.option(r),e._fieldChooserPopup.$content().dxPivotGridFieldChooser(n)):e._fieldChooserPopup=e._createComponent(i(Y).addClass("dx-fieldchooser-popup").appendTo(t),B,r)},_renderContextMenu:function(){var e=this,t=e._pivotGridContainer;e._contextMenu&&e._contextMenu.$element().remove(),e._contextMenu=e._createComponent(i(Y).appendTo(t),H,{onPositioning:function(t){var o,a,n,r=t.event;if(t.cancel=!0,r&&(o=r.target.cellIndex>=0?r.target:i(r.target).closest("td").get(0)))return a=e._createEventArgs(o,r),(n=e._getContextMenuItems(a))?(t.component.option("items",n),void(t.cancel=!1)):void 0},onItemClick:function(e){e.itemData.onItemClick&&e.itemData.onItemClick(e)},cssClass:"dx-pivotgrid",target:e.$element()})},_getContextMenuItems:function(e){var t=this,o=[],i=t.option("texts");if("row"===e.area||"column"===e.area){var a=e[e.area+"Fields"],n=e["column"===e.area?"rowFields":"columnFields"],r=e.cell.path&&a[e.cell.path.length-1],l=t.getDataSource();if(r&&r.allowExpandAll&&e.cell.path.length<e[e.area+"Fields"].length&&(o.push({beginGroup:!0,icon:"none",text:i.expandAll,onItemClick:function(){l.expandAll(r.index)}}),o.push({text:i.collapseAll,icon:"none",onItemClick:function(){l.collapseAll(r.index)}})),e.cell.isLast){var s=0;u(n,(function(t,a){a.allowSortingBySummary&&u(e.dataFields,(function(t,n){if(!p(e.cell.dataIndex)||e.cell.dataIndex===t){var r=!p(e.cell.dataIndex)&&e.dataFields.length>1,d="column"===e.area?i.sortColumnBySummary:i.sortRowBySummary,c=w.findField(e.dataFields,a.sortBySummaryField)===t&&(e.cell.path||[]).join("/")===(a.sortBySummaryPath||[]).join("/"),u=h.format(d,r?a.caption+" - "+n.caption:a.caption);o.push({beginGroup:0===s,icon:c?"desc"===a.sortOrder?"sortdowntext":"sortuptext":"none",text:u,onItemClick:function(){l.field(a.index,{sortBySummaryField:n.name||n.caption||n.dataField,sortBySummaryPath:e.cell.path,sortOrder:"desc"===a.sortOrder?"asc":"desc"}),l.load()}}),s++}}))})),u(n,(function(e,t){if(t.allowSortingBySummary&&p(t.sortBySummaryField))return o.push({beginGroup:0===s,icon:"none",text:i.removeAllSorting,onItemClick:function(){u(n,(function(e,t){l.field(t.index,{sortBySummaryField:void 0,sortBySummaryPath:void 0,sortOrder:void 0})})),l.load()}}),!1}))}}if(t.option("fieldChooser.enabled")&&o.push({beginGroup:!0,icon:"columnchooser",text:i.showFieldChooser,onItemClick:function(){t._fieldChooserPopup.show()}}),t.option("export.enabled")&&o.push({beginGroup:!0,icon:"exportxlsx",text:i.exportToExcel,onItemClick:function(){t.exportToExcel()}}),e.items=o,t._trigger("onContextMenuPreparing",e),(o=e.items)&&o.length)return o},_createEventArgs:function(e,t){var o=this,a=this.getDataSource(),n={rowFields:a.getAreaFields("row"),columnFields:a.getAreaFields("column"),dataFields:a.getAreaFields("data"),event:t};return le(i(e))?m(this._createFieldArgs(e),n):m(this._createCellArgs(e),n)},_createFieldArgs:function(e){var t=i(e).children().data("field"),o={field:t};return p(t)?o:{}},_createCellArgs:function(e){var t=i(e),o=e.cellIndex,a=e.parentElement.rowIndex,n=t.closest("table"),r=n.data("data"),l=r&&r[a]&&r[a][o],s;return{area:n.data("area"),rowIndex:a,columnIndex:o,cellElement:d(t),cell:l}},_handleCellClick:function(e){var t=this,o=t._createEventArgs(e.currentTarget,e),i=o.cell;i&&(o.area||!o.rowIndex&&!o.columnIndex)&&(t._trigger("onCellClick",o),i&&!o.cancel&&p(i.expanded)&&setTimeout((function(){t._dataController[i.expanded?"collapseHeaderItem":"expandHeaderItem"](o.area,i.path)})))},_getNoDataText:function(){return this.option("texts.noData")},_renderNoDataText:x.renderNoDataText,_renderLoadPanel:x.renderLoadPanel,_updateLoading:function(e){var t,o=this,i=o._dataController.isLoading();o._loadPanel&&((t=o._loadPanel.option("visible"))||(o._startLoadingTime=new Date),i&&(e?new Date-o._startLoadingTime>=1e3&&o._loadPanel.option("message",Math.floor(100*e)+"%"):o._loadPanel.option("message",o.option("loadPanel.text"))),clearTimeout(o._hideLoadingTimeoutID),t&&!i?o._hideLoadingTimeoutID=setTimeout((function(){o._loadPanel.option("visible",!1),o.$element().removeClass("dx-overflow-hidden")})):(o._loadPanel.option("visible",i),o.$element().toggleClass("dx-overflow-hidden",!i)))},_renderDescriptionArea:function(){var e=this,t=this.$element(),o=t.find(".dx-area-description-cell"),a=i(Y).addClass("dx-pivotgrid-toolbar"),n=this.option("fieldPanel"),r=t.find(".dx-filter-header"),l=t.find(".dx-column-header"),s=void 0;if(s=n.visible&&n.showFilterFields?r:n.visible&&(n.showDataFields||n.showColumnFields)?l:o,l.toggleClass("dx-bottom-border",!(!n.visible||!n.showDataFields&&!n.showColumnFields)),r.toggleClass("dx-bottom-border",!(!n.visible||!n.showFilterFields)),o.toggleClass("dx-pivotgrid-background",n.visible&&(n.showDataFields||n.showColumnFields||n.showRowFields)),this.$element().find(".dx-pivotgrid-toolbar").remove(),a.prependTo(s),this.option("fieldChooser.enabled")){var d=i(Y).appendTo(a).addClass("dx-pivotgrid-field-chooser-button"),h={icon:"columnchooser",hint:this.option("texts.showFieldChooser"),onClick:function(){e.getFieldChooserPopup().show()}};this._createComponent(d,"dxButton",h)}if(this.option("export.enabled")){var c=i(Y).appendTo(a).addClass("dx-pivotgrid-export-button"),u={icon:"exportxlsx",hint:this.option("texts.exportToExcel"),onClick:function(){e.exportToExcel()}};this._createComponent(c,"dxButton",u)}},_detectHasContainerHeight:function(){var e,t=this,o=this.$element();p(this._hasHeight)||o.is(":hidden")||(this._pivotGridContainer.addClass("dx-hidden"),e=i(Y).height(66666),o.append(e),this._hasHeight=66666!==o.height(),this._pivotGridContainer.removeClass("dx-hidden"),e.remove())},_renderHeaders:function(e,t,o,i){var a=this,n=this.getDataSource(),r=A.FieldsArea;this._rowFields=this._rowFields||new r(this,"row"),this._rowFields.render(e,n.getAreaFields("row")),this._columnFields=this._columnFields||new r(this,"column"),this._columnFields.render(t,n.getAreaFields("column")),this._filterFields=this._filterFields||new r(this,"filter"),this._filterFields.render(o,n.getAreaFields("filter")),this._dataFields=this._dataFields||new r(this,"data"),this._dataFields.render(i,n.getAreaFields("data")),this.$element().dxPivotGridFieldChooserBase("instance").renderSortable()},_createTableElement:function(){var e=this,t=i("<table>").css({width:"100%"}).toggleClass(M,!!this.option("showBorders")).toggleClass("dx-word-wrap",!!this.option("wordWrapEnabled"));return l.on(t,C.addNamespace(g.name,"dxPivotGrid"),"td",this._handleCellClick.bind(this)),t},_renderDataArea:function(e){var t=this,o=this._dataArea||new F.DataArea(this);return this._dataArea=o,o.render(e,this._dataController.getCellsInfo()),o},_renderRowsArea:function(e){var t=this,o=this._rowsArea||new S.VerticalHeadersArea(this);return this._rowsArea=o,o.render(e,this._dataController.getRowsInfo()),o},_renderColumnsArea:function(e){var t=this,o=this._columnsArea||new S.HorizontalHeadersArea(this);return this._columnsArea=o,o.render(e,this._dataController.getColumnsInfo()),o},_initMarkup:function(){var e=this;e.callBase.apply(this,arguments),e.$element().addClass("dx-pivotgrid")},_renderContentImpl:function(){var e,t,o,a,n,l,s,d,h,c,u,p=this,m=!this._pivotGridContainer;(a=!m&&this._tableElement())||(this.$element().addClass("dx-row-lines").addClass(U),this._pivotGridContainer=i(Y).addClass("dx-pivotgrid-container"),this._renderFieldChooser(),this._renderContextMenu(),e=i(X).addClass("dx-area-column-cell"),t=i(X).addClass("dx-area-row-cell"),o=i(X).addClass("dx-area-data-cell"),a=this._createTableElement(),u=i(X).addClass("dx-data-header"),c=i("<td>").attr("colspan","2").addClass("dx-filter-header"),h=i(X).addClass("dx-column-header"),d=i(X).addClass("dx-area-description-cell"),i(Q).append(c).appendTo(a),i(Q).append(u).append(h).appendTo(a),i(Q).toggleClass("dx-ie",!0===r.msie).append(d).append(e).appendTo(a),i(Q).addClass("dx-bottom-row").append(t).append(o).appendTo(a),this._pivotGridContainer.append(a),this.$element().append(this._pivotGridContainer),"tree"===this.option("rowHeaderLayout")&&t.addClass("dx-area-tree-view")),this.$element().addClass("dx-overflow-hidden"),this._createComponent(this.$element(),T,{dataSource:this.getDataSource(),encodeHtml:this.option("encodeHtml"),allowFieldDragging:this.option("fieldPanel.allowFieldDragging"),headerFilter:this.option("headerFilter"),visible:this.option("visible")}),n=this._renderDataArea(o),l=this._renderRowsArea(t),s=this._renderColumnsArea(e),n.tableElement().prepend(s.headElement()),m&&(this._renderLoadPanel(n.groupElement().parent(),this.$element()),this._renderDescriptionArea(),l.processScroll(),s.processScroll()),[n,l,s].forEach((function(e){oe(e)})),this._renderHeaders(d,h,c,u),this._update(m)},_update:function(e){var t,o=this;t=function(){o.updateDimensions().done((function(){o._subscribeToEvents(o._columnsArea,o._rowsArea,o._dataArea)}))},o._needDelayResizing(o._dataArea.getData())&&e?setTimeout(t):t()},_fireContentReadyAction:function(){this._dataController.isLoading()||this.callBase()},getScrollPath:function(e){var t=this;return"column"===e?this._columnsArea.getScrollPath(this._scrollLeft):this._rowsArea.getScrollPath(this._scrollTop)},getDataSource:function(){return this._dataController.getDataSource()},getFieldChooserPopup:function(){return this._fieldChooserPopup},hasScroll:function(e){var t=this;return"column"===e?this._columnsArea.hasScroll():this._rowsArea.hasScroll()},_dimensionChanged:function(){this.updateDimensions()},_visibilityChanged:function(e){e&&this.updateDimensions()},_dispose:function(){var e=this;clearTimeout(e._hideLoadingTimeoutID),e.callBase.apply(e,arguments),e._dataController&&e._dataController.dispose()},_tableElement:function(){return this.$element().find("table").first()},addWidgetPrefix:function(e){return"dx-pivotgrid-"+e},resize:function(){this.updateDimensions()},isReady:function(){return this.callBase()&&!this._dataController.isLoading()},updateDimensions:function(){var e,t,o,r,l,s,d,h,p,m,g,_,f,C,x,v,b,F=this,S=F._tableElement(),A=F._rowsArea,P=F._columnsArea,T=F._dataArea,E=0,D=0,B=0,H=ne(F.option("scrolling.useNative")),G=H.scrollBarWidth,W=S.find(".dx-area-data-cell"),I=S.find(".dx-area-row-cell"),R=S.find(".dx-area-column-cell"),$=S.find(".dx-area-description-cell"),M=S.find(".dx-filter-header"),O=S.find(".dx-column-header"),V=F._rowFields,N=new k;if(a.hasWindow())return b=V.isVisible()&&"tree"!==F.option("rowHeaderLayout"),F._detectHasContainerHeight(),T.headElement().length||T.tableElement().prepend(P.headElement()),b&&(A.updateColspans(V.getColumnsCount()),A.tableElement().prepend(V.headElement())),S.addClass("dx-incompressible-fields"),T.reset(),A.reset(),P.reset(),V.reset(),c.deferUpdate((function(){s=T.getColumnsWidth(),x=A.getRowsHeight(),r=b?x.slice(1):x,o=T.getRowsHeight(),f=y($[0],"height",{paddings:!0,borders:!0,margins:!0})+(b?x[0]:0),v=F._dataController.getColumnsInfo().length,l=w.mergeArraysByMaxValue(r,o.slice(v)),C=o.slice(0,v),_=ee(C),d=A.getColumnsWidth(),F._hasHeight&&(h=re([R,W,S,O,M],"height"),t=F.$element().height()-M.height()-S.find(".dx-data-header").height()-(Math.max(T.headElement().height(),R.height(),f)+h)),E=T.tableElement().width(),D=ee(l),E&&D?(B=ee(d),g=F.$element().width(),h=re([I,W,S],"width"),e=(e=g-B-h)>0?e:E,p=F._hasHeight&&D-t>=1,m=E-e>=1,p||(t=D+(m?G:0)),c.deferRender((function(){if(P.tableElement().append(T.headElement()),V.tableElement().append(A.headElement()),!m&&p&&G&&(te(s,G),E-=G),f>_&&(te(C,_-f),P.setRowsHeight(C)),S.removeClass("dx-incompressible-fields"),O.children().css("maxWidth",e),P.groupWidth(e),P.processScrollBarSpacing(p?G:0),P.setColumnsWidth(s),A.groupHeight(F._hasHeight?t:"auto"),A.processScrollBarSpacing(m?G:0),A.setColumnsWidth(d),A.setRowsHeight(l),T.setColumnsWidth(s),T.setRowsHeight(l),T.groupWidth(e),T.groupHeight(F._hasHeight?t:"auto"),b&&V.setColumnsWidth(d),W.toggleClass("dx-bottom-border",!p),I.toggleClass("dx-bottom-border",!p),!F._hasHeight&&g!==F.$element().width()){var o=g-F.$element().width();m||(te(s,o),P.setColumnsWidth(s),T.setColumnsWidth(s)),T.groupWidth(e-o),P.groupWidth(e-o)}if("virtual"===F.option("scrolling.mode")&&!F._dataController.isEmpty()){var a=F._dataController.calculateVirtualContentParams({contentWidth:E,contentHeight:D,rowCount:l.length,columnCount:s.length,viewportWidth:e,viewportHeight:F._hasHeight?t:i(n).outerHeight()});T.setVirtualContentParams({top:a.contentTop,left:a.contentLeft,width:a.width,height:a.height}),A.setVirtualContentParams({top:a.contentTop,width:B,height:a.height}),P.setVirtualContentParams({left:a.contentLeft,width:a.width,height:P.groupElement().height()})}var r=[];T.processScroll(H.scrollBarUseNative,m,p),u([P,A,T],(function(e,t){r.push(t&&t.updateScrollable())})),F._updateLoading(),F._renderNoDataText(W),L.apply(i,r).done((function(){F._updateScrollPosition(P,A,T),N.resolve()}))}))):N.resolve()})),N},applyPartialDataSource:function(e,t,o){this._dataController.applyPartialDataSource(e,t,o)}}).inherit(E).include(D);s("dxPivotGrid",se),o.exports=se}

