function module(e,t,i){"use strict";var n,r=y(e("../../core/renderer")),l,a=y(e("../../events/core/events_engine")),o=e("../../core/utils/type"),d=e("../../core/utils/extend"),s=e("../../events/utils"),u,f=y(e("../../core/utils/iterator")),c,p=y(e("./ui.grid_core.modules")),h,g=y(e("./ui.grid_core.utils")),m,x=y(e("../../localization/message")),v,w=y(e("../editor/editor")),_,F=y(e("../overlay")),O,C=y(e("../menu"));function y(e){return e&&e.__esModule?e:{default:e}}var b={"=":"filter-operation-equals","<>":"filter-operation-not-equals","<":"filter-operation-less","<=":"filter-operation-less-equal",">":"filter-operation-greater",">=":"filter-operation-greater-equal",default:"filter-operation-default",notcontains:"filter-operation-not-contains",contains:"filter-operation-contains",startswith:"filter-operation-starts-with",endswith:"filter-operation-ends-with",between:"filter-operation-between"},R={"=":"equal","<>":"notEqual","<":"lessThan","<=":"lessThanOrEqual",">":"greaterThan",">=":"greaterThanOrEqual",startswith:"startsWith",contains:"contains",notcontains:"notContains",endswith:"endsWith",between:"between"},V=700,E=1,T="filter-row",B="filter-range-overlay",D="filter-range-start",I="filter-range-end",S="dx-menu",A="dx-editor-with-menu",P="dx-editor-container",W="dx-editor-cell",G="dx-filter-menu",k="dx-apply-button",q="dx-highlight-outline",H="dx-focused",z="dx-cell-focus-disabled",L="dx-filter-range-content",M="dx-filter-modified",N="input:not([type='hidden'])";function $(e){return"onClick"===e.option("filterRow.applyFilter")}var K=(U=function(e){var t=e&&e.children(),i=t&&t.data("dxComponents"),n=i&&i.length&&t.data(i[0]);if(n instanceof w.default)return n},j=function(e,t){var i="",n="",r=J(e,t),l=g.default.getFormatOptionsByColumn(t,"filterRow");return Array.isArray(r)?(i=g.default.formatValue(r[0],l),""!==(n=g.default.formatValue(r[1],l))&&(i+=" - "+n)):(0,o.isDefined)(r)&&(i=g.default.formatValue(r,l)),i},J=function(e,t){if(t)return $(e)&&void 0!==t.bufferedFilterValue?t.bufferedFilterValue:t.filterValue},Q=function(e,t){if(t)return $(e)&&void 0!==t.bufferedSelectedFilterOperation?t.bufferedSelectedFilterOperation:t.selectedFilterOperation},X=function(e,t,i){var n=e._columnsController.columnOption(t),r=J(e,n),l=i.closest("."+e.addWidgetPrefix("filter-range-overlay")).length,a=i.hasClass(e.addWidgetPrefix("filter-range-start"));return r&&Array.isArray(r)&&"between"===Q(e,n)?a?r[0]:r[1]:l||void 0===r?null:r},Y=function(e,t,i,n){if("between"===Q(e,i)){var r=J(e,i);return n.hasClass(e.addWidgetPrefix("filter-range-start"))?[t,Array.isArray(r)?r[1]:void 0]:[Array.isArray(r)?r[0]:r,t]}return t},Z=function(e,t){var i=""===t.value?null:t.value,n=t.container,r=e._columnsController.columnOption(t.column.index),l=X(e,r.index,n);((0,o.isDefined)(l)||(0,o.isDefined)(i))&&(e._applyFilterViewController.setHighLight(n,l!==i),e._columnsController.columnOption(r.index,$(e)?"bufferedFilterValue":"filterValue",Y(e,i,r,n),t.notFireEvent))},{_updateEditorValue:function(e,t){var i=this,n=U(t);n&&n.option("value",X(this,e.index,t))},_columnOptionChanged:function(e){var t,i,n,l,a,o,d,s=this,u=e.optionNames;if(g.default.checkChanges(u,["filterValue","bufferedFilterValue","selectedFilterOperation","bufferedSelectedFilterOperation"])&&void 0!==e.columnIndex)return i=this._columnsController.getVisibleIndex(e.columnIndex),n=this._columnsController.columnOption(e.columnIndex),a=(l=this._getCellElement(this.element().find("."+this.addWidgetPrefix("filter-row")).index(),i)||(0,r.default)()).find(".dx-editor-container").first(),(u.filterValue||u.bufferedFilterValue)&&(this._updateEditorValue(n,a),(t=l.find("."+this.addWidgetPrefix("filter-range-overlay")).data("dxOverlay"))&&(o=t.$content().find(".dx-editor-container"),this._updateEditorValue(n,o.first()),this._updateEditorValue(n,o.last())),t&&t.option("visible")||this._updateFilterRangeContent(l,j(this,n))),void((u.selectedFilterOperation||u.bufferedSelectedFilterOperation)&&i>=0&&n&&(d=l.find(".dx-menu")).length&&(this._updateFilterOperationChooser(d,n,a),"between"===Q(this,n)?this._renderFilterRangeContent(l,n):a.find(".dx-filter-range-content").length&&(this._renderEditor(a,this._getEditorOptions(a,n)),this._hideFilterRange())));this.callBase(e)},_renderCore:function(){this._filterRangeOverlayInstance=null,this.callBase.apply(this,arguments)},_resizeCore:function(){this.callBase.apply(this,arguments),this._filterRangeOverlayInstance&&this._filterRangeOverlayInstance.repaint()},isFilterRowVisible:function(){return this._isElementVisible(this.option("filterRow"))},isVisible:function(){return this.callBase()||this.isFilterRowVisible()},init:function(){this.callBase(),this._applyFilterViewController=this.getController("applyFilter")},_initFilterRangeOverlay:function(e,t){var i=this,n={},l=e.find(".dx-editor-container"),o=(0,r.default)("<div>").addClass(i.addWidgetPrefix("filter-range-overlay")).appendTo(e);return i._createComponent(o,F.default,{height:"auto",shading:!1,showTitle:!1,focusStateEnabled:!1,closeOnTargetScroll:!1,closeOnOutsideClick:!0,animation:!1,position:{my:"top",at:"top",of:l.length&&l||e,offset:"0 -1"},contentTemplate:function(l){var o,d=(0,r.default)("<div>").addClass("dx-editor-container "+i.addWidgetPrefix("filter-range-start")).appendTo(l);return t=i._columnsController.columnOption(t.index),(o=i._getEditorOptions(d,t)).sharedData=n,i._renderEditor(d,o),a.default.on(d.find(N),"keydown",(function(t){var n=e.find("[tabindex]").not(t.target).first();"tab"===(0,s.normalizeKeyName)(t)&&t.shiftKey&&(t.preventDefault(),i._hideFilterRange(),n.length||(n=e.prev().find("[tabindex]").last()),a.default.trigger(n,"focus"))})),d=(0,r.default)("<div>").addClass("dx-editor-container "+i.addWidgetPrefix("filter-range-end")).appendTo(l),(o=i._getEditorOptions(d,t)).sharedData=n,i._renderEditor(d,o),a.default.on(d.find(N),"keydown",(function(t){"tab"!==(0,s.normalizeKeyName)(t)||t.shiftKey||(t.preventDefault(),i._hideFilterRange(),a.default.trigger(e.next().find("[tabindex]").first(),"focus"))})),(0,r.default)(l).addClass(i.getWidgetContainerClass())},onShown:function(e){var t=e.component.$content().find(".dx-editor-container").first();a.default.trigger(t.find(N),"focus")},onHidden:function(){t=i._columnsController.columnOption(t.index),e.find(".dx-menu").parent().addClass("dx-editor-with-menu"),"between"===Q(i,t)&&(i._updateFilterRangeContent(e,j(i,t)),i.component.updateDimensions())}})},_updateFilterRangeOverlay:function(e){var t=this._filterRangeOverlayInstance;t&&t.option(e)},_showFilterRange:function(e,t){var i=this,n=e.children("."+this.addWidgetPrefix("filter-range-overlay")),r=n.length&&n.data("dxOverlay");!r&&t&&(r=this._initFilterRangeOverlay(e,t)),r.option("visible")||(this._filterRangeOverlayInstance&&this._filterRangeOverlayInstance.hide(),this._filterRangeOverlayInstance=r,this._updateFilterRangeOverlay({width:e.outerWidth(!0)+1}),this._filterRangeOverlayInstance&&this._filterRangeOverlayInstance.show())},_hideFilterRange:function(){var e=this._filterRangeOverlayInstance;e&&e.hide()},getFilterRangeOverlayInstance:function(){return this._filterRangeOverlayInstance},_createRow:function(e){var t=this.callBase(e);return"filter"===e.rowType&&t.addClass(this.addWidgetPrefix("filter-row")),t},_getRows:function(){var e=this.callBase();return this.isFilterRowVisible()&&e.push({rowType:"filter"}),e},_renderFilterCell:function(e,t){var i,n,l=this,a=t.column,o=(0,r.default)(e);this.setAria("label",x.default.format("dxDataGrid-ariaColumn")+" "+a.caption+", "+x.default.format("dxDataGrid-ariaFilterCell"),o),o.addClass("dx-editor-cell"),i=(0,r.default)("<div>").appendTo(o),n=(0,r.default)("<div>").addClass("dx-editor-container").appendTo(i),"between"===Q(this,a)?this._renderFilterRangeContent(o,a):this._renderEditor(n,this._getEditorOptions(n,a)),a.alignment&&o.find(N).first().css("textAlign",a.alignment),a.filterOperations&&a.filterOperations.length&&this._renderFilterOperationChooser(i,a,n)},_renderCellContent:function(e,t){var i=this,n=t.column;if("filter"===t.rowType)if(n.command)e.html("&nbsp;");else if(n.allowFiltering)return void this.renderTemplate(e,this._renderFilterCell.bind(this),t);this.callBase(e,t)},_getEditorOptions:function(e,t){var i=this,n=(0,d.extend)({},t,{value:X(i,t.index,e),parentType:"filterRow",showAllText:i.option("filterRow.showAllText"),updateValueTimeout:"onClick"===i.option("filterRow.applyFilter")?0:700,width:null,setValue:function(n,r){Z(i,{column:t,value:n,container:e,notFireEvent:r})}});return"between"===Q(i,t)&&(e.hasClass(i.addWidgetPrefix("filter-range-start"))?n.placeholder=i.option("filterRow.betweenStartText"):n.placeholder=i.option("filterRow.betweenEndText")),n},_renderEditor:function(e,t){return e.empty(),this.getController("editorFactory").createEditor((0,r.default)("<div>").appendTo(e),t)},_renderFilterRangeContent:function(e,t){var i=this,n=e.find(".dx-editor-container").first();n.empty();var l=(0,r.default)("<div>").addClass("dx-filter-range-content").attr("tabindex",this.option("tabIndex"));a.default.on(l,"focusin",(function(){i._showFilterRange(e,t)})),l.appendTo(n),i._updateFilterRangeContent(e,j(i,t))},_updateFilterRangeContent:function(e,t){var i=e.find(".dx-filter-range-content");i.length&&(""===t?i.html("&nbsp;"):i.text(t))},_updateFilterOperationChooser:function(e,t,i){var n,r=this;r._createComponent(e,C.default,{integrationOptions:{},activeStateEnabled:!1,selectionMode:"single",cssClass:r.getWidgetContainerClass()+" dx-cell-focus-disabled "+G,showFirstSubmenuMode:"onHover",hideSubmenuOnMouseLeave:!0,items:[{disabled:!t.filterOperations||!t.filterOperations.length,icon:b[Q(r,t)||"default"],selectable:!1,items:r._getFilterOperationMenuItems(t)}],onItemClick:function(e){var n=e.itemData.name,l=Q(r,t),a=!1,o=$(r),d={};if(!(e.itemData.items||n&&n===l)){if(n?(d[o?"bufferedSelectedFilterOperation":"selectedFilterOperation"]=n,"between"!==n&&"between"!==l||(a="between"===n,d[o?"bufferedFilterValue":"filterValue"]=null)):(d[o?"bufferedFilterValue":"filterValue"]=null,d[o?"bufferedSelectedFilterOperation":"selectedFilterOperation"]=t.defaultSelectedFilterOperation||null),r._columnsController.columnOption(t.index,d),r._applyFilterViewController.setHighLight(i,!0),!n){var s=U(i);s&&"dxDateBox"===s.NAME&&!s.option("isValid")&&(s.reset(),s.option("isValid",!0))}a?r._showFilterRange(i.closest(".dx-editor-cell"),t):r._focusEditor(i)}},onSubmenuShown:function(){n=r._isEditorFocused(i),r.getController("editorFactory").loseFocus()},onSubmenuHiding:function(){var t=C.default.getInstance(e);a.default.trigger(e,"blur"),t&&t.option("focusedElement",null),n&&r._focusEditor(i)},rtlEnabled:r.option("rtlEnabled")})},_isEditorFocused:function(e){return e.hasClass("dx-focused")||e.parents(".dx-focused").length},_focusEditor:function(e){this.getController("editorFactory").focus(e),a.default.trigger(e.find(N),"focus")},_renderFilterOperationChooser:function(e,t,i){var n,l=this;this.option("filterRow.showOperationChooser")&&(e.addClass("dx-editor-with-menu"),n=(0,r.default)("<div>").prependTo(e),this._updateFilterOperationChooser(n,t,i))},_getFilterOperationMenuItems:function(e){var t=this,i=[{}],n=t.option("filterRow"),r=n&&n.operationDescriptions||{};if(e.filterOperations&&e.filterOperations.length){var l=e.filterOperations.filter((function(e){return(0,o.isDefined)(R[e])}));(i=f.default.map(l,(function(i){var n=R[i];return{name:i,selected:(Q(t,e)||e.defaultFilterOperation)===i,text:r[n],icon:b[i]}}))).push({name:null,text:n&&n.resetOperationText,icon:b.default})}return i},optionChanged:function(e){var t=this;switch(e.name){case"filterRow":case"showColumnLines":this._invalidate(!0,!0),e.handled=!0;break;default:this.callBase(e)}}}),U,j,J,Q,X,Y,Z,ee={skipCalculateColumnFilters:function(){return!1},_calculateAdditionalFilter:function(){if(this.skipCalculateColumnFilters())return this.callBase();var e=[this.callBase()],t=this._columnsController.getVisibleColumns();return f.default.each(t,(function(){var t;this.allowFiltering&&this.calculateFilterExpression&&(0,o.isDefined)(this.filterValue)&&(t=this.createFilterExpression(this.filterValue,this.selectedFilterOperation||this.defaultFilterOperation,"filterRow"),e.push(t))})),g.default.combineFilters(e)}};t.ApplyFilterViewController=p.default.ViewController.inherit({_getHeaderPanel:function(){return this._headerPanel||(this._headerPanel=this.getView("headerPanel")),this._headerPanel},setHighLight:function(e,t){$(this)&&(e&&e.toggleClass("dx-highlight-outline",t)&&e.closest(".dx-editor-cell").toggleClass("dx-filter-modified",t),this._getHeaderPanel().enableApplyButton(t))},applyFilter:function(){var e=this.getController("columns"),t=e.getColumns();e.beginUpdate();for(var i=0;i<t.length;i++){var n=t[i];void 0!==n.bufferedFilterValue&&(e.columnOption(i,"filterValue",n.bufferedFilterValue),n.bufferedFilterValue=void 0),void 0!==n.bufferedSelectedFilterOperation&&(e.columnOption(i,"selectedFilterOperation",n.bufferedSelectedFilterOperation),n.bufferedSelectedFilterOperation=void 0)}e.endUpdate(),this.removeHighLights()},removeHighLights:function(){if($(this)){var e=this.getView("columnHeadersView").element();e.find("."+this.addWidgetPrefix("filter-row")+" .dx-highlight-outline").removeClass("dx-highlight-outline"),e.find("."+this.addWidgetPrefix("filter-row")+" .dx-filter-modified").removeClass("dx-filter-modified"),this._getHeaderPanel().enableApplyButton(!1)}}}),i.exports={defaultOptions:function(){return{filterRow:{visible:!1,showOperationChooser:!0,showAllText:x.default.format("dxDataGrid-filterRowShowAllText"),resetOperationText:x.default.format("dxDataGrid-filterRowResetOperationText"),applyFilter:"auto",applyFilterText:x.default.format("dxDataGrid-applyFilterText"),operationDescriptions:{equal:x.default.format("dxDataGrid-filterRowOperationEquals"),notEqual:x.default.format("dxDataGrid-filterRowOperationNotEquals"),lessThan:x.default.format("dxDataGrid-filterRowOperationLess"),lessThanOrEqual:x.default.format("dxDataGrid-filterRowOperationLessOrEquals"),greaterThan:x.default.format("dxDataGrid-filterRowOperationGreater"),greaterThanOrEqual:x.default.format("dxDataGrid-filterRowOperationGreaterOrEquals"),startsWith:x.default.format("dxDataGrid-filterRowOperationStartsWith"),contains:x.default.format("dxDataGrid-filterRowOperationContains"),notContains:x.default.format("dxDataGrid-filterRowOperationNotContains"),endsWith:x.default.format("dxDataGrid-filterRowOperationEndsWith"),between:x.default.format("dxDataGrid-filterRowOperationBetween"),isBlank:x.default.format("dxFilterBuilder-filterOperationIsBlank"),isNotBlank:x.default.format("dxFilterBuilder-filterOperationIsNotBlank")},betweenStartText:x.default.format("dxDataGrid-filterRowOperationBetweenStartText"),betweenEndText:x.default.format("dxDataGrid-filterRowOperationBetweenEndText")}}},controllers:{applyFilter:t.ApplyFilterViewController},extenders:{controllers:{data:ee,columnsResizer:{_startResizing:function(){var e,t,i=this;i.callBase.apply(i,arguments),i.isResizing()&&(t=i._columnHeadersView.getFilterRangeOverlayInstance())&&((e=t.$element().closest("td").index())!==i._targetPoint.columnIndex&&e!==i._targetPoint.columnIndex+1||t.$content().hide())},_endResizing:function(){var e,t,i=this;i.isResizing()&&(t=i._columnHeadersView.getFilterRangeOverlayInstance())&&(e=t.$element().closest("td"),i._columnHeadersView._updateFilterRangeOverlay({width:e.outerWidth(!0)+1}),t.$content().show()),i.callBase.apply(i,arguments)}}},views:{columnHeadersView:K,headerPanel:{_getToolbarItems:function(){var e=this.callBase(),t;return this._prepareFilterItem(e).concat(e)},_prepareFilterItem:function(){var e=this,t=[];if(e._isShowApplyFilterButton()){var i=e.option("filterRow.applyFilterText"),n,l,a,o,d={widget:"dxButton",options:{icon:"apply-filter",disabled:!e._columnsController.getColumns().filter((function(e){return void 0!==e.bufferedFilterValue})).length,onClick:function(){e._applyFilterViewController.applyFilter()},hint:i,text:i,onInitialized:function(t){(0,r.default)(t.element).addClass(e._getToolbarButtonClass("dx-apply-button"))}},showText:"inMenu",name:"applyFilterButton",location:"after",locateInMenu:"auto",sortIndex:10};t.push(d)}return t},_isShowApplyFilterButton:function(){var e=this.option("filterRow");return e&&e.visible&&"onClick"===e.applyFilter},init:function(){this.callBase(),this._dataController=this.getController("data"),this._applyFilterViewController=this.getController("applyFilter")},enableApplyButton:function(e){this.setToolbarItemDisabled("applyFilterButton",!e)},isVisible:function(){return this.callBase()||this._isShowApplyFilterButton()},optionChanged:function(e){"filterRow"===e.name?(this._invalidate(),e.handled=!0):this.callBase(e)}}}}}}

