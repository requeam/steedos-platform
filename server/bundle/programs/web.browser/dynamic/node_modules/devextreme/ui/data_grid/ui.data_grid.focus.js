function module(e){"use strict";var t,o=c(e("./ui.data_grid.core")),r,a=c(e("../grid_core/ui.grid_core.focus")),i=e("../../core/utils/deferred"),n=e("../../core/utils/type"),l=e("../../core/utils/common"),u=e("./ui.data_grid.utils"),d=e("../../core/utils/data"),s=e("../../core/utils/extend");function c(e){return e&&e.__esModule?e:{default:e}}var p=Number.MAX_SAFE_INTEGER||9007199254740991;o.default.registerModule("focus",(0,s.extend)(!0,{},a.default,{extenders:{controllers:{data:{changeRowExpand:function(e){return this.option("focusedRowEnabled")&&Array.isArray(e)&&this.isRowExpanded(e)&&this._isFocusedRowInsideGroup(e)&&this.option("focusedRowKey",e),this.callBase.apply(this,arguments)},_isFocusedRowInsideGroup:function(e){var t,o=this.getController("columns"),r=this.option("focusedRowKey"),a=this.getRowIndexByKey(r),i=a>=0&&this.getVisibleRows()[a],n=o.getGroupDataSourceParameters(!0);if(i)for(var l=0;l<e.length;++l)if((t=(0,d.compileGetter)(n[l]&&n[l].selector))(i.data)!==e[l])return!1;return!0},_getGroupPath:function(e){for(var t=[e.key],o=e.items;o&&o[0];){var r=o[0];void 0!==r.key&&t.push(r.key),o=r.items}return t},_expandGroupByPath:function(e,t,o){var r=new i.Deferred;return o++,e.expandRow(t.slice(0,o)).done((function(){o===t.length?r.resolve():e._expandGroupByPath(e,t,o).done(r.resolve).fail(r.reject)})).fail(r.reject),r.promise()},_calculateGlobalRowIndexByGroupedData:function(e){var t,o=this,r=o._dataSource,a=o._generateFilterByKey(e),l=new i.Deferred,u=r.group();return r._grouping._updatePagingOptions?(r.load({filter:o._concatWithCombinedFilter(a),group:u}).done((function(r){if(!r||0===r.length||!(0,n.isDefined)(r[0].key)||-1===r[0].key)return l.resolve(-1).promise();t=o._getGroupPath(r[0]),o._expandGroupByPath(o,t,0).done((function(){o._calculateExpandedRowGlobalIndex(l,e,t,u)})).fail(l.reject)})).fail(l.reject),l.promise()):(o._calculateGlobalRowIndexByFlatData(e,null,!0).done(l.resolve).fail(l.reject),l)},_calculateExpandedRowGlobalIndex:function(e,t,o,r){var a,i=(0,u.createGroupFilter)(o,{group:r}),n=this._dataSource,d=this.option("scrolling.mode"),s="virtual"===d||"infinite"===d,c=n.pageSize();n._grouping._updatePagingOptions({skip:0,take:p},(function(e,t){(0,l.equalByValue)(e.path,o)&&(a=t)})),this._calculateGlobalRowIndexByFlatData(t,i).done((function(t){var r,i,n;t<0?e.resolve(-1):(r=(i=a%c||c)+t-o.length,n=s?0:Math.floor(r/(c-o.length))*o.length,r=a+t+n,e.resolve(r))})).fail(e.reject)}}}}}))}

