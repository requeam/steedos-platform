function module(t,e,a){"use strict";var r,s=u(t("../../core/class")),g=t("../../core/utils/data"),i=t("../../core/utils/type"),o=t("../../data/errors"),n=t("../../data/utils");function u(t){return t&&t.__esModule?t:{default:t}}function l(t,e,a,r){var s=0;if(t<e)for(;s<a.items.length;s++)l(t+1,e,a.items[s],r);t===e&&r(a)}function c(t,e){var a,r;if("map"in t)return t.map(e);for(a in r=new Array(t.length),t)r[a]=e(t[a],a);return r}function h(t){return t!=t||""===t||null==t}function _(t){return t===n.aggregators.count}function f(t){var e=(0,g.compileGetter)(t.selector),a=!("skipEmptyValues"in t)||t.skipEmptyValues,r=t.aggregator;if("string"==typeof r&&!(r=n.aggregators[r]))throw o.errors.Error("E4001",t.aggregator);return{selector:e,aggregator:r,skipEmptyValues:a}}a.exports=s.default.inherit({ctor:function(t){this._data=t.data,this._groupLevel=t.groupLevel||0,this._totalAggregates=c(t.totalAggregates||[],f),this._groupAggregates=c(t.groupAggregates||[],f),this._totals=[]},calculate:function(){this._totalAggregates.length&&this._calculateTotals(0,{items:this._data}),this._groupAggregates.length&&this._groupLevel>0&&this._calculateGroups({items:this._data})},totalAggregates:function(){return this._totals},_aggregate:function(t,e,a){var r,s,g=e.items?e.items.length:0;for(r=0;r<t.length;r++)if(_(t[r].aggregator))a[r]=(a[r]||0)+g;else for(s=0;s<g;s++)this._accumulate(r,t[r],a,e.items[s])},_calculateTotals:function(t,e){var a;if(0===t&&(this._totals=this._seed(this._totalAggregates)),t===this._groupLevel)this._aggregate(this._totalAggregates,e,this._totals);else for(a=0;a<e.items.length;a++)this._calculateTotals(t+1,e.items[a]);0===t&&(this._totals=this._finalize(this._totalAggregates,this._totals))},_calculateGroups:function(t){var e=this._groupLevel,a=e+1,r=this._seed.bind(this,this._groupAggregates),s=this._aggregate.bind(this,this._groupAggregates),g=this._finalize.bind(this,this._groupAggregates);function i(t){t.aggregates=r(a-1),a===e?s(t,t.aggregates):l(a,e,t,(function(e){s(e,t.aggregates)})),t.aggregates=g(t.aggregates)}for(;--a>0;)l(0,a,t,i)},_seed:function(t,e){return c(t,(function(t){var a=t.aggregator,r;return"seed"in a?(0,i.isFunction)(a.seed)?a.seed(e):a.seed:NaN}))},_accumulate:function(t,e,a,r){var s=e.selector(r),g=e.aggregator,i;e.skipEmptyValues&&h(s)||(a[t]!=a[t]?a[t]=s:a[t]=g.step(a[t],s))},_finalize:function(t,e){return c(t,(function(t,a){var r=t.aggregator.finalize;return r?r(e[a]):e[a]}))}})}

