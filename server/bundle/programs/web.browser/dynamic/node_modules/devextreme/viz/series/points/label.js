function module(t,i){"use strict";var n=t("../../../format_helper").format,e=t("../../core/utils"),o=t("../../../core/utils/iterator").each,r=t("../../../core/utils/extend").extend,s=e.degreesToRadians,h=e.patchFontOptions,a=Math,u=a.round,c=a.floor,d=a.abs,_=e.getCosAndSin,l=e.rotateBBox,g=12,f=8,p=4;function x(t,i){var n,e=1/0;return o(i,(function(i,o){var r=t[0]-o[0],s=t[1]-o[1],h=r*r+s*s;h<e&&(e=h,n=o)})),[c(n[0]),c(n[1])]}function b(t,i,n){return(i-t[0+n])/(t[2+n]-t[0+n])*(t[3-n]-t[1-n])+t[1-n]}var v={isLabelInside:function(t,i){var n=t.x+t.width/2,e=t.y+t.height/2;return i.x<=n&&n<=i.x+i.width&&i.y<=e&&e<=i.y+i.height},prepareLabelPoints:function(t,i,n,e,o){var r,s=i.x,h=s+i.width/2,a=s+i.width-1,u=i.y,c=u+i.height/2,_=u+i.height-1,l=d(e)%90==0;return r=o[0]>s&&o[0]<a?l?[[o[0],d(o[1]-u)<d(o[1]-_)?u:_]]:[[o[0],b([s,u,a,_],o[0],0)]]:o[1]>u&&o[1]<_?l?[[d(o[0]-s)<d(o[0]-a)?s:a,o[1]]]:[[b([s,u,a,_],o[1],1),o[1]]]:l?[[s,u],[n?s:h,n?c:u],[a,u],[s,_],[n?a:h,n?c:_],[a,_]]:[[h,c]]},isHorizontal:function(t,i){return t.x>i.x+i.width||t.x+t.width<i.x},getFigureCenter:function(t){return[c(t.x+t.width/2),c(t.y+t.height/2)]},findFigurePoint:function(t,i){var n=v.getFigureCenter(t),e;return x(i,[[t.x,n[1]],[n[0],t.y+t.height],[t.x+t.width,n[1]],[n[0],t.y]])},adjustPoints:function(t){var i=d(t[1]-t[3])<=1,n;return d(t[0]-t[2])<=1&&(t[0]=t[2]),i&&(t[1]=t[3]),t}},y={isLabelInside:function(){return!1},prepareLabelPoints:v.prepareLabelPoints,isHorizontal:function(t,i){return t.x>i.x+i.r||t.x+t.width<i.x-i.r},getFigureCenter:function(t){return[t.x,t.y]},findFigurePoint:function(t,i){var n=Math.atan2(t.y-i[1],i[0]-t.x);return[u(t.x+t.r*Math.cos(n)),u(t.y-t.r*Math.sin(n))]},adjustPoints:v.adjustPoints},w={isLabelInside:function(t,i,n){return!n},prepareLabelPoints:function(t,i,n,e){var o=t.x,r=o+t.width,s=o+u(t.width/2),h=t.y,a=h+t.height,c=h+u(t.height/2),d=[[[o,h],[r,h]],[[r,h],[r,a]],[[r,a],[o,a]],[[o,a],[o,h]]],l=_(e);return d=0===e?n?[[o,c],[r,c]]:[[s,h],[s,a]]:d.map((function(t){return t.map((function(t){return[u((t[0]-s)*l.cos+(t[1]-c)*l.sin+s),u(-(t[0]-s)*l.sin+(t[1]-c)*l.cos+c)]}))})).reduce((function(t,i){var e=i[0][0],o=i[0][1],r=i[1][0],h=i[1][1];return n?(o>=c&&c>=h||o<=c&&c<=h)&&t.push([(c-o)*(r-e)/(h-o)+e,c]):(e>=s&&s>=r||e<=s&&s<=r)&&t.push([s,(s-e)*(h-o)/(r-e)+o]),t}),[])},isHorizontal:function(t,i){return t.x>i.x||i.x>t.x+t.width},getFigureCenter:y.getFigureCenter,findFigurePoint:function(t,i,n){if(!n)return[t.x,t.y];var e=i[0],o=u(t.x+(t.y-i[1])/Math.tan(s(t.angle))),r=[t.x,t.y,o,i[1]];return t.x<=o&&o<=e||e<=o&&o<=t.x||(d(t.x-e)<12?r=[t.x,t.y]:t.x<=e?r[2]=t.x+12:r[2]=t.x-12),r},adjustPoints:function(t){return t}};function k(t){return void 0!==t.angle&&w||void 0!==t.r&&y||v}function B(t,i){t[i]&&t[i].dispose(),t[i]=null}function V(t){return t&&(t.fill&&"none"!==t.fill||t["stroke-width"]>0&&t.stroke&&"none"!==t.stroke)}function P(t){return t&&t["stroke-width"]>0&&t.stroke&&"none"!==t.stroke}function C(t,i){var e=i.format;return t.valueText=n(t.value,e),t.argumentText=n(t.argument,i.argumentFormat),void 0!==t.percent&&(t.percentText=n(t.percent,{type:"percent",precision:e&&e.percentPrecision})),void 0!==t.total&&(t.totalText=n(t.total,e)),void 0!==t.openValue&&(t.openValueText=n(t.openValue,e)),void 0!==t.closeValue&&(t.closeValueText=n(t.closeValue,e)),void 0!==t.lowValue&&(t.lowValueText=n(t.lowValue,e)),void 0!==t.highValue&&(t.highValueText=n(t.highValue,e)),void 0!==t.reductionValue&&(t.reductionValueText=n(t.reductionValue,e)),i.customizeText?i.customizeText.call(t,t):t.valueText}function L(t){this._renderer=t.renderer,this._container=t.labelsGroup,this._point=t.point,this._strategy=t.strategy}L.prototype={constructor:L,setColor:function(t){this._color=t},setOptions:function(t){this._options=t},setData:function(t){this._data=t},setDataField:function(t,i){this._data=this._data||{},this._data[t]=i},getData:function(){return this._data},setFigureToDrawConnector:function(t){this._figure=t},dispose:function(){var t=this;B(this,"_group"),this._data=this._options=this._textContent=this._visible=this._insideGroup=this._text=this._background=this._connector=this._figure=null},_setVisibility:function(t,i){this._group&&this._group.attr({visibility:t}),this._visible=i},isVisible:function(){return this._visible},hide:function(t){this._holdVisibility=!!t,this._hide()},_hide:function(){this._setVisibility("hidden",!1)},show:function(t){var i=!this._drawn;this._point.hasValue()&&(this._holdVisibility=!!t,this._show(),i&&this._point.correctLabelPosition(this))},_show:function(){var t=this,i=this._renderer,n=this._container,e=this._options||{},o=this._textContent=C(this._data,this._options)||null;o?(this._group||(this._group=i.g().append(n),this._insideGroup=i.g().append(this._group),this._text=i.text("",0,0).append(this._insideGroup)),this._text.css(e.attributes?h(e.attributes.font):{}),V(e.background)?(this._background=this._background||i.rect().append(this._insideGroup).toBackground(),this._background.attr(e.background),this._color&&this._background.attr({fill:this._color})):B(this,"_background"),P(e.connector)?(this._connector=this._connector||i.path([],"line").sharp().append(this._group).toBackground(),this._connector.attr(e.connector),this._color&&this._connector.attr({stroke:this._color})):B(this,"_connector"),this._text.attr({text:o,align:e.textAlignment}),this._updateBackground(this._text.getBBox()),this._setVisibility("visible",!0),this._drawn=!0):this._hide()},_getLabelVisibility:function(t){return this._holdVisibility?this.isVisible():t},draw:function(t){return this._getLabelVisibility(t)?(this._show(),this._point&&this._point.correctLabelPosition(this)):(this._drawn=!1,this._hide()),this},_updateBackground:function(t){var i=this;this._background&&(t.x-=8,t.y-=4,t.width+=16,t.height+=8,this._background.attr(t)),this._bBoxWithoutRotation=r({},t);var n=this._options.rotationAngle||0;this._insideGroup.rotate(n,t.x+t.width/2,t.y+t.height/2),t=l(t,[t.x+t.width/2,t.y+t.height/2],-n),this._bBox=t},getFigureCenter:function(){var t=this._figure,i;return(this._strategy||k(t)).getFigureCenter(t)},_getConnectorPoints:function(){var t,i,n=this,e=this._figure,o=this._options,r=this._strategy||k(e),s=this._shiftBBox(this._bBoxWithoutRotation),h=this.getBoundingRect(),a=[];if(!r.isLabelInside(s,e,"inside"!==o.position)){i=r.isHorizontal(s,e);var u=this.getFigureCenter();t=x(u,a=r.prepareLabelPoints(s,h,i,-o.rotationAngle||0,u)),a=(a=r.findFigurePoint(e,t,i)).concat(t)}return r.adjustPoints(a)},fit:function(t){var i=this._background?16:0;this._text&&this._text.applyEllipsis(t-i),this._updateBackground(this._text.getBBox())},resetEllipsis:function(){this._text&&this._text.restoreText(),this._updateBackground(this._text.getBBox())},setTrackerData:function(t){this._text.data({"chart-data-point":t}),this._background&&this._background.data({"chart-data-point":t})},hideInsideLabel:function(t){return this._point.hideInsideLabel(this,t)},getPoint:function(){return this._point},shift:function(t,i){var n=this;return this._textContent&&(this._insideGroup.attr({translateX:this._x=u(t-this._bBox.x),translateY:this._y=u(i-this._bBox.y)}),this._connector&&this._connector.attr({points:this._getConnectorPoints()})),this},getBoundingRect:function(){return this._shiftBBox(this._bBox)},_shiftBBox:function(t){return this._textContent?{x:t.x+this._x,y:t.y+this._y,width:t.width,height:t.height}:{}},getLayoutOptions:function(){var t=this._options;return{alignment:t.alignment,background:V(t.background),horizontalOffset:t.horizontalOffset,verticalOffset:t.verticalOffset,radialOffset:t.radialOffset,position:t.position,connectorOffset:(P(t.connector)?12:0)+(V(t.background)?8:0)}}},i.Label=L}

