function module(t,r){"use strict";function e(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var i=t("../../core/utils/extend").extend,a=t("../../core/utils/array").inArray,n=t("../../core/utils/iterator").each,o=t("./helpers/range_data_calculator"),s=t("../../core/utils/type"),l=t("../core/utils"),u=t("../../core/utils/common").noop,c=s.isDefined,h=s.isString,p=l.map,d=l.normalizeEnum,g=Math,_=g.abs,v=g.sqrt,f=g.max,m=12,y=400,b="highError",V="lowError",E="variance",w="stddeviation",k="stderror",A="percent",F="fixed",P="undefined",x="discrete",B="logarithmic",S="datetime";function G(t){var r=0;return n(t,(function(t,e){r+=e})),r}function C(t){return-1!==a(t,[F,A,E,w,k])}function O(t,r){return G(p(t,(function(t){return(t-r)*(t-r)})))/t.length}function T(t,r,e){var i=e.getOptions().valueErrorBar,a=e.getValueFields()[0],n=i.lowValueField||V,o=i.highValueField||b;if(e.areErrorBarsVisible()&&void 0===i.type){var s=r.reduce((function(t,r){return c(r[n])&&(t[0]+=r[a]-r[n],t[1]++),c(r[o])&&(t[2]+=r[o]-r[a],t[3]++),t}),[0,0,0,0]);s[1]&&(t[n]=t[a]-s[0]/s[1]),s[2]&&(t[o]=t[a]+s[2]/s[3])}return t}function D(t,r,e){var i=e.getOptions().valueErrorBar,a=i.lowValueField||V,n=i.highValueField||b;return e.areErrorBarsVisible()&&void 0===i.type&&(t[a]=0,t[n]=0,t=r.reduce((function(t,r){return t[a]+=r[a],t[n]+=r[n],t}),t)),t}function R(t){return function(r,a){var n=r.intervalStart,o=r.data,s=a.getValueFields()[0],l=o[0];return l=o.reduce((function(r,e){var i=e[s];return null===r[s]&&(r=e),null!==i&&t(i,r[s])?e:r}),l),i({},l,e({},a.getArgumentField(),n))}}function I(t,r,e){var i=!0;for(var a in r){var n="argument"===a;if(n||"size"===a?!c(t[a]):void 0===t[a]){var o=r[a];n||(e[o]=(e[o]||0)+1),i=!1}}return i}r.chart={},r.polar={};var M={_defaultDuration:400,_defaultTrackerWidth:12,_applyStyle:u,_updateOptions:u,_parseStyle:u,_prepareSegment:u,_drawSegment:u,_appendInGroup:function(){this._group.append(this._extGroups.seriesGroup)},_createLegendState:function(t,r){return{fill:t.color||r,hatching:t.hatching?i({},t.hatching,{direction:"right"}):void 0}},_applyElementsClipRect:function(t){t["clip-path"]=this._paneClipRectID},_applyMarkerClipRect:function(t){t["clip-path"]=this._forceClipping?this._paneClipRectID:null},_createGroup:function(t,r,e,i){var a=r[t]=r[t]||this._renderer.g();e&&a.append(e),i&&a.attr(i)},_applyClearingSettings:function(t){t.opacity=null,t.scale=null,this._options.rotated?t.translateX=null:t.translateY=null},_createGroups:function(){var t=this;this._createGroup("_markersGroup",this,this._group),this._createGroup("_labelsGroup",this)},_setMarkerGroupSettings:function(){var t=this,r=this._createPointStyles(this._getMarkerGroupOptions()).normal;r.class="dxc-markers",r.opacity=1,this._applyMarkerClipRect(r),this._markersGroup.attr(r)},getVisibleArea:function(){return this._visibleArea},areErrorBarsVisible:function(){var t=this._options.valueErrorBar;return t&&this._errorBarsEnabled()&&"none"!==t.displayMode&&(C(d(t.type))||c(t.lowValueField)||c(t.highValueField))},_createErrorBarGroup:function(t){var r,e=this,i=this._options.valueErrorBar;this.areErrorBarsVisible()&&(r={class:"dxc-error-bars",stroke:i.color,"stroke-width":i.lineWidth,opacity:t?.001:i.opacity||1,"stroke-linecap":"square",sharp:!0,"clip-path":this._forceClipping?this._paneClipRectID:this._widePaneClipRectID},this._createGroup("_errorBarGroup",this,this._group,r))},_setGroupsSettings:function(t){var r=this;this._setMarkerGroupSettings(),this._setLabelGroupSettings(t),this._createErrorBarGroup(t)},_getCreatingPointOptions:function(){var t,r,e=this,a=this._predefinedPointOptions;return a||(t=this._getPointOptions(),this._predefinedPointOptions=a=i(!0,{styles:{}},t),r=t.styles&&t.styles.normal||{},a.styles=a.styles||{},a.styles.normal={"stroke-width":r["stroke-width"],r:r.r,opacity:r.opacity}),a},_getPointOptions:function(){return this._parsePointOptions(this._preparePointOptions(),this._options.label)},_getOptionsForPoint:function(){return this._options.point},_parsePointStyle:function(t,r,e,i){var a=t.border||{},n=void 0!==t.size?t.size:i;return{fill:t.color||r,stroke:a.color||e,"stroke-width":a.visible?a.width:0,r:n/2+(a.visible&&0!==n&&~~(a.width/2)||0)}},_createPointStyles:function(t){var r=this,e=t.color||this._options.mainSeriesColor,i=this._options.containerBackgroundColor,a=this._parsePointStyle(t,e,e);return a.visibility=t.visible?"visible":"hidden",{normal:a,hover:this._parsePointStyle(t.hoverStyle,i,e,t.size),selection:this._parsePointStyle(t.selectionStyle,i,e,t.size)}},_checkData:function(t,r,e){return(e=e||{value:this.getValueFields()[0]}).argument=this.getArgumentField(),I(t,e,r||{})&&t.value==t.value},getErrorBarRangeCorrector:function(){var t,r;return this.areErrorBarsVisible()&&(t=d(this._options.valueErrorBar.displayMode),r=function(r){var e=r.lowError,i=r.highError;switch(t){case"low":return[e];case"high":return[i];case"none":return[];default:return[e,i]}}),r},getValueRangeInitialValue:function(){},_getRangeData:function(){return o.getRangeData(this)},_getPointDataSelector:function(){var t=this,r=this.getValueFields()[0],e=this.getArgumentField(),i=this.getTagField(),a=this.areErrorBarsVisible(),n=void 0,o=void 0;if(a){var s=this._options.valueErrorBar;n=s.lowValueField||V,o=s.highValueField||b}return function(s){var l={value:t._processEmptyValue(s[r]),argument:s[e],tag:s[i],data:s};return a&&(l.lowError=s[n],l.highError=s[o]),l}},_errorBarsEnabled:function(){return this.valueAxisType!==x&&this.valueAxisType!==B&&this.valueType!==S},_drawPoint:function(t){var r=t.point;r.isInVisibleArea()?(r.clearVisibility(),r.draw(this._renderer,t.groups,t.hasAnimation,t.firstDrawing),this._drawnPoints.push(r)):r.setInvisibility()},_animateComplete:function(){var t=this,r={duration:this._defaultDuration};this._labelsGroup&&this._labelsGroup.animate({opacity:1},r),this._errorBarGroup&&this._errorBarGroup.animate({opacity:this._options.valueErrorBar.opacity||1},r)},_animate:function(){var t=this,r=t._drawnPoints.length-1;n(t._drawnPoints||[],(function(e,i){i.animate(e===r?function(){t._animateComplete()}:void 0,{translateX:i.x,translateY:i.y})}))},_defaultAggregator:"avg",_aggregators:{avg:function(t,r){var i,a=t.data,n=t.intervalStart;if(a.length){var o=r.getValueFields()[0],s=a.reduce((function(t,r){var e=r[o];return c(e)?(t[0]+=e,t[1]++):null===e&&t[2]++,t}),[0,0,0]);return T((e(i={},o,s[2]===a.length?null:s[0]/s[1]),e(i,r.getArgumentField(),n),i),a,r)}},sum:function(t,r){var i,a=t.intervalStart,n=t.data;if(n.length){var o=r.getValueFields()[0],s=n.reduce((function(t,r){var e=r[o];return void 0!==e&&(t[0]+=e),null===e?t[1]++:void 0===e&&t[2]++,t}),[0,0,0]),l=s[0];if(s[1]===n.length&&(l=null),s[2]!==n.length)return D((e(i={},o,l),e(i,r.getArgumentField(),a),i),n,r)}},count:function(t,r){var i,a=t.data,n=t.intervalStart,o=r.getValueFields()[0];return e(i={},r.getArgumentField(),n),e(i,o,a.filter((function(t){return void 0!==t[o]})).length),i},min:R((function(t,r){return t<r})),max:R((function(t,r){return t>r}))},_endUpdateData:function(){delete this._predefinedPointOptions},getArgumentField:function(){return this._options.argumentField||"arg"},getValueFields:function(){var t,r,e=this._options,i=e.valueErrorBar,a=[e.valueField||"val"];return i&&(t=i.lowValueField,r=i.highValueField,h(t)&&a.push(t),h(r)&&a.push(r)),a},_calculateErrorBars:function(t){if(this.areErrorBarsVisible()){var r,e,i,a,o,s=this,l,u=this._options.valueErrorBar,h=d(u.type),g=parseFloat(u.value),_=this.getValueFields()[0],f=u.lowValueField||V,m=u.highValueField||b,y=function(t,e){r=e.value,e.lowError=r-g,e.highError=r+g};switch(h){case F:o=y;break;case A:o=function(t,e){var i=(r=e.value)*g/100;e.lowError=r-i,e.highError=r+i};break;case P:o=function(t,r){r.lowError=r.data[f],r.highError=r.data[m]};break;default:switch(i=(e=p(t,(function(t){return c(t.data[_])?t.data[_]:null}))).length,g=g||1,h){case E:g=O(e,G(e)/i)*g,o=y;break;case w:a=G(e)/i,g=v(O(e,a))*g,o=function(t,r){r.lowError=a-g,r.highError=a+g};break;case k:g=v(O(e,G(e)/i)/i)*g,o=y}}o&&n(t,o)}},_patchMarginOptions:function(t){var r=this._getCreatingPointOptions(),e=r.styles,i=[e.normal,e.hover,e.selection].reduce((function(t,r){return f(t,2*r.r+r["stroke-width"])}),0);return t.size=r.visible?i:0,t.sizePointNormalState=r.visible?2*e.normal.r+e.normal["stroke-width"]:2,t}};r.chart=i({},M,{drawTrackers:function(){var t,r,e=this,i=e._segments||[],a=e._options.rotated,o=[];e.isVisible()&&(i.length&&(t=e._trackers=e._trackers||[],r=e._trackersGroup=(e._trackersGroup||e._renderer.g().attr({fill:"gray",opacity:.001,stroke:"gray",class:"dxc-trackers"})).attr({"clip-path":this._paneClipRectID||null}).append(e._group),n(i,(function(i,a){t[i]?e._updateTrackerElement(a,t[i]):t[i]=e._drawTrackerElement(a).data({"chart-data-series":e}).append(r)}))),e._trackersTranslator=o,n(e.getVisiblePoints(),(function(t,r){var e=parseInt(a?r.vy:r.vx);o[e]?Array.isArray(o[e])?o[e].push(r):o[e]=[o[e],r]:o[e]=r})))},getNeighborPoint:function(t,r){var e,i=this._options.rotated?r:t,a=i,o=this._trackersTranslator,s=null,l=this._options.rotated?t:r,u=this._options.rotated?"vx":"vy";if(this.isVisible()&&o){s=o[i];do{s=o[a]||o[i],i--,a++}while((i>=0||a<o.length)&&!s);Array.isArray(s)&&(e=_(s[0][u]-l),n(s,(function(t,r){var i=_(r[u]-l);e>=i&&(e=i,s=r)})))}return s},_applyVisibleArea:function(){var t=this,r=this._options.rotated,e=(r?this.getValueAxis():this.getArgumentAxis()).getTranslator().getCanvasVisibleArea(),i=(r?this.getArgumentAxis():this.getValueAxis()).getTranslator().getCanvasVisibleArea();this._visibleArea={minX:e.min,maxX:e.max,minY:i.min,maxY:i.max}}}),r.polar=i({},M,{drawTrackers:function(){r.chart.drawTrackers.call(this);var t,e=this._trackersTranslator;this.isVisible()&&(n(e,(function(r,e){if(e)return t=r,!1})),e[t+360]=e[t])},getNeighborPoint:function(t,e){var i=l.convertXYToPolar(this.getValueAxis().getCenter(),t,e);return r.chart.getNeighborPoint.call(this,i.phi,i.r)},_applyVisibleArea:function(){var t=this,r=this.getValueAxis().getCanvas();this._visibleArea={minX:r.left,maxX:r.width-r.right,minY:r.top,maxY:r.height-r.bottom}}})}

