function module(t,e){"use strict";var i={},s=t("../../core/utils/type"),n=t("../../core/utils/extend").extend,r=t("../../core/utils/iterator").each,o=t("./points/base_point"),a=s.isDefined,l=t("../core/utils"),h=s.isEmptyObject,c=l.normalizeEnum,u=t("../../core/utils/common").noop,g=t("../components/consts").states,p=t("./helpers/range_data_calculator"),_=t("./scatter_series"),d=t("./line_series"),f=t("./area_series"),v=t("./bar_series"),m=t("./range_series"),y=t("./bubble_series"),S=t("./pie_series"),P=t("./financial_series"),b=t("./stacked_series"),A="discrete",w=g.selectedMark,x=g.hoverMark,k=g.hover,C=g.normal,V=g.selection,H=g.applySelected,O=g.applyHover,T=g.resetItem,M="none",G="includepoints",B="nearestpoint",D="seriesSelectionChanged",E="pointSelectionChanged",F="seriesHoverChanged",L="pointHoverChanged",I="allseriespoints",z="allargumentpoints",R="pointHover",N="clearPointHover",U="seriesSelect",K="pointSelect",Z="pointDeselect",W=function(){return{arg:{},val:{}}};function j(t,e,i){t&&t.trigger(e,i)}function X(t){return(t=c(t))===G||t===I}function Y(t,e){var i=t||{},r=n({},i.font)||{},o=i.border||{},a=i.connector||{},l={fill:i.backgroundColor||e,"stroke-width":o.visible&&o.width||0,stroke:o.visible&&o.width?o.color:"none",dashStyle:o.dashStyle},h={stroke:a.visible&&a.width?a.color||e:"none","stroke-width":a.visible&&a.width||0};return r.color="none"===i.backgroundColor&&"#ffffff"===c(r.color)&&"inside"!==i.position?e:r.color,{alignment:i.alignment,format:i.format,argumentFormat:i.argumentFormat,customizeText:s.isFunction(i.customizeText)?i.customizeText:void 0,attributes:{font:r},visible:0!==r.size&&i.visible,showForZeroValues:i.showForZeroValues,horizontalOffset:i.horizontalOffset,verticalOffset:i.verticalOffset,radialOffset:i.radialOffset,background:l,position:i.position,connector:h,rotationAngle:i.rotationAngle}}function q(t,e){t.fullState|=x,t.applyView(e)}function J(t,e){t.fullState&=~x,t.applyView(e),t.releaseHoverState()}function Q(t,e){t.fullState|=w,t.applyView(e)}function $(t,e){t.fullState&=~w,t.applyView(e)}function tt(t,e){var i=n({},t,e);return i.border=n({},t&&t.border,e&&e.border),i}function et(t,e){var i=tt(t,e);return i.image=n(!0,{},t.image,e.image),i.selectionStyle=tt(t.selectionStyle,e.selectionStyle),i.hoverStyle=tt(t.hoverStyle,e.hoverStyle),i}function it(t,e){var i=this;this.fullState=0,this._extGroups=t,this._renderer=t.renderer,this._group=t.renderer.g().attr({class:"dxc-series"}),this._eventTrigger=t.eventTrigger,this._eventPipe=t.eventPipe,this._incidentOccurred=t.incidentOccurred,this._legendCallback=u,this.updateOptions(e,t)}function st(t){return t.data}i.mixins={chart:{},pie:{},polar:{}},i.mixins.chart.scatter=_.chart,i.mixins.polar.scatter=_.polar,n(i.mixins.pie,S),n(i.mixins.chart,d.chart,f.chart,v.chart,m.chart,y.chart,P,b.chart),n(i.mixins.polar,d.polar,f.polar,v.polar,m.polar,y.polar,b.polar),e.Series=it,e.mixins=i.mixins,it.prototype={constructor:it,_createLegendState:u,getLegendStyles:function(){return this._styles.legendStyles},_createStyles:function(t){var e=this,i=t.mainSeriesColor;this._styles={normal:this._parseStyle(t,i,i),hover:this._parseStyle(t.hoverStyle||{},i,i),selection:this._parseStyle(t.selectionStyle||{},i,i),legendStyles:{normal:this._createLegendState(t,i),hover:this._createLegendState(t.hoverStyle||{},i),selection:this._createLegendState(t.selectionStyle||{},i)}}},setClippingParams:function(t,e,i){this._paneClipRectID=t,this._widePaneClipRectID=e,this._forceClipping=i},applyClip:function(){this._group.attr({"clip-path":this._paneClipRectID})},resetClip:function(){this._group.attr({"clip-path":null})},getTagField:function(){return this._options.tagField||"tag"},getValueFields:u,getSizeField:u,getArgumentField:u,getPoints:function(){return this._points},getPointsInViewPort:function(){return p.getPointsInViewPort(this)},_createPoint:function(t,e,i){t.index=e;var s,n=this,r=this.pointsByArgument,a=this._getCreatingPointOptions(t),l=t.argument.valueOf(),h=i;return h?h.update(t,a):(h=new o.Point(this,t,a),this.isSelected()&&X(this.lastSelectionMode)&&h.setView(V)),(s=r[l])?s.push(h):r[l]=[h],h.hasValue()&&this.customizePoint(h,t),h},getRangeData:function(){return this._visible?this._getRangeData():{arg:{},val:{}}},getArgumentRange:function(){return this._visible?p.getArgumentRange(this):{arg:{},val:{}}},getViewport:function(){return p.getViewport(this)},_deleteGroup:function(t){var e=this[t];e&&(e.dispose(),this[t]=null)},updateOptions:function(t,e){var i=this,s=t.widgetType,n=this.type,r=t.type;if(this.type=r&&c(r.toString()),!this._checkType(s)||this._checkPolarBarType(s,t))return this.dispose(),void(this.isUpdated=!1);n!==this.type?(this._firstDrawing=!0,this._resetType(n,s),this._setType(this.type,s)):this._defineDrawingState(),this._options=t,this._pointOptions=null,this.name=t.name,this.pane=t.pane,this.tag=t.tag,e&&(this._seriesModes=e.commonSeriesModes||this._seriesModes,this._valueAxis=e.valueAxis||this._valueAxis,this.axis=this._valueAxis&&this._valueAxis.name,this._argumentAxis=e.argumentAxis||this._argumentAxis),this._createStyles(t),this._stackName=null,this._updateOptions(t),this._visible=t.visible,this.isUpdated=!0,this._createGroups(),this._processEmptyValue=t.ignoreEmptyPoints?function(t){return null===t?void 0:t}:function(t){return t}},_defineDrawingState:function(){this._firstDrawing=!0},_disposePoints:function(t){r(t||[],(function(t,e){e.dispose()}))},getErrorBarRangeCorrector:u,updateDataType:function(t){var e=this;return this.argumentType=t.argumentType,this.valueType=t.valueType,this.argumentAxisType=t.argumentAxisType,this.valueAxisType=t.valueAxisType,this.showZero=t.showZero,this},getOptions:function(){return this._options},_getOldPoint:function(t,e,i){var s=t.argument&&t.argument.valueOf(),n=(e[s]||[])[0];return n&&e[s].splice(0,1),n},updateData:function(t){var e=this,i=this._options,s=i.nameField;(t=t||[]).length&&(this._canRenderCompleteHandle=!0);var n=this._getPointDataSelector(),r=0;this._data=t.reduce((function(t,e,o){var l=n(e);return a(l.argument)?s&&e[s]!==i.nameFieldValue||(l.index=o,t.push(l)):r++,t}),[]),r&&r===t.length&&this._incidentOccurred("W2002",[this.name,this.getArgumentField()]),this._endUpdateData()},_getData:function(){var t=this._data||[];return this.useAggregation()&&(t=this._resample(this.getArgumentAxis().getAggregationInfo(this._useAllAggregatedPoints,this.argumentAxisType!==A?this.getArgumentRange():{}),t)),t},useAggregation:function(){var t=this.getOptions().aggregation;return t&&t.enabled},createPoints:function(t){this._normalizeUsingAllAggregatedPoints(t),this._createPoints()},_normalizeUsingAllAggregatedPoints:function(t){this._useAllAggregatedPoints=this.useAggregation()&&(this.argumentAxisType===A||(this._data||[]).length>1&&!!t)},_createPoints:function(){var t,e=this,i=e.pointsByArgument||{},s=e._getData();e.pointsByArgument={},e._calculateErrorBars(s);var n={};for(var r in t=s.reduce((function(t,s){if(e._checkData(s,n)){var r=t.length,o=e._getOldPoint(s,i,r),a=e._createPoint(s,r,o);t.push(a)}return t}),[]),n)n[r]===s.length&&e._incidentOccurred("W2002",[e.name,r]);Object.keys(i).forEach((function(t){return e._disposePoints(i[t])})),e._points=t},_removeOldSegments:function(){var t=this,e=t._segments.length;r(t._graphics.splice(e,t._graphics.length)||[],(function(e,i){t._removeElement(i)})),t._trackers&&r(t._trackers.splice(e,t._trackers.length)||[],(function(t,e){e.remove()}))},_drawElements:function(t,e,i){var s,n=this,r=n._points||[],o=r[0]&&r[0].hasValue()&&n._options.closed,a={markers:n._markersGroup,errorBars:n._errorBarGroup};n._drawnPoints=[],n._graphics=n._graphics||[],n._segments=[],(s=r.reduce((function(s,r){var o=s[s.length-1];return r.translated&&!i||(r.translate(),!i&&r.setDefaultCoords()),r.hasValue()&&r.hasCoords()?(i&&n._drawPoint({point:r,groups:a,hasAnimation:t,firstDrawing:e}),o.push(r)):r.hasValue()?r.setInvisibility():o.length&&s.push([]),s}),[[]])).forEach((function(e,i){e.length&&n._drawSegment(e,t,i,o&&i===this.length-1)}),s),n._firstDrawing=!r.length,n._removeOldSegments(),t&&n._animate(e)},draw:function(t,e,i){var s=this,n=this._firstDrawing;if(this._legendCallback=i||this._legendCallback,!this._visible)return t=!1,void this._group.remove();this._appendInGroup(),this._applyVisibleArea(),this._setGroupsSettings(t,n),!n&&this._drawElements(!1,n,!1),this._drawElements(t,n,!0),e&&this.hideLabels(),this.isSelected()?this._changeStyle(this.lastSelectionMode,void 0,!0):this.isHovered()&&this._changeStyle(this.lastHoverMode,void 0,!0)},_setLabelGroupSettings:function(t){var e={class:"dxc-labels"};this._applyElementsClipRect(e),this._applyClearingSettings(e),t&&(e.opacity=.001),this._labelsGroup.attr(e).append(this._extGroups.labelsGroup)},_checkType:function(t){return!!i.mixins[t][this.type]},_checkPolarBarType:function(t,e){return"polar"===t&&e.spiderWidget&&-1!==this.type.indexOf("bar")},_resetType:function(t,e){var s,n;if(t)for(s in n=i.mixins[e][t])delete this[s]},_setType:function(t,e){var s,n=i.mixins[e][t];for(s in n)this[s]=n[s]},_setPointsView:function(t,e){this.getPoints().forEach((function(i){e!==i&&i.setView(t)}))},_resetPointsView:function(t,e){this.getPoints().forEach((function(i){e!==i&&i.resetView(t)}))},_resetNearestPoint:function(){var t=this;this._nearestPoint&&null!==this._nearestPoint.series&&this._nearestPoint.resetView(k),this._nearestPoint=null},_setSelectedState:function(t){var e=this;this.lastSelectionMode=c(t||this._options.selectionMode),this.fullState=this.fullState|w,this._resetNearestPoint(),this._changeStyle(this.lastSelectionMode),"none"!==this.lastSelectionMode&&this.isHovered()&&X(this.lastHoverMode)&&this._resetPointsView(k)},_releaseSelectedState:function(){var t=this;this.fullState=this.fullState&~w,this._changeStyle(this.lastSelectionMode,V),"none"!==this.lastSelectionMode&&this.isHovered()&&X(this.lastHoverMode)&&this._setPointsView(k)},isFullStackedSeries:function(){return 0===this.type.indexOf("fullstacked")},isStackedSeries:function(){return 0===this.type.indexOf("stacked")},isFinancialSeries:function(){return"stock"===this.type||"candlestick"===this.type},_canChangeView:function(){return!this.isSelected()&&"none"!==c(this._options.hoverMode)},_changeStyle:function(t,e,i){var s=this,n=this.fullState,r=[C,k,V,V];"none"===this.lastHoverMode&&(n&=~x),"none"===this.lastSelectionMode&&(n&=~w),X(t)&&!i&&(e?this._resetPointsView(e):this._setPointsView(r[n])),this._legendCallback([T,O,H,H][n]),this._applyStyle(this._styles[r[n]])},updateHover:function(t,e){var i=this,s=this._nearestPoint,n=this.isHovered()&&this.lastHoverMode===B&&this.getNeighborPoint(t,e);n===s||this.isSelected()&&"none"!==this.lastSelectionMode||(this._resetNearestPoint(),n&&(n.setView(k),this._nearestPoint=n))},_getMainAxisName:function(){return this._options.rotated?"X":"Y"},areLabelsVisible:function(){return!a(this._options.maxLabelCount)||this._points.length<=this._options.maxLabelCount},getLabelVisibility:function(){return this.areLabelsVisible()&&this._options.label&&this._options.label.visible},customizePoint:function t(e,i){var s,r,o,a,l,c,u=this,g=this._options,t=g.customizePoint,p=g.customizeLabel;p&&p.call&&((s=n({seriesName:this.name},i)).series=this,o=(l=(o=p.call(s,s))&&!h(o))?n(!0,{},g.label,o):null),t&&t.call&&((s=s||n({seriesName:this.name},i)).series=this,c=(a=t.call(s,s))&&!h(a)),(l||c)&&((r=this._parsePointOptions(this._preparePointOptions(a),o||g.label,i,e)).styles.useLabelCustomOptions=l,r.styles.usePointCustomOptions=c,e.updateOptions(r))},show:function(){this._visible||this._changeVisibility(!0)},hide:function(){this._visible&&this._changeVisibility(!1)},_changeVisibility:function(t){var e=this;this._visible=this._options.visible=t,this._updatePointsVisibility(),this.hidePointTooltip(),this._options.visibilityChanged(this)},_updatePointsVisibility:u,hideLabels:function(){r(this._points,(function(t,e){e._label.draw(!1)}))},_parsePointOptions:function(t,e,i,s){var r=this,o=this._options,a=this._createPointStyles(t,i,s),l=n({},t,{type:o.type,rotated:o.rotated,styles:a,widgetType:o.widgetType,visibilityChanged:o.visibilityChanged});return l.label=Y(e,a.normal.fill),this.areErrorBarsVisible()&&(l.errorBars=o.valueErrorBar),l},_preparePointOptions:function(t){var e=this._getOptionsForPoint();return t?et(e,t):e},_getMarkerGroupOptions:function(){return n(!1,{},this._getOptionsForPoint(),{hoverStyle:{},selectionStyle:{}})},_getAggregationMethod:function(t){var e=this.getOptions().aggregation,i=c(e.method),s="custom"===i&&e.calculate,n=void 0;return n=t?function(t){var e;return t.data[0]}:this._aggregators[i]||this._aggregators[this._defaultAggregator],s||n},_resample:function(t,e){var i=t.interval,s=t.ticks,n=this,r=n.argumentAxisType===A||n.valueAxisType===A,o=0,a=this._getPointDataSelector(),l=n.getOptions(),h=function(t,e,i){if(e){var s=function(e){var s=e&&a(e,l);s&&n._checkData(s)&&(s.aggregationInfo=i,t.push(s))};e.length?e.forEach(s):s(e)}},c=this._getAggregationMethod(r);if(r)return e.reduce((function(t,e,s,r){if(t[1].push(e),s===r.length-1||(s+1)%i==0){var o=t[1],a={aggregationInterval:i,data:o.map(st)};h(t[0],c(a,n)),t[1]=[]}return t}),[[],[]])[0];for(var u=[],g=1;g<s.length;g++){for(var p=s[g],_=s[g-1],d=[];e[o]&&e[o].argument<p;)e[o].argument>=_&&d.push(e[o]),o++;var f={intervalStart:_,intervalEnd:p,aggregationInterval:i,data:d.map(st)};h(u,c(f,n),f)}return n._endUpdateData(),u},canRenderCompleteHandle:function(){var t=this._canRenderCompleteHandle;return delete this._canRenderCompleteHandle,!!t},isHovered:function(){return!!(1&this.fullState)},isSelected:function(){return!!(2&this.fullState)},isVisible:function(){return this._visible},getAllPoints:function(){return this._createAllAggregatedPoints(),(this._points||[]).slice()},getPointByPos:function(t){return this._createAllAggregatedPoints(),(this._points||[])[t]},getVisiblePoints:function(){return(this._drawnPoints||[]).slice()},selectPoint:function(t){t.isSelected()||(Q(t,this._legendCallback),this._eventPipe({action:K,target:t}),this._eventTrigger("pointSelectionChanged",{target:t}))},deselectPoint:function(t){t.isSelected()&&($(t,this._legendCallback),this._eventPipe({action:Z,target:t}),this._eventTrigger("pointSelectionChanged",{target:t}))},hover:function(t){var e=this,i=this._eventTrigger;this.isHovered()||(this.lastHoverMode=c(t||this._options.hoverMode),this.fullState=this.fullState|x,this._changeStyle(this.lastHoverMode,void 0,this.isSelected()&&"none"!==this.lastSelectionMode),i("seriesHoverChanged",{target:this}))},clearHover:function(){var t=this,e=this._eventTrigger;this.isHovered()&&(this._resetNearestPoint(),this.fullState=this.fullState&~x,this._changeStyle(this.lastHoverMode,k,this.isSelected()&&"none"!==this.lastSelectionMode),e("seriesHoverChanged",{target:this}))},hoverPoint:function(t){var e=this;t.isHovered()||(t.clearHover(),q(t,this._legendCallback),this._canChangeView()&&this._applyStyle(this._styles.hover),this._eventPipe({action:R,target:t}),this._eventTrigger("pointHoverChanged",{target:t}))},clearPointHover:function(){var t=this;t.getPoints().some((function(e){return!!e.isHovered()&&(J(e,t._legendCallback),t._canChangeView()&&t._applyStyle(t._styles.normal),t._eventPipe({action:"clearPointHover",target:e}),t._eventTrigger("pointHoverChanged",{target:e}),!0)}))},showPointTooltip:function(t){j(this._extGroups.seriesGroup,"showpointtooltip",t)},hidePointTooltip:function(t){j(this._extGroups.seriesGroup,"hidepointtooltip",t)},select:function(){var t=this;this.isSelected()||(this._setSelectedState(this._options.selectionMode),this._eventPipe({action:U,target:this}),this._group.toForeground(),this._eventTrigger("seriesSelectionChanged",{target:this}))},clearSelection:function(){var t=this;this.isSelected()&&(this._releaseSelectedState(),this._eventTrigger("seriesSelectionChanged",{target:this}))},getPointsByArg:function(t,e){var i=this,s=t.valueOf(),n=this.pointsByArgument[s];return n||e||!this._createAllAggregatedPoints()||(n=this.pointsByArgument[s]),n||[]},_createAllAggregatedPoints:function(){return!(!this.useAggregation()||this._useAllAggregatedPoints)&&(this.createPoints(!0),!0)},getPointsByKeys:function(t){return this.getPointsByArg(t)},notify:function(t){var e=this,i=t.action,s=e._seriesModes,n=t.target,r=n.getOptions(),o=c(r.hoverMode),a=c(r.selectionMode);i===R?e._hoverPointHandler(n,o,t.notifyLegend):"clearPointHover"===i?e._clearPointHoverHandler(n,o,t.notifyLegend):i===U?n!==e&&"single"===s.seriesSelectionMode&&e.clearSelection():i===K?("single"===s.pointSelectionMode&&e.getPoints().some((function(t){return!(t===n||!t.isSelected())&&(e.deselectPoint(t),!0)})),e._selectPointHandler(n,a)):i===Z&&e._deselectPointHandler(n,a)},_selectPointHandler:function(t,e){var i=this;e===I?t.series===this&&this._setPointsView(V,t):"allargumentpoints"===e&&this.getPointsByKeys(t.argument,t.argumentIndex).forEach((function(e){e!==t&&e.setView(V)}))},_deselectPointHandler:function(t,e){e===I?t.series===this&&this._resetPointsView(V,t):"allargumentpoints"===e&&this.getPointsByKeys(t.argument,t.argumentIndex).forEach((function(e){e!==t&&e.resetView(V)}))},_hoverPointHandler:function(t,e,i){var s=this;t.series!==this&&"allargumentpoints"===e?(this.getPointsByKeys(t.argument,t.argumentIndex).forEach((function(t){t.setView(k)})),i&&this._legendCallback(t)):e===I&&t.series===this&&this._setPointsView(k,t)},_clearPointHoverHandler:function(t,e,i){var s=this;"allargumentpoints"===e?(t.series!==this&&this.getPointsByKeys(t.argument,t.argumentIndex).forEach((function(t){t.resetView(k)})),i&&this._legendCallback(t)):e===I&&t.series===this&&this._resetPointsView(k,t)},_deletePoints:function(){var t=this;this._disposePoints(this._points),this._points=this._drawnPoints=null},_deleteTrackers:function(){var t=this;r(this._trackers||[],(function(t,e){e.remove()})),this._trackersGroup&&this._trackersGroup.dispose(),this._trackers=this._trackersGroup=null},dispose:function(){var t=this;this._deletePoints(),this._group.dispose(),this._labelsGroup&&this._labelsGroup.dispose(),this._errorBarGroup&&this._errorBarGroup.dispose(),this._deleteTrackers(),this._group=this._extGroups=this._markersGroup=this._elementsGroup=this._bordersGroup=this._labelsGroup=this._errorBarGroup=this._graphics=this._rangeData=this._renderer=this._styles=this._options=this._pointOptions=this._drawnPoints=this.pointsByArgument=this._segments=this._prevSeries=null},correctPosition:u,drawTrackers:u,getNeighborPoint:u,areErrorBarsVisible:u,getMarginOptions:function(){return this._patchMarginOptions({percentStick:this.isFullStackedSeries()})},getColor:function(){return this.getLegendStyles().normal.fill},getOpacity:function(){return this._options.opacity},getStackName:function(){return this._stackName},getPointByCoord:function(t,e){var i=this.getNeighborPoint(t,e);return i&&i.coordsIn(t,e)?i:null},getValueAxis:function(){return this._valueAxis},getArgumentAxis:function(){return this._argumentAxis}}}

