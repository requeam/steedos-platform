function module(t,e){"use strict";var i=t("../../core/dom_adapter"),o=t("../../core/utils/window"),s=t("../../core/utils/inflector"),n=o.getWindow(),r=t("../../core/renderer"),h=t("./renderers/renderer"),l=t("../../core/utils/type"),p=t("../../core/utils/extend").extend,a=10,d=t("./utils"),c=t("../../format_helper").format,u=Math.ceil,_=Math.max,f=Math.min;function g(t){t.css({left:"-9999px"}).detach()}function m(t,e){var i=t;switch(e){case"argument":i={format:t.argumentFormat};break;case"percent":i={format:{type:"percent",precision:t.format&&t.format.percentPrecision}}}return i}function w(t){var e,i,o=this;this._eventTrigger=t.eventTrigger,this._widgetRoot=t.widgetRoot,this._wrapper=r("<div>").css({position:"absolute",overflow:"visible",height:"1px",pointerEvents:"none"}).addClass(t.cssClass),this._renderer=e=new h.Renderer({pathModified:t.pathModified,container:this._wrapper[0]}),(i=e.root).attr({"pointer-events":"none"}),this._cloud=e.path([],"area").sharp().append(i),this._shadow=e.shadowFilter(),this._textGroup=e.g().attr({align:"center"}).append(i),this._text=e.text(void 0,0,0).append(this._textGroup),this._textGroupHtml=r("<div>").css({position:"absolute",width:0,padding:0,margin:0,border:"0px solid transparent"}).appendTo(this._wrapper),this._textHtml=r("<div>").css({position:"relative",display:"inline-block",padding:0,margin:0,border:"0px solid transparent"}).appendTo(this._textGroupHtml)}w.prototype={constructor:w,dispose:function(){this._wrapper.remove(),this._renderer.dispose(),this._options=this._widgetRoot=null},_getContainer:function(){var t=this._options,e=r(this._widgetRoot).closest(t.container);return 0===e.length&&(e=r(t.container)),(e.length?e:r("body")).get(0)},setOptions:function(t){t=t||{};var e=this,i=this._cloudSettings={opacity:t.opacity,filter:this._shadow.id,"stroke-width":null,stroke:null},o=t.border||{};return this._shadowSettings=p({x:"-50%",y:"-50%",width:"200%",height:"200%"},t.shadow),this._options=t,o.visible&&p(i,{"stroke-width":o.width,stroke:o.color,"stroke-opacity":o.opacity,dashStyle:o.dashStyle}),this._textFontStyles=d.patchFontOptions(t.font),this._textFontStyles.color=t.font.color,this._wrapper.css({zIndex:t.zIndex}),this._customizeTooltip=l.isFunction(t.customizeTooltip)?t.customizeTooltip:null,this},setRendererOptions:function(t){return this._renderer.setOptions(t),this._textGroupHtml.css({direction:t.rtl?"rtl":"ltr"}),this},render:function(){var t=this;g(this._wrapper),this._cloud.attr(this._cloudSettings),this._shadow.attr(this._shadowSettings);var e={};for(var i in this._textFontStyles)e[s.camelize(i)]=this._textFontStyles[i];return this._textGroupHtml.css(e),this._textGroup.css(this._textFontStyles),this._text.css(this._textFontStyles),this._eventData=null,this},update:function(t){return this.setOptions(t).render()},_prepare:function(t,e){var i=this._options,o={};return this._customizeTooltip&&(o=this._customizeTooltip.call(t,t),"text"in(o=l.isPlainObject(o)?o:{})&&(e.text=l.isDefined(o.text)?String(o.text):""),"html"in o&&(e.html=l.isDefined(o.html)?String(o.html):"")),"text"in e||"html"in e||(e.text=t.valueText||""),e.color=o.color||i.color,e.borderColor=o.borderColor||(i.border||{}).color,e.textColor=o.fontColor||(i.font||{}).color,!!e.text||!!e.html},show:function(t,e,i){var o,s,r=this,h={},l=this._options,p=l.paddingLeftRight,a=l.paddingTopBottom,d=this._textGroupHtml,c=this._textHtml,_=this._shadowSettings,f=_.offsetX,g=_.offsetY,m=2*_.blur+1,w=n.getComputedStyle;return!!this._prepare(t,h)&&(this._state=h,h.tc={},this._wrapper.appendTo(this._getContainer()),this._cloud.attr({fill:h.color,stroke:h.borderColor}),h.html?(this._text.attr({text:""}),d.css({color:h.textColor,width:this._getCanvas().width}),c.html(h.html),w?(o=w(c.get(0)),o={x:0,y:0,width:u(parseFloat(o.width)),height:u(parseFloat(o.height))}):(o=c.get(0).getBoundingClientRect(),o={x:0,y:0,width:u(o.width?o.width:o.right-o.left),height:u(o.height?o.height:o.bottom-o.top)}),d.width(o.width),d.height(o.height)):(c.html(""),this._text.css({fill:h.textColor}).attr({text:h.text}),o=this._textGroup.css({fill:h.textColor}).getBBox()),(s=h.contentSize={x:o.x-p,y:o.y-a,width:o.width+2*p,height:o.height+2*a,lm:m-f>0?m-f:0,rm:m+f>0?m+f:0,tm:m-g>0?m-g:0,bm:m+g>0?m+g:0}).fullWidth=s.width+s.lm+s.rm,s.fullHeight=s.height+s.tm+s.bm+l.arrowLength,this.move(e.x,e.y,e.offset),this._eventData&&this._eventTrigger("tooltipHidden",this._eventData),this._eventData=i,this._eventTrigger("tooltipShown",this._eventData),!0)},hide:function(){var t=this;g(this._wrapper),this._eventData&&this._eventTrigger("tooltipHidden",this._eventData),this._eventData=null},move:function(t,e,i){i=i||0;var o=this,s=this._getCanvas(),n=this._state,r=n.tc,h=n.contentSize;this._calculatePosition(t,e,i,s)&&(this._cloud.attr({points:r.cloudPoints}).move(h.lm,h.tm),n.html?this._textGroupHtml.css({left:-h.x+h.lm,top:-h.y+h.tm+r.correction}):this._textGroup.move(-h.x+h.lm,-h.y+h.tm+r.correction),this._renderer.resize("out"===r.hp?s.fullWidth+h.lm:h.fullWidth,"out"===r.vp?s.fullHeight:h.fullHeight)),i=this._wrapper.css({left:0,top:0}).offset(),this._wrapper.css({left:r.x-i.left,top:r.y-i.top,width:"out"===r.hp?s.fullWidth+h.lm:h.fullWidth})},formatValue:function(t,e){var i=e?m(this._options,e):this._options;return c(t,i.format)},getLocation:function(){return d.normalizeEnum(this._options.location)},isEnabled:function(){return!!this._options.enabled},isShared:function(){return!!this._options.shared},_calculatePosition:function(t,e,i,o){var s,n,r,h=this,l,p=this._options.arrowLength,a=this._state,d=a.tc,c=a.contentSize,u=c.width,_=u/2,f=c.height,g=e-o.top,m=o.top+o.height-e,w=t-o.left,x=o.width+o.left-t,v=f+p+i+c.tm,T=f+p+i+c.bm,y=u+c.lm,b=u+c.rm,C=_+c.lm,H=_+c.rm,S=0,O=[6,0],R=_+10,W=_,z=_-10,D=f+p,F="center",G="bottom";return n=r=f,v>g&&T>m?G="out":v>g&&(G="top"),y>w&&b>x?F="out":C>w&&b<x?F="left":H>x&&y<w&&(F="right"),"out"===F?t=o.left:"left"===F?(R=10,W=z=0):"right"===F?(R=W=u,z=u-10,t-=u):"center"===F&&(t-=_),"out"===G?e=o.top:"top"===G?("out"!==F&&(S=p),O[0]=2,n=r=p,D=R,R=z,z=D,D=0,e+=i):e-=f+p+i,d.x=t-c.lm,d.y=e-c.tm,d.correction=S,(F!==d.hp||G!==d.vp)&&(d.hp=F,d.vp=G,s=[0,0+S,u,0+S,u,f+S,0,f+S],"out"!==F&&"out"!==G&&(O.splice(2,0,R,n,W,D,z,r),s.splice.apply(s,O)),d.cloudPoints=s,!0)},_getCanvas:function(){var t=this._getContainer(),e=t.getBoundingClientRect(),o=i.getDocumentElement(),s=i.getBody(),r=n.pageXOffset||o.scrollLeft||0,h=n.pageYOffset||o.scrollTop||0,l={left:r,top:h,width:o.clientWidth||0,height:o.clientHeight||0,fullWidth:_(s.scrollWidth,o.scrollWidth,s.offsetWidth,o.offsetWidth,s.clientWidth,o.clientWidth)-r,fullHeight:_(s.scrollHeight,o.scrollHeight,s.offsetHeight,o.offsetHeight,s.clientHeight,o.clientHeight)-h};return t!==s&&(r=_(l.left,l.left+e.left),h=_(l.top,l.top+e.top),l.width=f(l.width+l.left-r,e.width+(e.left>0?0:e.left)),l.height=f(l.height+l.top-h,e.height+(e.top>0?0:e.top)),l.fullWidth=l.width,l.fullHeight=l.height,l.left=r,l.top=h),l}},e.Tooltip=w,e.plugin={name:"tooltip",init:function(){this._initTooltip()},dispose:function(){this._disposeTooltip()},members:{_initTooltip:function(){this._tooltip=new e.Tooltip({cssClass:this._rootClassPrefix+"-tooltip",eventTrigger:this._eventTrigger,pathModified:this.option("pathModified"),widgetRoot:this.element()})},_disposeTooltip:function(){this._tooltip.dispose(),this._tooltip=null},_hideTooltip:function(){this._tooltip.hide()},_onRender:function(){this._$element.is(":visible")||this._hideTooltip()},_setTooltipRendererOptions:function(){this._tooltip.setRendererOptions(this._getRendererOptions())},_setTooltipOptions:function(){this._tooltip.update(this._getOption("tooltip"))}},customize:function(t){var e=t.prototype;e._eventsMap.onTooltipShown={name:"tooltipShown"},e._eventsMap.onTooltipHidden={name:"tooltipHidden"},t.addChange({code:"TOOLTIP_RENDERER",handler:function(){this._setTooltipRendererOptions()},isThemeDependent:!0,isOptionChange:!0}),t.addChange({code:"TOOLTIP",handler:function(){this._setTooltipOptions()},isThemeDependent:!0,isOptionChange:!0,option:"tooltip"})}}}

