function module(t,i){"use strict";var e=Math,s=e.abs,a=e.min,r=e.max,o=e.floor,n=t("../core/utils"),h=t("../../core/utils/extend").extend,l="horizontal",p="vertical",c=8,_=4,u="center",d="right",v="left",f="top",g="bottom";function x(t){return{x:t.x-c,y:t.y-_,width:t.width+2*c,height:t.height+2*_}}function y(t,i,e,s){var a=e?["x","width","y","height",i,0]:["y","height","x","width",t,1];return function(t,i,r){var o={x:r.x,y:r.y},n=x(t),h=e?r.y-t.y-t.height/2:r.y-t.y;return o.y=e||!e&&i===g?r.y+h:r.y,n[a[0]]<0?o[a[0]]-=n[a[0]]:n[a[0]]+n[a[1]]+h*a[5]>s[a[1]]&&(o[a[0]]-=n[a[0]]+n[a[1]]+h*a[5]-s[a[1]]),a[4]-n[a[3]]/2<0?o[a[2]]-=a[4]-n[a[3]]/2:a[4]+n[a[3]]/2>s[a[3]]&&(o[a[2]]-=a[4]+n[a[3]]/2-s[a[3]]),o}}function b(t,i,e,s){var a=this;this._renderer=t,this._crosshairGroup=s,this._options={},this.update(i,e)}i.getMargins=function(){return{x:c,y:_}},b.prototype={constructor:b,update:function(t,i){var e=this,s=i.canvas;this._canvas={top:s.top,bottom:s.height-s.bottom,left:s.left,right:s.width-s.right,width:s.width,height:s.height},this._axes=i.axes,this._panes=i.panes,this._prepareOptions(t,l),this._prepareOptions(t,p)},dispose:function(){var t=this;this._renderer=this._crosshairGroup=this._options=this._axes=this._canvas=this._horizontalGroup=this._verticalGroup=this._horizontal=this._vertical=this._circle=this._panes=null},_prepareOptions:function(t,i){var e=t[i+"Line"];this._options[i]={visible:e.visible,line:{stroke:e.color||t.color,"stroke-width":e.width||t.width,dashStyle:e.dashStyle||t.dashStyle,opacity:e.opacity||t.opacity,"stroke-linecap":"butt"},label:h(!0,{},t.label,e.label)}},_createLines:function(t,i,e){for(var s=[],a=this._canvas,r=[a.left,a.top,a.left,a.top],o=0;o<2;o++)s.push(this._renderer.path(r,"line").attr(t).sharp(i).append(e));return s},render:function(){var t=this,i=this._renderer,e=this._options,s=e.vertical,a=e.horizontal,r=a.visible?a.line:s.line,o={stroke:r.stroke,"stroke-width":r["stroke-width"],dashStyle:r.dashStyle,opacity:r.opacity},n=this._canvas;this._horizontal={},this._vertical={},this._circle=i.circle(n.left,n.top,0).attr(o).append(this._crosshairGroup),this._horizontalGroup=i.g().append(this._crosshairGroup),this._verticalGroup=i.g().append(this._crosshairGroup),s.visible&&(this._vertical.lines=this._createLines(s.line,"h",this._verticalGroup),this._vertical.labels=this._createLabels(this._axes[0],s,!1,this._verticalGroup)),a.visible&&(this._horizontal.lines=this._createLines(a.line,"v",this._horizontalGroup),this._horizontal.labels=this._createLabels(this._axes[1],a,!0,this._horizontalGroup)),this.hide()},_createLabels:function(t,i,e,s){var a,r,o,h,l,p=this,c=this._canvas,_=this._renderer,x=[],y=i.label;return y.visible&&t.forEach((function(t){var p,b=t.getOptions().position;t.getTranslator().getBusinessRange().isEmpty()||(l=t.getLabelsPosition(),e?(r=c.top,a=l):(a=c.left,r=l),p=b===f||b===g?u:b===d?v:d,h=_.rect(0,0,0,0).attr({fill:y.backgroundColor||i.line.stroke}).append(s),o=_.text("0",0,0).css(n.patchFontOptions(i.label.font)).attr({align:p}).append(s),x.push({text:o,background:h,axis:t,options:y,pos:{coord:l,side:b},startXY:{x:a,y:r}}))})),x},_updateText:function(t,i,e,s,a){var r=this;e.forEach((function(e){var o=e.axis,n=e.startXY,h=e.text,l=e.background,p="";o.name&&o.name!==i||(p=o.getFormattedValue(t,e.options,s)),p?(h.attr({text:p,x:n.x,y:n.y}),h.attr(a(h.getBBox(),e.pos.side,n)),r._updateLinesCanvas(e),l.attr(x(h.getBBox()))):(h.attr({text:""}),l.attr({x:0,y:0,width:0,height:0}))}))},hide:function(){this._crosshairGroup.attr({visibility:"hidden"})},_updateLinesCanvas:function(t){var i=t.pos.side,e=t.pos.coord,a=this._linesCanvas,r=this._canvas;a[i]=a[i]!==r[i]&&s(a[i]-r[i])<s(e-r[i])?a[i]:e},_updateLines:function(t,i,e,s,o){for(var n=this._linesCanvas,h=this._canvas,l=o?[[a(i-s,n.left),h.top,i-s,h.top],[i+s,h.top,r(n.right,i+s),h.top]]:[[h.left,a(n.top,e-s),h.left,e-s],[h.left,e+s,h.left,r(n.bottom,e+s)]],p=0;p<2;p++)t[p].attr({points:l[p]})},_resetLinesCanvas:function(){var t=this._canvas;this._linesCanvas={left:t.left,right:t.right,top:t.top,bottom:t.bottom}},_getClipRectForPane:function(t,i){var e,s,a=this._panes;for(e=0;e<a.length;e++)if((s=a[e].coords).left<=t&&s.right>=t&&s.top<=i&&s.bottom>=i)return a[e].clipRect;return{id:null}},show:function(t){var i=this,e=t.point,s=e.getCrosshairData(t.x,t.y),a=e.getPointRadius(),r=this._horizontal,n=this._vertical,h=a?a+3:0,l=this._canvas,p=o(s.x),c=o(s.y);p>=l.left&&p<=l.right&&c>=l.top&&c<=l.bottom?(this._crosshairGroup.attr({visibility:"visible"}),this._resetLinesCanvas(),this._circle.attr({cx:p,cy:c,r:h,"clip-path":this._getClipRectForPane(p,c).id}),r.lines&&(this._updateText(s.yValue,s.axis,r.labels,e,y(p,c,!0,l)),this._updateLines(r.lines,p,c,h,!0),this._horizontalGroup.attr({translateY:c-l.top})),n.lines&&(this._updateText(s.xValue,s.axis,n.labels,e,y(p,c,!1,l)),this._updateLines(n.lines,p,c,h,!1),this._verticalGroup.attr({translateX:p-l.left}))):this.hide()}},i.Crosshair=b}

